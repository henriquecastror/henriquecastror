{
  "hash": "fb75b3b6205160f4822eb348df441e12",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Estrat√©gia Financeira'\nsubtitle: ' **Part 7 - Ch 14 Capital Structure in a Perfect Market** '\nauthor:\n  - name: ' **Henrique C. Martins** '\n    affiliation: '**[![](../figs/background6.png){width=300px style=\"box-shadow: none;\"}](https://eaesp.fgv.br/en)**'\ndate: last-modified\ndate-format: \"DD-MM-YYYY\"\ntitle-block-banner: true\nformat:\n  revealjs:\n    body-attributes:\n      data-module: mod7\n    include-in-header: ../login-start.html\n    include-after-body:\n      - ../chat-widget.html\n      - ../threads-gate.html\n      - ../ranking-widget2.html\n      - ../notices-on-login.html\n    touch: true\n    controls: true\n    slide-number: true\n    theme: simple\n    chalkboard: false\n    menu: false\n    preview-links: auto\n    logo: ../figs/background8.png\n    css: ../logo.css\n    footer: '<span style=\"font-size:10px\"> [[Henrique C. Martins](mailto:henrique.martins@fgv.br)] [[Teaching Resources](https://henriquemartins.net/teaching/financial_strategy/)]**[Do not use without permission]**</span>'\n    scrollable: true\ntitle-slide-attributes:\n    data-background-color: \"#b1cafa\"\ninclude-after: |\n  <script>\n    // Redund√¢ncia leve: tamb√©m define o m√≥dulo via JS neste deck\n    // (o notices-on-login reconhece body[data-module], localStorage e window.VHCM.module)\n    window.VHCM = window.VHCM || {};\n    window.VHCM.module = \"mod7\";\n\n    document.addEventListener('DOMContentLoaded', () => {\n      try { localStorage.setItem('mod2','mod2'); } catch(_) {}\n    });\n\n    Reveal.on('ready', event => {\n      if (event.indexh === 0) {\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n    });\n    Reveal.addEventListener('slidechanged', (event) => {\n      if (event.indexh === 0) {\n        Reveal.configure({ slideNumber: null });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n      if (event.indexh === 1) {\n        Reveal.configure({ slideNumber: 'c' });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = null;\n      }\n    });\n  </script>\n---\n\n\n\n\n# Intro {visibility=\"hidden\"}\n\n##  { background=\"#A91B0D\"}\n\n::: {.callout-important title=\"‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses\"}\n\nThe **Virtual HCM** is powered by **AI** to assist you with course materials.  \nWhile it is trained on the course's content, **it may occasionally**:\n\n- Misinterpret the question or context.  \n- Generate **inaccurate or incomplete** information.  \n- Provide answers **not explicitly included** in the materials.\n\n**Your responsibility:**  \nAlways cross-check the answers with the book, slides, readings, and feedback provided in the course. In case you are not sure, ask the instructor.\n\nüí° *Use Virtual HCM as a **learning aid**, not as the sole source of truth.*\n\n:::\n\n##  {background-image=\"../figs/ch14.png\" background-size=\"1300px\"}\n\n\n\n\n\n## Chapter Outline {style=\"color: #000;\"}\n\n14.1 Equity Versus Debt Financing\n\n14.2 MM I: Leverage, Arbitrage, and Firm Value\n\n14.3 MM II: Leverage, Risk, and the Cost of Capital\n\n14.4 Capital Structure Fallacies\n\n14.5 MM: Beyond the Propositions\n\n\n\n\n\n\n\n\n\n# 14.1 Equity Vs. Debt Financing {.smaller background=\"#c9f7ba\"}\n\n\n## 14.1 Equity Vs. Debt Financing {.smaller background=\"#c9f7ba\"}\n\nWhen corporations raise funds from outside investors, they must choose which type of security to issue.\n\nThe most common choices are financing through equity alone and financing through a combination of **debt** and **equity**.\n\nThe relative proportions of debt, equity, and other securities that a firm has outstanding constitute its **capital structure**.\n\n. . .\n\nA central question in this chapter:\n\n**If a firm decides for a specific capital structure, does it change the investment decisions?**\n\nSimilarly,\n\n**Do capital structure decisions affect firm value?**\n\n\n. . .\n\n**For clarity:** Throughout the chapter, we will assume the firm is a portfolio of debt and equity.\n\n\n\n\n\n \n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\nLet's start our discussion by analyzing again the value of a firm.\n\nImagine an economy with two future states; firm will receive cash flows as follows:\n\n| Date 0 (investment) | Date 1 (strong economy) | Date 1 (Weak economy) |\n|---------------------|-------------------------|-----------------------|\n| -800                | 1400                    | 900                   |\n\nThe cost of capital for this project is **15%**. Each scenario has a **50%** probability of occurrence. The NPV is:\n\n$$NPV = -800 + \\frac{\\frac{1}{2} \\times 1400 + \\frac{1}{2} \\times 900 }{1.15} = 200$$\n\n$$PV(CF) = \\frac{1150}{1.15} = 1000$$\n\n. . .\n\nSo the firm value today is **\\$1000**. If the firm wants to finance the project all-equity, it could raise this amount selling equity. In this case, the firm is **unlevered equity**.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\nThe expected return on the unlevered equity is 15%.\n\n| Date 0 (investment) | Date 1 (strong economy) | Date 1 (Weak economy) |\n|---------------------|-------------------------|-----------------------|\n| 1000                | 1400                    | 900                   |\n| Return              | +40%                    | -10%                  |\n\n$$\\frac{1}{2} \\times 40\\% + \\frac{1}{2} \\times -10\\% = 15\\%$$\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\nLet's now analyse the case where the firm issues 500 of debt and 500 of equity. This firm is **levered equity**. The debt cost is **5%**. **Do the NPV and the firm value change?**\n\n. . .\n\nBecause the firm needs to pay debt holders no matter the state of the economy, we can say that **Debt value in Date 1 is 525 (**$500 \\times 1.05$).\n\n. . .\n\nBecause we know the firm value in each state of the economy, we can say that the difference between the firm value and the debt value is the equity value: $V - D = E$, i.e. $1400 - 525 = 875$ or $900 - 525 = 375$.\n\n. . .\n\nThen, we can write:\n\n| Source     | Date 0 (investment) | Date 1 (strong economy) | Date 1 (Weak economy) |\n|------------|---------------------|-------------------------|-----------------------|\n| Debt (D)   | 500                 | 525                     | 525                   |\n| Equity (E) | ?                   | 875                     | 375                   |\n| Firm (V)   | 1000                | 1400                    | 900                   |\n\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\n**Wait, but if debt cost is only 5%, why the firm value still is 1.000? Shouldn't the value of equity increase?**\n\n. . .\n\nThe answer is that **the cost of equity increases for levered equity.** Let's see how.\n\n. . .\n\n| Source     | Date 0 (investment) | Date 1 (strong) | Date 1 (Weak) | Return 1 (strong) | Return 1 (Weak) |\n|------------|---------------------|-----------------|---------------|-------------------|-----------------|\n| D   | 500                 | 525             | 525           | 5%                | 5%              |\n| E | 500                 | 875             | 375           | 75%               | -25%            |\n| V   | 1000                | 1400            | 900           | 40%               | -10%            |\n\n**Unlevered equity** has returns of 40% or -10%. On average, 15%.\n\n**Debt** has return of 5% no matter what.\n\n**Levered equity** has returns of 75% ($\\frac{875}{500}-1$) or -25% ($\\frac{375}{500}-1$). On average, 25%.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\nThe takeaway:\n\n**Levered equity is riskier, so the cost of capital is higher.**\n\n| Source           | Return sensitivity (systematic risk) | Risk premium   |\n|------------------|--------------------------------------|----------------|\n| Debt             | 5% - 5% = 0%                         | 5% - 5% = 0%   |\n| Unlevered Equity | 40% - (-10%) = 50%                   | 15% - 5% = 10% |\n| Levered Equity   | 75% - (-25%) = 100%                  | 25% - 5% = 20% |\n\n**Because the debt's return bears no systematic risk, its risk premium is zero.**\n\n**In this particular case, the levered equity has twice the systematic risk of the unlevered equity and, as a result, has twice the risk premium.**\n\n. . .\n\n**Modigliani and Miller argued that with perfect capital markets, the total value of a firm should not depend on its capital structure.**\n\n-   They reasoned that the firm's total cash flows still equal the cash flows of the project and, therefore, have the same present value.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\nIn summary\n\n-   In the case of perfect capital markets, if the firm is 100% equity financed, the equity holders will require a 15% expected return.\n-   If the firm is financed 50% with debt and 50% with equity, the debt holders will receive a return of 5%, while the levered equity holders will require an expected return of 25% (because of increased risk).\n-   Leverage increases the risk of equity even when there is no risk that the firm will default.\n    -   Thus, while debt may be cheaper, its use raises the cost of capital for equity. **Considering both sources of capital together, the firm's average cost of capital with leverage is the same as for the unlevered firm.**\n\n\n\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\n**Problem**\n\nUsing the same values as before, suppose the firm borrows **\\$700** when financing the project.\n\nAccording to Modigliani and Miller, **what should the value of the equity be? What is the expected return?**\n\n. . .\n\nBecause the value of the firm's total cash flows is still 1000, if the firm borrows 700, **its equity will be worth 300**.\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\nThe firm will owe 700 √ó 1.05 = 735 in one year to debt holders. Thus,\n\n-   if the economy is strong, equity holders will receive $1400 ‚àí 735 = 665$, for a return of $\\frac{665}{300}-1 = 121.67\\%$.\n-   if the economy is weak, equity holders will receive $900 ‚àí 735 = 165$, for a return of $\\frac{165}{300}-1 = -45\\%$.\n\n. . .\n\nExpected return is:\n\n$$\\frac{1}{2} \\times 121.67\\% + \\frac{1}{2} \\times -45\\% = 38.33\\%$$\n\n. . .\n\nNote that the equity has a return sensitivity of 121.67% ‚àí (‚àí45.0%) = 166.67%.\n\nIts risk premium is 38.33% ‚àí 5% = 33.33%.\n\n\n\n\n\n\n\n## 14.1 Equity Vs.  Debt Financing {.smaller background=\"#c9f7ba\"}\n\n| Source | Date 0 | Date 1 (strong) | Date 1 (Weak) | Ret. 1 (strong) | Ret. 1 (Weak) | Syst. risk           | Risk premium   |\n|--------|--------|-----------------|---------------|-----------------|---------------|----------------------|----------------|\n| Debt   | 700    | 735             | 735           | 5%              | 5%            | 5% - 5% = 0%         | 5% - 5% = 0%   |\n| Equity | 300    | 665             | 165           | 122%            | -45%          | 122% - (-45%) = 167% | 38% - 5% = 33% |\n| Firm   | 1000   | 1400            | 900           | 40%             | -10%          | 75% - (-25%) = 100%  | 25% - 5% = 20% |\n\n. . .\n\n**So, debt increases equity risk.**\n\n\n\n\n\n\n\n\n# 14.2 MM I {.smaller background=\"#f2f5ce\"} \n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"} \n\nIn this subsection, we will explore further the MM propositions and the theory of capital structure.\n\nFirst, we will understand what **Homemade Leverage** means.\n\n- Let's say the firm selects a given capital structure. The investor likes an alternative capital structure. \n- MM demonstrated that if investors would prefer an alternative capital structure to the one the firm has chosen, **investors can borrow or lend on their own and achieve the same result.**\n\n\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"}\n\n**Assume the firm is an all‚àíequity firm**. **An investor who would prefer to hold levered equity** can do so by **using leverage in his own portfolio**.\n\n-   An investor who would like more leverage than the firm has chosen can borrow (let's say 500) and add leverage to his or her own portfolio (500 personal + 500 debt).\n-   The investor borrows 500 and buys the firm's stock.\n\n| Source                             | Date 0 | Date 1 (strong economy) | Date 1 (Weak economy) |\n|------------------------------------|--------|-------------------------|-----------------------|\n| Unlevered equity (firm)            | 1000   | 1400                    | 900                   |\n| Margin loan (Investor borrowing)   | -500   | -525                    | -525                  |\n| Levered equity (Investor's return) | 500    | 875                     | 375                   |\n\n\n\n\n\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"}\n\nIf the cash flows of the unlevered equity serve as collateral for the margin loan (at the risk‚àífree rate of 5%), then **by using homemade leverage, the investor has *replicated* the payoffs to the levered equity**.\n\n-   As long as investors can borrow or lend at the same interest rate as the firm, homemade leverage is a perfect substitute for the use of leverage by the firm.\n\n\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"}\n\n**Now assume the firm uses debt, but the investor would prefer to hold unlevered equity.**\n\nThe **investor can replicate** the payoffs of unlevered equity by **buying both the debt and the equity of the firm.**\n\nCombining the cash flows of the two securities produces cash flows identical to unlevered equity, for a total cost of \\$1000.\n\n| Source                              | Date 0 | Date 1 (strong economy) | Date 1 (Weak economy) |\n|-------------------------------------|--------|-------------------------|-----------------------|\n| Debt (Investor's lending)           | 500    | 525                     | 525                   |\n| Levered equity (the firm)           | 500    | 875                     | 375                   |\n| Unlevered equity (Investor's return) | 1000   | 1400                    | 900                   |\n\n\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"}\n\n**Homemade leverage**\n\nIn each case, the firm's choice of capital structure does not affect the opportunities available to investors.\n\n-   **Investors can alter the leverage choice of the firm to suit their personal tastes either by adding more leverage or by reducing leverage.**\n\n-   **With perfect capital markets, different choices of capital structure offer no benefit to investors and does not affect the value of the firm.**\n\n\n\n\n\n\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"}\n\nIn summary,\n\n-   Modigliani and Miller (or simply MM) showed that **leverage would not affect the total value of the firm**.\n\n-   This result holds more generally under a set of conditions referred to as **perfect capital markets**:\n\n    -   Investors and firms can trade the same set of securities at competitive market prices equal to the present value of their future cash flows.\n    -   There are no taxes, transaction costs, or issuance costs associated with security trading.\n    -   A firm's financing decisions do not change the cash flows generated by its investments, nor do they reveal new information about them.\n\nUnder these conditions, MM demonstrated the following result regarding the role of capital structure in determining firm value:\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\"}\n\n**MM Proposition I: In a perfect capital market, the total value of a firm's securities is equal to the market value of the total cash flows generated by its assets and is not affected by its choice of capital structure.**\n\n. . .\n\nIn the absence of taxes or other transaction costs, the total cash flow paid out to all of a firm's security holders is equal to the total cash flow generated by the firm's assets.\n\n\n\n\n\n\n\n\n\n## 14.2 MM I {.smaller background=\"#f2f5ce\" visibility=\"hidden\"}\n\n**Example of MM I: Leveraged Recapitalization**\n\n-   It is a transaction in which the firm issues debt and uses the proceeds to buy its own shares.\n\n![](../figs/bm_14_9.png)\n\n\n\n\n\n\n# 14.3 MM II {.smaller background=\"#ced8f5\"}\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\nModigliani and Miller showed that a firm's financing choice does not affect its value. But how can we reconcile this conclusion with the fact that the cost of capital differs for different securities?\n\nWe will now discuss the second proposition of MM.\n\n\n\n\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\n**MM's first proposition can be used to derive an explicit relationship between leverage and the equity cost of capital.** Let's denote:\n\n-   E = Market value of equity in a levered firm\n-   D = Market value of debt in a levered firm\n-   U = Market value of equity in an unlevered firm\n-   A = Market value of the firm's assets\n\nMMI states that:\n\n$$E+D = U = A$$\n\nThat is, **the total market value of the firm's securities is equal to the market value of its assets, whether the firm is unlevered or levered**.\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\nAlso, remember that the return of a portfolio is the weighted average of the returns.\n\nSo, we can write that **the return on unlevered equity (**$R_u$) is related to the returns of levered equity ($R_e$) and debt ($R_d$):\n\n$$R_u = \\frac{E}{E+D} \\times R_e + \\frac{D}{E+D} \\times R_d$$ Solving for $R_e$:\n\n$$R_e = R_u + \\frac{D}{E} \\times (R_u - R_d)$$\n\nThat is, **the levered equity return equals the unlevered return, plus a premium due to leverage**. The amount of the premium depends on the amount of leverage, measured by the firm's market value debt‚àíequity ratio.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\n**Proposition II: The cost of capital of levered equity is equal to the cost of capital of unlevered equity plus a premium that is proportional to the market value debt‚àíequity ratio.**\n\n. . .\n\nUsing the previous example's numbers:\n\n-   the expected return on unlevered equity is 15%\n-   the expected return of the debt is 5%.\n-   the expected return on equity for the levered firm is 25%\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\n**Problem**\n\nSuppose the entrepreneur borrows only \\$700 when financing the project. Recall that the expected return on unlevered equity is 15% and the risk‚àífree rate is 5%. **According to MM Proposition II, what will be the firm's equity cost of capital?**\n\n. . .\n\n$$R_e = R_u + \\frac{D}{E} \\times (R_u - R_d) = 15\\% + \\frac{700}{300} \\times (15\\%-5\\%) = 38.33\\%$$\n\nExactly the same cost we found before.\n\n\n\n\n\n##  { background=\"#f7f9fc\"}\n\n<div data-ticket\n     data-bridge=\"https://course-chat.hcmrtns.workers.dev/checkouts\"\n     data-session=\"module7_checkout1\"\n     data-page=\"module7_checkout1\"\n     data-require-login=\"true\"\n     data-open=\"2025-10-27 16:30\"\n     data-close=\"2025-10-27 16:59\">\n</div>\n\n<!-- checkout2.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) -->\n<style>\n  /* ===== Tokens (light) ‚Äî exit-checkout colors ===== */\n  :root{\n    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);\n    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;\n    --focus:rgba(59,130,246,.22);\n    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;\n    --textarea-bg:#fff;\n\n    /* ribbon colors by state */\n    --ribbon-open-1: rgba(34,197,94,.18);   /* green */\n    --ribbon-open-2: rgba(16,185,129,.16);\n    --ribbon-soon-1: rgba(245,158,11,.18);  /* amber */\n    --ribbon-soon-2: rgba(251,191,36,.16);\n    --ribbon-closed-1: rgba(239,68,68,.20); /* red */\n    --ribbon-closed-2: rgba(248,113,113,.16);\n    --ribbon-default-1: rgba(99,102,241,.14); /* blue (fallback) */\n    --ribbon-default-2: rgba(96,165,250,.14);\n  }\n  @media (prefers-color-scheme: dark){\n    :root{\n      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);\n      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);\n      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;\n      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;\n      --textarea-bg:rgba(2,6,23,.55);\n    }\n  }\n\n  /* Card */\n  [data-ticket] .tw-card{\n    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;\n    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);\n    color:var(--ink);overflow:hidden;box-sizing:border-box;\n  }\n  [data-ticket] .tw-card::before{\n    content:\"\";position:absolute;inset:0 0 auto 0;height:56px;\n    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));\n    pointer-events:none;\n  }\n  /* ribbon by state */\n  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }\n  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }\n  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }\n\n  /* Header */\n  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}\n  [data-ticket] .tw-icon{\n    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;\n    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;\n  }\n  [data-ticket] .tw-icon::after{\n    content:\"\";position:absolute;inset:-3px;border-radius:14px;\n    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));\n    z-index:-1;filter:blur(6px);opacity:.55;\n  }\n  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}\n  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}\n  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}\n  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}\n\n  /* Badges */\n  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}\n  [data-ticket] .tw-badge{\n    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;\n    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;\n  }\n  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{\n    color:currentColor;stroke:currentColor!important;fill:none;\n  }\n  [data-ticket] .tw-window-text{white-space:pre-line;}\n\n  /* Status dot */\n  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}\n  [data-ticket].open  .tw-dot{background:#16a34a;}\n  [data-ticket].soon  .tw-dot{background:#f59e0b;}\n  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}\n\n  /* Textarea */\n  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}\n  [data-ticket] textarea.tw-text{\n    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;\n    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;\n    resize:vertical;color:var(--ink);box-sizing:border-box;\n  }\n  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}\n  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}\n\n  /* Footer & messages */\n  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;}\n  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}\n  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}\n  [data-ticket] .tw-msg.success{color:#059669!important;}\n  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}\n  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}\n  /* match dot color if no explicit class was set */\n  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}\n  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}\n  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}\n\n  /* Button */\n  [data-ticket] .tw-btn{\n    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);\n    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;\n    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;\n  }\n  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}\n  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}\n  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}\n  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}\n\n  /* Spinner */\n  [data-ticket] .spin:after{\n    content:\"\";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);\n    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;\n  }\n  @keyframes twspin{to{transform:rotate(360deg)}}\n\n  /* Mini-login */\n  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}\n  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}\n\n  /* Responsive */\n  @media (max-width:640px){\n    [data-ticket] .tw-card{border-radius:14px;padding:14px;}\n    [data-ticket] .tw-header{gap:10px;}\n    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}\n  }\n</style>\n\n<script>\n(() => {\n  const $ = (sel, el=document) => el.querySelector(sel);\n\n  function mountAll(){\n    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);\n  }\n\n  function initOne(host){\n    host.setAttribute('data-tw-mounted','1');\n\n    // ---- Config/attrs\n    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();\n    const sessionTag = (host.getAttribute('data-session') || '').trim();\n    const pageAttr   = (host.getAttribute('data-page') || '').trim();\n    const winStartStr= (host.getAttribute('data-open') || '').trim();\n    const winEndStr  = (host.getAttribute('data-close') || '').trim();\n    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';\n\n    // ---- Helpers\n    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;\n    const winStart = parseLocal(winStartStr);\n    const winEnd   = parseLocal(winEndStr);\n\n    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };\n    function statusNow(){\n      const now = new Date();\n      if (!winStart || !winEnd) return {state:'open', label:'Always available'};\n      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }\n      if (now > winEnd)   return {state:'closed', label:'Closed'};\n      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};\n    }\n    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();\n    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);\n\n    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };\n    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;\n    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };\n    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };\n\n    // ---- UI skeleton\n    host.innerHTML = '';\n    const card = document.createElement('div'); card.className = 'tw-card';\n    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\\n‚Üí ' + winEndStr) : 'No window set';\n    card.innerHTML = `\n      <div class=\"tw-header\">\n        <div class=\"tw-icon\" aria-hidden=\"true\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>\n        </div>\n        <div class=\"tw-titles\">\n          <div class=\"tw-title\">Check-out</div>\n          <div class=\"tw-sub\"></div>\n        </div>\n        <div class=\"tw-meta\">\n          <div class=\"tw-badge\"><span class=\"tw-dot\"></span><span class=\"tw-badge-text\">‚Äî</span></div>\n          <div class=\"tw-badge\" title=\"S√£o Paulo time\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"opacity:.8\"><path d=\"M12 7v5l4 2\" stroke=\"#334155\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#334155\" stroke-width=\"1.5\" fill=\"none\"/></svg>\n            <span class=\"tw-window-text\">${windowLabel}</span>\n          </div>\n        </div>\n      </div>\n      <div class=\"tw-login\" style=\"display:none\">\n        <input type=\"text\" class=\"tw-login-input\" placeholder=\"Digite seu ID / e-mail do curso\"/>\n        <button type=\"button\" class=\"tw-btn tw-login-btn\">Entrar</button>\n      </div>\n      <div class=\"tw-body\"></div>\n      <div class=\"tw-footer\">\n        <button type=\"button\" class=\"tw-btn tw-send\">Send (click only 1x)</button>\n        <div class=\"tw-count\">0/500</div>\n      </div>\n      <div class=\"tw-msg\"></div>`;\n    host.appendChild(card);\n\n    // refs\n    const body = $('.tw-body', card);\n    const btn  = $('.tw-send', card);\n    const msg  = $('.tw-msg', card);\n    const badgeText = $('.tw-badge-text', card);\n    const count = $('.tw-count', card);\n    const loginRow = $('.tw-login', card);\n    const loginInp = $('.tw-login-input', card);\n    const loginBtn = $('.tw-login-btn', card);\n\n    // textarea\n    const ta = document.createElement('textarea');\n    ta.className = 'tw-text'; ta.maxLength = 500;\n    ta.placeholder = 'Your check-out (max 500): one thing you learned + one question‚Ä¶';\n    body.appendChild(ta);\n    ta.addEventListener('input', () => { count.textContent = `${ta.value.length}/500`; syncEnabled(); });\n    count.textContent = '0/500';\n\n    const successMsg = 'Check-out recorded. Thank you!';\n    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';\n\n    function paintBadge(){\n      const st = statusNow();\n      host.classList.remove('open','soon','closed'); host.classList.add(st.state);\n      badgeText.textContent = st.label;\n    }\n\n    function showLoginIfNeeded(){\n      const need = requireLogin && !getStudentId();\n      loginRow.style.display = need ? 'flex' : 'none';\n    }\n\n    function syncEnabled(){\n      const logged = !requireLogin || !!getStudentId();\n      const st     = statusNow().state;\n      const filled = ta.value.trim().length>0;\n      const enabled= logged && (st==='open') && filled && !isDone();\n      btn.disabled = !enabled;\n\n      showLoginIfNeeded(); paintBadge();\n\n      if (isDone()){\n        setMsg(msg, dupMsg, 'success');\n        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;\n      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');\n      else if (st==='soon') setMsg(msg,'Not open yet.','warning');\n      else if (st==='closed') setMsg(msg,'This activity is closed.','error');\n      else if (!filled) setMsg(msg,'Write something to submit.','warning');\n      else setMsg(msg,''); // ready\n    }\n\n    // mini-login\n    loginBtn?.addEventListener('click', () => {\n      const v = (loginInp.value || '').trim();\n      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }\n      try { localStorage.setItem('studentId', v); } catch {}\n      window.studentId = v;\n      document.dispatchEvent(new Event('auth:login'));\n      setMsg(msg,''); syncEnabled();\n    });\n\n    // timers + cleanup\n    paintBadge(); syncEnabled();\n    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);\n    const obs = new MutationObserver(() => {\n      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }\n    });\n    obs.observe(document.body, {childList:true, subtree:true});\n    document.addEventListener('auth:login', syncEnabled);\n\n    // Submit\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault(); e.stopPropagation();\n\n      const sid = getStudentId();\n      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }\n      const text = ta.value.trim().slice(0,500);\n      if (!text){ setMsg(msg,'Write something to submit.','warning'); return; }\n      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }\n\n      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');\n\n      const payload = {\n        student_id: sid,                 // ‚Üê alinha com D1\n        slide_id: (sessionTag || getPageId()),\n        ticket: text,\n        tsClient: new Date().toISOString(),\n        open:  winStartStr,\n        close: winEndStr,\n        user_agent: navigator.userAgent\n      };\n\n      try{\n        const res = await fetch(bridge, {\n          method:'POST',\n          headers:{ 'Content-Type':'application/json' },\n          body: JSON.stringify(payload),\n          keepalive:true\n        });\n\n        const raw = await res.text();\n        let data = null; try{ data = JSON.parse(raw); }catch(_){}\n\n        if (!res.ok){\n          if (data && data.status === 'closed_window'){\n            setMsg(msg,'This activity is closed now.','error');\n          } else {\n            setMsg(msg,'Failed to submit. Please try again.','error');\n          }\n          console.error('[checkout2] HTTP error:', res.status, raw);\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        if (data && data.status === 'success'){\n          setMsg(msg, successMsg, 'success');\n          ta.value=''; count.textContent='0/500';\n          markDone(btn); clearInterval(ticker);\n          return;\n        }\n        if (data && data.status === 'duplicate'){\n          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;\n        }\n        if (data && data.status === 'closed_window'){\n          setMsg(msg,'This activity is closed now.','error');\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        setMsg(msg,'Failed to submit. Please try again.','error');\n        console.error('[checkout2] unexpected response:', raw);\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }catch(err){\n        console.error('[checkout2] submit error:', err);\n        setMsg(msg,'Network error. Please try again.','error');\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }\n    });\n  }\n\n  if (document.readyState === 'loading'){\n    document.addEventListener('DOMContentLoaded', mountAll, { once:true });\n  } else {\n    mountAll();\n  }\n})();\n</script>\n\n\n\n\n\n\n\n\n\n## 14.3 Capital Budgeting &  WACC {.smaller background=\"#ced8f5\"}\n\n\nWe can use the insight of Modigliani and Miller to understand the effect of leverage on the firm's cost of capital for new investments.\n\n**If a firm is unlevered, all of the free cash flows generated by its assets are paid out to its equity holders.**\n\n-   The market value, risk, and cost of capital for the firm's assets and its equity coincide and therefore\n\n$$R_u = R_a$$\n\n. . .\n\nIf a firm is levered, project $R_A$ is equal to the firm's weighted average cost of capital.\n\n$$R_{wacc} = R_u = R_a$$\n\n**That is, with perfect capital markets, a firm's WACC is independent of its capital structure and is equal to its equity cost of capital if it is unlevered, which matches the cost of capital of its assets.**\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\nAssuming taxes do not exist:\n\n![](../figs/berk_demarzo_debt_value1.jpg)\n\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\nThe takeaway:\n\n**Although debt has a lower cost of capital than equity, leverage does not lower a firm's WACC. As a result, the value of the firm's free cash flow evaluated using the WACC does not change, and so the enterprise value of the firm does not depend on its financing choices.**\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\n**Problem**\n\nHoneywell International Inc. (HON) has a market debt‚àíequity ratio of 0.5.\n\nAssume its current debt cost of capital is 6.5%, and its equity cost of capital is 14%.\n\nIf HON issues equity and uses the proceeds to repay its debt and reduce its debt‚àíequity ratio to 0.4, it will lower its debt cost of capital to 5.75%.\n\nWith perfect capital markets, what effect will this transaction have on HON's equity cost of capital and WACC?\n\n\n\n\n\n\n## 14.3 MM II {.smaller background=\"#ced8f5\"}\n\nCurrent WACC\n\n$$R_{wacc} = \\frac{E}{E+D} \\times R_e + \\frac{D}{E+D} \\times R_d = \\frac{2}{2+1} \\times 14 + \\frac{1}{2+1} \\times 6.5 = 11.5\\%$$\n\nNew Cost of Equity:\n\n$$R_e = R_u + \\frac{D}{E} (R_u - R_a) = 11.5 +0.4 \\times (11.5 - 5.75) = 13.8\\%$$\n\n\"New\" WACC:\n\n$$R_{wacc_{new}} = \\frac{1}{1+0.4} \\times 13.8 + \\frac{0.4}{1+0.4} \\times 5.75 = 11.5\\%$$\n\n\n\n\n\n\n# Multiple Securities {.smaller background=\"#f5d5d5\" visibility=\"hidden\"}\n\n\n\n\n## Multiple Securities {.smaller background=\"#f5d5d5\"}\n\nIf the firm's capital structure is made up of multiple securities, then the WACC is calculated by computing the weighted average cost of capital of all of the firm's securities.\n\nLet's say the firm has Equity (E), Debt (D), Warrant (W) issued:\n\n$$R_{wacc}  = R_u = R_e \\times \\frac{E}{E+D+W} + R_d \\times \\frac{D}{E+D+W} + R_w \\times \\frac{W}{E+D+W} $$\n\n\n\n\n\n\n## Levered and unlevered Betas {.smaller background=\"#f5d5d5\"}\n\nRemember that\n\n$$\\beta_u = \\frac{E}{D+E} \\times \\beta_e + \\frac{D}{D+E} \\times \\beta_d$$\n\nWhen a firm changes its capital structure without changing its investments, its unlevered beta will remain unaltered. However, **its equity beta will change to reflect the effect of the capital structure change on its risk**.\n\n$$\\beta_e = \\beta_u + \\frac{D}{E} (\\beta_u - \\beta_d)$$\n\nObs \n\n- Unlevered Beta: A measure of the risk of a firm as if it did not have leverage, which is equivalent to the beta of the firm's assets.\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Levered and unlevered Betas {.smaller background=\"#f5d5d5\"}\n\n**Problem**\n\nIn August 2018, Reenor had a market capitalization of **140 billion**. It had debt of **25.4** billion as well as cash and short‚àíterm investments of **60.4** billion. Its equity beta was **1.09** and its debt beta was approximately **zero**. What was Reenor's enterprise value at time? Given a risk‚àífree rate of **2%** and a market risk premium of **5%**, estimate the unlevered cost of capital of Reenor's business.\n\n. . .\n\nReenor's net debt = 25.4 ‚àí 60.4 billion = ‚àí35.0 billion. Enterprise value 140 billion ‚àí 35billion = 105 billion.\n\n$$\\beta_u = \\frac{E}{E+D} \\times \\beta_e + \\frac{D}{E+D} \\times \\beta_d = \\frac{140}{105} \\times 1.09 + \\frac{-35}{105} \\times 0 = 1.45$$ Unlevered cost of capital:\n\n$$R_u = 2\\% + 1.45 \\times 5\\% = 9.25\\%$$\n\n\n\n\n\n\n\n\n\n  \n\n##  {.smaller  background=\"#FFFFFF\"}\n\n::: {style=\"font-size: 40%; text-align: right;\"}\nKey: *module7_num_qu1*\n<input type=\"hidden\" \n       id=\"slide-id\" \n       value=\"module7_num_qu1\"\n       data-open=\"2025-10-29 15:30\"\n       data-close=\"2025-10-29 16:59\">\n:::\n\n<!-- submit-to-sheets2.html ‚Äî Exercises ‚Üí Cloudflare Worker (/exercises) -->\n<style>\n  :root{\n    --card-bg:#b6c2d9; --card-fg:#0b1220;\n    --pill-bg:rgba(15,23,42,.16); --pill-bd:rgba(15,23,42,.30);\n    --input-bg:#edf3fa; --input-bd:#c7d2e3; --divider:#cbd7e6;\n    --ok:#16a34a; --warn:#f59e0b; --err:#ff4d4f;\n    --btn1:#1992d4; --btn2:#0ea5e9; --btn1-off:#93c5fd; --btn2-off:#bae6fd;\n    --shadow:0 12px 28px rgba(2,6,23,.14);\n    --msg-size:1.02rem;\n  }\n  @media (prefers-color-scheme: dark){\n    :root{\n      --card-bg:#192233; --card-fg:#eaf2ff;\n      --pill-bg:rgba(255,255,255,.10); --pill-bd:rgba(255,255,255,.24);\n      --input-bg:#0f172a; --input-bd:#263043; --divider:rgba(148,163,184,.28);\n      --shadow:0 18px 42px rgba(0,0,0,.55);\n    }\n  }\n\n  .exw-card{\n    margin:8px 0 12px; padding:12px 14px;\n    background:var(--card-bg); color:var(--card-fg);\n    border:1px solid var(--divider); border-radius:16px; box-shadow:var(--shadow);\n    display:flex; align-items:center; gap:10px; flex-wrap:wrap;\n  }\n  .exw-title{ font-weight:800; font-size:1.06rem; letter-spacing:.2px; }\n  .exw-dot{ width:9px; height:9px; border-radius:50%; background:#94a3b8; }\n  .exw.open  .exw-dot{ background:var(--ok); }\n  .exw.soon  .exw-dot{ background:var(--warn); }\n  .exw.closed .exw-dot{ background:var(--err); }\n\n  .exw-pill{\n    margin-left:auto; display:inline-flex; align-items:center; gap:8px;\n    padding:6px 12px; border-radius:999px; background:var(--pill-bg);\n    border:1px solid var(--pill-bd); font-size:.92rem; white-space:nowrap;\n  }\n\n  .exw-msg{ width:100%; margin-top:2px; font-weight:800; font-size:var(--msg-size); }\n  .exw.open  .exw-msg{ color:var(--ok); }\n  .exw.soon  .exw-msg{ color:var(--warn); }\n  .exw.closed .exw-msg{ color:var(--err); }\n\n  /* Student ID compacto (altura menor) */\n  .sid-inline{\n    width:100%; margin-top:8px; padding-top:6px;\n    border-top:1px solid var(--pill-bd);\n    display:flex; align-items:center; gap:10px;\n  }\n  .sid-inline label{ font-weight:800; color:var(--card-fg); opacity:.95; }\n  .sid-inline .ex-sid{\n    background:var(--input-bg); color:var(--card-fg);\n    border:1px solid var(--input-bd); border-radius:10px;\n    padding:6px 10px; min-width:260px; outline:none;\n  }\n  .sid-inline .ex-sid::placeholder{ color:rgba(100,116,139,.9); }\n\n  .row-actions{ display:flex; gap:10px; margin:6px 0 12px; flex-wrap:wrap; }\n  .ex-btn{\n    border:none; border-radius:12px; padding:10px 16px; color:#fff; font-weight:800; cursor:pointer;\n    box-shadow:0 8px 20px rgba(30,58,138,.25); transition:filter .15s, transform .06s, opacity .15s;\n  }\n  .ex-btn.primary{ background:linear-gradient(135deg, var(--btn1), var(--btn2)); }\n  .ex-btn.primary:hover{ transform:translateY(-1px); filter:saturate(110%); }\n  .ex-btn.secondary{ background:linear-gradient(135deg, var(--btn2), #38bdf8); }\n  .ex-btn.secondary:hover{ transform:translateY(-1px); filter:saturate(110%); }\n  .ex-btn:disabled{\n    cursor:not-allowed; transform:none; filter:none;\n    background:linear-gradient(135deg, var(--btn1-off), var(--btn2-off));\n    color:#234; opacity:.95; box-shadow:none;\n  }\n\n  .feedback[data-status=\"correct\"]{ color:#16a34a; }\n  .feedback[data-status=\"incorrect\"]{ color:#ff4d4f; }\n</style>\n\n<div class=\"exw-card exw\" id=\"exw-card\" aria-live=\"polite\">\n  <span class=\"exw-dot\" aria-hidden=\"true\"></span>\n  <div class=\"exw-title\">Submit your answers</div>\n\n  <div class=\"exw-pill\"><span id=\"exw-pill-text\">Loading‚Ä¶</span></div>\n  <div class=\"exw-msg\" id=\"exw-msg\">‚Äî</div>\n\n  <!-- Placeholder: o JS cria label+input aqui para n√£o serem escapados -->\n  <div class=\"sid-inline\" id=\"sid-inline\"></div>\n</div>\n\n<div class=\"row-actions\">\n  <button id=\"submit-btn\" class=\"ex-btn primary\">Submit</button>\n  <button id=\"download-btn\" class=\"ex-btn primary\" disabled>üìÑ Download My Answers (TXT)</button>\n  <button id=\"toggle-feedback-btn\" class=\"ex-btn secondary\" disabled>Show Feedback</button>\n</div>\n\n<script>\nwindow.COURSE_WORKER = window.COURSE_WORKER || \"https://course-chat.hcmrtns.workers.dev\";\nwindow.EXW_USE_ALERT = true;\n\n(function(){\n  try{\n    var script = document.currentScript;\n    var slide  = script ? (script.closest('section') || script.parentElement || document.body) : document.body;\n    var ENDPOINT = String(window.COURSE_WORKER || \"\").replace(/\\/$/,'') + \"/exercises\";\n    var TZ_LABEL = \"S√£o Paulo time\";\n\n    function $(sel, root){ return (root||document).querySelector(sel); }\n    function $$(sel, root){ return Array.prototype.slice.call((root||document).querySelectorAll(sel)); }\n    function trim(s){ return (s==null?'':String(s)).trim(); }\n\n    // monta o campo de ID via DOM (evita HTML escapado pelo builder)\n    function mountSID(){\n      var mount = $('#sid-inline', slide);\n      if (!mount || mount.__mounted) return;\n      mount.__mounted = true;\n\n      var label = document.createElement('label');\n      label.setAttribute('for','student-id');\n      label.textContent = 'Student ID:';\n\n      var input = document.createElement('input');\n      input.type = 'text';\n      input.id = 'student-id';\n      input.className = 'ex-sid';\n      input.placeholder = 'Enter your ID';\n\n      mount.appendChild(label);\n      mount.appendChild(input);\n    }\n    mountSID();\n\n    var sidInput = $('#student-id', slide);\n    var btnSubmit= $('#submit-btn', slide);\n    var btnDown  = $('#download-btn', slide);\n    var btnFB    = $('#toggle-feedback-btn', slide);\n    var card     = $('#exw-card', slide);\n    var pillText = $('#exw-pill-text', slide);\n    var msgEl    = $('#exw-msg', slide);\n\n    function getIds(){\n      // garante que pegamos o input mesmo se montado depois\n      sidInput = sidInput || $('#student-id', slide);\n      var sid = trim(window.studentId || localStorage.getItem('studentId') || sessionStorage.getItem('studentId') || (sidInput && sidInput.value) || '');\n      var el  = $('#slide-id', slide) || $('input#slide-id');\n      var slideId = el ? el.value : (slide.getAttribute('data-slide-key') || 'unknown');\n      return { studentId:sid, slideId:slideId, slideIdEl:el };\n    }\n\n    function parseBR(ts){\n      if(!ts) return null;\n      var sp = ts.split(' '), d=sp[0], t=(sp[1]||'00:00:00');\n      if(t.length===5) t = t + ':00';\n      return new Date(d+'T'+t+'-03:00');\n    }\n    function fmtDurSeconds(s){\n      var m=Math.floor(s/60), r=s%60;\n      if(m>=60){ var h=Math.floor(m/60), mm=m%60; return h+'h '+mm+'m'; }\n      if(m>0) return m+'m '+r+'s';\n      return r+'s';\n    }\n    function statusNow(openStr, closeStr){\n      var now=new Date(), open=parseBR(openStr), close=parseBR(closeStr);\n      if(!open && !close) return {state:'open', msg:'Submission is OPEN'};\n      if(open && now<open){ var s1=Math.max(0, ((open-now)/1000)|0); return {state:'soon', msg:'Submission not open yet. Opens in '+fmtDurSeconds(s1)+'.'}; }\n      if(close && now>close) return {state:'closed', msg:'Submission is CLOSED'};\n      if(close){ var s2=Math.max(0, ((close-now)/1000)|0); return {state:'open', msg:'Submission is OPEN. Closes in '+fmtDurSeconds(s2)+'.'}; }\n      return {state:'open', msg:'Submission is OPEN'};\n    }\n\n    function notify(msg){ if(window.EXW_USE_ALERT){ alert(msg); } else { console.log('[EXW]', msg); } }\n\n    function findFeedbackBlocks(){\n      var b = $$('.feedback', slide);\n      return b.length ? b : $$('.feedback');\n    }\n    function lockKey(ids){ return 'exw_lock_'+ids.slideId+':'+ids.studentId; }\n    function isLocked(ids){ try{ return !!localStorage.getItem(lockKey(ids)); }catch(e){ return false; } }\n    function setLock(ids){ try{ localStorage.setItem(lockKey(ids),'1'); }catch(e){} }\n    function clearLock(ids){ try{ localStorage.removeItem(lockKey(ids)); }catch(e){} }\n\n    function markSubmittedUI(){ if(!btnSubmit) return; btnSubmit.disabled=true; btnSubmit.textContent='Submitted ‚úì'; if(btnDown) btnDown.disabled = !slide.__lastSubmittedAnswers; }\n    function restoreSubmitUI(){ if(!btnSubmit) return; btnSubmit.disabled=false; btnSubmit.textContent='Submit'; }\n\n    function syncButtons(state){\n      var ids = getIds();\n      var locked = isLocked(ids);\n      if(state!=='open' || locked) markSubmittedUI(); else restoreSubmitUI();\n      var hasFB = findFeedbackBlocks().length > 0;\n      if(btnFB) btnFB.disabled = !(state==='closed' && hasFB);\n      if(btnDown) btnDown.disabled = !slide.__lastSubmittedAnswers;\n    }\n\n    function paintWindow(){\n      var ids = getIds();\n      var el  = ids.slideIdEl;\n      var openS  = el ? (el.getAttribute('data-open') || '')  : '';\n      var closeS = el ? (el.getAttribute('data-close') || '') : '';\n      pillText.textContent = (openS || closeS) ? (openS+' ‚Üí '+closeS+' ('+TZ_LABEL+')') : 'No window set';\n      var st = statusNow(openS, closeS);\n      card.classList.remove('open','soon','closed');\n      card.classList.add(st.state);\n      msgEl.textContent = st.msg;\n      syncButtons(st.state);\n    }\n\n    function collectAnswers(){\n      var out = {};\n      $$('input[type=\"text\"], input[type=\"number\"]', slide).forEach(function(inp){\n        var key = inp.name || inp.id || '';\n        if(!(key && (key.indexOf('q')===0 || key.indexOf('module')===0))) return;\n        var v = trim(inp.value); if(v!=='') out[key]=v;\n      });\n      var names = {};\n      $$('input[type=\"radio\"]', slide).forEach(function(r){\n        if(r.name && (r.name.indexOf('q')===0 || r.name.indexOf('module')===0)) names[r.name]=1;\n      });\n      Object.keys(names).forEach(function(name){\n        var sel = slide.querySelector('input[type=\"radio\"][name=\"'+CSS.escape(name)+'\"]:checked');\n        if(sel) out[name]=sel.value;\n      });\n      $$('input[type=\"checkbox\"]', slide).forEach(function(ch){\n        var key = ch.name || ch.id || '';\n        if(!(key && (key.indexOf('q')===0 || key.indexOf('module')===0))) return;\n        if(ch.checked) out[key] = ch.value || 'on';\n      });\n      $$('textarea, select', slide).forEach(function(el){\n        var key = el.name || el.id || '';\n        if(!(key && (key.indexOf('q')===0 || key.indexOf('module')===0))) return;\n        var v = trim(el.value); if(v!=='') out[key]=v;\n      });\n      return out;\n    }\n\n    var submitting=false;\n    async function doSubmit(){\n      var ids = getIds();\n      var el  = ids.slideIdEl;\n      var openS  = el ? (el.getAttribute('data-open') || '')  : '';\n      var closeS = el ? (el.getAttribute('data-close') || '') : '';\n      var gate = statusNow(openS, closeS);\n      if(gate.state!=='open'){\n        notify(gate.state==='soon' ? ('This exercise is not open yet. It opens at '+openS+' ('+TZ_LABEL+').') : ('This exercise is already closed. It closed at '+closeS+' ('+TZ_LABEL+').'));\n        return;\n      }\n      if(!ids.studentId){ notify('Please enter your student ID (or log in).'); if(sidInput) sidInput.focus(); return; }\n      var answers = collectAnswers();\n      if(!Object.keys(answers).length){ notify('No filled answers on this slide.'); return; }\n      if(submitting) return; submitting=true;\n\n      var prevTxt = btnSubmit.textContent;\n      btnSubmit.textContent='‚è≥ Sending‚Ä¶'; btnSubmit.disabled=true;\n\n      slide.__lastSubmittedAnswers = {\n        studentId: ids.studentId, slide: ids.slideId,\n        timestamp: new Date().toLocaleString('pt-BR',{timeZone:'America/Sao_Paulo'}),\n        answers: answers\n      };\n\n      try{\n        var res = await fetch(ENDPOINT, {\n          method:'POST',\n          headers:{ 'Content-Type':'application/json' },\n          body: JSON.stringify({\n            student: ids.studentId,\n            exercise_id: ids.slideId,\n            answers: answers,\n            tsClient: new Date().toISOString(),\n            open: openS, close: closeS\n          }),\n          credentials:'omit'\n        });\n        var data = {}; try{ data = await res.json(); }catch(e){}\n        if(res.status===403 && data && data.status==='closed_window'){\n          notify('Submission blocked: window closed.');\n          slide.__lastSubmittedAnswers = null; if(btnDown) btnDown.disabled=true;\n          clearLock(ids); restoreSubmitUI();\n        }else if(res.ok && data && (data.status==='success' || data.status==='duplicate')){\n          setLock(ids); markSubmittedUI(); if(btnDown) btnDown.disabled=false;\n          notify(data.status==='duplicate' ? 'You had already submitted this exercise.' : 'Submitted! Thank you.');\n        }else{\n          notify('Submission error: '+(data && data.message ? data.message : ('HTTP '+res.status)));\n          slide.__lastSubmittedAnswers = null; if(btnDown) btnDown.disabled=true;\n          clearLock(ids); restoreSubmitUI();\n        }\n      }catch(e){\n        notify('Submission error: '+e.message);\n        slide.__lastSubmittedAnswers = null; if(btnDown) btnDown.disabled=true;\n        clearLock(ids); restoreSubmitUI();\n      }finally{\n        submitting=false; btnSubmit.textContent=prevTxt; paintWindow();\n      }\n    }\n\n    function downloadTXT(){\n      var p = slide.__lastSubmittedAnswers;\n      if(!p){ notify('No answers available to download yet.'); return; }\n      var txt = 'üìù Student Answers Summary\\n\\n';\n      txt += 'Student ID: '+p.studentId+'\\nSlide: '+p.slide+'\\nTimestamp: '+p.timestamp+'\\n\\nAnswers:\\n';\n      Object.keys(p.answers).forEach(function(k){ txt += '- '+k+': '+p.answers[k]+'\\n'; });\n      var blob = new Blob([txt], {type:'text/plain'});\n      var a = document.createElement('a');\n      a.href = URL.createObjectURL(blob);\n      a.download = (p.studentId+'_'+p.slide+'_'+p.timestamp.replace(/[/:\\s]/g,'-')+'_answers.txt');\n      document.body.appendChild(a); a.click(); a.remove();\n    }\n\n    var fbShown=false;\n    function toggleFeedback(){\n      var ids = getIds();\n      var el  = ids.slideIdEl;\n      var st  = statusNow(el?el.getAttribute('data-open'):'', el?el.getAttribute('data-close'):'').state;\n      if(st!=='closed'){ if(btnFB) btnFB.disabled=true; return; }\n      var blocks = findFeedbackBlocks(); if(!blocks.length){ notify('Feedback unavailable at the moment.'); return; }\n      fbShown=!fbShown; blocks.forEach(function(b){ b.style.display = fbShown ? 'block' : 'none'; });\n      btnFB.textContent = fbShown ? 'Hide Feedback' : 'Show Feedback';\n    }\n\n    async function checkServerSubmitted(){\n      try{\n        var ids = getIds(); if(!(ids.studentId && ids.slideId)) return;\n        var u = new URL(ENDPOINT);\n        u.searchParams.set('student', ids.studentId);\n        u.searchParams.set('exercise_id', ids.slideId);\n        var r = await fetch(u, { method:'GET', credentials:'omit' });\n        var d = {}; try{ d = await r.json(); }catch(e){}\n        if(d && d.found){\n          setLock(ids);\n          slide.__lastSubmittedAnswers = slide.__lastSubmittedAnswers || {\n            studentId: ids.studentId, slide: ids.slideId,\n            timestamp: new Date().toLocaleString('pt-BR',{timeZone:'America/Sao_Paulo'}),\n            answers: collectAnswers()\n          };\n          markSubmittedUI();\n        }\n      }catch(e){}\n    }\n\n    function init(){\n      // autopreenche ID se existir\n      var auto = trim(window.studentId || localStorage.getItem('studentId') || sessionStorage.getItem('studentId') || '');\n      sidInput = $('#student-id', slide);\n      if (sidInput && auto) sidInput.value = auto;\n\n      if(btnSubmit) btnSubmit.addEventListener('click', doSubmit);\n      if(btnDown)   btnDown.addEventListener('click', downloadTXT);\n      if(btnFB)     btnFB.addEventListener('click', toggleFeedback);\n\n      paintWindow(); setInterval(paintWindow, 1000);\n\n      var ids = getIds();\n      if(isLocked(ids)) markSubmittedUI();\n      checkServerSubmitted();\n    }\n\n    if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init, {once:true}); }\n    else { init(); }\n  }catch(err){\n    console.error('[EXW] init error:', err);\n  }\n})();\n</script>\n\n\n\n::: panel-tabset\n\n\n\n# T/F\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswerBox('module7_tf_q53','T')\" style=\"display: flex; align-items: center; gap: 8px;\">\n  <input type=\"text\" id=\"module7_tf_q53\" name=\"module7_tf_q53\" maxlength=\"1\" placeholder=\"T or F\" style=\"width: 55px;\" data-correct-answer=\"T\" /> \n  <label for=\"module7_tf_q53\"><strong>Firms with identical future cash flows must have the same value, regardless of leverage.</strong></label>\n</form>\n\n<div id=\"feedback-module7_tf_q53\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\nThis is TRUE. Under MM, identical cash flows imply identical firm values.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswerBox('module7_tf_q82','T')\" style=\"display: flex; align-items: center; gap: 8px;\">\n  <input type=\"text\" id=\"module7_tf_q82\" name=\"module7_tf_q82\" maxlength=\"1\" placeholder=\"T or F\" style=\"width: 55px;\" data-correct-answer=\"T\" /> \n  <label for=\"module7_tf_q82\"><strong>Under MM Proposition II in perfect markets, the cost of equity increases linearly with the debt-to-equity ratio.</strong></label>\n</form>\n\n<div id=\"feedback-module7_tf_q82\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\nThis is TRUE. In perfect markets, higher leverage raises equity risk, so the cost of equity increases linearly with D/E, while WACC remains constant.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswerBox('module7_tf_q13','T')\" style=\"display: flex; align-items: center; gap: 8px;\">\n  <input type=\"text\" id=\"module7_tf_q13\" name=\"module7_tf_q13\" maxlength=\"1\" placeholder=\"T or F\" style=\"width: 55px;\" data-correct-answer=\"T\" /> \n  <label for=\"module7_tf_q13\"><strong>Debt financing is a less expensive source of capital for a firm compared to equity financing.</strong></label>\n</form>\n\n<div id=\"feedback-module7_tf_q13\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\nThis is TRUE. Debt typically has a lower required return because it is less risky than equity.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswerBox('module7_tf_q81','T')\" style=\"display: flex; align-items: center; gap: 8px;\">\n  <input type=\"text\" id=\"module7_tf_q81\" name=\"module7_tf_q81\" maxlength=\"1\" placeholder=\"T or F\" style=\"width: 55px;\" data-correct-answer=\"T\" /> \n  <label for=\"module7_tf_q81\"><strong>If the risk-free rate is 3% and the market premium is 6%, a firm with Œ≤u=1.2 has an unlevered cost of capital of 10.2%.</strong></label>\n</form>\n\n<div id=\"feedback-module7_tf_q81\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\nThis is TRUE. Ru = 3% + 1.2√ó6% = 10.2%.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswerBox('module7_tf_q17','F')\" style=\"display: flex; align-items: center; gap: 8px;\">\n  <input type=\"text\" id=\"module7_tf_q17\" name=\"module7_tf_q17\" maxlength=\"1\" placeholder=\"T or F\" style=\"width: 55px;\" data-correct-answer=\"F\" /> \n  <label for=\"module7_tf_q17\"><strong>In a perfect capital market, the capital structure of a firm affects the overall cost of capital.</strong></label>\n</form>\n\n<div id=\"feedback-module7_tf_q17\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\nThis is FALSE. Under MM I, WACC is independent of capital structure.\n</div>\n\n:::\n\n\n\n\n# MCQ \n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswer('module7_mcq_q78')\" data-correct-answer=\"E\">\n<strong style=\"display: block;\">Firm A and Firm B are identical except for their capital structures. Firm A is all-equity with $\\beta_U = 1.0$. Firm B has a debt-to-equity ratio of $D/E = 0.3$, and debt is risk-free with $\\beta_D= 0$. Which statement best describes the relationship between their equity betas?</strong>\n\n<label><input type=\"radio\" name=\"module7_mcq_q78\" value=\"A\"> A. Both firms have the same equity beta because total business risk is unchanged.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q78\" value=\"B\"> B. Firm B‚Äôs equity beta will be lower because debt absorbs part of the risk.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q78\" value=\"C\"> C. Firm A‚Äôs equity beta is higher because it bears all operating risk.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q78\" value=\"D\"> D. Firm B‚Äôs equity beta equals 1.0 since its debt is risk-free.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q78\" value=\"E\"> E. Firm B‚Äôs equity beta is higher (about 1.3) because leverage increases the sensitivity of equity returns to market risk.</label><br>\n</form>\n\n<div id=\"feedback-module7_mcq_q78\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ Correct: E. With no taxes and risk-free debt, financial leverage increases the volatility of equity returns even though total business risk is unchanged.  \nAccording to Modigliani‚ÄìMiller Proposition II, $\\beta_E = \\beta_U(1 + \\frac{D}{E}) = 1.0(1 + 0.3) = 1.3$.  \nThus, Firm B‚Äôs equity is riskier than Firm A‚Äôs because leverage amplifies systematic risk for shareholders.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswer('module7_mcq_q26')\" data-correct-answer=\"B\">\n<strong style=\"display: block;\">Homemade leverage: You hold $10,000 of an unlevered firm (no debt). To replicate a levered position with D/E = 1 (no taxes), you should:</strong>\n\n<label><input type=\"radio\" name=\"module7_mcq_q26\" value=\"A\"> A. Borrow $2,500 and buy more shares</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q26\" value=\"B\"> B. Borrow $10,000 and buy more shares</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q26\" value=\"C\"> C. Lend $10,000 (buy risk-free) and keep the shares</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q26\" value=\"D\"> D. Sell $5,000 of shares and borrow $5,000</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q26\" value=\"E\"> E. Nothing; replication is impossible</label><br>\n</form>\n\n<div id=\"feedback-module7_mcq_q26\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ Correct: B. With D/E = 1, equity is 50% of firm value; to mimic that leverage, borrow an amount equal to your equity stake ($10k) and invest the total $20k in the firm.\n</div>\n\n:::\n\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswer('module7_mcq_q33')\" data-correct-answer=\"A\">\n<strong style=\"display: block;\">A firm‚Äôs unlevered beta is 1. If its D/E = 1.5 (no taxes), what is the levered beta, assuming $\\beta_D = 0$?</strong>\n\n<label><input type=\"radio\" name=\"module7_mcq_q33\" value=\"A\"> A. 2.5</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q33\" value=\"B\"> B. 2.0</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q33\" value=\"C\"> C. 1.5</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q33\" value=\"D\"> D. 1.8</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q33\" value=\"E\"> E. 3.0</label><br>\n</form>\n\n<div id=\"feedback-module7_mcq_q33\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ Correct: A. $\\beta_E = \\beta_U(1 + D/E) = 1 √ó (1 + 1.5) = 2.5$.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswer('module7_mcq_q37')\" data-correct-answer=\"B\">\n<strong style=\"display: block;\">In the context of Modigliani and Miller Proposition II (no taxes), which statement best describes the effect of financial leverage on a firm‚Äôs equity beta?</strong>\n\n<label><input type=\"radio\" name=\"module7_mcq_q37\" value=\"A\"> A. Financial leverage has no effect on the equity beta because total firm risk is constant.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q37\" value=\"B\"> B. Financial leverage increases the equity beta because shareholders bear a greater share of the firm‚Äôs total risk.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q37\" value=\"C\"> C. Financial leverage decreases the equity beta because debt is less risky than equity.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q37\" value=\"D\"> D. Financial leverage only affects the beta of debt, not equity.</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q37\" value=\"E\"> E. Financial leverage reduces the systematic risk of equity by diversifying investors‚Äô exposure.</label><br>\n</form>\n\n<div id=\"feedback-module7_mcq_q37\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ Correct: B.  \nUnder MM Proposition II (no taxes), increasing leverage magnifies the risk borne by equity holders because debt holders have a fixed claim on cash flows.  \nThe relationship $\\beta_E = \\beta_U(1 + \\frac{D}{E})$ shows that as $D/E$ rises, $\\beta_E$ increases proportionally ‚Äî meaning equity becomes more sensitive to market fluctuations.\n</div>\n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault(); checkAnswer('module7_mcq_q46')\" data-correct-answer=\"D\">\n<strong style=\"display: block;\">A firm operates with no taxes and has a cost of equity $r_E = 15\\%$, a cost of debt $r_D = 6\\%$, and a weighted average cost of capital (WACC) of $10\\%$. What is its current proportion of debt in the firm‚Äôs value ($D/V$)?</strong>\n\n<label><input type=\"radio\" name=\"module7_mcq_q46\" value=\"A\"> A. 0.30</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q46\" value=\"B\"> B. 0.35</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q46\" value=\"C\"> C. 0.40</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q46\" value=\"D\"> D. 0.44</label><br>\n<label><input type=\"radio\" name=\"module7_mcq_q46\" value=\"E\"> E. 0.50</label><br>\n</form>\n\n<div id=\"feedback-module7_mcq_q46\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ Correct: D.  \nThe WACC in a no-tax world is a weighted average of debt and equity costs:  \n$WACC = (D/V)r_D + (1 - D/V)r_E$.  \n\nSubstituting:  \n$0.10 = x(0.06) + (1 - x)(0.15)$  \n$\\Rightarrow 0.10 = 0.06x + 0.15 - 0.15x$  \n$\\Rightarrow 0.09x = 0.05$  \n$\\Rightarrow D/V = 0.44$.  \n\nThus, **44% of the firm‚Äôs value is financed by debt**, consistent with a WACC between the cost of equity and the cost of debt.\n</div>\n\n:::\n\n\n\n\n\n\n\n# NUM I\n\n::: {.question}\n\n**Leverage Effect ‚Äî Compute $r_E$ (no taxes)**\n\n\nA firm has an unlevered cost of capital of r<sub>U</sub> = 8.75% and a cost of debt of r<sub>D</sub> = 3.97%.<br>The firm‚Äôs debt-to-equity ratio is D/E = 0.74. Compute the firm‚Äôs <strong>equity cost of capital</strong> r<sub>E</sub> (in %).\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q1_single\"><strong>r<sub>E</sub> (%):</strong></label> <input type=\"number\" id=\"module7_num_q1_single\" name=\"module7_num_q1_single\" style=\"width:160px;\" data-correct-answer=12.29 data-tolerance=\"0.1\" step=\"0.01\" /> </form> <div id=\"feedback-module7_num_q1_single\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ <br> r<sub>E</sub> = r<sub>U</sub> + (D/E)(r<sub>U</sub> ‚àí r<sub>D</sub>) = 8.75% + 0.74√ó(4.78%) = <strong>12.29%</strong>. </div> \n\n::: \n\n:::\n\n\n\n\n\n\n# NUM II\n\n::: {.question}\n\n**Expected Return without Leverage**\n\n\n\n\n\nA company has no debt. Its assets will be worth 606.6 million in one year if the economy is strong, but only 299.5 million if the economy is weak. Both events are equally likely.   The current market value of the company‚Äôs assets is 399.4 million.   Compute the **expected return without leverage (in %)**.\n\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q2\"><strong>Expected return (%):</strong></label> <input type=\"number\" id=\"module7_num_q2\" name=\"module7_num_q2\" style=\"width:160px;\" data-correct-answer=13.4 data-tolerance=\"0.5\" step=\"0.1\" /> </form> <div id=\"feedback-module7_num_q2\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ Expected return = (453 ‚àí 399.4) √∑ 399.4 = <strong>13.4%</strong>. </div> \n::: \n::: \n\n\n\n\n# NUM III\n\n::: {.question}\n\n**Deleveraging and Share Issuance**\n\n\n\n\n\nCompany Y has 50 million shares outstanding and a market capitalization of 2 billion.  It also has 756 million in debt outstanding. The company plans to **delever completely** by issuing new equity and repaying all outstanding debt.   Assume perfect capital markets.  How many new shares must the company issue (in million)?\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q3\"><strong>New shares to issue (millions):</strong></label> <input type=\"number\" id=\"module7_num_q3\" name=\"module7_num_q3\" style=\"width:160px;\" data-correct-answer=18.9 data-tolerance=\"1\" step=\"0.01\" /> </form> <div id=\"feedback-module7_num_q3\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ New shares = Debt √∑ Price = 756 √∑ 40 = <strong>18.9 million</strong>. </div> \n::: \n::: \n\n\n\n# NUM IV\n\n::: {.question}\n\n**Stock Price under MM Proposition I**\n\n\n\n\n\nConsider two firms, **Leverage** and **NonLeverage**, that have identical assets and generate identical cash flows.   NonLeverage is an all-equity firm with 1.93 million shares outstanding trading at 22.74 per share.   Leverage has 2 million shares outstanding and 26 million in debt, with an interest rate of 5%.  Under **Modigliani‚ÄìMiller Proposition I (no taxes)**, compute the **stock price for Leverage (in $)**.\n\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q4\"><strong>Leverage stock price ($):</strong></label> <input type=\"number\" id=\"module7_num_q4\" name=\"module7_num_q4\" style=\"width:160px;\" data-correct-answer=8.94 data-tolerance=\"0.1\" step=\"0.01\" /> </form> <div id=\"feedback-module7_num_q4\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ By MM I (no taxes): firm value unchanged. Equity value = Total assets ‚àí Debt = 43.89 ‚àí 26 = 17.89; Stock price = 17.89 √∑ 2 = <strong>8.94</strong>. </div> \n::: \n::: \n\n\n\n\n# NUM V\n\n::: {.question}\n\n**MM I ‚Äî WACC and Value (no taxes)**\n\n\n\n\nA firm operates in a perfect capital market (no taxes) with perpetual free cash flow to the firm (FCFF) of 39.53 million per year. Its unlevered cost of capital is r<sub>U</sub> = 7.44%, the cost of debt is r<sub>D</sub> = 4.07%,  and the target leverage is D/E = 1.16.  Compute: **(a)** the levered cost of equity r<sub>E</sub> (in %); **(b)** the WACC (in %); and **(c)** the levered firm value V<sub>L</sub> (in millions).\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q5a_single\"><strong>2a. r<sub>E</sub> (%):</strong></label> <input type=\"number\" id=\"module7_num_q5a_single\" name=\"module7_num_q5a_single\" style=\"width:160px;\" data-correct-answer=11.35 data-tolerance=\"0.1\" step=\"0.01\" /> </form> <div id=\"feedback-module7_num_q5a_single\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ $r_E = r_U + \\frac{D}{E}(r_U - r_D) =$ 11.35%. </div> \n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q5b_single\"><strong>2b. WACC (%):</strong></label> <input type=\"number\" id=\"module7_num_q5b_single\" name=\"module7_num_q5b_single\" style=\"width:160px;\" data-correct-answer=7.44 data-tolerance=\"0.1\" step=\"0.01\" /> </form> <div id=\"feedback-module7_num_q5b_single\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ $WACC = \\frac{E}{V}r_E + \\frac{D}{V}r_D =$ 7.44%. </div> \n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex; gap:8px; align-items:center;\"> <label for=\"module7_num_q5c_single\"><strong>2c. V<sub>L</sub> (millions):</strong></label> <input type=\"number\" id=\"module7_num_q5c_single\" name=\"module7_num_q5c_single\" style=\"width:160px;\" data-correct-answer=531.32 data-tolerance=\"0.05\" step=\"0.01\" /> </form> <div id=\"feedback-module7_num_q5c_single\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ By MM I (no taxes), $V_L = V_U = \\frac{FCFF}{r_U} =$ <strong>531.32</strong> (millions). </div> \n:::\n\n::: \n\n\n\n\n\n:::   \n\n\n\n\n\n\n\n# 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\nWe will discuss now two fallacies concerning capital structure:\n\n-   *Leverage increases earnings per share (EPS), thus increase firm value*\n-   *Issuing new equity will dilute existing shareholders, so debt should be issued*\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n**Leverage and EPS** example\n\n-   LVI is currently an all‚àíequity firm.\n-   It expects to generate earnings before interest and taxes (EBIT) of 10 million over the next year.\n-   Currently, LVI has 10 million shares outstanding, and its stock is trading for a price of 7.50 per share.\n-   LVI is considering changing its capital structure by borrowing 15 million at an interest rate of 8% and using the proceeds to repurchase 2 million shares at \\$7.50 per share.\n\n. . .\n\nSuppose LVI has no debt. Because there is no interest and no taxes, LVI's earnings would equal its EBIT and LVI's earnings per share without leverage would be\n\n$$EPS=\\frac{earnings}{Out. Shares}=\\frac{10\\;million}{10\\;million}= 1$$\n\n\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n-   If LVI recapitalizes, the new debt will obligate LVI to make interest payments each year of \\$1.2 million/year\n    -   15 million √ó 8% interest/year = 1.2 million/year\n-   As a result, LVI will have expected earnings after interest of 8.8 million\n    -   Earnings = EBIT ‚àí Interest\n    -   Earnings = 10 million ‚àí 1.2 million = 8.8 million\n\n$$EPS=\\frac{earnings}{Out. Shares}=\\frac{8.8\\;million}{8\\;million}= 1.1$$ **EPS increases**. Should firm value increase?\n\n\n\n\n\n\n\n\n\n##  {.smaller background=\"#c9f7ba\"}\n\n**The answer is no.**\n\nJust like equity becomes riskier when the firm issues debt, the earnings stream is also riskier when the firm issues debt.\n\n![](../figs/bm_14_2.png)\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n|                 | (no debt) | (with debt) |\n|-----------------|-----------|-------------|\n| EBIT            | 10        | 10          |\n| \\- Interets     | 0         | 1.2         |\n| Earnings        | 10        | 8.8         |\n| \\# shares (out) | 10        | 10          |\n| EPS             | 1         | 1.1         |\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n**No debt**\n\n|           |     |     |     |     |     |     |     |     |     |     |     |\n|-----------|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|\n| EBIT      | 0   | 2   | 4   | 6   | 8   | 10  | 12  | 14  | 16  | 18  | 20  |\n| \\- Int.   | 0   | 0   | 0   | 0   | 0   | 0   | 0   | 0   | 0   | 0   | 0   |\n| Earnings  | 0   | 2   | 4   | 6   | 8   | 10  | 12  | 14  | 16  | 18  | 20  |\n| \\# shares | 10  | 10  | 10  | 10  | 10  | 10  | 10  | 10  | 10  | 10  | 10  |\n| EPS       | 0   | 0.2 | 0.4 | 0.6 | 0.8 | 1   | 1.2 | 1.4 | 1.6 | 1.8 | 2.0 |\n\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n**With debt**\n\n|           |       |      |      |      |      |      |      |      |      |      |      |\n|-----------|-------|------|------|------|------|------|------|------|------|------|------|\n| EBIT      | 0     | 2    | 4    | 6    | 8    | 10   | 12   | 14   | 16   | 18   | 20   |\n| \\- Int.   | 1.2   | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  |\n| Earnings  | -1.2  | 0.8  | 2.8  | 4.8  | 6.8  | 8.8  | 10.8 | 12.8 | 14.8 | 16.8 | 18.8 |\n| \\# shares | 10    | 10   | 10   | 10   | 10   | 10   | 10   | 10   | 10   | 10   | 10   |\n| EPS       | -0.12 | 0.08 | 0.28 | 0.48 | 0.68 | 0.88 | 1.08 | 1.28 | 1.48 | 1.68 | 1.88 |\n\n\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n**Problem**\n\nAssume that LVI's EBIT is not expected to grow in the future and that all earnings are paid as dividends. Use MM proposition I and II to show that the increase in expected EPS for LVI will not lead to an increase in the share price.\n\n**Solution**\n\nWithout leverage, expected earnings per share and therefore dividends are 1 each year, and the share price 7.50. Let r be LVI's cost of capital without leverage. Then we can value LVI as a perpetuity:\n\n$$P = 7.50 = \\frac{Div}{R_u} = \\frac{EPS}{R_u} = \\frac{1}{R_u}$$\n\nTherefore, current stock price implies that $R_u = \\frac{1}{7.50} = 13.33\\%$\n\n\n\n\n\n\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\n-   The market value of LVI without leverage is 7.50 √ó 10 million shares = 75 million.\n-   If LVI uses debt to repurchase 15 million worth of the firm's equity\n-   then the remaining equity will be worth 75 million ‚àí 15million = 60 million.\n\nAfter the transaction, $\\frac{D}{E} = \\frac{1}{4}$, thus, we can write:\n\n$$R_e= R_u +\\frac{D}{E} \\times (R_u - R_d) = 13.33 + 0.25 \\times (13.33 - 8) = 14.66$$\n\nGiven that expected EPS is now 1.10 per share, the new value of the shares equals\n\n$$P=\\frac{1.10}{14.66} = 7.50$$\n\nThus, even though EPS is higher, due to the additional risk, shareholders will demand a higher return. **These effects cancel out, so the price per share is unchanged.**\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\"}\n\nBecause the **firm's earnings per share and price-earnings ratio are affected by leverage, we cannot reliably compare these measures across firms with different capital structures**.\n\nThe same is true for accounting-based performance measures such as return on equity (ROE).\n\nTherefore, most analysts prefer to use performance measures and valuation multiples that are based on the firm's earnings before interest has been deducted.\n\n-   For example, the ratio of enterprise value to EBIT (or EBITDA) is more useful when analyzing firms with very different capital structures than is comparing their P/E ratios.\n\n\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\" visibility=\"hidden\"}\n\n**Equity Issuances and Dilution**\n\nIt is sometimes (incorrectly) argued that issuing equity will dilute existing shareholders' ownership, so debt financing should be used instead.\n\n-   Dilution: An increase in the total of shares that will divide a fixed amount of earnings\n\nSuppose Jet Sky Airlines (JSA) currently has no debt and 500 million shares of stock outstanding, which is currently trading at a price of \\$16.\n\nLast month the firm announced that it would expand and the expansion will require the purchase of \\$1 billion of new planes, which will be financed by issuing new equity.\n\n-   The current (prior to the issue) value of the equity and the assets of the firm is 8 billion.\n    -   500 million shares √ó 16 per share = 8 billion\n\n\n\n\n\n\n\n\n## 14.4 Capital Structure Fallacies {.smaller background=\"#c9f7ba\" visibility=\"hidden\"}\n\nSuppose now JSA sells 62.5 million new shares at the current price of 16 per share to raise the additional 1 billion needed to purchase the planes.\n\n| Assets          | Before | After |\n|-----------------|--------|-------|\n| Cash            |        | 1000  |\n| Existing assets | 8000   | 8000  |\n| Total Value     | 8000   | 9000  |\n| \\# shares (out) | 500    | 562.5 |\n| Value per share | 16     | 16    |\n\n**Result: share prices don't change. Any gain or loss associated with the transaction will result from the NPV of the investments the firm makes with the funds raised.**\n\n\n\n\n# 14.5 MM: Beyond  Propositions {.smaller background=\"#f2f7ba\"}\n\n\n## 14.5 MM: Beyond  Propositions {.smaller background=\"#f2f7ba\"}\n\nMM is truly about the **Conservation of Value Principle** in **perfect financial markets**\n\n-   **With perfect capital markets, financial transactions neither add nor destroy value**\n-   They only represent a **repackaging of risk (and therefore return)**.\n-   This implies that any financial transaction that appears to be a good deal may be **exploiting some type of market imperfection**.\n\n\n\n\n\n\n\n\n\n\n\n##  Recap {.smaller visibility=hidden}\n\n**After this chapter, you should know:**\n\n- Describe the capital structure that the firm should choose.\n\n- List the conditions that make capital markets perfect.\n\n- Discuss the implications of MM Proposition I, and the roles of homemade leverage in the development of the proposition.\n\n-  Calculate the cost of capital for levered equity according to MM Proposition II.\n\n- Illustrate the effect of a change in debt on weighted average cost of capital in perfect capital markets.\n\n- Calculate the market risk of a firm‚Äôs assets using its unlevered beta.\n-\nIllustrate the effect of increased leverage on the beta of a firm‚Äôs equity.\n\n- Compute a firm‚Äôs net debt.\n\n- Discuss the effect of leverage on a firm‚Äôs expected earnings per share.\n\n\n\n\n\n\n\n\n\n##  { background=\"#f7f9fc\"}\n\n<div data-ticket\n     data-bridge=\"https://course-chat.hcmrtns.workers.dev/checkouts\"\n     data-session=\"module7_checkout2\"\n     data-page=\"module7_checkout2\"\n     data-require-login=\"true\"\n     data-open=\"2025-10-29 16:00\"\n     data-close=\"2025-10-29 16:59\">\n</div>\n\n<!-- checkout2.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) -->\n<style>\n  /* ===== Tokens (light) ‚Äî exit-checkout colors ===== */\n  :root{\n    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);\n    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;\n    --focus:rgba(59,130,246,.22);\n    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;\n    --textarea-bg:#fff;\n\n    /* ribbon colors by state */\n    --ribbon-open-1: rgba(34,197,94,.18);   /* green */\n    --ribbon-open-2: rgba(16,185,129,.16);\n    --ribbon-soon-1: rgba(245,158,11,.18);  /* amber */\n    --ribbon-soon-2: rgba(251,191,36,.16);\n    --ribbon-closed-1: rgba(239,68,68,.20); /* red */\n    --ribbon-closed-2: rgba(248,113,113,.16);\n    --ribbon-default-1: rgba(99,102,241,.14); /* blue (fallback) */\n    --ribbon-default-2: rgba(96,165,250,.14);\n  }\n  @media (prefers-color-scheme: dark){\n    :root{\n      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);\n      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);\n      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;\n      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;\n      --textarea-bg:rgba(2,6,23,.55);\n    }\n  }\n\n  /* Card */\n  [data-ticket] .tw-card{\n    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;\n    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);\n    color:var(--ink);overflow:hidden;box-sizing:border-box;\n  }\n  [data-ticket] .tw-card::before{\n    content:\"\";position:absolute;inset:0 0 auto 0;height:56px;\n    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));\n    pointer-events:none;\n  }\n  /* ribbon by state */\n  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }\n  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }\n  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }\n\n  /* Header */\n  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}\n  [data-ticket] .tw-icon{\n    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;\n    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;\n  }\n  [data-ticket] .tw-icon::after{\n    content:\"\";position:absolute;inset:-3px;border-radius:14px;\n    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));\n    z-index:-1;filter:blur(6px);opacity:.55;\n  }\n  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}\n  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}\n  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}\n  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}\n\n  /* Badges */\n  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}\n  [data-ticket] .tw-badge{\n    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;\n    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;\n  }\n  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{\n    color:currentColor;stroke:currentColor!important;fill:none;\n  }\n  [data-ticket] .tw-window-text{white-space:pre-line;}\n\n  /* Status dot */\n  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}\n  [data-ticket].open  .tw-dot{background:#16a34a;}\n  [data-ticket].soon  .tw-dot{background:#f59e0b;}\n  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}\n\n  /* Textarea */\n  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}\n  [data-ticket] textarea.tw-text{\n    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;\n    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;\n    resize:vertical;color:var(--ink);box-sizing:border-box;\n  }\n  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}\n  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}\n\n  /* Footer & messages */\n  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;}\n  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}\n  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}\n  [data-ticket] .tw-msg.success{color:#059669!important;}\n  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}\n  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}\n  /* match dot color if no explicit class was set */\n  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}\n  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}\n  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}\n\n  /* Button */\n  [data-ticket] .tw-btn{\n    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);\n    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;\n    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;\n  }\n  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}\n  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}\n  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}\n  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}\n\n  /* Spinner */\n  [data-ticket] .spin:after{\n    content:\"\";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);\n    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;\n  }\n  @keyframes twspin{to{transform:rotate(360deg)}}\n\n  /* Mini-login */\n  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}\n  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}\n\n  /* Responsive */\n  @media (max-width:640px){\n    [data-ticket] .tw-card{border-radius:14px;padding:14px;}\n    [data-ticket] .tw-header{gap:10px;}\n    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}\n  }\n</style>\n\n<script>\n(() => {\n  const $ = (sel, el=document) => el.querySelector(sel);\n\n  function mountAll(){\n    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);\n  }\n\n  function initOne(host){\n    host.setAttribute('data-tw-mounted','1');\n\n    // ---- Config/attrs\n    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();\n    const sessionTag = (host.getAttribute('data-session') || '').trim();\n    const pageAttr   = (host.getAttribute('data-page') || '').trim();\n    const winStartStr= (host.getAttribute('data-open') || '').trim();\n    const winEndStr  = (host.getAttribute('data-close') || '').trim();\n    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';\n\n    // ---- Helpers\n    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;\n    const winStart = parseLocal(winStartStr);\n    const winEnd   = parseLocal(winEndStr);\n\n    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };\n    function statusNow(){\n      const now = new Date();\n      if (!winStart || !winEnd) return {state:'open', label:'Always available'};\n      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }\n      if (now > winEnd)   return {state:'closed', label:'Closed'};\n      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};\n    }\n    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();\n    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);\n\n    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };\n    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;\n    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };\n    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };\n\n    // ---- UI skeleton\n    host.innerHTML = '';\n    const card = document.createElement('div'); card.className = 'tw-card';\n    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\\n‚Üí ' + winEndStr) : 'No window set';\n    card.innerHTML = `\n      <div class=\"tw-header\">\n        <div class=\"tw-icon\" aria-hidden=\"true\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>\n        </div>\n        <div class=\"tw-titles\">\n          <div class=\"tw-title\">Check-out</div>\n          <div class=\"tw-sub\"></div>\n        </div>\n        <div class=\"tw-meta\">\n          <div class=\"tw-badge\"><span class=\"tw-dot\"></span><span class=\"tw-badge-text\">‚Äî</span></div>\n          <div class=\"tw-badge\" title=\"S√£o Paulo time\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"opacity:.8\"><path d=\"M12 7v5l4 2\" stroke=\"#334155\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#334155\" stroke-width=\"1.5\" fill=\"none\"/></svg>\n            <span class=\"tw-window-text\">${windowLabel}</span>\n          </div>\n        </div>\n      </div>\n      <div class=\"tw-login\" style=\"display:none\">\n        <input type=\"text\" class=\"tw-login-input\" placeholder=\"Digite seu ID / e-mail do curso\"/>\n        <button type=\"button\" class=\"tw-btn tw-login-btn\">Entrar</button>\n      </div>\n      <div class=\"tw-body\"></div>\n      <div class=\"tw-footer\">\n        <button type=\"button\" class=\"tw-btn tw-send\">Send (click only 1x)</button>\n        <div class=\"tw-count\">0/500</div>\n      </div>\n      <div class=\"tw-msg\"></div>`;\n    host.appendChild(card);\n\n    // refs\n    const body = $('.tw-body', card);\n    const btn  = $('.tw-send', card);\n    const msg  = $('.tw-msg', card);\n    const badgeText = $('.tw-badge-text', card);\n    const count = $('.tw-count', card);\n    const loginRow = $('.tw-login', card);\n    const loginInp = $('.tw-login-input', card);\n    const loginBtn = $('.tw-login-btn', card);\n\n    // textarea\n    const ta = document.createElement('textarea');\n    ta.className = 'tw-text'; ta.maxLength = 500;\n    ta.placeholder = 'Your check-out (max 500): one thing you learned + one question‚Ä¶';\n    body.appendChild(ta);\n    ta.addEventListener('input', () => { count.textContent = `${ta.value.length}/500`; syncEnabled(); });\n    count.textContent = '0/500';\n\n    const successMsg = 'Check-out recorded. Thank you!';\n    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';\n\n    function paintBadge(){\n      const st = statusNow();\n      host.classList.remove('open','soon','closed'); host.classList.add(st.state);\n      badgeText.textContent = st.label;\n    }\n\n    function showLoginIfNeeded(){\n      const need = requireLogin && !getStudentId();\n      loginRow.style.display = need ? 'flex' : 'none';\n    }\n\n    function syncEnabled(){\n      const logged = !requireLogin || !!getStudentId();\n      const st     = statusNow().state;\n      const filled = ta.value.trim().length>0;\n      const enabled= logged && (st==='open') && filled && !isDone();\n      btn.disabled = !enabled;\n\n      showLoginIfNeeded(); paintBadge();\n\n      if (isDone()){\n        setMsg(msg, dupMsg, 'success');\n        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;\n      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');\n      else if (st==='soon') setMsg(msg,'Not open yet.','warning');\n      else if (st==='closed') setMsg(msg,'This activity is closed.','error');\n      else if (!filled) setMsg(msg,'Write something to submit.','warning');\n      else setMsg(msg,''); // ready\n    }\n\n    // mini-login\n    loginBtn?.addEventListener('click', () => {\n      const v = (loginInp.value || '').trim();\n      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }\n      try { localStorage.setItem('studentId', v); } catch {}\n      window.studentId = v;\n      document.dispatchEvent(new Event('auth:login'));\n      setMsg(msg,''); syncEnabled();\n    });\n\n    // timers + cleanup\n    paintBadge(); syncEnabled();\n    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);\n    const obs = new MutationObserver(() => {\n      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }\n    });\n    obs.observe(document.body, {childList:true, subtree:true});\n    document.addEventListener('auth:login', syncEnabled);\n\n    // Submit\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault(); e.stopPropagation();\n\n      const sid = getStudentId();\n      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }\n      const text = ta.value.trim().slice(0,500);\n      if (!text){ setMsg(msg,'Write something to submit.','warning'); return; }\n      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }\n\n      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');\n\n      const payload = {\n        student_id: sid,                 // ‚Üê alinha com D1\n        slide_id: (sessionTag || getPageId()),\n        ticket: text,\n        tsClient: new Date().toISOString(),\n        open:  winStartStr,\n        close: winEndStr,\n        user_agent: navigator.userAgent\n      };\n\n      try{\n        const res = await fetch(bridge, {\n          method:'POST',\n          headers:{ 'Content-Type':'application/json' },\n          body: JSON.stringify(payload),\n          keepalive:true\n        });\n\n        const raw = await res.text();\n        let data = null; try{ data = JSON.parse(raw); }catch(_){}\n\n        if (!res.ok){\n          if (data && data.status === 'closed_window'){\n            setMsg(msg,'This activity is closed now.','error');\n          } else {\n            setMsg(msg,'Failed to submit. Please try again.','error');\n          }\n          console.error('[checkout2] HTTP error:', res.status, raw);\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        if (data && data.status === 'success'){\n          setMsg(msg, successMsg, 'success');\n          ta.value=''; count.textContent='0/500';\n          markDone(btn); clearInterval(ticker);\n          return;\n        }\n        if (data && data.status === 'duplicate'){\n          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;\n        }\n        if (data && data.status === 'closed_window'){\n          setMsg(msg,'This activity is closed now.','error');\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        setMsg(msg,'Failed to submit. Please try again.','error');\n        console.error('[checkout2] unexpected response:', raw);\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }catch(err){\n        console.error('[checkout2] submit error:', err);\n        setMsg(msg,'Network error. Please try again.','error');\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }\n    });\n  }\n\n  if (document.readyState === 'loading'){\n    document.addEventListener('DOMContentLoaded', mountAll, { once:true });\n  } else {\n    mountAll();\n  }\n})();\n</script>\n\n\n\n\n\n\n\n\n\n# Now it is your turn... {.smaller background=\"#191f36\"}\n\n::: footer\n:::\n\n \n\n\n\n\n## Interact {.smaller background=\"#8091d1\" visibility=\"hidden\"}\n\n<script src=\"https://giscus.app/client.js\"\n        data-repo=\"henriquecastror/EF202401\"\n        data-repo-id=\"R_kgDOLJQ8yQ\"\n        data-mapping=\"number\"\n        data-term=\"13\"\n        data-reactions-enabled=\"1\"\n        data-emit-metadata=\"0\"\n        data-input-position=\"bottom\"\n        data-theme=\"light\"\n        data-lang=\"en\"\n        crossorigin=\"anonymous\"\n        async>\n</script>\n\n\n::: footer\n:::\n\n\n\n\n## üôã‚Äç‚ôÇÔ∏è **Any Questions?** { background=\"#fdf6e3\"}\n\n::: columns\n::: {.column width=\"50%\"}\n### Thank You!\n\n![](../figs/qa2.png){width=\"110%\" style=\"box-shadow: none;\"}\n\n:::\n\n::: {.column width=\"50%\"}\n<div style=\"text-align:right;\">\n  <img src=\"../figs/avatar.jpg\" width=\"120px\" style=\"border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);\" />\n</div>\n\n### **Henrique C. Martins**\n\n- üåê [FGV/EAESP](https://eaesp.fgv.br/en/people/henrique-castro-martins)  \n- üíº [LinkedIn](https://www.linkedin.com/in/henriquecastror/)  \n- üß† [Google Scholar](https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&hl=pt-BR&oi=ao)  \n- üìÑ [Lattes CV](http://lattes.cnpq.br/6076997472159785)  \n- üè† [Personal Website](https://henriquemartins.net/)  \n:::\n:::\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
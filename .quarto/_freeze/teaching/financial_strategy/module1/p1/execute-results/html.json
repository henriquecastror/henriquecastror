{
  "hash": "e6a3290f5da7e2589cdc161d8bdb1174",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Estrat√©gia Financeira'\nsubtitle: ' **Module 1 - ch.23 Raising Equity Capital** '\nauthor:\n  - name: ' **Henrique C. Martins** '\n    affiliation: '**[![](../figs/background6.png){width=300px style=\"box-shadow: none;\" }](https://eaesp.fgv.br/en)**'\ndate: last-modified\ndate-format: \"DD-MM-YYYY\"\ntitle-block-banner: true\nformat:\n  revealjs:\n    body-attributes:\n      data-module: mod1\n    include-in-header: ../html/login-start.html\n    include-after-body:\n      - ../html/chat-widget.html\n      - ../html/ranking-widget2.html\n      - ../html/polls.html\n    touch: true\n    controls: true\n    slide-number: true\n    theme: simple\n    chalkboard: false\n    menu: false\n    preview-links: auto\n    logo: ../figs/background8.png\n    css: ../logo.css\n    footer: '<span style=\"font-size:10px\"> [[Henrique C. Martins](mailto:henrique.martins@fgv.br)] [[Teaching Resources](https://henriquemartins.net/teaching/financial_strategy/)]**[Do not use without permission]**</span>'\n    scrollable: true\ntitle-slide-attributes:\n  data-background-color: \"#b1cafa\"\ninclude-after: |\n  <script>\n    // Redund√¢ncia leve: tamb√©m define o m√≥dulo via JS neste deck\n    // (o notices-on-login reconhece body[data-module], localStorage e window.VHCM.module)\n    window.VHCM = window.VHCM || {};\n    window.VHCM.module = \"mod1\";\n\n    document.addEventListener('DOMContentLoaded', () => {\n      try { localStorage.setItem('mod1','mod1'); } catch(_) {}\n    });\n\n    Reveal.on('ready', event => {\n      if (event.indexh === 0) {\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n    });\n    Reveal.addEventListener('slidechanged', (event) => {\n      if (event.indexh === 0) {\n        Reveal.configure({ slideNumber: null });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n      if (event.indexh === 1) {\n        Reveal.configure({ slideNumber: 'c' });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = null;\n      }\n    });\n  </script>\n---\n\n\n\n  \n\n\n# Intro {visibility=\"hidden\"}\n\n\n\n##  { background=\"#A91B0D\"}\n\n::: {.callout-important title=\"‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses\"}\n\nThe **Virtual HCM** is powered by **AI** to assist you with course materials.  \nWhile it is trained on the course's content, **it may occasionally**:\n\n- Misinterpret the question or context.  \n- Generate **inaccurate or incomplete** information.  \n- Provide answers **not explicitly included** in the materials.\n\n**Your responsibility:**  \nAlways cross-check the answers with the book, slides, readings, and feedback provided in the course. In case you are not sure, ask the instructor.\n\nüí° *Use Virtual HCM as a **learning aid**, not as the sole source of truth.*\n\n<div class=\"like-container\">\n  <button class=\"like-btn\" title=\"Click if you got this\">\n    ‚úÖ <span class=\"like-text\">Got it</span>\n    <span class=\"like-count\">(0)</span>\n  </button>\n</div>\n\n<script>\n(function () {\n  const root = document.currentScript && document.currentScript.previousElementSibling;\n  if (!root || !root.matches('.like-container')) return;\n\n  const btn = root.querySelector('.like-btn');\n  const textSpan = btn && btn.querySelector('.like-text');\n  const countSpan = btn && btn.querySelector('.like-count');\n  if (!btn || !textSpan || !countSpan) return;\n\n  const scriptURL = \"https://course-chat.hcmrtns.workers.dev\";\n\n  function pageId() {\n    const sec = root.closest('section');\n    function getSlideHashForSection(sec) {\n      if (sec && sec.id) return `#/${sec.id}`;\n      if (window.Reveal && Reveal.getIndices) {\n        const idx = Reveal.getIndices(sec || Reveal.getCurrentSlide());\n        if (idx && typeof idx.h === 'number') {\n          return (typeof idx.v === 'number' && idx.v > 0) ? `#/${idx.h}/${idx.v}` : `#/${idx.h}`;\n        }\n      }\n      return location.hash || '#';\n    }\n    const hash = getSlideHashForSection(sec);\n    return location.origin + location.pathname + location.search + hash;\n  }\n  function getStudentId(){\n    return (window.studentId || localStorage.getItem(\"studentId\") || localStorage.getItem(\"fs_user\") || \"\");\n  }\n  function hasLogin(){ return !!getStudentId(); }\n\n  function setGotItState() {\n    textSpan.textContent = \"Got it ‚úî\";\n    btn.classList.add(\"liked\");\n    btn.title = \"You have already confirmed\";\n  }\n  function clearGotItState() {\n    textSpan.textContent = \"Got it\";\n    btn.classList.remove(\"liked\");\n    btn.title = hasLogin() ? \"Click if you got this\" : \"Please log in to confirm\";\n  }\n\n  function syncButtonLock() {\n    if (!hasLogin()) {\n      btn.setAttribute('disabled', 'disabled');\n      btn.style.opacity = 0.6;\n      btn.title = \"Please log in to confirm\";\n    } else {\n      btn.removeAttribute('disabled');\n      btn.style.opacity = \"\";\n      btn.title = \"Click if you got this\";\n    }\n  }\n  syncButtonLock();\n  document.addEventListener('auth:login', () => { syncButtonLock(); updateCount(); });\n\n  // Envia ponto (opcional; n√£o bloqueia)\n  async function awardLikePoint(student, pid){\n    try{\n      await fetch(`${scriptURL}/ranking`, {\n        method:'POST',\n        headers:{'Content-Type':'application/json'},\n        body: JSON.stringify({\n          student,\n          event_type:'like',\n          module:(window.moduleId||'module'),\n          page: pid,\n          details:'source=like_button',\n          fingerprint:`${student}:like:${pid}`\n        })\n      });\n      if (typeof window.leaderboardLogEvent === 'function') {\n        window.leaderboardLogEvent('like', { details:'mirrored_to_cloudflare' });\n      }\n    }catch(_){}\n  }\n\n  btn.addEventListener('click', () => {\n    const pid = pageId();\n    if (!hasLogin()) { alert(\"Please log in first.\"); return; }\n    if (localStorage.getItem(`liked_${pid}`)) return;\n\n    btn.disabled = true;\n    btn.classList.add('pulse');\n    setTimeout(() => btn.classList.remove('pulse'), 300);\n\n    const student = getStudentId();\n    fetch(`${scriptURL}/likes?like=1&page=${encodeURIComponent(pid)}&student=${encodeURIComponent(student)}`)\n      .then(r=>r.json())\n      .then(async data=>{\n        if (data && data.status === 'liked') {\n          await awardLikePoint(student, pid);\n        }\n        if (data && (data.status === 'liked' || data.status === 'already')) {\n          localStorage.setItem(`liked_${pid}`,\"true\");\n          setGotItState();\n        }\n        updateCount();\n      })\n      .catch(console.error)\n      .finally(()=>{ btn.disabled = false; });\n  });\n\n  function updateCount(){\n    const pid = pageId();\n    const student = getStudentId() || \"anon\";\n    fetch(`${scriptURL}/likes?state=1&page=${encodeURIComponent(pid)}&student=${encodeURIComponent(student)}`)\n      .then(r=>r.json())\n      .then(data=>{\n        const count = Number(data && data.count) || 0;\n        countSpan.textContent = `(${count})`;\n        if (data && data.liked) {\n          // servidor confirma like ‚Üí garante UI e storage\n          localStorage.setItem(`liked_${pid}`,\"true\");\n          setGotItState();\n        } else {\n          // servidor diz que N√ÉO h√° like ‚Üí limpa UI e storage\n          localStorage.removeItem(`liked_${pid}`);\n          clearGotItState();\n        }\n      })\n      .catch(()=>{ /* ignora */ });\n  }\n\n  updateCount();\n  const interval = setInterval(updateCount, 3000);\n\n  const obs = new MutationObserver(() => {\n    if (!document.body.contains(root)) { clearInterval(interval); obs.disconnect(); }\n  });\n  obs.observe(document.body, { childList:true, subtree:true });\n\n  if (window.Reveal && Reveal.addEventListener) {\n    Reveal.addEventListener('slidechanged', updateCount);\n  }\n})();\n</script>\n\n<style>\n.like-container { position: relative; margin-top: 20px; text-align: right; }\n.like-btn {\n  background-color:#f0fdf4; border:2px solid #86efac; color:#15803d;\n  padding:8px 16px; font-size:16px; border-radius:25px;\n  display:inline-flex; align-items:center; gap:8px; font-weight:500;\n  box-shadow:1px 1px 4px rgba(0,0,0,0.08);\n  transition: background-color .2s, color .2s, opacity .2s, transform .15s;\n  cursor:pointer;\n}\n.like-btn:hover{ background-color:#dcfce7; border-color:#4ade80; color:#166534; }\n.like-btn.liked{ background:#f0f0f0; color:#888; border-color:#ddd; opacity:.6; cursor:default; }\n.like-btn .like-count{\n  background:#86efac; color:#064e3b; padding:2px 8px; border-radius:12px;\n  font-size:14px; font-weight:bold;\n}\n@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}\n.pulse{animation:pulse .3s ease;}\n</style>\n\n\n\n:::\n\n \n\n##  {background-image=\"../figs/cha23.png\" background-size=\"1300px\" }\n\n\n\n\n\n\n\n\n\n## Chapter Outline {style=\"color: #000;\"}\n \n23.1 Equity Financing for Private Companies\n\n23.2 The Initial Public Offering\n\n23.3 IPO Puzzles\n\n23.4 The Seasoned Equity Offering\n\n\n\n\n\n\n\n\n\n\n\n\n\n# 23.1 Equity Financing for Private {.smaller background=\"#ead1dc\" }\n\n## 23.1 Equity Financing for Private {.smaller background=\"#ead1dc\" }\n\n\n- The initial capital that is required to start a business is usually provided by the entrepreneur.\n- Often, a private company must seek outside sources that can provide additional capital for growth.\n- It is important to understand how the infusion of outside capital will affect the control of the company.\n\n<!-- Define unique ID for this slide -->\n\n\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Sources of funding: Angel Investors**\n\n-   Individual Investors who buy equity in small private firms. Angel investors are often rich, successful entrepreneurs themselves who are willing to help new companies get started in exchange for a share of the business.\n-   The angel investment is usually necessary to kick off the business and the angel market is more well organized these days.\n-   Angel financing often occurs at such an early stage in the business that it is difficult to assess a value for the firm. Angel investors often circumvent this problem by holding either a convertible note or a SAFE (simple agreement for future equity) rather than equity.\n    -   Usually, angel investors have a share price discount over new investors.\n    -   Structuring the deal in this way allows **angels and entrepreneurs to agree on terms without agreeing on a value for the firm**, instead postponing the valuation decision until the firm is more mature and attractive to venture capitalists.\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Venture Capital Firm**\n\nA limited partnership that specializes in raising money to invest in the private equity of young firms.\n\n**Venture Capitalists**\n\nOne of the general partners who work for and run a venture capital firm.\n\n. . .\n\nVC firms offer limited partners advantages over investing directly in start-ups themselves as angel investors.\n\n-   Limited partners are more diversified.\n\n-   They also benefit from the expertise of the general partners.\n\n-   General partners usually charge substantial fees: over the return they make (carried interest) plus a an annual management fee of about 2% of the fund's committed capital.\n\n-   Usually, they demand great control (e.g., board seats).\n\n\n\n\n\n\n##  {.smaller background=\"#ead1dc\"}\n\n![](../figs/bm_23_1.jpg)\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Private Equity Firms**\n\n-   Organized very much like a venture capital firm, but it **invests in the equity of existing privately held firms** rather than start-up companies.\n-   Private equity firms also might initiate their investment by finding a publicly traded firm and purchasing the outstanding equity, thereby taking the company private in a transaction called a leveraged buyout (LBO).\n-   In most cases, the private equity firms use debt as well as equity to finance the purchase.\n-   Private equity firms also charge fees.\n-   Market value of PE firms greater than VC.\n\n\n\n\n\n\n##  {.smaller background=\"#ead1dc\"}\n\n![](../figs/bm_23_2.jpg)\n\n \n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Institutional Investors**\n\n-   Institutional investors, such as pension funds, insurance companies, endowments, and foundations, are **active investors in private companies**.\n-   Institutional investors **may invest directly** in private firms or they **may invest indirectly by becoming limited partners in venture capital firms**.\n\nEx. Blackrock funds, Vanguard funds.\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Corporate Investors**\n\n-   A corporation that invests in private companies.\n-   Also known as corporate partner, strategic partner, and strategic investor.\n-   Although most other types of investors in private firms are primarily interested in the financial returns of their investments, **corporate investors might invest for corporate strategic objectives**, in addition to the financial returns.\n\nEx. Google.\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Venture capital investing**\n\nWhen a company founder decides to sell equity to outside investors for the first time, **it is common practice for private companies to issue preferred stock rather than common stock to raise capital**.\n\n**Preferred Stock**\n\n-   Preferred stock issued by mature companies usually has a preferential dividend and seniority in any liquidation and sometimes special voting rights.\n-   Preferred stock issued by young companies has seniority in any liquidation but typically **does not pay regular cash dividends and often contains a right to convert to common stock**.\n\n. . .\n\n**Convertible Preferred Stock**\n\nPreferred stock that gives the owner an option to convert it into common stock on some future date.\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n-   Each time the firm raises money is referred to as a funding round, and each round will have its own set of securities with special terms and provisions.\n\n-   After a potential initial \"seed round,\" it is common to name the securities alphabetically, starting with Series A, Series B, etc\n\n-   Only then, the company has a market value.\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Book's example.**\n\n-   Real Networks, which was founded by Robert Glaser in 1993, with an investment of approximately 1 million by Glaser.\n-   In April 1995, Glaser's 1 million initial investment represented 13,713,439 shares of Series A preferred stock, implying an initial price of about \\$0.07 per share.\n-   The company's **first round of outside equity funding was Series B preferred stock**. Real Networks sold 2,686,567 shares of Series B preferred stock at 0.67 per share.\n-   At the price the new shares were sold for, Glaser's shares were worth 9.2 million and represented 83.6% of the outstanding shares.\n\n\n\n\n<center>\n![](../figs/bm_23_ex.png)\n\n\n</center>\n\n\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\n**Pre-Money Valuation**\n\n-   At the issuance of new equity, the value of the firm's prior shares outstanding at the price in the funding round\n    -   9.2 million in the RealNetworks example\n\n**Post-Money Valuation**\n\n-   At the issue of new equity, the value of the whole firm (old plus new shares) at the price at which the new equity sold\n    -   11.0 million in the RealNetworks example\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\"}\n\nOver the next few years, Real Networks raised three more rounds of outside equity in addition to the Series B funding round\n\n![](../figs/bm_23_ex2.png)\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\" visibility=\"hidden\"}\n\n**Problem**\n\nYou founded your own firm two years ago. Initially, you contributed 100,000 of your money and, in return, received 1,500,000 shares of stock.\n\nSince then, you have sold an additional 500,000 shares to angel investors.\n\nYou are now considering raising even more capital from a venture capitalist. The venture capitalist has agreed to invest 6 million with a post-money valuation of \\$10 million for the firm.\n\nAssuming that this is the venture capitalist's first investment in your company, **what percentage of the firm will she end up owning? What percentage will you own? What is the value of your shares?**\n\n## 23.1 Equity Financing for Private Comp. {.smaller background=\"#ead1dc\" visibility=\"hidden\"}\n\n**Solution**\n\nBecause the VC will invest 6 million out of the 10 million post-money valuation, her ownership percentage is 60%.\n\n. . .\n\nThe pre-money valuation is 10 ‚àí 6 = 4 million. As there are 2 million pre-money shares outstanding, this implies a share price of $\\frac{4 million}{2 million\\;shares}=2 \\;per\\;share$\n\n. . .\n\nThus, the V C will receive 3 million shares for her investment, and after this funding round, there will be a total of 5,000,000 shares outstanding.\n\n. . .\n\nYou will own $\\frac{1,5000,000}{3,000,000} = 30\\%$ of the firm and the post-transaction valuation of your shares is \\$3 million.\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\" visibility=\"hidden\"}\n\n**Problem**\n\n**Assume**\n\n-   You founded your own firm two years ago.\n-   You initially contributed \\$50,000 of your money and in return received 1,000,000 shares of stock.\n-   Since then, you have sold an additional 750,000 shares to angel investors.\n-   You are now considering raising even more capital from a venture capitalist.\n-   The venture capitalist would invest \\$2 million and would receive 2,000,000 newly issued shares.\n\n**What is the post-money valuation? Assuming that this is the venture capitalist's first investment in your company, what percentage of the firm will he end up owning? What percentage will you own? What is the value of your shares?**\n\n## 23.1 Equity Financing for Private Comp. {.smaller background=\"#ead1dc\" visibility=\"hidden\"}\n\n**Solution**\n\n|                             |           |        |\n|-----------------------------|-----------|--------|\n| Your shares                 | 1,000,000 | 26,67% |\n| Angel investor's shares     | 750,000   | 20,00% |\n| Venture capitalist's shares | 2,000,000 | 53,33% |\n| Total shares outstanding    | 3,750,000 | 100%   |\n\n-   The venture capitalist is paying \\$1 per share.\n-   Thus, the post-money valuation is \\$3,750,000.\n-   You will own 26.67% of the firm, and the post-money valuation of your shares is \\$1,000,000.\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\" visibility=\"hidden\"}\n\n**Venture Capital Financing Terms**\n\n**Liquidation Preference**: The liquidation preference specifies a minimum amount that must be paid to these security holders---before any payments to common stockholders---in the event of a liquidation, sale, or merger of the company. It is typically set to between 1 and 3 times the value of the initial investment.\n\n. . .\n\n**Seniority**: It is not uncommon for investors in later rounds to demand seniority over investors in earlier rounds, to ensure that they are repaid first. When later round investors accept securities with equal priority, they are said to be pari passu.\n\n. . .\n\n**Anti-Dilution Protection**: If things are not going well and the firm raises new funding at a lower price than in a prior round, it is referred to as a \"down round.\" Anti-dilution protection lowers the price at which investors in earlier rounds can convert their shares to common, effectively increasing their ownership percentage in a down round at the expense of founders and employees.\n\n. . .\n\n**Exit Strategy**: It details how investors will eventually realize the return from their investment\n\n\n\n\n\n\n\n\n## 23.1 Equity Financing for Private  {.smaller background=\"#ead1dc\" visibility=\"hidden\"}\n\n**Problem**\n\nIn addition to common shares, your firm raised 10 million in Series A financing with a 2x liquidation preference and a 25 million post-money valuation. **What is the minimum sale price such that the Series A investors will convert their shares?**\n\n**Solution**\n\n-   Series A investors have a liquidation preference of 2x 10 million = 20 million\n-   Series A investors own 10/25 of the firm.\n-   Because the Series A investors will receive up to 2x their investment from their liquidation preference, they will not be willing to convert their shares to common unless the value of the firm has at least doubled from 25 million to 50 million.\n-   At 50 million, Series A investors are willing to convert and the other common shareholders will receive the remaining 30 million.\n\n\n\n\n\n \n\n\n##  {.smaller background=\"#FFFFFF\" }\n\n::: {style=\"font-size: 40%; text-align: right;\"}\nKey: *module1_slide2*\n<input type=\"hidden\" id=\"slide-id\" value=\"module1_slide2\">\n:::\n\n::: {.question}\n\n**Post-money valuation and VC ownership**\n\n\n\n \nYou founded a firm three years ago. You started with $0.3 million, which gave you 1.5 million shares. You later sold 1 million shares to angel investors. Now, a VC firm wants to invest $6.7 million in exchange for 3 million new shares.\n\n::: {.question-block}\n<form onsubmit=\"event.preventDefault();\" style=\"display: flex; align-items: center; gap: 12px;\">\n  <label for=\"module1_num_q3a\"><strong>1. What is the post-money valuation (in million)?</strong></label>\n  <input type=\"number\" id=\"module1_num_q3a\" name=\"module1_num_q3a\" placeholder=\"Enter value\" style=\"width: 120px;\"\n         data-correct-answer=\"12.28\" data-tolerance=\"0.1\" />\n</form>\n<div id=\"feedback-module1_num_q3a\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ Post-money = Total shares √ó Price per share = (5.5) √ó (2.23) = **12.28 million**\n</div>\n:::\n\n::: {.question-block}\n<form onsubmit=\"event.preventDefault();\" style=\"display: flex; align-items: center; gap: 12px;\">\n  <label for=\"module1_num_q3b\"><strong>2. What percentage of the firm will the VC own?</strong></label>\n  <input type=\"number\" id=\"module1_num_q3b\" name=\"module1_num_q3b\" placeholder=\"Enter %\" style=\"width: 100px;\"\n         data-correct-answer=\"54.55\" data-tolerance=\"0.1\" />\n</form>\n<div id=\"feedback-module1_num_q3b\" class=\"feedback\" data-status=\"\" style=\"display:none;\">\n‚úÖ VC Ownership = 3 / (5.5) √ó 100 = **54.55%**\n</div>\n:::\n\n\n:::\n\n\n\n\n<div style=\"text-align: right;\">\n<script>\n// Fun√ß√£o auxiliar para verificar e definir o status de uma quest√£o.\nfunction checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance = 0) {\n  const feedbackDiv = document.getElementById(feedbackDivId);\n  if (!feedbackDiv) return;\n\n  let isCorrect = false;\n\n  // Trata respostas num√©ricas com toler√¢ncia\n if (typeof correctAnswer === 'number' && typeof userAnswer === 'number' && !isNaN(userAnswer)) {\n    const lowerBound = correctAnswer - tolerance;\n    const upperBound = correctAnswer + tolerance;\n    isCorrect = (userAnswer >= lowerBound && userAnswer <= upperBound);\n  } else if (typeof userAnswer === 'string') {\n    // Para respostas de texto (T/F, M√∫ltipla Escolha)\n    isCorrect = (userAnswer.trim().toUpperCase() === correctAnswer.toUpperCase());\n  }\n  // Adicione outras l√≥gicas de compara√ß√£o aqui se necess√°rio (ex: arrays para m√∫ltiplos checkboxes)\n\n  if (isCorrect) {\n    feedbackDiv.dataset.status = \"correct\";\n  } else {\n    feedbackDiv.dataset.status = \"incorrect\";\n  }\n  feedbackDiv.style.display = \"none\"; // Mant√©m o feedback oculto\n}\n\n// Fun√ß√£o para obter a resposta de um grupo de radio buttons\nfunction getSelectedRadioValue(name) {\n    const radios = document.querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]:checked`);\n    if (radios.length > 0) {\n        return radios[0].value;\n    }\n    return ''; // Retorna string vazia se nada for selecionado\n}\n\nfunction toggleFeedback() {\n  const questionBlocks = document.querySelectorAll('.question-block');\n  const feedbacks = document.querySelectorAll('.feedback');\n  const scoreDiv = document.getElementById('score-summary');\n  const toggleButton = document.getElementById('toggle-feedback-btn');\n\n  let showing = feedbacks.length > 0 && feedbacks[0].style.display === 'block';\n\n  if (showing) {\n    // Esconder feedback\n    feedbacks.forEach(f => {\n      f.style.display = 'none';\n      f.style.color = 'black'; // Reseta a cor ao esconder\n    });\n    scoreDiv.textContent = '';\n    toggleButton.textContent = 'Show Feedback';\n  } else {\n    // Mostrar feedback\n    let correctCount = 0;\n    let totalQuestions = 0;\n\n    questionBlocks.forEach(block => {\n      totalQuestions++;\n      const textInput = block.querySelector('input[type=\"text\"]');\n      const numberInput = block.querySelector('input[type=\"number\"]'); // Novo: input num√©rico\n      const form = block.querySelector('form');\n\n      let questionId, userAnswer, correctAnswer, tolerance = 0;\n      let feedbackDivId;\n\n      if (textInput && textInput.dataset.correctAnswer) {\n        // Quest√£o de texto (T/F)\n        questionId = textInput.id;\n        userAnswer = textInput.value;\n        correctAnswer = textInput.dataset.correctAnswer;\n      } else if (numberInput && numberInput.dataset.correctAnswer) {\n        // Quest√£o num√©rica\n        questionId = numberInput.id;\n        // Converte para n√∫mero. Se n√£o for um n√∫mero v√°lido, NaN.\n        userAnswer = parseFloat(numberInput.value);\n        correctAnswer = parseFloat(numberInput.dataset.correctAnswer);\n        if (numberInput.dataset.tolerance) {\n          tolerance = parseFloat(numberInput.dataset.tolerance);\n        }\n        // Se a resposta do usu√°rio n√£o for um n√∫mero v√°lido, trate como incorreta\n        if (isNaN(userAnswer)) {\n             userAnswer = null; // Mant√©m como valor num√©rico inv√°lido\n        }\n      } else if (form && form.querySelector('input[type=\"radio\"]') && form.dataset.correctAnswer) {\n        // Quest√£o de m√∫ltipla escolha (radio)\n        questionId = form.querySelector('input[type=\"radio\"]').name;\n        userAnswer = getSelectedRadioValue(questionId);\n        correctAnswer = form.dataset.correctAnswer;\n      } else {\n        // Se n√£o for um tipo de quest√£o reconhecido ou n√£o tem resposta correta\n        totalQuestions--; // N√£o conta esta quest√£o no total se n√£o puder ser avaliada\n        return; // Pula para a pr√≥xima quest√£o\n      }\n\n      feedbackDivId = 'feedback-' + questionId;\n      const feedbackDiv = document.getElementById(feedbackDivId);\n\n      if (feedbackDiv) { // Apenas processa se h√° um feedback div\n        checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance);\n\n        // Agora, exibe e colore o feedback ap√≥s a verifica√ß√£o\n        if (feedbackDiv.dataset.status === 'correct') {\n          feedbackDiv.style.color = 'green';\n          correctCount++;\n        } else if (feedbackDiv.dataset.status === 'incorrect') {\n          feedbackDiv.style.color = 'red';\n        } else {\n          feedbackDiv.style.color = 'black'; // Se n√£o foi respondida ou n√£o tem status\n        }\n        feedbackDiv.style.display = 'block'; // Exibe o feedback\n      }\n    });\n\n    scoreDiv.textContent = `‚úÖ  You answered ${correctCount} out of  ${totalQuestions}  correctly.`;\n    toggleButton.textContent = 'Hide Feedback';\n  }\n}\n</script>\n\n<button id=\"toggle-feedback-btn\" onclick=\"toggleFeedback()\"\n  style=\"background-color:#007BFF; color:white; padding:8px 16px; border:none; border-radius:5px; cursor:pointer;\">\n  Show Feedback\n</button>\n<div id=\"score-summary\" style=\"margin-top: 15px; font-weight: bold;\"></div>\n\n\n</div>\n\n\n\n\n\n\n# 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Initial Public Offering (IPO)**\n\nThe process of selling stock to the public for the first time.\n\nIt allows **greater liquidity**, and **better access to capital** at the cost of **more external monitoring** and **more demand for transparency**.\n\n. . .\n\n**Primary Offering**: New shares available in a public offering that raise new capital\n\n**Secondary Offering**: Shares sold by existing shareholders in an equity offering\n\n. . .\n\n**Underwriter**\n\nAn investment banking firm that manages a security issuance and designs its structure.\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Best-Efforts Basis**: For smaller IPOs, a situation in which the underwriter does not guarantee that the stock will be sold, but instead tries to sell the sock for the best possible price. Often such deals have an all-or-none clause: either all of the shares are sold on the IPO or the deal is called off.\n\n. . .\n\n**Firm Commitment**: An agreement between an underwriter and an issuing firm in which the underwriter guarantees that it will sell all of the stock at the offer price. Most common.\n\n. . .\n\n**Auction IPO**: A method of selling new issues directly to the public rather than setting a price itself and then allocating shares to buyers, the underwriter in an auction IPO takes bids from investors and then sets the price that clears the market.\n\n\n\n\n\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Problem**\n\n-   Ashton, Inc., is selling 900,000 shares of stock in an **auction IPO**.\n-   At the end of the bidding period, Ashton's investment bank has received the following bids. **What will be the offer price of the shares?**\n\n![](../figs/bm_23_2_table.png)\n\n. . .\n\n**Solution**: The winning auction price would be 9.25.\n\n\n\n\n\n\n\n\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Lead Underwriter**: The primary investment banking firm responsible for managing a security issuance.\n\n**Syndicate**: A group of underwriters who jointly underwrite and distribute a security issuance.\n\n-   Underwriters market the IPO, and they help the company with all the necessary filings.\n-   More importantly, they actively participate in determining the offer price.\n-   In many cases, the underwriter will also commit to making a market in the stock after the issue, thereby guaranteeing that the stock will be liquid.\n\n\n\n\n\n\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Filings**\n\n**Registration Statement**: A legal document that provides financial and other information about a company to investors prior to a security issuance. Company managers work closely with the underwriters to prepare this registration statement.\n\n**Preliminary Prospectus**: Part of the registration statement prepared by a company prior to an IPO that is circulated to investors before the stock is offered.\n\n**Final Prospectus**: Part of the final registration statement prepared by a company prior to an IPO that contains all the details of the offering, including the number of shares offered and the offer price. This document is created only after carefull revision.\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Valuation**: There are two ways to value a company: a) Compute the present value of the estimated future cash flows, or B) Estimate the value by examining comparables (recent IPOs).\n\n**Road Show**: During an IPO, when a company's senior management and its underwriters travel around promoting the company and explaining their rationale for an offer price to the underwriters' largest customers, mainly institutional investors such as mutual funds and pension funds.\n\n**Book Building**: A process used by underwriters for coming up with an offer price based on customers' expressions of interest. The book-building process provides an early indication of demand for the IPO. If demand appears to be weak in the target price range, the firm may choose to withdraw from the IPO process.\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\" visibility=\"hidden\"}\n\n**Problem**\n\n-   RAX House is a private company considering going public. RAX House has assets of 585 million and liabilities of 415 million. The firm's cash flow from operations was 137 million for the previous year.\n-   After the IPO, RAX House will have 118 million shares outstanding.\n-   The industry average **cash flow per share multiple is 3.0**, and the **average book value per share is 2.3**. Based on these multiples, **estimate the IPO price.**\n\n. . .\n\n**Solution**\n\nRAX House's book value of equity is $585 - 415 = 170 million$. With 118 million shares outstanding, book value per share is $\\frac{170}{118} = 1.44$ per share. Given the industry average of 2.3, the estimated IPO price would be 1.44 √ó 2.3 = 3.31 per share.\n\n. . .\n\nThe firm's cash flow from operations was 137 million, thus cash flow per share is $\\frac{137}{118} =1.16$. Given the industry average multiple of 3.0, the estimated IPO price would be 1.16 √ó 3.0 = 3.48.\n\n\n\n\n\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Spread**: The fee a company pays to its underwriters that is a percentage of the issue price of a share of stock.\n\n-   For instance, consider the final offer price is 12.50 per share, and the company paid the underwriters a spread of \\$0.875 per share, exactly 7% of the issue price.\n-   The underwriters buy the stock for 11.625 per share and then resold it to their customers for \\$12.50 per share.\n\n. . .\n\n-   When an underwriter provides a **firm commitment**, it is potentially exposing itself to the risk that the banking firm might have to sell the shares at less than the offer price and take a loss.\n    -   However, research shows that about 75% of IPOs experience an increase in share price on the first day (only 9% experience a decrease).\n\n\n\n\n\n\n\n## 23.2 The Initial Public Offering {.smaller background=\"#d9ead3\"}\n\n**Over-allotment allocation (greenshoe provision)**: In an IPO, an option that allows the underwriter to issue more stock, usually amounting to some % of the original offer size, at the IPO offer price.\n\n. . .\n\n**Lockup**: A restriction that prevents existing shareholders from selling their shares for some period, usually 180 days, after an IPO.\n\n# 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\"}\n\n## 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\"}\n\n1.  On average, IPOs appear to be **underpriced**: The price at the end of trading on the first day is often substantially higher than the IPO price.\n\n2.  The number of issues is **highly cyclical**: When times are good, the market is flooded with new issues; when times are bad, the number of issues dries up.\n\n3.  The **costs of an IPO are very high**, and it is unclear why firms willingly incur them (source: Berk & DeMarzo).\n\n4.  The **long-run performance of a newly public company (three to five years from the date of issue) is poor**. That is, on average, a three- to five-year buy and hold strategy appears to be a bad investment.\n\n\n\n\n\n\n## 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\"}\n\n**Underpricing**\n\n-   Generally, underwriters set the issue price so that the average first-day return is positive.\n-   Research has found that about 75% of first-day returns are positive. The average first-day return in the United States is 17%.\n-   The underwriters benefit from the under pricing because it allows them to manage their risk.\n-   The pre-IPO shareholders bear the cost of underpricing.\n-   In effect, these owners are selling stock in their firm for less than they could get in the aftermarket.\n\n\n\n\n\n\n## 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\" visibility=\"hidden\"}\n\n**Underpricing**\n\n-   Although IPO returns are attractive, all investors cannot earn these returns.\n-   When an IPO goes well, the demand for the stock exceeds the supply.\n-   Thus the allocation of shares for each investor is rationed.\n-   When an IPO does not go well, demand at the issue price is weak, so all initial orders are filled completely.\n-   Thus, the typical investor will have their investment in \"good\" IPOs rationed while fully investing in \"bad\" IPOs.\n\n**Winner's Curse**: Refers to a situation in competitive bidding when the high bidder, by virtue of being the high bidder, has very likely overestimated the value of the item being bid on. You \"win\" (get all the shares you requested) when demand for the shares by others is low and the IPO is more likely to perform poorly.\n\n\n\n\n\n\n## 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\"}\n\n**Cyclicality and Recent Trends**\n\n-   The number of issues is highly cyclical.\n-   When times are good, the market is flooded with new issues; when times are bad, the number of issues dries up.\n-   What is surprising is the magnitude of the swings.\n-   Another striking feature of the data in the following figure is that while the average dollar volume of IPOs since 2000 has been similar to that in the 1990s, the average number of IPOs per year has fallen significantly.\n\n\n\n\n\n\n##  {.smaller background=\"#FFD6A4\"}\n\n![](../figs/bm_23_5.jpg)\n\n\n\n\n\n\n## 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\"}\n\n**Costs of an IPO**\n\n-   A typical spread is 7% of the issue price.\n-   By most standards, this fee is large, especially considering the additional cost to the firm associated with underpricing.\n-   It is puzzling that there seems to be a lack of sensitivity of fees to issue size.\n-   One possible explanation is that by charging lower fees, an underwriter may risk signaling that it is not the same quality as its higher priced competitors.\n\n\n\n\n\n\n##  {.smaller background=\"#FFD6A4\"}\n\n![](../figs/bm_23_6.jpg)\n\n\n\n\n\n\n\n## 23.3 IPO Puzzles {.smaller background=\"#FFD6A4\"}\n\n**Long-Run Underperformance**\n\nAlthough shares of IPOs generally perform very well immediately following the public offering, it has been shown that newly listed firms subsequently appear to perform relatively poorly over the following three to five years after their IPOs.\n\n\n\n\n\n\n\n\n\n# 23.4  Seasoned Equity Offering {.smaller background=\"#f1f2c9\"}\n\n## 23.4  Seasoned Equity Offering {.smaller background=\"#f1f2c9\"}\n\n**Seasoned Equity Offering (SEO)**\n\n-   When a public company offers new shares for sale\n-   Public firms use SEOs to raise additional equity.\n-   When a firm issues stock using an SEO, it follows many of the same steps as for an IPO.\n-   The main difference is that a market price for the stock already exists, so the price-setting process is not necessary.\n\n. . .\n\n**Primary Shares**: New shares issued by a company in an equity offering.\n\n**Secondary Shares**: Shares sold by existing shareholders in an equity offering.\n\n\n\n\n\n\n\n\n\n\n\n\n## 23.4  Seasoned Equity Offering {.smaller background=\"#f1f2c9\"}\n\n**There are two types of seasoned equity offerings.**\n\n**Cash Offer**: A type of SEO in which a firm offers the new shares to investors at large.\n\n**Rights Offer**: A type of SEO in which a firm offers the new shares only to existing shareholders.\n\n-   Rights offers protect existing shareholders from underpricing.\n\n\n\n\n\n\n\n\n## 23.4  Seasoned Equity Offering {.smaller background=\"#f1f2c9\"}\n\n**Rights offers protect existing shareholders from underpricing.**\n\n-   Suppose a firm holds 100 in cash and has 50 shares out. Each share is worth 2.\n-   It announces a cash offer for 50 shares at 1 per share. Once this offer is complete, the company will have 150 in cash and 100 shares outstanding. The price per share is now 1.50. **The new shareholders therefore receive a 0.50 windfall at the expense of the old shareholders**.\n-   If it announces a rights offer, shareholders have the right to purchase an additional share for 1. If all shareholders chose to exercise their rights, then after the sale, the value of the firm is 150 with 100 shares outstanding and a price of 1.50 per share. **In this case, however, the 0.50 windfall accrues to existing shareholders, which exactly offsets the drop in the stock price.**\n-   By using a **rights offering** the firm can continue to issue equity without imposing a loss on its current shareholders.\n\n\n\n\n\n\n\n\n\n\n\n## 23.4  Seasoned Equity Offering {.smaller background=\"#f1f2c9\"}\n\n**Price Reaction**\n\n-   Researchers have found that, on average, the market greets the news of an SEO with a price decline. This is consistent with the adverse selection discussed in Chapter 16.\n\n**Issuance Costs**\n\n-   Although not as costly as IPOs, seasoned offerings are still expensive. Underwriting fees amount to 5% of the proceeds of the issue. Rights offers have lower costs than cash offers.\n\n\n\n\n\n## {.smaller background=\"#FFFFFF\" }\n\n\n::: {style=\"font-size: 40%; text-align: right;\"}\nKey: *module1_question3*\n<input type=\"hidden\" id=\"slide-id\" value=\"module1_question3\">\n:::\n\n::: {.question}\n\n\n**Net Proceeds in an SEO**\n\n\n\n\nOrion AutoTech executed a seasoned equity offering (SEO) of 10 million shares at $31.09 per share.\nOf these, 4.8 million were primary (new shares issued by the company) and 5.2 million were secondary (sold by existing investors).\nAssume the underwriter charges 4.5% of the gross proceeds as an underwriting fee which is shared proportionately between the primary and secondary shares.\n\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex;align-items:center;gap:8px;\"> <span ><strong>1. The amount of money raised by the company (in million USD) is:</strong></span> <input type=\"number\" id=\"module1_num_q7a\" name=\"module1_num_q7a\" placeholder=\"Value\" style=\"width:110px;\" data-correct-answer=\"142.5\" data-tolerance=\"0.5\" /> </form> <div id=\"feedback-module1_num_q7a\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ Net to issuer = (Primary Shares √ó Price) ‚àí Underwriter fee on primary = (4.8 √ó $31.09) ‚àí (4.5% √ó $149.23 million) = $149.23 million ‚àí $6.72 million = **$142.5 million**. </div> \n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex;align-items:center;gap:8px;\"> <span ><strong>2. The amount of money raised by the VC (in million USD) is:</strong></span> <input type=\"number\" id=\"module1_num_q7b\" name=\"module1_num_q7b\" placeholder=\"Value\" style=\"width:110px;\" data-correct-answer=\"154.4\" data-tolerance=\"0.5\" /> </form> <div id=\"feedback-module1_num_q7b\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ Net to VCs = (Secondary Shares √ó Price) ‚àí Underwriter fee on secondary = (5.2 √ó $31.09) ‚àí (4.5% √ó $161.67 million) = $161.67 million ‚àí $7.28 million = **$154.4 million**. </div> \n\n:::\n\n::: {.question-block}\n\n<form onsubmit=\"event.preventDefault();\" style=\"display:flex;align-items:center;gap:8px;\"> <span ><strong>3. The amount of money the underwriter will earn  (in million USD) is:</strong></span> <input type=\"number\" id=\"module1_num_q7c\" name=\"module1_num_q7c\" placeholder=\"Value\" style=\"width:110px;\" data-correct-answer=\"14\" data-tolerance=\"0.5\" /> </form> <div id=\"feedback-module1_num_q7c\" class=\"feedback\" data-status=\"\" style=\"display:none;\"> ‚úÖ Fee = (Total Shares √ó Price) √ó Fee Rate = (10 √ó $31.09) √ó 4.5% = $310.9 million √ó 4.5% = **$14 million**. </div> \n\n:::\n\n\n:::\n\n\n\n<div style=\"text-align: right;\">\n<script>\n// Fun√ß√£o auxiliar para verificar e definir o status de uma quest√£o.\nfunction checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance = 0) {\n  const feedbackDiv = document.getElementById(feedbackDivId);\n  if (!feedbackDiv) return;\n\n  let isCorrect = false;\n\n  // Trata respostas num√©ricas com toler√¢ncia\n if (typeof correctAnswer === 'number' && typeof userAnswer === 'number' && !isNaN(userAnswer)) {\n    const lowerBound = correctAnswer - tolerance;\n    const upperBound = correctAnswer + tolerance;\n    isCorrect = (userAnswer >= lowerBound && userAnswer <= upperBound);\n  } else if (typeof userAnswer === 'string') {\n    // Para respostas de texto (T/F, M√∫ltipla Escolha)\n    isCorrect = (userAnswer.trim().toUpperCase() === correctAnswer.toUpperCase());\n  }\n  // Adicione outras l√≥gicas de compara√ß√£o aqui se necess√°rio (ex: arrays para m√∫ltiplos checkboxes)\n\n  if (isCorrect) {\n    feedbackDiv.dataset.status = \"correct\";\n  } else {\n    feedbackDiv.dataset.status = \"incorrect\";\n  }\n  feedbackDiv.style.display = \"none\"; // Mant√©m o feedback oculto\n}\n\n// Fun√ß√£o para obter a resposta de um grupo de radio buttons\nfunction getSelectedRadioValue(name) {\n    const radios = document.querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]:checked`);\n    if (radios.length > 0) {\n        return radios[0].value;\n    }\n    return ''; // Retorna string vazia se nada for selecionado\n}\n\nfunction toggleFeedback() {\n  const questionBlocks = document.querySelectorAll('.question-block');\n  const feedbacks = document.querySelectorAll('.feedback');\n  const scoreDiv = document.getElementById('score-summary');\n  const toggleButton = document.getElementById('toggle-feedback-btn');\n\n  let showing = feedbacks.length > 0 && feedbacks[0].style.display === 'block';\n\n  if (showing) {\n    // Esconder feedback\n    feedbacks.forEach(f => {\n      f.style.display = 'none';\n      f.style.color = 'black'; // Reseta a cor ao esconder\n    });\n    scoreDiv.textContent = '';\n    toggleButton.textContent = 'Show Feedback';\n  } else {\n    // Mostrar feedback\n    let correctCount = 0;\n    let totalQuestions = 0;\n\n    questionBlocks.forEach(block => {\n      totalQuestions++;\n      const textInput = block.querySelector('input[type=\"text\"]');\n      const numberInput = block.querySelector('input[type=\"number\"]'); // Novo: input num√©rico\n      const form = block.querySelector('form');\n\n      let questionId, userAnswer, correctAnswer, tolerance = 0;\n      let feedbackDivId;\n\n      if (textInput && textInput.dataset.correctAnswer) {\n        // Quest√£o de texto (T/F)\n        questionId = textInput.id;\n        userAnswer = textInput.value;\n        correctAnswer = textInput.dataset.correctAnswer;\n      } else if (numberInput && numberInput.dataset.correctAnswer) {\n        // Quest√£o num√©rica\n        questionId = numberInput.id;\n        // Converte para n√∫mero. Se n√£o for um n√∫mero v√°lido, NaN.\n        userAnswer = parseFloat(numberInput.value);\n        correctAnswer = parseFloat(numberInput.dataset.correctAnswer);\n        if (numberInput.dataset.tolerance) {\n          tolerance = parseFloat(numberInput.dataset.tolerance);\n        }\n        // Se a resposta do usu√°rio n√£o for um n√∫mero v√°lido, trate como incorreta\n        if (isNaN(userAnswer)) {\n             userAnswer = null; // Mant√©m como valor num√©rico inv√°lido\n        }\n      } else if (form && form.querySelector('input[type=\"radio\"]') && form.dataset.correctAnswer) {\n        // Quest√£o de m√∫ltipla escolha (radio)\n        questionId = form.querySelector('input[type=\"radio\"]').name;\n        userAnswer = getSelectedRadioValue(questionId);\n        correctAnswer = form.dataset.correctAnswer;\n      } else {\n        // Se n√£o for um tipo de quest√£o reconhecido ou n√£o tem resposta correta\n        totalQuestions--; // N√£o conta esta quest√£o no total se n√£o puder ser avaliada\n        return; // Pula para a pr√≥xima quest√£o\n      }\n\n      feedbackDivId = 'feedback-' + questionId;\n      const feedbackDiv = document.getElementById(feedbackDivId);\n\n      if (feedbackDiv) { // Apenas processa se h√° um feedback div\n        checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance);\n\n        // Agora, exibe e colore o feedback ap√≥s a verifica√ß√£o\n        if (feedbackDiv.dataset.status === 'correct') {\n          feedbackDiv.style.color = 'green';\n          correctCount++;\n        } else if (feedbackDiv.dataset.status === 'incorrect') {\n          feedbackDiv.style.color = 'red';\n        } else {\n          feedbackDiv.style.color = 'black'; // Se n√£o foi respondida ou n√£o tem status\n        }\n        feedbackDiv.style.display = 'block'; // Exibe o feedback\n      }\n    });\n\n    scoreDiv.textContent = `‚úÖ  You answered ${correctCount} out of  ${totalQuestions}  correctly.`;\n    toggleButton.textContent = 'Hide Feedback';\n  }\n}\n</script>\n\n<button id=\"toggle-feedback-btn\" onclick=\"toggleFeedback()\"\n  style=\"background-color:#007BFF; color:white; padding:8px 16px; border:none; border-radius:5px; cursor:pointer;\">\n  Show Feedback\n</button>\n<div id=\"score-summary\" style=\"margin-top: 15px; font-weight: bold;\"></div>\n\n\n</div>\n\n\n\n\n\n\n \n\n\n\n\n\n\n# Now it is your turn... { background=\"#191f36\" visibility=\"hidden\"}\n\n\n## Now it is your turn... { background=\"#191f36\"}\n\n\n<div style=\"font-family: sans-serif; display: flex; flex-direction: column; align-items: center; gap: 16px; margin-top: 30px;\">\n\n  <a href=\"https://henriquemartins.net/teaching/financial_strategy/module1/p1tf.html\" target=\"_blank\"\n     style=\"text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);\">\n    ‚úÖ True / False Questions\n  </a>\n\n  <a href=\"https://henriquemartins.net/teaching/financial_strategy/module1/p1num.html\" target=\"_blank\"\n     style=\"text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);\">\n    üî¢ Numeric Questions\n  </a>\n\n  <a href=\"https://henriquemartins.net/teaching/financial_strategy/module1/p1mcq.html\" target=\"_blank\"\n     style=\"text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);\">\n    üìù Multiple Choice\n  </a>\n\n  <a href=\"https://henriquemartins.net/teaching/financial_strategy/module1/p1long.html\" target=\"_blank\"\n     style=\"text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);\">\n    ‚úçÔ∏è Long-form Answers\n  </a>\n\n</div>\n\n\n::: footer\n:::\n\n\n\n\n\n\n\n\n\n\n\n##  { background=\"#f7f9fc\" }\n\n<div data-ticket\n     data-bridge=\"https://course-chat.hcmrtns.workers.dev/checkouts\"\n     data-session=\"module1_checkout1\"\n     data-page=\"module1_checkout1\"\n     data-require-login=\"true\"\n     data-open=\"2026-01-02 16:30\"\n     data-close=\"2026-02-02 16:59\">\n</div>\n\n<!-- checkout2.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) -->\n<style>\n  /* ===== Tokens (light) ‚Äî exit-checkout colors ===== */\n  :root{\n    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);\n    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;\n    --focus:rgba(59,130,246,.22);\n    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;\n    --textarea-bg:#fff;\n\n    /* ribbon colors by state */\n    --ribbon-open-1: rgba(34,197,94,.18);   /* green */\n    --ribbon-open-2: rgba(16,185,129,.16);\n    --ribbon-soon-1: rgba(245,158,11,.18);  /* amber */\n    --ribbon-soon-2: rgba(251,191,36,.16);\n    --ribbon-closed-1: rgba(239,68,68,.20); /* red */\n    --ribbon-closed-2: rgba(248,113,113,.16);\n    --ribbon-default-1: rgba(99,102,241,.14); /* blue (fallback) */\n    --ribbon-default-2: rgba(96,165,250,.14);\n  }\n  @media (prefers-color-scheme: dark){\n    :root{\n      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);\n      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);\n      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;\n      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;\n      --textarea-bg:rgba(2,6,23,.55);\n    }\n  }\n\n  /* Card */\n  [data-ticket] .tw-card{\n    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;\n    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);\n    color:var(--ink);overflow:hidden;box-sizing:border-box;\n  }\n  [data-ticket] .tw-card::before{\n    content:\"\";position:absolute;inset:0 0 auto 0;height:56px;\n    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));\n    pointer-events:none;\n  }\n  /* ribbon by state */\n  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }\n  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }\n  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }\n\n  /* Header */\n  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}\n  [data-ticket] .tw-icon{\n    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;\n    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;\n  }\n  [data-ticket] .tw-icon::after{\n    content:\"\";position:absolute;inset:-3px;border-radius:14px;\n    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));\n    z-index:-1;filter:blur(6px);opacity:.55;\n  }\n  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}\n  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}\n  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}\n  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}\n\n  /* Badges */\n  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}\n  [data-ticket] .tw-badge{\n    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;\n    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;\n  }\n  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{\n    color:currentColor;stroke:currentColor!important;fill:none;\n  }\n  [data-ticket] .tw-window-text{white-space:pre-line;}\n\n  /* Status dot */\n  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}\n  [data-ticket].open  .tw-dot{background:#16a34a;}\n  [data-ticket].soon  .tw-dot{background:#f59e0b;}\n  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}\n\n  /* Textarea */\n  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}\n  [data-ticket] textarea.tw-text{\n    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;\n    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;\n    resize:vertical;color:var(--ink);box-sizing:border-box;\n  }\n  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}\n  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}\n\n  /* Footer & messages */\n  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;}\n  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}\n  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}\n  [data-ticket] .tw-msg.success{color:#059669!important;}\n  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}\n  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}\n  /* match dot color if no explicit class was set */\n  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}\n  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}\n  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}\n\n  /* Button */\n  [data-ticket] .tw-btn{\n    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);\n    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;\n    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;\n  }\n  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}\n  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}\n  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}\n  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}\n\n  /* Spinner */\n  [data-ticket] .spin:after{\n    content:\"\";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);\n    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;\n  }\n  @keyframes twspin{to{transform:rotate(360deg)}}\n\n  /* Mini-login */\n  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}\n  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}\n\n  /* Responsive */\n  @media (max-width:640px){\n    [data-ticket] .tw-card{border-radius:14px;padding:14px;}\n    [data-ticket] .tw-header{gap:10px;}\n    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}\n  }\n</style>\n\n<script>\n(() => {\n  const $ = (sel, el=document) => el.querySelector(sel);\n\n  function mountAll(){\n    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);\n  }\n\n  function initOne(host){\n    host.setAttribute('data-tw-mounted','1');\n\n    // ===== NEW: min/max chars =====\n    const MIN_CHARS = 100;\n    const MAX_CHARS = 500;\n\n    // ---- Config/attrs\n    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();\n    const sessionTag = (host.getAttribute('data-session') || '').trim();\n    const pageAttr   = (host.getAttribute('data-page') || '').trim();\n    const winStartStr= (host.getAttribute('data-open') || '').trim();\n    const winEndStr  = (host.getAttribute('data-close') || '').trim();\n    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';\n\n    // ---- Helpers\n    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;\n    const winStart = parseLocal(winStartStr);\n    const winEnd   = parseLocal(winEndStr);\n\n    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };\n    function statusNow(){\n      const now = new Date();\n      if (!winStart || !winEnd) return {state:'open', label:'Always available'};\n      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }\n      if (now > winEnd)   return {state:'closed', label:'Closed'};\n      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};\n    }\n    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();\n    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);\n\n    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };\n    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;\n    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };\n    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };\n\n    // ---- UI skeleton\n    host.innerHTML = '';\n    const card = document.createElement('div'); card.className = 'tw-card';\n    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\\n‚Üí ' + winEndStr) : 'No window set';\n    card.innerHTML = `\n      <div class=\"tw-header\">\n        <div class=\"tw-icon\" aria-hidden=\"true\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>\n        </div>\n        <div class=\"tw-titles\">\n          <div class=\"tw-title\">Check-out</div>\n          <div class=\"tw-sub\"></div>\n        </div>\n        <div class=\"tw-meta\">\n          <div class=\"tw-badge\"><span class=\"tw-dot\"></span><span class=\"tw-badge-text\">‚Äî</span></div>\n          <div class=\"tw-badge\" title=\"S√£o Paulo time\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"opacity:.8\"><path d=\"M12 7v5l4 2\" stroke=\"#334155\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#334155\" stroke-width=\"1.5\" fill=\"none\"/></svg>\n            <span class=\"tw-window-text\">${windowLabel}</span>\n          </div>\n        </div>\n      </div>\n      <div class=\"tw-login\" style=\"display:none\">\n        <input type=\"text\" class=\"tw-login-input\" placeholder=\"Digite seu ID / e-mail do curso\"/>\n        <button type=\"button\" class=\"tw-btn tw-login-btn\">Entrar</button>\n      </div>\n      <div class=\"tw-body\"></div>\n      <div class=\"tw-footer\">\n        <button type=\"button\" class=\"tw-btn tw-send\">Send (click only 1x)</button>\n        <div class=\"tw-count\">0/${MAX_CHARS}</div>\n      </div>\n      <div class=\"tw-msg\"></div>`;\n    host.appendChild(card);\n\n    // refs\n    const body = $('.tw-body', card);\n    const btn  = $('.tw-send', card);\n    const msg  = $('.tw-msg', card);\n    const badgeText = $('.tw-badge-text', card);\n    const count = $('.tw-count', card);\n    const loginRow = $('.tw-login', card);\n    const loginInp = $('.tw-login-input', card);\n    const loginBtn = $('.tw-login-btn', card);\n\n    // textarea\n    const ta = document.createElement('textarea');\n    ta.className = 'tw-text';\n    ta.maxLength = MAX_CHARS;\n    ta.placeholder = `Your check-out (min ${MIN_CHARS}, max ${MAX_CHARS}): one thing you learned + one idea of application + one question‚Ä¶`;\n    body.appendChild(ta);\n\n    const getLen = () => ta.value.trim().length;\n\n    ta.addEventListener('input', () => {\n      count.textContent = `${ta.value.length}/${MAX_CHARS}`;\n      syncEnabled();\n    });\n    count.textContent = `0/${MAX_CHARS}`;\n\n    const successMsg = 'Check-out recorded. Thank you!';\n    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';\n\n    function paintBadge(){\n      const st = statusNow();\n      host.classList.remove('open','soon','closed'); host.classList.add(st.state);\n      badgeText.textContent = st.label;\n    }\n\n    function showLoginIfNeeded(){\n      const need = requireLogin && !getStudentId();\n      loginRow.style.display = need ? 'flex' : 'none';\n    }\n\n    function syncEnabled(){\n      const logged = !requireLogin || !!getStudentId();\n      const st     = statusNow().state;\n      const len    = getLen();\n      const okLen  = len >= MIN_CHARS;\n      const enabled= logged && (st==='open') && okLen && !isDone();\n      btn.disabled = !enabled;\n\n      showLoginIfNeeded(); paintBadge();\n\n      if (isDone()){\n        setMsg(msg, dupMsg, 'success');\n        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;\n      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');\n      else if (st==='soon') setMsg(msg,'Not open yet.','warning');\n      else if (st==='closed') setMsg(msg,'This activity is closed.','error');\n      else if (len === 0) setMsg(msg, `Write your check-out (min ${MIN_CHARS} characters).`, 'warning');\n      else if (!okLen) setMsg(msg, `Keep going: ${MIN_CHARS - len} more characters needed.`, 'warning');\n      else setMsg(msg,''); // ready\n    }\n\n    // mini-login\n    loginBtn?.addEventListener('click', () => {\n      const v = (loginInp.value || '').trim();\n      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }\n      try { localStorage.setItem('studentId', v); } catch {}\n      window.studentId = v;\n      document.dispatchEvent(new Event('auth:login'));\n      setMsg(msg,''); syncEnabled();\n    });\n\n    // timers + cleanup\n    paintBadge(); syncEnabled();\n    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);\n    const obs = new MutationObserver(() => {\n      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }\n    });\n    obs.observe(document.body, {childList:true, subtree:true});\n    document.addEventListener('auth:login', syncEnabled);\n\n    // Submit\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault(); e.stopPropagation();\n\n      const sid = getStudentId();\n      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }\n\n      const trimmed = ta.value.trim();\n      const len = trimmed.length;\n\n      if (len < MIN_CHARS){\n        setMsg(msg, `Minimum is ${MIN_CHARS} characters. You need ${MIN_CHARS - len} more.`, 'warning');\n        return;\n      }\n\n      const text = trimmed.slice(0, MAX_CHARS);\n      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }\n\n      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');\n\n      const payload = {\n        student_id: sid,\n        slide_id: (sessionTag || getPageId()),\n        ticket: text,\n        tsClient: new Date().toISOString(),\n        open:  winStartStr,\n        close: winEndStr,\n        user_agent: navigator.userAgent\n      };\n\n      try{\n        const res = await fetch(bridge, {\n          method:'POST',\n          headers:{ 'Content-Type':'application/json' },\n          body: JSON.stringify(payload),\n          keepalive:true\n        });\n\n        const raw = await res.text();\n        let data = null; try{ data = JSON.parse(raw); }catch(_){}\n\n        if (!res.ok){\n          if (data && data.status === 'closed_window'){\n            setMsg(msg,'This activity is closed now.','error');\n          } else {\n            setMsg(msg,'Failed to submit. Please try again.','error');\n          }\n          console.error('[checkout2] HTTP error:', res.status, raw);\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        if (data && data.status === 'success'){\n          setMsg(msg, successMsg, 'success');\n          ta.value=''; count.textContent=`0/${MAX_CHARS}`;\n          markDone(btn); clearInterval(ticker);\n          return;\n        }\n        if (data && data.status === 'duplicate'){\n          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;\n        }\n        if (data && data.status === 'closed_window'){\n          setMsg(msg,'This activity is closed now.','error');\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        setMsg(msg,'Failed to submit. Please try again.','error');\n        console.error('[checkout2] unexpected response:', raw);\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }catch(err){\n        console.error('[checkout2] submit error:', err);\n        setMsg(msg,'Network error. Please try again.','error');\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }\n    });\n  }\n\n  if (document.readyState === 'loading'){\n    document.addEventListener('DOMContentLoaded', mountAll, { once:true });\n  } else {\n    mountAll();\n  }\n})();\n</script>\n\n\n\n\n\n\n\n\n##  { background=\"#f7f9fc\" }\n\n<div data-ticket\n     data-bridge=\"https://course-chat.hcmrtns.workers.dev/checkouts\"\n     data-session=\"module1_checkout2\"\n     data-page=\"module1_checkout2\"\n     data-require-login=\"true\"\n     data-open=\"2026-02-04 16:30\"\n     data-close=\"2026-02-04 16:59\">\n</div>\n\n<!-- checkout2.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) -->\n<style>\n  /* ===== Tokens (light) ‚Äî exit-checkout colors ===== */\n  :root{\n    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);\n    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;\n    --focus:rgba(59,130,246,.22);\n    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;\n    --textarea-bg:#fff;\n\n    /* ribbon colors by state */\n    --ribbon-open-1: rgba(34,197,94,.18);   /* green */\n    --ribbon-open-2: rgba(16,185,129,.16);\n    --ribbon-soon-1: rgba(245,158,11,.18);  /* amber */\n    --ribbon-soon-2: rgba(251,191,36,.16);\n    --ribbon-closed-1: rgba(239,68,68,.20); /* red */\n    --ribbon-closed-2: rgba(248,113,113,.16);\n    --ribbon-default-1: rgba(99,102,241,.14); /* blue (fallback) */\n    --ribbon-default-2: rgba(96,165,250,.14);\n  }\n  @media (prefers-color-scheme: dark){\n    :root{\n      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);\n      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);\n      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;\n      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;\n      --textarea-bg:rgba(2,6,23,.55);\n    }\n  }\n\n  /* Card */\n  [data-ticket] .tw-card{\n    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;\n    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);\n    color:var(--ink);overflow:hidden;box-sizing:border-box;\n  }\n  [data-ticket] .tw-card::before{\n    content:\"\";position:absolute;inset:0 0 auto 0;height:56px;\n    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));\n    pointer-events:none;\n  }\n  /* ribbon by state */\n  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }\n  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }\n  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }\n\n  /* Header */\n  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}\n  [data-ticket] .tw-icon{\n    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;\n    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;\n  }\n  [data-ticket] .tw-icon::after{\n    content:\"\";position:absolute;inset:-3px;border-radius:14px;\n    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));\n    z-index:-1;filter:blur(6px);opacity:.55;\n  }\n  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}\n  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}\n  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}\n  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}\n\n  /* Badges */\n  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}\n  [data-ticket] .tw-badge{\n    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;\n    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;\n  }\n  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{\n    color:currentColor;stroke:currentColor!important;fill:none;\n  }\n  [data-ticket] .tw-window-text{white-space:pre-line;}\n\n  /* Status dot */\n  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}\n  [data-ticket].open  .tw-dot{background:#16a34a;}\n  [data-ticket].soon  .tw-dot{background:#f59e0b;}\n  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}\n\n  /* Textarea */\n  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}\n  [data-ticket] textarea.tw-text{\n    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;\n    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;\n    resize:vertical;color:var(--ink);box-sizing:border-box;\n  }\n  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}\n  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}\n\n  /* Footer & messages */\n  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;}\n  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}\n  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}\n  [data-ticket] .tw-msg.success{color:#059669!important;}\n  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}\n  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}\n  /* match dot color if no explicit class was set */\n  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}\n  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}\n  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}\n\n  /* Button */\n  [data-ticket] .tw-btn{\n    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);\n    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;\n    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;\n  }\n  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}\n  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}\n  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}\n  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}\n\n  /* Spinner */\n  [data-ticket] .spin:after{\n    content:\"\";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);\n    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;\n  }\n  @keyframes twspin{to{transform:rotate(360deg)}}\n\n  /* Mini-login */\n  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}\n  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}\n\n  /* Responsive */\n  @media (max-width:640px){\n    [data-ticket] .tw-card{border-radius:14px;padding:14px;}\n    [data-ticket] .tw-header{gap:10px;}\n    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}\n  }\n</style>\n\n<script>\n(() => {\n  const $ = (sel, el=document) => el.querySelector(sel);\n\n  function mountAll(){\n    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);\n  }\n\n  function initOne(host){\n    host.setAttribute('data-tw-mounted','1');\n\n    // ===== NEW: min/max chars =====\n    const MIN_CHARS = 100;\n    const MAX_CHARS = 500;\n\n    // ---- Config/attrs\n    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();\n    const sessionTag = (host.getAttribute('data-session') || '').trim();\n    const pageAttr   = (host.getAttribute('data-page') || '').trim();\n    const winStartStr= (host.getAttribute('data-open') || '').trim();\n    const winEndStr  = (host.getAttribute('data-close') || '').trim();\n    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';\n\n    // ---- Helpers\n    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;\n    const winStart = parseLocal(winStartStr);\n    const winEnd   = parseLocal(winEndStr);\n\n    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };\n    function statusNow(){\n      const now = new Date();\n      if (!winStart || !winEnd) return {state:'open', label:'Always available'};\n      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }\n      if (now > winEnd)   return {state:'closed', label:'Closed'};\n      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};\n    }\n    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();\n    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);\n\n    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };\n    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;\n    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };\n    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };\n\n    // ---- UI skeleton\n    host.innerHTML = '';\n    const card = document.createElement('div'); card.className = 'tw-card';\n    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\\n‚Üí ' + winEndStr) : 'No window set';\n    card.innerHTML = `\n      <div class=\"tw-header\">\n        <div class=\"tw-icon\" aria-hidden=\"true\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>\n        </div>\n        <div class=\"tw-titles\">\n          <div class=\"tw-title\">Check-out</div>\n          <div class=\"tw-sub\"></div>\n        </div>\n        <div class=\"tw-meta\">\n          <div class=\"tw-badge\"><span class=\"tw-dot\"></span><span class=\"tw-badge-text\">‚Äî</span></div>\n          <div class=\"tw-badge\" title=\"S√£o Paulo time\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"opacity:.8\"><path d=\"M12 7v5l4 2\" stroke=\"#334155\" stroke-width=\"1.7\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"#334155\" stroke-width=\"1.5\" fill=\"none\"/></svg>\n            <span class=\"tw-window-text\">${windowLabel}</span>\n          </div>\n        </div>\n      </div>\n      <div class=\"tw-login\" style=\"display:none\">\n        <input type=\"text\" class=\"tw-login-input\" placeholder=\"Digite seu ID / e-mail do curso\"/>\n        <button type=\"button\" class=\"tw-btn tw-login-btn\">Entrar</button>\n      </div>\n      <div class=\"tw-body\"></div>\n      <div class=\"tw-footer\">\n        <button type=\"button\" class=\"tw-btn tw-send\">Send (click only 1x)</button>\n        <div class=\"tw-count\">0/${MAX_CHARS}</div>\n      </div>\n      <div class=\"tw-msg\"></div>`;\n    host.appendChild(card);\n\n    // refs\n    const body = $('.tw-body', card);\n    const btn  = $('.tw-send', card);\n    const msg  = $('.tw-msg', card);\n    const badgeText = $('.tw-badge-text', card);\n    const count = $('.tw-count', card);\n    const loginRow = $('.tw-login', card);\n    const loginInp = $('.tw-login-input', card);\n    const loginBtn = $('.tw-login-btn', card);\n\n    // textarea\n    const ta = document.createElement('textarea');\n    ta.className = 'tw-text';\n    ta.maxLength = MAX_CHARS;\n    ta.placeholder = `Your check-out (min ${MIN_CHARS}, max ${MAX_CHARS}): one thing you learned + one idea of application + one question‚Ä¶`;\n    body.appendChild(ta);\n\n    const getLen = () => ta.value.trim().length;\n\n    ta.addEventListener('input', () => {\n      count.textContent = `${ta.value.length}/${MAX_CHARS}`;\n      syncEnabled();\n    });\n    count.textContent = `0/${MAX_CHARS}`;\n\n    const successMsg = 'Check-out recorded. Thank you!';\n    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';\n\n    function paintBadge(){\n      const st = statusNow();\n      host.classList.remove('open','soon','closed'); host.classList.add(st.state);\n      badgeText.textContent = st.label;\n    }\n\n    function showLoginIfNeeded(){\n      const need = requireLogin && !getStudentId();\n      loginRow.style.display = need ? 'flex' : 'none';\n    }\n\n    function syncEnabled(){\n      const logged = !requireLogin || !!getStudentId();\n      const st     = statusNow().state;\n      const len    = getLen();\n      const okLen  = len >= MIN_CHARS;\n      const enabled= logged && (st==='open') && okLen && !isDone();\n      btn.disabled = !enabled;\n\n      showLoginIfNeeded(); paintBadge();\n\n      if (isDone()){\n        setMsg(msg, dupMsg, 'success');\n        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;\n      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');\n      else if (st==='soon') setMsg(msg,'Not open yet.','warning');\n      else if (st==='closed') setMsg(msg,'This activity is closed.','error');\n      else if (len === 0) setMsg(msg, `Write your check-out (min ${MIN_CHARS} characters).`, 'warning');\n      else if (!okLen) setMsg(msg, `Keep going: ${MIN_CHARS - len} more characters needed.`, 'warning');\n      else setMsg(msg,''); // ready\n    }\n\n    // mini-login\n    loginBtn?.addEventListener('click', () => {\n      const v = (loginInp.value || '').trim();\n      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }\n      try { localStorage.setItem('studentId', v); } catch {}\n      window.studentId = v;\n      document.dispatchEvent(new Event('auth:login'));\n      setMsg(msg,''); syncEnabled();\n    });\n\n    // timers + cleanup\n    paintBadge(); syncEnabled();\n    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);\n    const obs = new MutationObserver(() => {\n      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }\n    });\n    obs.observe(document.body, {childList:true, subtree:true});\n    document.addEventListener('auth:login', syncEnabled);\n\n    // Submit\n    btn.addEventListener('click', async (e) => {\n      e.preventDefault(); e.stopPropagation();\n\n      const sid = getStudentId();\n      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }\n\n      const trimmed = ta.value.trim();\n      const len = trimmed.length;\n\n      if (len < MIN_CHARS){\n        setMsg(msg, `Minimum is ${MIN_CHARS} characters. You need ${MIN_CHARS - len} more.`, 'warning');\n        return;\n      }\n\n      const text = trimmed.slice(0, MAX_CHARS);\n      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }\n\n      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');\n\n      const payload = {\n        student_id: sid,\n        slide_id: (sessionTag || getPageId()),\n        ticket: text,\n        tsClient: new Date().toISOString(),\n        open:  winStartStr,\n        close: winEndStr,\n        user_agent: navigator.userAgent\n      };\n\n      try{\n        const res = await fetch(bridge, {\n          method:'POST',\n          headers:{ 'Content-Type':'application/json' },\n          body: JSON.stringify(payload),\n          keepalive:true\n        });\n\n        const raw = await res.text();\n        let data = null; try{ data = JSON.parse(raw); }catch(_){}\n\n        if (!res.ok){\n          if (data && data.status === 'closed_window'){\n            setMsg(msg,'This activity is closed now.','error');\n          } else {\n            setMsg(msg,'Failed to submit. Please try again.','error');\n          }\n          console.error('[checkout2] HTTP error:', res.status, raw);\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        if (data && data.status === 'success'){\n          setMsg(msg, successMsg, 'success');\n          ta.value=''; count.textContent=`0/${MAX_CHARS}`;\n          markDone(btn); clearInterval(ticker);\n          return;\n        }\n        if (data && data.status === 'duplicate'){\n          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;\n        }\n        if (data && data.status === 'closed_window'){\n          setMsg(msg,'This activity is closed now.','error');\n          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n          return;\n        }\n\n        setMsg(msg,'Failed to submit. Please try again.','error');\n        console.error('[checkout2] unexpected response:', raw);\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }catch(err){\n        console.error('[checkout2] submit error:', err);\n        setMsg(msg,'Network error. Please try again.','error');\n        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';\n      }\n    });\n  }\n\n  if (document.readyState === 'loading'){\n    document.addEventListener('DOMContentLoaded', mountAll, { once:true });\n  } else {\n    mountAll();\n  }\n})();\n</script>\n\n\n\n\n\n\n\n\n\n\n\n\n\n## üôã‚Äç‚ôÇÔ∏è **Any Questions?** { background=\"#fdf6e3\"}\n\n::: columns\n::: {.column width=\"50%\"}\n### Thank You!\n\n![](../figs/qa2.png){width=\"110%\" style=\"box-shadow: none;\"}\n\n:::\n\n::: {.column width=\"50%\"}\n<div style=\"text-align:right;\">\n  <img src=\"../figs/avatar.jpg\" width=\"120px\" style=\"border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);\" />\n</div>\n\n### **Henrique C. Martins**\n\n- üåê [FGV/EAESP](https://eaesp.fgv.br/en/people/henrique-castro-martins)  \n- üíº [LinkedIn](https://www.linkedin.com/in/henriquecastror/)  \n- üß† [Google Scholar](https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&hl=pt-BR&oi=ao)  \n- üìÑ [Lattes CV](http://lattes.cnpq.br/6076997472159785)  \n- üè† [Personal Website](https://henriquemartins.net/)  \n:::\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
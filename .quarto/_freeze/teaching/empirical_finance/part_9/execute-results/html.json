{
  "hash": "08f06de75a1a7fb3ca8821c1bcd06637",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Empirical Methods in Finance'\nsubtitle: 'Part 9'\nauthor: 'Henrique C. Martins'\nformat:\n  revealjs: \n    slide-number: true\n    theme: simple\n    chalkboard: true\n    preview-links: auto\n    logo: figs/background8.png\n    css: logo.css\n    footer: '**[**Henrique C. Martins**] [[henrique.martins@fgv.br](mailto:henrique.martins@fgv.br)][Do not use without permission]**  '\n    multiplex: true\n    scrollable: true \ntitle-slide-attributes:\n    data-background-color: \"#b1cafa\"\ninclude-after: |\n  <script type=\"text/javascript\">\n    Reveal.on('ready', event => {\n      if (event.indexh === 0) {\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n    });\n    Reveal.addEventListener('slidechanged', (event) => {\n      if (event.indexh === 0) {\n        Reveal.configure({ slideNumber: null });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n      if (event.indexh === 1) { \n        Reveal.configure({ slideNumber: 'c' });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = null;\n      }\n    });\n  </script>\n\n---\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Synthetic Control {.smaller background=\"#f2c7c4\"}\n\n## Synthetic Control {.smaller background=\"#f2c7c4\"}\n\nIt is a method to estimate the effect of events or policy interventions, often at an **aggregate level** (cities, states, etc.)\n\nThe event occurs often in **only one unit**.\n\nIt compares the evolution of the  outcome for the treated unit to the evolution of the control group.\n\n- The control group contains many units. \n\n. . . \n\nThe limitation is often the selection of the control group. It is very **ambiguous**.\n\n\n\n\n\n\n## Synthetic Control {.smaller background=\"#f2c7c4\"}\n\n[Abadie, Diamond, and Hainmueller (2010)](https://doi.org/10.1198/jasa.2009.ap08746) apply synth  by using a cigarette tax in California called Proposition 99.\n\n*In 1988, California passed comprehensive tobacco control legislation called Proposition 99.*\n\n*Proposition 99 increased cigarette taxes by $0.25 a pack, spurred clean-air ordinances throughout the state, funded anti-smoking media campaigns, earmarked tax revenues to health and anti-smoking budgets, and produced more than $100 million a year in anti-tobacco projects.*\n\n*Other states had similar control programs, and they were dropped from their analysis.* [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#cuba-miami-and-the-mariel-boatlift)\n\n\n\n\n\n\n## Synthetic Control {.smaller background=\"#f2c7c4\"}\n\nThere was a trend before the treatment. **How can we estimate the causal effect?**\n\n![](figs/synth1.png)\n\n\n\n\n\n\n\n## Synthetic Control {.smaller background=\"#f2c7c4\"}\n\nThe goal is to  elect an optimal set of weights that when applied to the rest of the country produces the following figure: \n\n![](figs/synth3.png)\n\n\n## Synthetic Control {.smaller background=\"#f2c7c4\"}\n\nThe variables used for computing the weights are the following. You are creating weights such that weighting the other states, you can create a synthetic California. **Notice that, so far, the product of this analysis is only two data points per period.** \n\n\n![](figs/synth2.png)\n\n\n\n## Synthetic Control {.smaller background=\"#f2c7c4\"}\n\n**Tip**: Synth is also an graphical method, so graphs like the following are common. This is the difference between the two series.\n\n![](figs/synth4.png)\n\n\n\n\n# Inference {.smaller background=\"#d49692\"}\n\n## Inference {.smaller background=\"#d49692\"}\n\n\n**Notice that, so far, the product of this analysis is only two data points per period.** How can you stablish a \"significant\" causal effect?\n\n\n**Steps**\n\n1) Apply synth to each state in the control group (also called \"donor pool\"). \n\n2) Obtain a distribution of placebos.\n\n3) Compare the gap for California to the distribution of the placebo gaps.\n\n4) Then, test whether the effect for the treated unit is large enough relative to the placebos (i.e., to the effect estimated for a placebo unit randomly selected).\n\n\n\n\n\n\n\n## Inference {.smaller background=\"#d49692\"}\n\nNotice the bold line (treated unit) after the treatment. It is at the bottom. \n\n![](figs/synth5.png)\n\n## Inference {.smaller background=\"#d49692\"}\n\n*Abadie, Diamond, and Hainmueller (2010) recommend iteratively dropping the states whose pre-treatment RMSPE is considerably different than California’s because as you can see, they’re kind of blowing up the scale and making it hard to see what’s going on.* [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#cuba-miami-and-the-mariel-boatlift)\n\n![](figs/synth6.png)\n\n\n\n\n\n\n## Inference {.smaller background=\"#d49692\"}\n\nThe previous figure suggests the effect is large enough relative to the placebo effects.\n\n. . . \n\n\n1) The root mean squared prediction error (RMSPE) is:\n\n$$RMSPE = \\bigg (\\dfrac{1}{T-T_0} \\sum_{t=T_0+t}^T \\bigg (Y_{1t} - \\sum_{j=2}^{J+1} w_j^* Y_{jt} \\bigg )^2 \\bigg )^{\\tfrac{1}{2}}$$\n\n*It shows how far predictions fall from measured true values using Euclidean distance.*\n\n\n\n2) Sort the ratio post- to pre-treatment RMSPE in descending order\n\n3) Calculate the p-value as $\\frac{Rank}{Total}$.\n\n\n. . . \n\nBasically, these steps give how likely is the occurrence of the treated unit distance vis-a-vis the average placebo.\n\n\n\n\n\n\n\n\n\n\n\n## Inference {.smaller background=\"#d49692\"}\n\n**RMSPE**: in the previous example, California has the largest increase in the error after the treatment. Position 1 out of 39 states, implying an exact p-value of $\\frac{1}{38}=0.026$ (significant). \n\n\n\n![](figs/synth7.png)\n\n\n\n\n\n\n\n\n\n\n\n\n# Example Synth  {.smaller background=\"#f5a7a2\"}\n\n## Example Synth  {.smaller background=\"#f5a7a2\"}\n\n::: panel-tabset\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/synth_smoking.dta , clear\ntsset state year\nsynth cigsale beer(1984(1)1988) lnincome retprice age15to24 cigsale(1988) cigsale(1980) cigsale(1975), trunit(3) trperiod(1989) \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Tobacco Sales in 39 US States)\n\n\nPanel variable: state (strongly balanced)\n Time variable: year, 1970 to 2000\n         Delta: 1 unit\n\n-------------------------------------------------------------------------------\nSynthetic Control Method for Comparative Case Studies\n-------------------------------------------------------------------------------\n\nFirst Step: Data Setup\n-------------------------------------------------------------------------------\ncontrol units: for 38 of out 38 units missing obs for predictor lnincome in per\n> iod 1970 -ignored for averaging\ncontrol units: for 38 of out 38 units missing obs for predictor lnincome in per\n> iod 1971 -ignored for averaging\ntreated unit: for 1 of out 1 units missing obs for predictor lnincome in period\n>  1970 -ignored for averaging\ntreated unit: for 1 of out 1 units missing obs for predictor lnincome in period\n>  1971 -ignored for averaging\n-------------------------------------------------------------------------------\nData Setup successful\n-------------------------------------------------------------------------------\n                Treated Unit: California\n               Control Units: Alabama, Arkansas, Colorado, Connecticut,\n                              Delaware, Georgia, Idaho, Illinois, Indiana,\n                              Iowa, Kansas, Kentucky, Louisiana, Maine,\n                              Minnesota, Mississippi, Missouri, Montana,\n                              Nebraska, Nevada, New Hampshire, New Mexico,\n                              North Carolina, North Dakota, Ohio, Oklahoma,\n                              Pennsylvania, Rhode Island, South Carolina, South\n                              Dakota, Tennessee, Texas, Utah, Vermont,\n                              Virginia, West Virginia, Wisconsin, Wyoming\n-------------------------------------------------------------------------------\n          Dependent Variable: cigsale\n  MSPE minimized for periods: 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979\n                              1980 1981 1982 1983 1984 1985 1986 1987 1988\nResults obtained for periods: 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979\n                              1980 1981 1982 1983 1984 1985 1986 1987 1988 1989\n                              1990 1991 1992 1993 1994 1995 1996 1997 1998 1999\n                              2000\n-------------------------------------------------------------------------------\n                  Predictors: beer(1984(1)1988) lnincome retprice age15to24\n                              cigsale(1988) cigsale(1980) cigsale(1975)\n-------------------------------------------------------------------------------\nUnless period is specified\npredictors are averaged over: 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979\n                              1980 1981 1982 1983 1984 1985 1986 1987 1988\n-------------------------------------------------------------------------------\n\nSecond Step: Run Optimization\n-------------------------------------------------------------------------------\n-------------------------------------------------------------------------------\nOptimization done\n-------------------------------------------------------------------------------\n\nThird Step: Obtain Results\n-------------------------------------------------------------------------------\nLoss: Root Mean Squared Prediction Error\n\n---------------------\n   RMSPE |  1.943233 \n---------------------\n-------------------------------------------------------------------------------\nUnit Weights:\n\n----------------------------\n         Co_No | Unit_Weight\n---------------+------------\n       Alabama |           0\n      Arkansas |           0\n      Colorado |        .285\n   Connecticut |        .101\n      Delaware |           0\n       Georgia |           0\n         Idaho |           0\n      Illinois |           0\n       Indiana |           0\n          Iowa |           0\n        Kansas |           0\n      Kentucky |           0\n     Louisiana |           0\n         Maine |           0\n     Minnesota |           0\n   Mississippi |           0\n      Missouri |           0\n       Montana |           0\n      Nebraska |           0\n        Nevada |        .245\n New Hampshire |           0\n    New Mexico |           0\nNorth Carolina |           0\n  North Dakota |           0\n          Ohio |           0\n      Oklahoma |           0\n  Pennsylvania |           0\n  Rhode Island |           0\nSouth Carolina |           0\n  South Dakota |           0\n     Tennessee |           0\n         Texas |           0\n          Utah |        .369\n       Vermont |           0\n      Virginia |           0\n West Virginia |           0\n     Wisconsin |           0\n       Wyoming |           0\n----------------------------\n-------------------------------------------------------------------------------\nPredictor Balance:\n\n------------------------------------------------------\n                               |   Treated  Synthetic \n-------------------------------+----------------------\n             beer(1984(1)1988) |     24.28   23.22596 \n                      lnincome |  10.03176   9.867266 \n                      retprice |  66.63684   65.40743 \n                     age15to24 |  .1786624   .1825559 \n                 cigsale(1988) |      90.1    92.6063 \n                 cigsale(1980) |     120.2   120.3907 \n                 cigsale(1975) |     127.1   126.7094 \n------------------------------------------------------\n-------------------------------------------------------------------------------\n\ncounter | pri_inf  | dual_inf  | pri_obj   | dual_obj  | sigfig | alpha  | nu \n----------------------------------------------------------------------------------\n      0 | 8.29e+001 | 7.80e-006 | -1.26e+001 | -3.93e+002 |  0.000 | 0.0000 | 1.00e+002\n      1 | 5.04e-001 | 4.74e-008 | -1.26e+001 | -7.02e+002 |  0.000 | 0.9939 | 3.05e-005\n      2 | 2.85e-003 | 2.68e-010 | -1.25e+001 | -2.80e+001 |  0.000 | 0.9943 | 2.70e-006\n      3 | 1.60e-004 | 1.51e-011 | -1.26e+001 | -1.34e+001 |  1.193 | 0.9438 | 5.40e-006\n      4 | 1.57e-005 | 1.47e-012 | -1.26e+001 | -1.27e+001 |  2.000 | 0.9022 | 9.21e-007\n      5 | 9.72e-006 | 9.13e-013 | -1.26e+001 | -1.27e+001 |  2.207 | 0.3806 | 6.37e-006\n      6 | 2.91e-006 | 2.73e-013 | -1.26e+001 | -1.26e+001 |  2.714 | 0.7006 | 8.69e-007\n      7 | 5.05e-007 | 4.75e-014 | -1.26e+001 | -1.26e+001 |  3.414 | 0.8263 | 8.90e-008\n      8 | 1.70e-007 | 1.60e-014 | -1.26e+001 | -1.26e+001 |  3.881 | 0.6640 | 6.85e-008\n      9 | 2.24e-008 | 2.10e-015 | -1.26e+001 | -1.26e+001 |  4.685 | 0.8682 | 3.46e-009\n     10 | 2.57e-010 | 2.43e-017 | -1.26e+001 | -1.26e+001 |  6.512 | 0.9885 | 4.02e-012\n     11 | 1.28e-012 | 1.87e-018 | -1.26e+001 | -1.26e+001 |  8.807 | 0.9950 | 1.14e-014\n     12 | 6.45e-015 | 1.86e-018 | -1.26e+001 | -1.26e+001 | 11.104 | 0.9950 | 5.78e-017\n     13 | 8.88e-016 | 2.02e-018 | -1.26e+001 | -1.26e+001 | 13.407 | 0.9950 | 2.91e-019\n----------------------------------------------------------------------------------\noptimization converged\n```\n\n\n:::\n:::\n\n\n:::\n\n\n## Example Synth  {.smaller background=\"#f5a7a2\"}\n\n::: panel-tabset\n\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/synth_smoking.dta , clear\nsynth cigsale beer lnincome(1980&1985) retprice cigsale(1988) cigsale(1980) cigsale(1975), trunit(3) trperiod(1989) fig\nquietly graph export figs/synth1.svg, replace\n```\n:::\n\n\n![](figs/synth1.svg)\n\n:::\n\n\n\n\n\n\n\n\n\n## Example Synth  {.smaller background=\"#f5a7a2\"}\n\n\n*Authors using synthetic control must do more than merely run the synth command when doing comparative case studies.* \n\n*They must find the exact-values through placebo-based inference, check for the quality of the pre-treatment fit, investigate the balance of the covariates used for matching, and check for the validity of the model through placebo estimation (e.g., rolling back the treatment date).*\n\n\n\n\n\n\n\n\n\n\n\n\n\n# [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\n\n## [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\nIn 1992, Texas expanded the prision system operational capacity.\n\n![](figs/synth8.png)\n\n\n\n\n\n\n\n## [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\nThis is what happened.\n\n![](figs/synth9.png)\n\n\n\n\n\n\n## [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\nSynthetic Texas.\n\n![](figs/synth10.png)\n\n\n\n\n## [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\nGap between Synthetic Texas and Texas.\n\n![](figs/synth11.png)\n\n\n\n\n## [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\nBuilding Placebos.\n\n![](figs/synth13.png)\n\n\n\n\n## [Mastering Metrics](https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration)  {.smaller background=\"#de938e\"}\n\nTexas is the one in the far right tail. \n\n![](figs/synth12.png)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 🙋‍♂️ **Any Questions?**{ .smaller  background=\"#fdf6e3\"}\n\n::: columns\n::: {.column width=\"50%\"}\n### Thank You!\n\n![](figs/qa2.png){width=\"110%\" style=\"box-shadow: none;\"}\n\n:::\n\n::: {.column width=\"50%\"}\n<div style=\"text-align:right;\">\n  <img src=\"figs/avatar.jpg\" width=\"120px\" style=\"border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);\" />\n</div>\n\n### **Henrique C. Martins**\n\n- 🌐 [FGV/EAESP](https://eaesp.fgv.br/en/people/henrique-castro-martins)  \n- 💼 [LinkedIn](https://www.linkedin.com/in/henriquecastror/)  \n- 🧠 [Google Scholar](https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&hl=pt-BR&oi=ao)  \n- 📄 [Lattes CV](http://lattes.cnpq.br/6076997472159785)  \n- 🏠 [Personal Website](https://henriquemartins.net/)  \n:::\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
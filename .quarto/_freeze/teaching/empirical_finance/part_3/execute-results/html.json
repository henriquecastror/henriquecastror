{
  "hash": "daee5b8022b85f969b3e84380f8d3b95",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Empirical Methods in Finance'\nsubtitle: 'Part 3'\nauthor: 'Henrique C. Martins'\nformat:\n  revealjs: \n    slide-number: true\n    theme: simple\n    chalkboard: true\n    preview-links: auto\n    logo: figs/background8.png\n    css: logo.css\n    footer: '**[**Henrique C. Martins**] [[henrique.martins@fgv.br](mailto:henrique.martins@fgv.br)][Do not use without permission]**  '\n    multiplex: true\n    scrollable: true \ntitle-slide-attributes:\n    data-background-color: \"#b1cafa\"\ninclude-after: |\n  <script type=\"text/javascript\">\n    Reveal.on('ready', event => {\n      if (event.indexh === 0) {\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n    });\n    Reveal.addEventListener('slidechanged', (event) => {\n      if (event.indexh === 0) {\n        Reveal.configure({ slideNumber: null });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n      }\n      if (event.indexh === 1) { \n        Reveal.configure({ slideNumber: 'c' });\n        document.querySelector(\"div.has-logo > img.slide-logo\").style.display = null;\n      }\n    });\n  </script>\n\n---\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Conterfactuals {.smaller background=\"#b3eafc\"}\n\n## Conterfactuals {.smaller background=\"#b3eafc\"}\n\n-   Imagine that John and Mary are moving to the north of Canada.\n\n-   John has a history of respiratory disease and decide to buy insurance.\n\n-   Mary does not have a history of respiratory disease and decide not to buy insurance.\n\n-   What is the causal effect of buying insurance?\n\n| Default                     | John   |   Mary |\n|-----------------------------|:-------|-------:|\n| State of insurance          | 1      |      0 |\n| Situation without insurance | `n.o.` |      5 |\n| Situation with insurance    | 4      | `n.o.` |\n| Observed                    | 4      |      5 |\n| Effect                      | ?      |      ? |\n\n[Source: Mastering Metrics](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845)\n\n\n\n\n\n\n\n\n## Conterfactuals {.smaller background=\"#b3eafc\"}\n\n**Naïve calculation: comparing John com Mary**\n\n$$Y_{john} - Y_{Mary} = 4 - 5 = -1$$\n\nConclusion: buying insurance has a negative effect on health.\n\n. . .\n\n**This is wrong!**\n\n[Source: Mastering Metrics](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845)\n\n## Conterfactuals {.smaller background=\"#b3eafc\"}\n\n| Default                     | John | Mary |\n|-----------------------------|:-----|-----:|\n| State of insurance          | 1    |    0 |\n| Situation without insurance | `3`  |    5 |\n| Situation with insurance    | 4    |  `5` |\n| Observed                    | 4    |    5 |\n| Effect                      | ?    |    ? |\n\n$$(Y_{1,john} - Y_{0,john}) + (Y_{1,Mary}- Y_{0,Mary}) = 4 - 3 + 5 - 5 = 0.5$$\n\n**Conclusion:** buying insurance has a positive effect of 1 in John's health and average effect of 0.5 in the sample's health (i.e. averages conditional on insurance status).\n\n[Source: Mastering Metrics](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Regressions {.smaller background=\"#dfe3f7\"}\n\n## Regression [Source: Mastering Metrics](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n**Let's see how a regression could solve the problem.** Imagine that you have the following data on students' application. (**Decisions in bold**)\n\n| Student | Private   | Private   | Private   | Public    | Public    | Public    | Earnings |\n|---------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|\n|         | Ivy       | Leafy     | Smart     | State     | Tall      | Altered   | 110,000  |\n| 1       |           | Reject    | **Admit** |           | Admit     |           | 110,000  |\n| 2       |           | Reject    | **Admit** |           | Admit     |           | 100,000  |\n| 3       |           | Reject    | Admit     |           | **Admit** |           | 110,000  |\n| 4       | **Admit** |           | Admit     |           | Admit     | Admit     | 60,000   |\n| 5       | Admit     |           | Admit     |           | Admit     | **Admit** | 30,000   |\n| 6       |           | **Admit** |           |           |           |           | 115,000  |\n| 7       |           | **Admit** |           |           |           |           | 75,000   |\n| 8       | Reject    |           |           | **Admit** | Admit     |           | 90,000   |\n| 9       | Reject    |           |           | Admit     | **Admit** |           | 60,000   |\n\n\n\n\n\n\n\n\n## Regression [Source: Mastering Metrics](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n**We can see from the table that:**\n\n-   Some students earn high salary, in both situations\n\n-   Some students earn low salary, in both situations\n\n-   There are clusters of students that applied for the same universities\n\n    -   How likely are they to be similar? Can we benefit from the fact they believe they are similar?\n\n. . .\n\n-   If we compare earnings from the first three individuals:\n\n    -   ((110 + 100)/ 2 - 11000) = -5.000\n\n-   If we compare earnings from individuals 4 and 5:\n\n    -   (60 - 30) = 30.000\n\n-   The average is:\n\n    -   25.000/2 = 12.500\n\n\n\n\n\n\n\n\n\n\n\n## Regression [Source](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\nLet's create a dataframe to run regressions with the previous student's data.\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Create the data frame\ndata <- data.frame(\n  id = 1:9,\n  earnings = c(110000, 100000, 110000, 60000, 30000, 115000, 75000, 90000, 60000),\n  school = c(\"private\", \"private\", \"public\", \"private\", \"public\", \"private\", \"private\", \"public\", \"public\"),\n  private = c(1, 1, 0, 1, 0, 1, 1, 0, 0),\n  group = c(1, 1, 1, 2, 2, 3, 3, 4, 4)\n)\nprint(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id earnings  school private group\n1  1   110000 private       1     1\n2  2   100000 private       1     1\n3  3   110000  public       0     1\n4  4    60000 private       1     2\n5  5    30000  public       0     2\n6  6   115000 private       1     3\n7  7    75000 private       1     3\n8  8    90000  public       0     4\n9  9    60000  public       0     4\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\ndata = pd.DataFrame({\n    'id': range(1, 10),\n    'earnings': [110000, 100000, 110000, 60000, 30000, 115000, 75000, 90000, 60000],\n    'school': [\"private\", \"private\", \"public\", \"private\", \"public\", \"private\", \"private\", \"public\", \"public\"],\n    'private': [1, 1, 0, 1, 0, 1, 1, 0, 0],\n    'group': [1, 1, 1, 2, 2, 3, 3, 4, 4]\n})\nprint(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   id  earnings   school  private  group\n0   1    110000  private        1      1\n1   2    100000  private        1      1\n2   3    110000   public        0      1\n3   4     60000  private        1      2\n4   5     30000   public        0      2\n5   6    115000  private        1      3\n6   7     75000  private        1      3\n7   8     90000   public        0      4\n8   9     60000   public        0      4\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\ninput id earnings str7 school private group\n1 110000 \"private\" 1 1\n2 100000 \"private\" 1 1\n3 110000 \"public\" 0 1\n4 60000 \"private\" 1 2\n5 30000 \"public\" 0 2\n6 115000 \"private\" 1 3\n7 75000 \"private\" 1 3\n8 90000 \"public\" 0 4\n9 60000 \"public\" 0 4\nend\nlist\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            id   earnings     school    private      group\n  1. 1 110000 \"private\" 1 1\n  2. 2 100000 \"private\" 1 1\n  3. 3 110000 \"public\" 0 1\n  4. 4 60000 \"private\" 1 2\n  5. 5 30000 \"public\" 0 2\n  6. 6 115000 \"private\" 1 3\n  7. 7 75000 \"private\" 1 3\n  8. 8 90000 \"public\" 0 4\n  9. 9 60000 \"public\" 0 4\n 10. end\n\n     +-------------------------------------------+\n     | id   earnings    school   private   group |\n     |-------------------------------------------|\n  1. |  1     110000   private         1       1 |\n  2. |  2     100000   private         1       1 |\n  3. |  3     110000    public         0       1 |\n  4. |  4      60000   private         1       2 |\n  5. |  5      30000    public         0       2 |\n     |-------------------------------------------|\n  6. |  6     115000   private         1       3 |\n  7. |  7      75000   private         1       3 |\n  8. |  8      90000    public         0       4 |\n  9. |  9      60000    public         0       4 |\n     +-------------------------------------------+\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n\n\n\n## \"Naive\" regression all students [Source](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\epsilon$$ **What is the benefit of private education here?**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Create the data frame\nmodel <- lm(earnings ~ private, data = data)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = earnings ~ private, data = data)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-42500 -17000   8000  18000  37500 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)   \n(Intercept)    72500      14522   4.992  0.00158 **\nprivate        19500      19484   1.001  0.35023   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29040 on 7 degrees of freedom\nMultiple R-squared:  0.1252,\tAdjusted R-squared:  0.0002116 \nF-statistic: 1.002 on 1 and 7 DF,  p-value: 0.3502\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n#pip install numpy scikit-learn statsmodels\nimport statsmodels.api as sm\nX = sm.add_constant(data['private'])  \ny = data['earnings']\nmodel = sm.OLS(y, X).fit()\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:               earnings   R-squared:                       0.125\nModel:                            OLS   Adj. R-squared:                  0.000\nMethod:                 Least Squares   F-statistic:                     1.002\nDate:                qua, 11 set 2024   Prob (F-statistic):              0.350\nTime:                        16:17:18   Log-Likelihood:                -104.13\nNo. Observations:                   9   AIC:                             212.3\nDf Residuals:                       7   BIC:                             212.7\nDf Model:                           1                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst        7.25e+04   1.45e+04      4.992      0.002    3.82e+04    1.07e+05\nprivate      1.95e+04   1.95e+04      1.001      0.350   -2.66e+04    6.56e+04\n==============================================================================\nOmnibus:                        1.011   Durbin-Watson:                   2.352\nProb(Omnibus):                  0.603   Jarque-Bera (JB):                0.666\nSkew:                          -0.263   Prob(JB):                        0.717\nKurtosis:                       1.776   Cond. No.                         2.77\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nquiet input id earnings str7 school private group\n1 110000 \"private\" 1 1\n2 100000 \"private\" 1 1\n3 110000 \"public\" 0 1\n4 60000 \"private\" 1 2\n5 30000 \"public\" 0 2\n6 115000 \"private\" 1 3\n7 75000 \"private\" 1 3\n8 90000 \"public\" 0 4\n9 60000 \"public\" 0 4\nend\n\nreg earnings private \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Source |       SS           df       MS      Number of obs   =         9\n-------------+----------------------------------   F(1, 7)         =      1.00\n       Model |   845000000         1   845000000   Prob > F        =    0.3502\n    Residual |  5.9050e+09         7   843571429   R-squared       =    0.1252\n-------------+----------------------------------   Adj R-squared   =    0.0002\n       Total |  6.7500e+09         8   843750000   Root MSE        =     29044\n\n------------------------------------------------------------------------------\n    earnings | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n     private |      19500   19483.51     1.00   0.350    -26571.18    65571.18\n       _cons |      72500   14522.15     4.99   0.002     38160.57    106839.4\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n\n\n\n## \"Naive\" regression all students [Source](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\epsilon$$ **What is the benefit of private education here?**\n\nThe coefficient of `private` is 19500, meaning that those that have private education earn 19500 more.\n\n. . . \n\nThe problem with this design is that 1) we are including all students, even those that do not bring any \"information\", and 2) we are not controlling for the differences in students' profiles. \n\n\nLet's fix the first problem first. \n\n**What students should we not include in the model?**\n\n\n\n\n\n## Students id\\<=5 [Source](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\epsilon \\;,\\; if\\; i <=5$$ **What is the benefit of private education here?**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nmodel2 <- lm(earnings ~ private , data = subset(data,id<=5))\nsummary(model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = earnings ~ private, data = subset(data, id <= 5))\n\nResiduals:\n     1      2      3      4      5 \n 20000  10000  40000 -30000 -40000 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    70000      27689   2.528   0.0856 .\nprivate        20000      35746   0.560   0.6149  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 39160 on 3 degrees of freedom\nMultiple R-squared:  0.09449,\tAdjusted R-squared:  -0.2073 \nF-statistic: 0.313 on 1 and 3 DF,  p-value: 0.6149\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n#pip install numpy scikit-learn statsmodels\n\nsubset_data = data[data['id'] <= 5]\nX = sm.add_constant(subset_data['private']) \ny = subset_data['earnings']\nmodel2 = sm.OLS(y, X).fit()\nprint(model2.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:               earnings   R-squared:                       0.094\nModel:                            OLS   Adj. R-squared:                 -0.207\nMethod:                 Least Squares   F-statistic:                    0.3130\nDate:                qua, 11 set 2024   Prob (F-statistic):              0.615\nTime:                        16:17:20   Log-Likelihood:                -58.694\nNo. Observations:                   5   AIC:                             121.4\nDf Residuals:                       3   BIC:                             120.6\nDf Model:                           1                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst           7e+04   2.77e+04      2.528      0.086   -1.81e+04    1.58e+05\nprivate         2e+04   3.57e+04      0.560      0.615   -9.38e+04    1.34e+05\n==============================================================================\nOmnibus:                          nan   Durbin-Watson:                   1.304\nProb(Omnibus):                    nan   Jarque-Bera (JB):                0.520\nSkew:                          -0.129   Prob(JB):                        0.771\nKurtosis:                       1.441   Cond. No.                         2.92\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nquiet input id earnings str7 school private group\n1 110000 \"private\" 1 1\n2 100000 \"private\" 1 1\n3 110000 \"public\" 0 1\n4 60000 \"private\" 1 2\n5 30000 \"public\" 0 2\n6 115000 \"private\" 1 3\n7 75000 \"private\" 1 3\n8 90000 \"public\" 0 4\n9 60000 \"public\" 0 4\nend\nreg earnings private if id<=5\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Source |       SS           df       MS      Number of obs   =         5\n-------------+----------------------------------   F(1, 3)         =      0.31\n       Model |   480000000         1   480000000   Prob > F        =    0.6149\n    Residual |  4.6000e+09         3  1.5333e+09   R-squared       =    0.0945\n-------------+----------------------------------   Adj R-squared   =   -0.2073\n       Total |  5.0800e+09         4  1.2700e+09   Root MSE        =     39158\n\n------------------------------------------------------------------------------\n    earnings | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n     private |      20000   35746.02     0.56   0.615    -93759.78    133759.8\n       _cons |      70000   27688.75     2.53   0.086    -18117.95    158117.9\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n## Students id\\<=5 [Source](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\epsilon \\;,\\; if\\; i <=5$$ **What is the benefit of private education here?**\n\nStudents 6 and 7 only applied to Private, while students 8 and 9 did not really had a choice. So we should exclude them.\n\n. . .\n\nThe benefit of private is now 20000.\n\nThe coefficient did not change much, but the design improved partially.\n\n. . .\n\nWe still have an uncontrolled \"heterogeneity\" in the groups of students. **Students 1 to 3 seem to earn more no matter their decisions**.\n\n\n\n\n\n\n\n## Apples-to-Apples [Source](https://www.amazon.com.br/Mastering-Metrics-Path-Cause-Effect/dp/0691152845) {.smaller background=\"#dfe3f7\"}\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\beta_2 Group+ \\epsilon \\;,\\; if\\; i <=5$$ **This is the best we can do.**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\ndata$dummy <- ifelse(data$group == 1, 1, 0)\ndata$dummy[data$group == 2] <- 0\nmodel3 <- lm(earnings ~ private + dummy, data = subset(data,id<=5))\nsummary(model3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = earnings ~ private + dummy, data = subset(data, \n    id <= 5))\n\nResiduals:\n         1          2          3          4          5 \n 1.182e-11 -1.000e+04  1.000e+04  1.000e+04 -1.000e+04 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    40000      11952   3.347   0.0789 .\nprivate        10000      13093   0.764   0.5248  \ndummy          60000      13093   4.583   0.0445 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 14140 on 2 degrees of freedom\nMultiple R-squared:  0.9213,\tAdjusted R-squared:  0.8425 \nF-statistic:  11.7 on 2 and 2 DF,  p-value: 0.07874\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n#pip install numpy scikit-learn statsmodels\n\ndata['dummy'] = 1\ndata.loc[data['group'] == 2, 'dummy'] = 0\nsubset_data = data[data['id'] <= 5]\nX = sm.add_constant(subset_data[['private', 'dummy']])\ny = subset_data['earnings']\nmodel3 = sm.OLS(y, X).fit()\nprint(model3.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:               earnings   R-squared:                       0.921\nModel:                            OLS   Adj. R-squared:                  0.843\nMethod:                 Least Squares   F-statistic:                     11.70\nDate:                qua, 11 set 2024   Prob (F-statistic):             0.0787\nTime:                        16:17:23   Log-Likelihood:                -52.589\nNo. Observations:                   5   AIC:                             111.2\nDf Residuals:                       2   BIC:                             110.0\nDf Model:                           2                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst           4e+04    1.2e+04      3.347      0.079   -1.14e+04    9.14e+04\nprivate         1e+04   1.31e+04      0.764      0.525   -4.63e+04    6.63e+04\ndummy           6e+04   1.31e+04      4.583      0.044    3665.052    1.16e+05\n==============================================================================\nOmnibus:                          nan   Durbin-Watson:                   2.250\nProb(Omnibus):                    nan   Jarque-Bera (JB):                0.638\nSkew:                           0.000   Prob(JB):                        0.727\nKurtosis:                       1.250   Cond. No.                         3.49\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nquiet input id earnings str7 school private group\n1 110000 \"private\" 1 1\n2 100000 \"private\" 1 1\n3 110000 \"public\" 0 1\n4 60000 \"private\" 1 2\n5 30000 \"public\" 0 2\n6 115000 \"private\" 1 3\n7 75000 \"private\" 1 3\n8 90000 \"public\" 0 4\n9 60000 \"public\" 0 4\nend\ngen \tdummy = 1 if group == 1\nreplace dummy = 0 if group == 2\nreg earnings private dummy if id<=5 \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(6 missing values generated)\n\n(2 real changes made)\n\n      Source |       SS           df       MS      Number of obs   =         5\n-------------+----------------------------------   F(2, 2)         =     11.70\n       Model |  4.6800e+09         2  2.3400e+09   Prob > F        =    0.0787\n    Residual |   400000000         2   200000000   R-squared       =    0.9213\n-------------+----------------------------------   Adj R-squared   =    0.8425\n       Total |  5.0800e+09         4  1.2700e+09   Root MSE        =     14142\n\n------------------------------------------------------------------------------\n    earnings | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n     private |      10000   13093.07     0.76   0.525    -46334.95    66334.95\n       dummy |      60000   13093.07     4.58   0.044     3665.052    116334.9\n       _cons |      40000   11952.29     3.35   0.079    -11426.54    91426.54\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n## Regression {.smaller background=\"#dfe3f7\"}\n\nThe previous regression assumes that students 1 to 3 are different that students 4 and 5. \n\nWe will find many instances like that in empirical research. E.g., industry. \n\n. . .\n\nThe private school coefficient, in this case 10,000, implies a private-public earnings differential of this value.\n\n. . .\n\n::: callout-important\nThe Y above is used in monetary values.\n\nUsing a logged y, ln(Y) or ln(earnings), allows estimates to be interpreted as a percent change.\n\nFor instance if $\\beta=0.05$, it means that the earnings differential is 5% for those studying in private schools (conditional on the controls included in the model). \n:::\n\n\n\n\n\n\n\n\n\n\n\n# OVB again {.smaller background=\"#f5caae\"}\n\n\n## OVB again {.smaller background=\"#f5caae\"}\n\n\n\nRegression is a way to make other things equal (ceteris paribus), but equality  is generated only for variables included in the model as controls on the right-hand sided of the model.\n\nFailure to include enough controls of the right controls still leave us with selection bias.\n\nThe regression version of the selection bias generated by the inadequate controls is called **Omitted Variable Bias (OVB)**. \n\nThe inclusion of a control that should not be included is called \"**Bad Controls**\" problem.\n\n\n\n\n\n\n\n\n## OVB again {.smaller background=\"#f5caae\"}\n\n**How could we calculate the OVB in this example?**\n\n\n$$earnings_i = 70.000 + 20.000\\times Private_i  \\epsilon $$\n\n$$earnings_i = 40.000 + 10.000 \\times Private_i + 60.000 \\times Group+ \\epsilon$$ \n\n\n- $\\beta$ (1st regression) - $\\beta$ (second regression).\n- The OVB here is 20.000 - 10.000 = 10.000.\n- Meaning that the $\\beta$ (1st regression) is 10.000 higher than what it should be.\n\n\n\n\n\n\n\n\n\n\n\n\n\n## OVB again {.smaller background=\"#f5caae\"}\n\n**How could we calculate the OVB in this example?**\n\n\nWe could calculate the bias by estimating:\n\n$$Private=\\alpha + \\beta_{omitted} \\times Group + \\epsilon$$\n\nThen,\n\n$$\\beta_{omitted} \\times \\beta_{missing} = 0.1667 * 60.000 = 10.000$$\n\nThe OVB is 10.000, meaning that the first model (the one with the omitted variable) estimates a Beta that is 10.000 higher than it should be. \n\n\n\n\n\n\n\n\n\n## OVB again {.smaller background=\"#f5caae\"}\n\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nmodel4 <- lm(private ~ dummy , data = subset(data,id<=5))\nsummary(model4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = private ~ dummy, data = subset(data, id <= 5))\n\nResiduals:\n      1       2       3       4       5 \n 0.3333  0.3333 -0.6667  0.5000 -0.5000 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)   0.5000     0.4410   1.134    0.339\ndummy         0.1667     0.5693   0.293    0.789\n\nResidual standard error: 0.6236 on 3 degrees of freedom\nMultiple R-squared:  0.02778,\tAdjusted R-squared:  -0.2963 \nF-statistic: 0.08571 on 1 and 3 DF,  p-value: 0.7888\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nmatrix2<- summary(model4)$coefficients\nsum(0.1667 * 60000 )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 10002\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nsubset_data = data[data['id'] <= 5]\nmodel4 = sm.OLS(subset_data['private'], sm.add_constant(subset_data[['dummy']])).fit()\nprint(model4.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:                private   R-squared:                       0.028\nModel:                            OLS   Adj. R-squared:                 -0.296\nMethod:                 Least Squares   F-statistic:                   0.08571\nDate:                qua, 11 set 2024   Prob (F-statistic):              0.789\nTime:                        16:17:25   Log-Likelihood:                -3.4565\nNo. Observations:                   5   AIC:                             10.91\nDf Residuals:                       3   BIC:                             10.13\nDf Model:                           1                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst          0.5000      0.441      1.134      0.339      -0.903       1.903\ndummy          0.1667      0.569      0.293      0.789      -1.645       1.978\n==============================================================================\nOmnibus:                          nan   Durbin-Watson:                   2.881\nProb(Omnibus):                    nan   Jarque-Bera (JB):                0.749\nSkew:                          -0.394   Prob(JB):                        0.688\nKurtosis:                       1.276   Cond. No.                         2.92\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nbias = 0.1667 * 60000\nprint(bias)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n10002.0\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nquiet input id earnings str7 school private group\n1 110000 \"private\" 1 1\n2 100000 \"private\" 1 1\n3 110000 \"public\" 0 1\n4 60000 \"private\" 1 2\n5 30000 \"public\" 0 2\n6 115000 \"private\" 1 3\n7 75000 \"private\" 1 3\n8 90000 \"public\" 0 4\n9 60000 \"public\" 0 4\nend\ngen \tdummy = 1 if group == 1\nreplace dummy = 0 if group == 2\nreg private dummy if id<=5\ndi .1666667 *  60000 \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(6 missing values generated)\n\n(2 real changes made)\n\n      Source |       SS           df       MS      Number of obs   =         5\n-------------+----------------------------------   F(1, 3)         =      0.09\n       Model |  .033333333         1  .033333333   Prob > F        =    0.7888\n    Residual |  1.16666667         3  .388888889   R-squared       =    0.0278\n-------------+----------------------------------   Adj R-squared   =   -0.2963\n       Total |         1.2         4          .3   Root MSE        =    .62361\n\n------------------------------------------------------------------------------\n     private | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       dummy |   .1666667    .569275     0.29   0.789    -1.645021    1.978354\n       _cons |         .5   .4409586     1.13   0.339    -.9033269    1.903327\n------------------------------------------------------------------------------\n\n10000.002\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n\n## OVB again {.smaller background=\"#f5caae\"}\n\n**So what?**\n\n- Anticipating the effect of the omitted variable on the non-omitted variable can tell you the sign of the bias.\n\n- Then you can know if the bias is attenuating or increasing the effect you are investigating.\n\n- If attenuating, the problem is smaller than if it is increasing\n\n\n\n\n\n\n\n\n\n\n\n\n## OVB again {.smaller background=\"#f5caae\"}\n\n**Regressions**\n\n-   The previous examples show that we can run **regressions and find correlations** ...\n\n-   ... And we can run regressions and find **causal effects**.\n\n-   But we need to control for all relevant variables, otherwise we have the *OVB problem*.\n\n-   Should you not look careful to your data, you'd miss the inclusion of the variable `group`.\n\n-   The results show that you may estimate a spurious coefficient twice the size of the \"true\" coefficient.\n\n\n\n\n\n\n\n# Bad Controls Problem {.smaller background=\"#dff2c7\"}\n\n\n## Bad Controls Problem {.smaller background=\"#dff2c7\"}\n\n**Bad controls** are variables that are **also outcome of the treatment** being studied.\n\nA **Bad control** could very well be a **dependent variable** of the treatment as well. \n\n**Good controls** are variables that **you can think as being fixed** at the time of the treatment. \n\n. . .\n\nLet's return to the model.\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\beta_2 Group+ \\epsilon \\;,\\; if\\; i <=5$$ \n\n\nAssuming you also have the occupation of the students at the time of earnings. Should you include `occupation` in the model?\n\n\n$$earnings_i = \\alpha + \\beta_1 Private_i + \\beta_2 Group + \\beta_3 Occupation + \\epsilon \\;,\\; if\\; i <=5$$ \n\nReasoning: \"*We should use occupation as control because it would be wise to look at the effect of education on earnings only for those within an occupation*\".\n\nWhat is the problem with this reasoning?\n\n\n\n\n\n\n\n\n## Bad Controls Problem {.smaller background=\"#dff2c7\"}\n\nThe problem is that studying in private would increase the chances of getting a white-collar occupation, i.e., *private education (treatment) affects the occupation (bad control)*.\n\nIn this case, should you include occupation as control, the coefficient of interest no longer has a causal interpretation.\n\n\n. . .\n\n**This is a very common problem in empirical research**.\n\nIt is not hard to come up with stories of why a control is a bad control.\n\n\n\n\n\n\n# Randomization {.smaller background=\"#ff9c6b\"}\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\n**Now I want to discuss the idea of randomization**\n\nSuppose you have developed a treatment (e.g., a program) that you believe will increase the 'motivation' of employees of a factory.\n\nYou have 100 employees to use in an experiment to test your claim that the treatment will increase motivation.\n\n. . .\n\n- You randomly allocate 50 employees to receive the treatment. The other 50 are part of the control group.\n\n. . .\n\n- You treat all employees in the same manner, except for the treatment.\n\n\n\n. . .\n\nUsing the data available, this is the **difference in motivation between the treatment and control groups (next slide):**\n\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(readxl)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(dplyr)\ndata  <- read_excel(\"files/part_3_data.xlsx\", range = \"A1:C101\")\n# Box plot control vs treatment groups\nggplot(data, aes(y=motivation, fill=group)) +   \n  geom_boxplot()+\n  theme(plot.title = element_text(color=\"black\", size=30, face=\"bold\"),\n        panel.background = element_rect(fill = \"grey95\", colour = \"grey95\"),\n        axis.text.y = element_text(face=\"bold\", color=\"black\", size = 18),\n        axis.text.x = element_blank(),\n        legend.title = element_blank(),\n        legend.key.size = unit(3, \"cm\"))\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n# Read data from Excel file\ndata = pd.read_excel(\"files/part_3_data.xlsx\")\n\n# Create a box plot of control vs treatment groups using seaborn\nplt.figure(figsize=(7, 5))\nsns.set(style='whitegrid')\nsns.boxplot(x='group', y='motivation', data=data, palette='Set2')\nplt.title(\"Box Plot of Control vs Treatment Groups\", fontsize=18)\nplt.xlabel(\"Group\", fontsize=14)\nplt.ylabel(\"Motivation\", fontsize=14)\nplt.show()\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-17-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nimport excel \"files/part_3_data.xlsx\", cellrange(A1:C101) firstrow clear\ngraph box motivation , over(group) box(1, color(black)) \tytitle(\"Motivation\")  \n\nquietly graph export \"files/graph3_5.svg\", replace\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(3 vars, 100 obs)\n```\n\n\n:::\n:::\n\n\n![](files/graph3_5.svg)\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\nThe calculated means are below. And they are statistically different.\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\ndata  <- read_excel(\"files/part_3_data.xlsx\", range = \"A1:C101\")\ntapply(data$motivation, data$group, summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$Control\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  16.70   19.70   20.70   20.80   22.27   24.60 \n\n$Treatment\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  17.60   20.52   22.50   22.27   23.77   26.50 \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nt.test(motivation ~ group, data = data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  motivation by group\nt = -3.7301, df = 94.879, p-value = 0.0003258\nalternative hypothesis: true difference in means between group Control and group Treatment is not equal to 0\n95 percent confidence interval:\n -2.2493176 -0.6866824\nsample estimates:\n  mean in group Control mean in group Treatment \n                 20.800                  22.268 \n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\ndata = pd.read_excel(\"files/part_3_data.xlsx\")\ngroup_summary = data.groupby('group')['motivation'].describe()\nprint(group_summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           count    mean       std   min     25%   50%     75%   max\ngroup                                                               \nControl     50.0  20.800  1.780392  16.7  19.700  20.7  22.275  24.6\nTreatment   50.0  22.268  2.138800  17.6  20.525  22.5  23.775  26.5\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nimport excel \"files/part_3_data.xlsx\", cellrange(A1:C101) firstrow clear\nbys group  : sum motivation\nestpost ttest motivation , by(group)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(3 vars, 100 obs)\n\n\n-------------------------------------------------------------------------------\n-> group = Control\n\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n  motivation |         50        20.8    1.780392       16.7       24.6\n\n-------------------------------------------------------------------------------\n-> group = Treatment\n\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n  motivation |         50      22.268      2.1388       17.6       26.5\n\n             |      e(b)   e(count)      e(se)       e(t)    e(df_t) \n-------------+-------------------------------------------------------\n  motivation |    -1.468        100   .3935546  -3.730105         98 \n\n             |    e(p_l)       e(p)     e(p_u)     e(N_1)    e(mu_1) \n-------------+-------------------------------------------------------\n  motivation |  .0001604   .0003208   .9998396         50       20.8 \n\n             |    e(N_2)    e(mu_2) \n-------------+----------------------\n  motivation |        50     22.268 \n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\n**Is there evidence that the program has increased motivation?**\n\n. . .\n\n- well, if you randomly split a group of 100 people into two groups of 50, you certainly wouldn't get the same mean motivation in both groups even if you treated them exactly alike. \n\n- Maybe the difference that we see is just such a difference?\n\n**How can we test this hypothesis?**\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\n**Solution**: \n\n- Suppose the treatment had no effect, and the employees developed their motivation  independently of the treatment. \n\n- What is the chance that the 50 employees randomly assigned to the treatment group would have an average at least 1.47 (22.27 - 20.80)  points higher than the average motivation of the employees randomly assigned to the control group?\n\n\n\n\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\n**Steps**\n\n1) Randomly split the 100 employees that we observed in this experiment into two groups of 50.\n\n2) Note the difference in the mean motivation  between the two groups.\n\n3) Repeat 1 and 2 a total of 10,000 times.\n\n4) Note the proportion of times the difference is at least 1.47 (22.27 - 20.80).\n\n\n\n\n\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary libraries\ndata <- read_excel(\"files/part_3_data.xlsx\", range = \"A1:C101\")\ncomb <- 10000\ndf <- data.frame(matrix(ncol = 2, nrow = comb))\ncolnames(df) <- c(\"order\" ,\"diff\")\n# Create the loop for randomization:\nfor (i in seq(from = 1, to = comb)) {\n  set.seed(i)                               \n  data$temp <- runif(100, min = 0, max = 1)  # Creating 100 random numbers 0 to 1\n  data <- data[order(data$temp),]            # Sorting data by the random numbers generated in the previous row\n  data$rank <- rank(data$temp)               # Ranking by the random numbers\n# The row below defines the treatment group based on the random numbers generated. This is where we guarantee randomization\ndata$status_rank <- case_when(data$rank <= 50 ~ \"Control_rand\", data$rank > 50 ~ \"Treated_rand\")\n# Calculate the new means of the new groups. Need to transpose data.\nmeans <- t(as.data.frame(tapply(data$motivation, data$status_rank, mean)))\n# Moving the new means to df. Each row is the difference of means\ndf[i, 1] <- i\ndf[i, 2] <- means[1, 2] - means[1, 1]\nrm(means) # Deleting value\ndata = subset(data, select = -c(temp, rank, status_rank)) # Deleting variables\n}\n# Calculate a suitable binwidth for the histogram\nbinwidth <- (max(df$diff) - min(df$diff)) / sqrt(length(df$diff))\n# Create a histogram of the differences with the calculated binwidth\nggplot(df, aes(x = diff)) +\n  geom_histogram(binwidth = binwidth, fill = \"blue\", color = \"black\") +\n  labs(title = \"Distribution of Differences\", x = \"Difference\", y = \"Frequency\")\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-22-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nimport excel \"files/part_3_data.xlsx\", cellrange(A1:C101) firstrow clear\nset seed 472195 \t\t\nsort group\t\t \nset obs 10000 \t\t\t\t \negen fin_order = seq() \nsort fin_order \t\t\t\t \nsummarize \t\t\t\t\t\ngen av_diff=.\n\nlocal i = 1\nwhile `i'<=10000 {\n\n\tsort fin_order\n\tgen rand_num`i' = uniform() if !missing(motivation)\n\tegen ordering`i' = rank(rand_num`i')\n\tsort ordering`i'\n\n\tgen group`i' = \"\"\n\treplace group`i' = \"T\" if ordering <= 50\n\treplace group`i' = \"C\" if ordering > 50 & ordering<=100\n\t\n\tqui summ motivation if group`i'==\"T\"\n\tscalar avT = `r(mean)'\n\tqui summ motivation if group`i'==\"C\"\n\tscalar avC = `r(mean)'\n\t\n\tsort fin_order\n\treplace av_diff = avT-avC in `i'\n\t\n\tdrop rand_num`i' ordering`i' group`i'\n\tlocal i = `i' + 1\n}\nhistogram av_diff, frequency kdensity  \ngraph export \"files/graph3_6.png\" , replace\n\n```\n:::\n\n\n![](files/graph3_6.png){ width=800px height=450px }\n:::\n\n\n\n\n\n\n## Randomization {.smaller background=\"#ff9c6b\"}\n\nThe mean difference was as far from 0 as 1.5 for only a few out of the 10,000 random divisions of the data into two groups of 50.\n\n- Thus, **the difference between the mean motivation would almost always be less than the observed difference of 1.47 (22.27 - 20.80) if the treatment had no effect.**\n\n- It seems reasonable to believe that the treatment caused the difference in motivation.\n\n\n\n\n\n\n\n\n\n# Measurement Error problem  {.smaller background=\"#f2e9b6\"}\n\n\n## Measurement Error problem  {.smaller background=\"#f2e9b6\"}\n\nThe measurement error problem has a similar statistical structure to the omitted variable bias (OVB).\n\n- \"Classical\" random measurement error for the $y$ will inflate standard errors but will not lead to biased coefficients. \n\n    - $y^{*} = y + \\sigma_{1}$\n    - If you estimante $y^{*} = f(x)$, you have $y + \\sigma_{1} = x + \\epsilon$ \n    - $y = x + u$ \n        - where $u = \\epsilon - \\sigma_{1}$ \n\n\n\n\n## Measurement Error problem  {.smaller background=\"#f2e9b6\"}\n\n- \"Classical” random measurement error in x’s will bias coefficient estimates toward zero.\n\n- $x^*=x+\\sigma_2$\n\n- Imagine that $x^*$ is a bunch of noise. It would not explain anything. Thus, your results are biased toward zero.\n\n\n\n\n\n## Measurement Error problem  {.smaller background=\"#f2e9b6\"}\n\nA example using one of the Wooldridge's datasets.\n\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign) \nlibrary(jtools)\ndata <- read.dta(\"files/CEOSAL1.dta\")\nset.seed(2)\ndata$salary_noise <- data$salary + runif(length((data$salary)), min=-100, max= 100)\ndata$roe_noise <- data$roe + runif(length((data$roe)), min=-100, max= 100)\n# OLS model \nmodel1 <- lm(data$salary ~ data$roe)\nmodel2 <- lm(data$salary ~ data$roe_noise)\nmodel3 <- lm(data$salary_noise ~ data$roe)\n#summary(model1)\n#summary(model2)\n#summary(model3)\nexport_summs(model1, model2, model3, digits = 3 , model.names = c(\"Roe\", \"Roe (X) with noise\", \"Salary (y) with noise\") )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<table class=\"huxtable\" style=\"border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  \" id=\"tab:unnamed-chunk-24\">\n<col><col><col><col><tr>\n<th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">Roe</th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">Roe (X) with noise</th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">Salary (y) with noise</th></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(Intercept)</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">963.191 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">1269.739 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">964.058 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(213.240)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(97.356)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(214.588)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">data$roe</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">18.501&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">18.318&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(11.123)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(11.194)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">data$roe_noise</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.868&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(1.593)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">N</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">209&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">209&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">209&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">R2</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.013&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.001&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.013&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th colspan=\"4\" style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>\n</table>\n\n```\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nfrom statsmodels.iolib.summary2 import summary_col\n\ndata = pd.read_stata(\"files/CEOSAL1.dta\")\nnp.random.seed(2)\n# Add noise to the 'salary' and 'roe' columns\ndata['salary_noise'] = data['salary'] + np.random.uniform(-100, 100, len(data))\ndata['roe_noise'] = data['roe'] + np.random.uniform(-100, 100, len(data))\n# OLS model\nmodel1 = smf.ols(formula='salary ~ roe', data=data).fit()\nmodel2 = smf.ols(formula='salary ~ roe_noise', data=data).fit()\nmodel3 = smf.ols(formula='salary_noise ~ roe', data=data).fit()\n# Create a summary table for all regressions\nresults = summary_col([model1, model2, model3], \n                      model_names=['Reg 1', 'Reg 2', 'Reg 3'],\n                      stars=True,\n                      float_format='%0.2f')\n# Print the summary table\nprint(results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=============================================\n                 Reg 1     Reg 2      Reg 3  \n---------------------------------------------\nIntercept      963.19*** 1262.12*** 966.97***\n               (213.24)  (98.19)    (213.37) \nR-squared      0.01      0.00       0.01     \nR-squared Adj. 0.01      -0.00      0.01     \nroe            18.50*               17.92    \n               (11.12)              (11.13)  \nroe_noise                1.25                \n                         (1.63)              \n=============================================\nStandard errors in parentheses.\n* p<.1, ** p<.05, ***p<.01\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.dta\", clear\nset seed 2\ngen salary_noise = salary + runiform() * 200 - 100\ngen roe_noise = roe + runiform() * 200 - 100\neststo: qui reg salary roe\neststo: qui reg salary roe_noise\neststo: qui reg salary_noise roe\nesttab\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(est1 stored)\n\n(est2 stored)\n\n(est3 stored)\n\n\n------------------------------------------------------------\n                      (1)             (2)             (3)   \n                   salary          salary    salary_noise   \n------------------------------------------------------------\nroe                 18.50                           18.14   \n                   (1.66)                          (1.63)   \n\nroe_noise                          0.0336                   \n                                   (0.02)                   \n\n_cons               963.2***       1280.4***        966.1***\n                   (4.52)         (12.71)          (4.53)   \n------------------------------------------------------------\nN                     209             209             209   \n------------------------------------------------------------\nt statistics in parentheses\n* p<0.05, ** p<0.01, *** p<0.001\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n# More about Regressions {.smaller background=\"#454343\"}\n\n## Regression {.smaller background=\"#454343\"}\n\nLinear regressions are the workhorse tool in econometrics\n\n-   **Simplicity**: straightforward to understand, implement, and visualize.\n\n. . .\n\n-   **Interpretability**: coefficients have clear interpretations.\n    -   represents the change in the Y for a one-unit change in the X, holding all other variables constant.\n\n. . .\n\n-   **Versatility**: simple linear regression or *multiple linear regression*.\n\n. . .\n\n-   **Assumptions**: linearity, independence of errors, homoscedasticity, and normality of errors.\n\n. . .\n\n-   **Baseline Model**: You can compare the performance of more advanced models to linear regression.\n\n. . .\n\n-   **Estimation**: provides clear estimates of the coefficients' confidence intervals and hypothesis testing.\n\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\nIn this setting, the variables $y$ and $x$ can have several names.\n\n| Y                  | X                    |\n|--------------------|----------------------|\n| Dependent variable | Independent variable |\n| Explained variable | Explanatory variable |\n| Response variable  | Control variable     |\n| Predicted variable | Predictor variable   |\n| Regressand         | Regressor            |\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\nBroadly, we are interested in how y is explained by x?\n\n-   $y_i = \\alpha + \\beta_1 x_i + \\epsilon$\n\n. . .\n\nPerhaps $\\epsilon$ is the most important part of a regression.\n\nThe interpretation is \"*everything that is not explained by X and that explains Y*\".\n\n. . .\n\nA comment\n\n-   Usually, the literature uses $\\epsilon$ for the \"estimated\" residual.\n\n-   And $\\mu$ for the \"true\" residual, which necessarily implies that the assumptions hold.\n\n-   At the end od the day, you don't need to worry to much with the notation of this term because we are always in the \"estimated world\", and almost never in the \"true world\".\n\n-   The \"true world\" implies that you are studying the population or that you have a true random sample of the population\n\n    -   $y_i = \\alpha + \\beta_1 x_i + \\mu$\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\n**Remember**\n\n- $y, x$, and $\\mu$ are random variables\n- $y and x$ are observable\n- $\\mu$ and $\\beta$ are unobservable\n- $\\mu$ captures everything that determines y after accounting for x \n\nOur goal is to estimate β\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\nThere are some assumptions/requirements about $\\mu$ in a OLS\n\n**First assumption**\n\n-   E($\\mu$) = 0\n\n    -   This is a simple assumption, not strong at all.\n    -   It simply assumes that the average of $\\mu$ is zero in the population.\n    -   Basically, any non-zero mean is absorbed by the intercept\n        -   Say that E($\\mu$) = k\n        -   We could rewrite $\\mu = k + w$, where E(w)=0\n        -   Then, model becomes $y=(\\alpha +𝑘) + \\beta𝑥+𝑤$\n        -   Intercept is now just (α + k), and error, w, is mean zero\n\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\n**Second assumption**\n\n-   E($\\mu$\\|x) = E($\\mu$) for all values of x\n    -   It says that the average value of $\\mu$ does not depend on the value of x (i.e., the slice of the population you are looking at).\n    -   We say that $\\mu$ is mean-independent of x.\n    -   This is true if the X and the $\\mu$ are independent to each other.\n    -   Implies that x and $\\mu$ are *uncorrelated*.\n    -   **Conditional Mean Independence (CMI)**.\n    -   This is one of the keys assumption to *causal inference*.\n\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\n**Second assumption**\n\n**Example**\n\nLet's say the model is:\n\n$$wage = \\alpha + \\beta Schooling_{years} + \\epsilon$$\n\n-   where $\\epsilon$ represents *unobserved ability*.\n\nDoes CMI hold?\n\nThat is E(ability\\|x=8)=E(ability\\|x=10)=E(ability\\|x=12)?\n\n. . .\n\n**Probably not**, because the unobserved ability should depend on the years of schooling.\n\nThe solution (not trivial) would be to include ability as a new X.\n\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\n**Another example**\n\nConsider the following model (with only one X)\n\n$$Leverage_i = \\alpha + \\beta_1 Profitability_i + \\mu_i$$\n\n-   CMI says that, to every firm *i*, $\\mu$ is the same, even when firms have different profitability.\n\n-   Can you think on examples when this assumption may not hold in this model?\n\n. . .\n\n1)  unprofitable firms have higher bankruptcy risk, which should make them to have lower leverage (tradeoff theory).\n\n2)  unprofitable firms have low cash, which should make them to have more leverage (pecking order theory).\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\n**The discussion of whether the CMI holds is the origin of the \"endogeneity\" problem.**\n\nYou will face reviewers arguing reasons of why the CMI might not hold in your case.\n\n- Many  will criticize a model by saying it has an “endogeneity problem”, whithout explaining more.\n\n  - This is very generic. **Don't do that!**\n\n. . .\n\nThey should explain what is the source of the problem that is making the model violate CMI.\n\n - OVB, selection bias, reverse causality, simultaneity, etc?\n\n. . . \n\nGenerally speaking, endogeneity refers to a violation of CMI, meaning that $x$ and $\\mu$ are correlated.\n\nThis is always a plausible possibility, since $\\mu$ carries a lot of stuff (something must be correlated with X).\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\n**Third assumption**\n\nCombining 1 and 2 leads to\n\n-   E($\\mu$\\|x) = 0\n    -   This is a very important assumption called **zero conditional mean assumption**.\n\n## Ordinary Least Squares {.smaller background=\"#454343\"}\n\nOur focus is to find estimates for $\\alpha$ and $\\beta$. Should we have access to the population, it would be easy. We could write:\n\n$$y_i= \\alpha + \\beta_1x_i + \\mu$$\n\n. . .\n\nBut remember that,\n\n$$E(u) = 0$$ $$E(u|x) = 0$$\n\nThe second bullet implies that the correlation between x and $\\mu$ is zero (we can write that as E(x,u) = 0).\n\n. . .\n\n::: callout-important\nRemember: $\\alpha$ and $\\beta$ are parameters to be estimated (i.e., constants), while $X$ and $Y$ are variables\n:::\n\n\n\n\n\n\n\n\n## Regression {.smaller background=\"#454343\"}\n\nSo we can write that (in the **population**)\n\n$E(y - \\alpha - \\beta_1x ) = 0$\n\n$(x[y - \\alpha - \\beta_1x ]) = 0$\n\n. . .\n\nSo we can write that (in the **sample**)\n\n$\\frac{1}{n} \\sum_{i=1}^n (y_i - \\hat{\\alpha} - \\hat{\\beta_1} x_i ) = 0$ , We will use this to find $\\alpha$:\n\n$\\frac{1}{n} \\sum_{i=1}^n (x_i [y_i - \\hat{\\alpha} - \\hat{\\beta_1} x_i ]) = 0$ , We will use this to find $\\beta$:\n\n\n\n\n\n\n\n## Finding $\\alpha$ {.smaller background=\"#454343\"}\n\nFrom before:\n\n$$\\frac{1}{n} \\sum_{i=1}^n (y_i - \\hat{\\alpha} - \\hat{\\beta_1} x_i ) =0$$\n\n. . .\n\nPassing the sum operator through\n\n$$\\frac{1}{n}\\sum_{i=1}^n(y_i) - \\frac{1}{n}\\sum_{i=1}^n(\\hat{\\alpha})  - \\frac{1}{n} \\sum_{i=1}^n(\\hat{\\beta_1} x_i )=0$$\n\n. . .\n\nCoefficients are constants, so we can get rid of the sum operator.\n\n$$\\frac{1}{n}\\sum_{i=1}^n(y_i) - \\hat{\\alpha}  - \\hat{\\beta_1} \\frac{1}{n}  \\sum_{i=1}^n(\\ x_i )=0$$\n\n\n\n\n\n\n\n\n## Finding $\\alpha$ {.smaller background=\"#454343\"}\n\n-   We know that $\\frac{1}{n}\\sum_{i=1}^n(y_i)$ is $\\bar{y_i}$ (the mean)\n\n$$\\bar{y_i} - \\hat{\\alpha}  - \\hat{\\beta_1}  \\bar{x_i}=0$$\n\n. . .\n\nSo we write:\n\n$$\\hat{\\alpha}  = \\bar{y_i} -  \\hat{\\beta_1}   \\bar{x_i}$$\n\n. . .\n\n**Easy Peasy** 😀\n\n\n\n\n\n## Finding $\\beta$ {.smaller background=\"#454343\"}\n\nFrom before:\n\n$$\\frac{1}{n} \\sum_{i=1}^n (x_i [y_i - \\hat{\\alpha} - \\hat{\\beta_1} x_i ]) = 0$$\n\n. . .\n\nBut now we have:\n\n$$\\hat{\\alpha}  = \\bar{y_i} -  \\hat{\\beta_1}   \\bar{x_i}$$\n\n. . .\n\nThus,\n\n$$\\frac{1}{n} \\sum_{i=1}^n (x_i [y_i - (\\bar{y_i} -  \\hat{\\beta_1}   \\bar{x_i}) - \\hat{\\beta_1} x_i ]) = 0$$\n\n\n\n\n## Finding $\\beta$ {.smaller background=\"#454343\"}\n\nTurning into\n\n$$\\frac{1}{n} \\sum_{i=1}^n (x_i [y_i - \\bar{y_i} ])  -  \\frac{1}{n} \\sum_{i=1}^n (x_i [\\hat{\\beta_1} x_i - \\hat{\\beta_1} \\bar{x_i} ]) = 0$$\n\n. . .\n\nOr\n\n$$\\frac{1}{n} \\sum_{i=1}^n (x_i [y_i - \\bar{y_i} ])  =  \\hat{\\beta_1} \\frac{1}{n} \\sum_{i=1}^n (x_i [ x_i  - \\bar{x_i} ]) $$\n\n. . . \n\nLast step (I am skipping some steps here)\n\n$$\\frac{1}{n} \\sum_{i=1}^n (x_i - \\bar{x} )(y_i - \\bar{y_i} )  =  \\hat{\\beta_1} \\frac{1}{n} \\sum_{i=1}^n (x_i - \\bar{x_i} )^2 $$\n\n\n\n\n## Finding $\\beta$ {.smaller background=\"#454343\"}\n\n\nIf the variance of x is not zero, we can write $\\beta$ as\n\n$$\\hat{\\beta_1} = \\frac{\\sum_i^n (x_i - \\bar{x})(y_i - \\bar{y})}{\\sum_i^n (x_i - \\bar{x})^2} = \\frac{Covariance(x_i,y_i)}{Variance(x_i)}$$\n\n\n\n## Finding $\\mu$  {.smaller background=\"#454343\"}\n\nNow that we have $\\hat{Y_i}=\\hat{\\alpha} + \\hat{\\beta_1} X_i$, we can estimate the residual $\\mu$\n\n$$\\hat{\\mu} = Y_i - \\hat{Y_i}$$\n\n\nWhich is the same as:\n\n$$\\hat{\\mu} = Y_i - \\hat{\\alpha} - \\hat{\\beta_1}x_i$$\n\nMost residuals will not be 0, meaning they do not lie on the best fitting line. \n\n\n\n\n\n\n## Finding $\\mu$  {.smaller background=\"#454343\"}\n\nThe job of an OLS model is find the parameters to minimize the squared error (i.e., to find the best fitting line).\n\n$$\\sum_{i=1}^n \\hat{\\mu}^2 = \\sum_{i=1}^n(Y_i - \\hat{Y_i})^2$$\n\n\n\n\n\n\n\n\n\n\n\n\n## Regression ([Source](https://mixtape.scunning.com/02-probability_and_regression#ordinary-least-squares)) {.smaller background=\"#454343\"}\n\nAnother example of regression. The differences in the coefficients are due to the differences in the seed of the random variables generator.\n\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(tidyverse)\nset.seed(1)\ntb <- tibble(\n  x = rnorm(10000),\n  u = rnorm(10000),\n  y = 5.5*x + 12*u # notice that I am defining the beta1 here. The 5.5 is the \"true\" beta we want to estimate.\n) \nreg_tb <- lm(y ~ x, data=tb) \nsummary(reg_tb)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = y ~ x, data = tb)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-51.528  -8.152  -0.173   7.978  44.718 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -0.04991    0.11890   -0.42    0.675    \nx            5.55690    0.11745   47.31   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 11.89 on 9998 degrees of freedom\nMultiple R-squared:  0.1829,\tAdjusted R-squared:  0.1828 \nF-statistic:  2238 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nimport matplotlib.pyplot as plt\nnp.random.seed(1)\n\nobs = 10000\ndata = pd.DataFrame({\n    'x': np.random.normal(size=obs),\n    'u': np.random.normal(size=obs),\n})\ndata['y'] = 5.5 * data['x'] + 12 * data['u']\n\nX = sm.add_constant(data['x'])\nmodel = sm.OLS(data['y'], X).fit()\n\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:                      y   R-squared:                       0.183\nModel:                            OLS   Adj. R-squared:                  0.183\nMethod:                 Least Squares   F-statistic:                     2237.\nDate:                qua, 11 set 2024   Prob (F-statistic):               0.00\nTime:                        16:19:51   Log-Likelihood:                -39049.\nNo. Observations:               10000   AIC:                         7.810e+04\nDf Residuals:                    9998   BIC:                         7.812e+04\nDf Model:                           1                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst          0.1114      0.120      0.927      0.354      -0.124       0.347\nx              5.6887      0.120     47.293      0.000       5.453       5.924\n==============================================================================\nOmnibus:                        0.640   Durbin-Watson:                   2.050\nProb(Omnibus):                  0.726   Jarque-Bera (JB):                0.672\nSkew:                          -0.012   Prob(JB):                        0.715\nKurtosis:                       2.968   Cond. No.                         1.01\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nset seed 1 \nset obs 10000 \ngen x = rnormal() \ngen u  = rnormal() \ngen y  = 5.5*x + 12*u \nreg y x \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of observations (_N) was 0, now 10,000.\n\n      Source |       SS           df       MS      Number of obs   =    10,000\n-------------+----------------------------------   F(1, 9998)      =   2206.80\n       Model |  327141.413         1  327141.413   Prob > F        =    0.0000\n    Residual |   1482125.8     9,998  148.242229   R-squared       =    0.1808\n-------------+----------------------------------   Adj R-squared   =    0.1807\n       Total |  1809267.22     9,999  180.944816   Root MSE        =    12.175\n\n------------------------------------------------------------------------------\n           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n           x |   5.598296    .119172    46.98   0.000     5.364695    5.831897\n       _cons |  -.0750109   .1217548    -0.62   0.538    -.3136748     .163653\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n\n## Regression ([Source](https://mixtape.scunning.com/02-probability_and_regression#ordinary-least-squares)) {.smaller background=\"#454343\"}\n\nAnother example of regression. The differences in the coefficients are due to the differences in the seed of the random variables generator.\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(tidyverse)\nset.seed(1)\ntb <- tibble(\n  x = rnorm(10000),\n  u = rnorm(10000),\n  y = 5.5*x + 12*u # notice that I am defining the beta1 here. The 5.5 is the \"true\" beta we want to estimate.\n) \nreg_tb <- lm(y ~ x, data=tb) \ntb %>% \n  lm(y ~ x, .) %>% \n  ggplot(aes(x=x, y=y)) + \n  ggtitle(\"OLS Regression Line\") +\n  geom_point(size = 0.05, color = \"black\", alpha = 0.5) +\n  geom_smooth(method = lm, color = \"black\") +\n  annotate(\"text\", x = -1.5, y = 30, color = \"red\", \n           label = paste(\"Intercept = \", reg_tb$coefficients[1])) +\n  annotate(\"text\", x = 1.5, y = -30, color = \"blue\", \n           label = paste(\"Slope =\", reg_tb$coefficients[2]))\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-30-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n# Create a scatterplot with the OLS regression line using Seaborn\nsns.set(style='whitegrid')\nplt.figure(figsize=(7, 5))\nsns.scatterplot(x='x', y='y', data=data, color='black', alpha=0.5, s=5)\nsns.regplot(x='x', y='y', data=data, color='black', scatter=False, line_kws={'color':'black'})\nplt.title('OLS Regression Line')\nplt.annotate(f'Intercept = {model.params[0]:.2f}', xy=(-1.5, 30), color='red')\nplt.annotate(f'Slope = {model.params[1]:.2f}', xy=(1.5, -30), color='blue')\nplt.show()\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-31-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nset seed 1 \nset obs 10000 \ngen x = rnormal() \ngen u  = rnormal() \ngen y  = 5.5*x + 12*u \nreg y x \npredict yhat1 \ngen yhat2 = -0.0750109  + 5.598296*x \npredict uhat1, residual \ngen uhat2=y-yhat2 \nqui sum uhat* \ntwoway (lfit y x, lcolor(black) lwidth(medium)) (scatter y x, mcolor(black) msize(tiny) msymbol(point)), title(OLS Regression Line) \nqui graph export \"files/graph3.svg\", replace\n```\n:::\n\n\n![](files/graph3.svg) \n\n:::\n\n\n\n\n\n\n## Regression ([Source](https://mixtape.scunning.com/02-probability_and_regression#ordinary-least-squares)) {.smaller background=\"#454343\"}\n\nUsing the previous regressions, we can show  that:\n\n1)  $\\hat{y_i} = \\hat{\\alpha} + \\hat{\\beta_1} x_i$\n\n2)  $\\hat{\\mu_i} = y_i - \\hat{y_i}$\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(tidyverse)\nset.seed(1)\ntb <- tibble(\n  x = rnorm(10000),\n  u = rnorm(10000),\n  y = 5.5*x + 12*u # notice that I am defining the beta1 here. The 5.5 is the \"true\" beta we want to estimate.\n) \nreg_tb <- lm(y ~ x, data=tb) \n\ntb <- tb %>% \n  mutate(\n    yhat1 = predict(lm(y ~ x, .)),\n    yhat2 = reg_tb$coefficients[1] + reg_tb$coefficients[2]*x, \n    uhat1 = residuals(lm(y ~ x, .)),\n    uhat2 = y - yhat2\n  )\nsummary(tb[-1:-3])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     yhat1               yhat2               uhat1              uhat2         \n Min.   :-20.45096   Min.   :-20.45096   Min.   :-51.5275   Min.   :-51.5275  \n 1st Qu.: -3.79189   1st Qu.: -3.79189   1st Qu.: -8.1520   1st Qu.: -8.1520  \n Median : -0.13842   Median : -0.13842   Median : -0.1727   Median : -0.1727  \n Mean   : -0.08624   Mean   : -0.08624   Mean   :  0.0000   Mean   :  0.0000  \n 3rd Qu.:  3.71578   3rd Qu.:  3.71578   3rd Qu.:  7.9778   3rd Qu.:  7.9778  \n Max.   : 21.12342   Max.   : 21.12342   Max.   : 44.7176   Max.   : 44.7176  \n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nnp.random.seed(1)\nobs = 10000\nx = np.random.normal(size=obs)\nu = np.random.normal(size=obs)\ny = 5.5 * x + 12 * u\n\nX = sm.add_constant(x)\nmodel = sm.OLS(y, X).fit()\n\ntb = pd.DataFrame({'x': x, 'u': u, 'y': y})\ntb['yhat1'] = model.predict(X)\ntb['uhat1'] = y - tb['yhat1']\ntb['yhat2'] = model.params[0] + model.params[1] * x\ntb['uhat2'] = y - tb['yhat2']\n\nprint(tb[['yhat1','yhat2', 'uhat1','uhat2']].describe())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              yhat1         yhat2         uhat1         uhat2\ncount  10000.000000  10000.000000  1.000000e+04  1.000000e+04\nmean       0.166975      0.166975 -1.691092e-16 -1.691092e-16\nstd        5.682040      5.682040  1.201339e+01  1.201339e+01\nmin      -20.688875    -20.688875 -4.142425e+01 -4.142425e+01\n25%       -3.659775     -3.659775 -8.199882e+00 -8.199882e+00\n50%        0.159473      0.159473  4.497835e-02  4.497835e-02\n75%        3.933075      3.933075  8.147307e+00  8.147307e+00\nmax       23.018769     23.018769  5.000751e+01  5.000751e+01\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nset seed 1 \nclear \nqui set obs 10000 \ngen x = rnormal() \ngen u  = rnormal() \ngen y  = 5.5*x + 12*u \nqui reg y x \npredict uhat1, residual \npredict yhat1 \ngen yhat2 = -0.0750109  + 5.598296*x \ngen uhat2=y-yhat2 \nsum yhat*  uhat* \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(option xb assumed; fitted values)\n\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n       yhat1 |     10,000   -.0797351    5.719914  -23.06927   22.47639\n       yhat2 |     10,000   -.0797351    5.719913  -23.06927   22.47639\n       uhat1 |     10,000   -3.53e-09    12.17487   -49.8996   42.15174\n       uhat2 |     10,000   -1.72e-08    12.17487   -49.8996   42.15174\n```\n\n\n:::\n:::\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n# Properties of OLS {.smaller background=\"#bfc4d9\"}\n\n\n## Properties of OLS {.smaller background=\"#bfc4d9\"}\n\nWe can easily show that (remember from before) \n\n$$\\sum_i^n(y_i - \\hat{\\alpha} - \\hat{\\beta_1} x_i) = 0$$\n\nAnd that \n\n$$\\sum_i^n \\hat{\\mu}  = 0$$\n\nThe graphs next slide shows a spherical figure, suggesting that the residual is not correlated with the the fitted values ($\\hat{y_i}$)\n\n\n\n\n\n\n\n## Properties of OLS {.smaller background=\"#bfc4d9\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(tidyverse)\nset.seed(1)\ntb <- tibble(\n  x = rnorm(10000),\n  u = rnorm(10000),\n  y = 5.5*x + 12*u # notice that I am defining the beta1 here. The 5.5 is the \"true\" beta we want to estimate.\n) \nreg_tb <- lm(y ~ x, data=tb) \ntb <- tb %>% \n  mutate(\n    yhat1 = predict(lm(y ~ x, .)),\n    yhat2 = reg_tb$coefficients[1] + reg_tb$coefficients[2]*x, \n    uhat1 = residuals(lm(y ~ x, .)),\n    uhat2 = y - yhat2\n  )\ntb %>% \n  lm(uhat1 ~ yhat1 , .) %>% \n  ggplot(aes(x=yhat1, y=uhat1)) + \n  geom_point(size = 0.1, color = \"black\") +\n  geom_smooth(method = lm, color = \"black\")\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-36-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nnp.random.seed(1)\nobs = 10000\nx = np.random.normal(size=obs)\nu = np.random.normal(size=obs)\ny = 5.5 * x + 12 * u\n\nX = sm.add_constant(x)\nmodel = sm.OLS(y, X).fit()\n\ntb = pd.DataFrame({'x': x, 'u': u, 'y': y})\ntb['yhat1'] = model.predict(X)\ntb['uhat1'] = y - tb['yhat1']\ntb['yhat2'] = model.params[0] + model.params[1] * x\ntb['uhat2'] = y - tb['yhat2']\nmodel = sm.OLS(tb['uhat1'], sm.add_constant(tb['yhat1'])).fit()\n# Create a scatter plot with a regression line\nsns.set(style=\"whitegrid\")\nplt.figure(figsize=(7, 4.5))\nsns.scatterplot(x='yhat1', y='uhat1', data=tb, size=0.05, color='black', alpha=0.5)\nsns.regplot(x='yhat1', y='uhat1', data=tb, scatter=False, color='black')\nplt.xlabel('yhat1')\nplt.ylabel('uhat1')\nplt.title('Scatter Plot of uhat1 vs. yhat1')\nplt.show()\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-37-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nset seed 1 \nset obs 10000 \ngen x = rnormal() \ngen u  = rnormal() \ngen y  = 5.5*x + 12*u \nqui reg y x \npredict yhat1 \npredict uhat1, residual \ntwoway (lfit uhat1 yhat1 , lcolor(black) lwidth(large)) (scatter uhat1 yhat1 , mcolor(black)  msymbol(point))\nqui graph export \"files/graph4.svg\", replace\n```\n:::\n\n\n![](files/graph4.svg) \n\n:::\n\n\n\n\n\n\n\n\n\n\n## Properties of OLS {.smaller background=\"#bfc4d9\"}\n\nSimilarly, we can easily show that \n\n$$\\sum_i^nx_i(y_i - \\hat{\\alpha} - \\hat{\\beta_1} x_i) = 0$$\n \nAnd that\n \n$$\\sum_i^nx_i\\hat{\\mu}  = 0$$\n\n \nMeaning that the sample covariance between the X and the residual will be always zero.\n\n\n\n\n\n\n\n\n\n## Properties of OLS {.smaller background=\"#bfc4d9\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(tidyverse)\nset.seed(1)\ntb <- tibble(\n  x = rnorm(10000),\n  u = rnorm(10000),\n  y = 5.5*x + 12*u # notice that I am defining the beta1 here. The 5.5 is the \"true\" beta we want to estimate.\n) \nreg_tb <- lm(y ~ x, data=tb) \ntb <- tb %>% \n  mutate(\n    yhat1 = predict(lm(y ~ x, .)),\n    yhat2 = reg_tb$coefficients[1] + reg_tb$coefficients[2]*x, \n    uhat1 = residuals(lm(y ~ x, .)),\n    uhat2 = y - yhat2\n  )\ntb %>% \n  lm(uhat1 ~ x , .) %>% \n  ggplot(aes(x=x, y=uhat1)) + \n  geom_point(size = 0.1, color = \"black\") +\n  geom_smooth(method = lm, color = \"black\")\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-39-3.png){fig-align='center' width=960}\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nnp.random.seed(1)\nobs = 10000\nx = np.random.normal(size=obs)\nu = np.random.normal(size=obs)\ny = 5.5 * x + 12 * u\n\nX = sm.add_constant(x)\nmodel = sm.OLS(y, X).fit()\n\ntb = pd.DataFrame({'x': x, 'u': u, 'y': y})\ntb['yhat1'] = model.predict(X)\ntb['uhat1'] = y - tb['yhat1']\ntb['yhat2'] = model.params[0] + model.params[1] * x\ntb['uhat2'] = y - tb['yhat2']\nmodel = sm.OLS(tb['uhat1'], sm.add_constant(tb['yhat1'])).fit()\n# Create a scatter plot with a regression line\nsns.set(style=\"whitegrid\")\nplt.figure(figsize=(7, 4.5))\nsns.scatterplot(x='x', y='uhat1', data=tb, size=0.05, color='black', alpha=0.5)\nsns.regplot(x='x', y='uhat1', data=tb, scatter=False, color='black')\nplt.xlabel('x')\nplt.ylabel('uhat1')\nplt.title('Scatter Plot of uhat1 vs. x')\nplt.show()\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-40-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nset seed 1 \nset obs 10000 \ngen x = rnormal() \ngen u  = rnormal() \ngen y  = 5.5*x + 12*u \nqui reg y x \npredict yhat1 \npredict uhat1, residual \ntwoway (lfit uhat1 x , lcolor(black) lwidth(large)) (scatter uhat1 x , mcolor(black) msymbol(point))\nqui graph export \"files/graph5.svg\", replace\n```\n:::\n\n\n![](files/graph5.svg) \n\n:::\n\n\n## Properties of OLS {.smaller background=\"#bfc4d9\"}\n\nLet's say you estimate a model and find the $\\hat{\\mu}$.\n\nIf you calculate the correlation between the X and $\\hat{\\mu}$, you will find zero.\n\n**This is by construction!** It is not an evidence that CMI is nos violated.\n\nIn fact, the OLS \"assumes\" and \"forces\" zero correlation.\n\n**It is intuitive: if you are \"forcing\" zero correlation when the correlation is not in fact zero, your coefficients will be biased.**\n\nThe previous graphs actually show zero correlation. But that is expected and does not suggest the model is not violating CMI.\n\n**At the end of the day, CMI is untestable and unverifiable**.\n\n\n\n\n\n\n\n\n\n# Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\n## Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\n**Understanding what SSR, SSE and SST mean** \n\n- SSE = Sum of Squares Explained = $\\sum_i^n(\\hat{y_i}-\\bar{y})^2$\n- SSR = Sum of Squares Residuals = $\\sum_i^n\\hat{\\mu}^2$\n- SST = Sum of Squares Total = SSE + SSR = $\\sum_i^n(y_i-\\hat{y_i})^2$ \n\n\nR-squared is simply the ratio of portion explained over the total that could be explained.\n\n\n$$R^2 = \\frac{SSE}{SST} = 1-\\frac{SSR}{SST}$$\n\n\n\n## Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\n![](figs/R2.jpg)\n\n\n\n\n\n## Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\nYou can think this way:\n\n1) If X does not explain Y, then the best predictor of Y is $\\bar{y}$. In that case, your model does not explain anything of Y, thus $R^2$ is zero, and $\\hat{y_i}=\\bar{y}$\n\n. . .\n\n2) If X partially explains Y, then $\\hat{y_i} \\neq \\bar{y}$, meaning that $\\hat{y_i}$ has some inclination (like the figure next slide). This means that $SSE>0$ and your $R^2>0$ but $R^2<1$\n\n. . .\n\n3) Whatever is not explained by $\\hat{y_i}$ is left to $\\sum_i^2\\hat{\\mu}^2$, meaning that SSR will be non-zero.\n\n. . .\n\n4) The ratio of the portion that you can explain by  $\\hat{y_i}$ over the total that is to be explained  $y_i-\\hat{y_i}$ if the $R^2$.\n\n\n\n\n\n\n## Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign) # importing dataset from a stata dta file\ndata <- read.dta(\"files/CEOSAL1.dta\")\nattach(data)\n# Statistics of salary \nmean(salary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1281.12\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# OLS model\nmodel <- lm(salary ~ roe)\nsalaryhat <- fitted(model)                      # Predict values for dependent variable\nuhat <- resid(model)                            # Predict regression residuals\nsalarymean <- rep(mean(salary),length(salary))  # Generating the mean of salary \nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = salary ~ roe)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1160.2  -526.0  -254.0   138.8 13499.9 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   963.19     213.24   4.517 1.05e-05 ***\nroe            18.50      11.12   1.663   0.0978 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1367 on 207 degrees of freedom\nMultiple R-squared:  0.01319,\tAdjusted R-squared:  0.008421 \nF-statistic: 2.767 on 1 and 207 DF,  p-value: 0.09777\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\ndata = pd.read_stata(\"files/CEOSAL1.dta\")\nprint(data['salary'].mean())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1281.1196172248804\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n# OLS model\nX = data['roe']\nX = sm.add_constant(X)\ny = data['salary']\n\nmodel = sm.OLS(y, X).fit()  # Fit the linear regression model\nsalaryhat = model.fittedvalues  # Predicted values for the dependent variable\nuhat = model.resid  # Predict regression residuals\nsalarymean = pd.Series([y.mean()] * len(y))  # Generating the mean of salary\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:                 salary   R-squared:                       0.013\nModel:                            OLS   Adj. R-squared:                  0.008\nMethod:                 Least Squares   F-statistic:                     2.767\nDate:                qua, 11 set 2024   Prob (F-statistic):             0.0978\nTime:                        16:20:17   Log-Likelihood:                -1804.5\nNo. Observations:                 209   AIC:                             3613.\nDf Residuals:                     207   BIC:                             3620.\nDf Model:                           1                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst        963.1913    213.240      4.517      0.000     542.790    1383.592\nroe           18.5012     11.123      1.663      0.098      -3.428      40.431\n==============================================================================\nOmnibus:                      311.096   Durbin-Watson:                   2.105\nProb(Omnibus):                  0.000   Jarque-Bera (JB):            31120.902\nSkew:                           6.915   Prob(JB):                         0.00\nKurtosis:                      61.158   Cond. No.                         43.3\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\nsum salary \nreg salary roe \npredict salaryhat , xb\t\t\t\t\npredict uhat, resid\t\t\t\t\t\negen salarymean = mean(salary)\t\t\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n      salary |        209     1281.12    1372.345        223      14822\n\n      Source |       SS           df       MS      Number of obs   =       209\n-------------+----------------------------------   F(1, 207)       =      2.77\n       Model |  5166419.04         1  5166419.04   Prob > F        =    0.0978\n    Residual |   386566563       207  1867471.32   R-squared       =    0.0132\n-------------+----------------------------------   Adj R-squared   =    0.0084\n       Total |   391732982       208  1883331.64   Root MSE        =    1366.6\n\n------------------------------------------------------------------------------\n      salary | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n         roe |   18.50119   11.12325     1.66   0.098    -3.428196    40.43057\n       _cons |   963.1913   213.2403     4.52   0.000     542.7902    1383.592\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n## Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign) # importing dataset from a stata dta file\nmydata <- read.dta(\"files/CEOSAL1.dta\")\nattach(mydata)\nmodel <- lm(salary ~ roe)\nsalaryhat <- fitted(model)                      # Predict values for dependent variable\nuhat <- resid(model)                            # Predict regression residuals\nsalarymean <- rep(mean(salary),length(salary))  # Generating the mean of salary \n# r-squared is simply the ratio of portion explained over total that could be explained - Understanding what SSR, SSE and SST mean \nplot(salary ~ roe)\nabline(lm(salary ~ roe), col = \"blue\")\nabline(lm(salarymean ~ roe), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-45-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\ndata = pd.read_stata(\"files/CEOSAL1.dta\")\nX = data[['roe']]\ny = data['salary']\nsalarymean = np.repeat(y.mean(), len(y))\nX_mean = X.mean()\ny_mean = y.mean()\nslope = np.sum((X - X_mean) * (y - y_mean)) / np.sum((X - X_mean) ** 2)\nintercept = y_mean - slope * X_mean\nsalaryhat = slope * X + intercept\n# Plotting the data and regression lines\nplt.scatter(X, y,  alpha=0.7)\nplt.plot(X, salaryhat,  color='blue', linewidth=2)\nplt.plot(X, salarymean, color='red',  linewidth=2)\nplt.xlabel('roe')\nplt.ylabel('salary')\nplt.show()\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-46-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\nsum salary , d\nreg salary roe \npredict salaryhat , xb\t\t\t\t\npredict uhat, resid\t\t\t\t\t\negen salarymean = mean(salary)\t\t\n\ntwoway (scatter salary roe) (lfit salary roe) (lfit salarymean roe) \nqui graph export \"files/graph4_6.svg\", replace\n```\n:::\n\n\n![](files/graph4_6.svg) \n\n:::\n\n\n\n\n\n\n\n\n\n\n## Goodness-of-fit {.smaller background=\"#dff2c7\"}\n\nManually calculating $R^2$\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign) # importing dataset from a stata dta file\nmydata <- read.dta(\"files/CEOSAL1.dta\")\nattach(mydata)\nmodel <- lm(salary ~ roe)\nsalaryhat <- fitted(model)                      # Predict values for dependent variable\nuhat <- resid(model)                            # Predict regression residuals\nsalarymean <- rep(mean(salary),length(salary))  # Generating the mean of salary \n\n# r-squared is simply the ratio of portion explained over total that could be explained\nssr  <- sum(uhat^2)\nssrB <- sum((salary    - salaryhat)^2)\nsst  <- sum((salary    - salarymean)^2)\nsse  <- sum((salaryhat - salarymean)^2)\nsse / sst\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.01318862\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\ndata = pd.read_stata(\"files/CEOSAL1.dta\")\nX = data['roe']\ny = data['salary']\nX = sm.add_constant(X)  # Add a constant term (intercept)\nmodel = sm.OLS(y, X).fit()\nsalaryhat = model.fittedvalues\nuhat = model.resid\nsalarymean = np.repeat(y.mean(), len(y))\n# Calculate R-squared\nssr = np.sum(uhat**2)\nssrB = np.sum((y - salaryhat)**2)\nsst = np.sum((y - salarymean)**2)\nsse = np.sum((salaryhat - salarymean)**2)\nrsquared = sse / sst\nprint(rsquared)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n0.013188624081034118\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\nqui reg salary roe \npredict salaryhat , xb\t\t\t\t\npredict uhat, resid\t\t\t\t\t\negen salarymean = mean(salary)\t\t\negen sst  = total((salary    - salarymean)^2)  \negen ssr  = total((salary    - salaryhat)^2)\negen ssrB = total(uhat^2)\t\t\t\t\t\negen sse  = total((salaryhat - salarymean)^2)\t\ndi sse / sst\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n.01318862\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n# Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\nWhen we estimate coefficients we have some \"error of estimation\".\n\n- Basically, you are searching the \"true\" coefficient using a sample, which should be representative of the population but it is not the population itself.\n\n- This means that the coefficient estimated is estimated with error.\n\n- We would like (e.g., we will need) to impose some \"structure\" to that error.\n\n\n\n\n\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\n**Standard error and T-stat**\n\nTo assess if the variables are significantly related, you need to assess the significance of $\\beta$ coefficients.\n\nUsing the example from Wooldridge, we know that the Beta of ROE is `18.591`, while the standard error of ROE is `11.123`.\n\n. . .\n\n- The standard error is a measure of the accuracy of your estimate. If you find a large standard error, your estimate does not have good accuracy. \n\n- Ideally, you would find small standard errors, meaning that your coefficient is accurately estimated. \n\n- However, you do not have good control over the magnitude of the standard errors. \n\n\n\n\n\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\n**Standard error and T-stat**\n\nIf you have a large standard error, probably you coefficient will not be significantly different from zero. You can test whether your coefficient is significantly different from zero computing the t-statistics as follows:\n\n$$t_{\\beta} = \\frac{\\hat{\\beta}}{se(\\hat{\\beta})}$$\n\nIf $t_{\\beta}$ is large enough, you can say that $\\beta$ is significantly different from zero. Usually, $t_{\\beta}$ larger than 2 is enough to be significant. \n\n\n\n\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\nIn the previous example, you can find the t-stat manually as follows ($t_{\\beta} =\\frac{\\hat{\\beta}}{se(\\hat{\\beta})}$):\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign) # importing dataset from a stata dta file\ndata <- read.dta(\"files/CEOSAL1.dta\")\nattach(data)\n# OLS model\nmodel <- lm(salary ~ roe)\nsummary(model)$coefficients[2,1] / summary(model)$coefficients[2,2] \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.663289\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nsummary(model)$coefficients[2,3]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.663289\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\ndata = pd.read_stata(\"files/CEOSAL1.dta\")\n# OLS model\nX = data['roe']\nX = sm.add_constant(X)\ny = data['salary']\nmodel = sm.OLS(y, X).fit()  \n# Extract and calculate specific coefficients\ncoef_beta = model.params['roe']\ncoef_std_error = model.bse['roe']\n# Calculate t-value\nt_value = coef_beta / coef_std_error\n# Print the coefficient and t-value\nprint(\"Coefficient (beta):\", coef_beta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoefficient (beta): 18.501186345214933\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nprint(\"Standard Error:\", coef_std_error)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error: 11.123250903287634\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nprint(\"t-value:\", t_value)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nt-value: 1.6632894920806511\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\nqui reg salary roe \nlocal beta = _b[roe]\nlocal std_error = _se[roe]\nlocal t_value = `beta' / `std_error'\ndisplay \"Coefficient (beta): \" `beta'\ndisplay \"Standard Error: \" `std_error'\ndisplay \"t-value: \" `t_value'\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoefficient (beta): 18.501186\n\nStandard Error: 11.123251\n\nt-value: 1.6632895\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\nNaturally, the previous analysis requires an estimate of $\\beta$ and an estimate of the $\\beta$'s standard error.\n\n\nThe standard error can be defined as:\n\n$$se(\\hat{\\beta_1})=\\frac{\\hat{\\sigma}}{\\sqrt{SST_x}}$$\n\n- Where $\\hat{\\sigma}$ is the standard deviation of the error term in the regression, which can be calculated as:\n\n$$\\hat{\\sigma} = \\sqrt{\\frac{SSR}{n-2}}$$\n\n    - The $n-2$ here is an adjustment for the degrees of freedom in the regression.\n\n- SST is defined as before $\\sum_i^n(y_i-\\hat{y_i})^2$ \n\n\n\n\n\n\n\n\n\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign) # importing dataset from a stata dta file\ndata <- read.dta(\"files/CEOSAL1.dta\")\nattach(data)\n# OLS model\nmodel <- lm(salary ~ roe)\n# Extract the standard error of the coefficient for 'roe'\nsummary(model)$coefficients[\"roe\", \"Std. Error\"]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 11.12325\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n#calculating manually\n# Extract the residuals\nresiduals <- resid(model)\n# Number of observations (n)\nn <- length(residuals)\n# Calculate the mean of the independent variable (roe)\nroe_mean <- mean(roe)\n# Calculate the sum of squared deviations of roe from its mean (SXX)\nSST <- sum((roe - roe_mean)^2)\n# Calculate the sum of squared errors (SSE)\nSSR <- sum(residuals^2)\n# Calculate the standard error of beta\nSd_beta <- sqrt(SSR / ((n - 2)))\n# Calculate S.E\nSe_beta <- Sd_beta / sqrt(SST)\n# Print the standard error of beta\nprint(Se_beta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 11.12325\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\ndata = pd.read_stata(\"files/CEOSAL1.dta\")\nX = data['roe']\ny = data['salary']\nX = sm.add_constant(X)  \nmodel = sm.OLS(y, X).fit()\n# Extract the standard error of the coefficient for 'roe'\nbeta_se_summary = model.bse['roe']\nprint(\"Standard Error (from summary):\", beta_se_summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (from summary): 11.123250903287634\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n# Calculate it manually\n# Extract the residuals\nresiduals = model.resid\n# Number of observations (n)\nn = len(residuals)\n# Calculate the mean of the independent variable (roe)\nroe_mean = X['roe'].mean()\n# Calculate the sum of squared deviations of roe from its mean (SST)\nSST = np.sum((X['roe'] - roe_mean) ** 2)\n# Calculate the sum of squared errors (SSE)\nSSE = np.sum(residuals ** 2)\n# Calculate the standard error of beta (Sd_beta)\nSd_beta = np.sqrt(SSE / (n - 2))\n# Calculate SE_beta\nSE_beta = Sd_beta / np.sqrt(SST)\nprint(\"Standard Error (manually calculated):\", SE_beta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (manually calculated): 11.123250601798315\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\nqui reg salary roe \ngen beta_se_summary = _se[roe]\ngen n = _N\npredict residuals, residuals\nsum roe, meanonly\ngen roe_diff = roe - r(mean)\negen roe_diff_sq = total(roe_diff^2)\ngen residuals_sq = residuals^2\negen residuals_sq_sum = total(residuals_sq)\ngen Sd_beta = sqrt(residuals_sq_sum / (n - 2))\ngen SE_beta = Sd_beta / sqrt(roe_diff_sq)\ndisplay \"Standard Error (from summary): \" sum(beta_se_summary)\ndisplay \"Standard Error (manually calculated): \" sum(SE_beta)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (from summary): 11.123251\n\nStandard Error (manually calculated): 11.123251\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n## Variance of coefficients {.smaller background=\"#c4f5d7\"}\n\n**Another comment:**\n\n$$se(\\hat{\\beta_1})=\\frac{\\hat{\\sigma}}{\\sqrt{SST_x}}$$\n\n1) The larger $\\hat{\\sigma}$ is, the larger the variance of $\\beta$. That is, the more \"noise\" in the association between x and Y, the harder it is to learn something about $\\beta$.\n\n2) However, more variation in x, the larger the SST, so the smaller is the variance of $\\beta$.\n\n\n\n\n\n\n\n\n\n# Robust standard errors {.smaller background=\"#e0cafc\"}\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\nLooking at both equations below:\n\n$$t_{\\beta} = \\frac{\\hat{\\beta}}{se(\\hat{\\beta})}$$\n\n\n$$se(\\hat{\\beta_1})=\\frac{\\hat{\\sigma}}{\\sqrt{SST_x}}$$\n\n\n**What happens if $\\hat{\\sigma}$ is not constant (for the values of x)?**\n\n**In other words, how realistic is to assume that the variance in the errors is the same for all slices of x?**\n\n**Can you think of an example where that may happen?**\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\n**Earnings = f(education)**\n\nPhD have a higher variance of earnings than non-educated people.\n\n. . .\n\n**Leveragge=f(Size)**\n\nIt is quite possible that small firms will have less options of leverage than large companies. \n\nThis means that a sub-sample of large companies will have higher variance in the leverage decisions (and thus the error terms) than the sub-sample of small firms\n\n\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\nOne of the key assumptions in OLS estimators is homoscedasticity \n\nThat is, the assumption is that the variance of the errors is homoscedastic (constant variance in all slices of X). \n\nIt means that throughout all observations, the error term shows the **same variance**. \n\nIf errors are not homoscedastic, we have the heteroscedasticity problem.\n\n\n. . . \n\nHeteroskedasticity **does not cause bias or inconsistency in the OLS estimators** of the $\\beta$ like the OVB would. \n\nIt also does not affect the $R^2$. \n\n**What Heteroscedasticity does is to bias the standard errors of the estimates.**\n\n\n\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\n![](files/homoscedasticity.png)\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\n\n\n![](files/heteroscedasticity.png)\n\n\n\n\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\n**Homoskedascticity** = Constant $\\hat{\\sigma}$ to all slices of X.\n\n**Heteroskedascticity** = Non-constant $\\hat{\\sigma}$ to all slices of X.\n\n**Without homoskedascticity, OLS no longer has the minimum mean squared errors**, which means that the *estimated standard errors are biased*, which in turn creates bias in the t-stat and the inference you'll make with your model.\n \n\n. . . \n\nFortunately, we have an easy solution for that.\n\n\n$$Var(\\hat{\\beta_1}) = \\frac{\\sum_i^n(x_i-\\bar{x})^2\\hat{\\mu}^2}{SST^2_x}$$\n\nThis formula simply \"includes\" the heteroskedascticity in the calculation of $Var(\\hat{\\beta_1})$, meaning this correct the estimated standard deviation to heteroskedascticity.\n\nWe call this correction as **Robust Standard Errors** (White Robust).\n\n. . .\n\nIn other words, you should always use Robust Standard Errors. It is easy to use it with R.\n\n\n\n\n\n\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\n**Using Robust Standard-errors.**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(sandwich)\nlibrary(foreign) \nlibrary(lmtest)\n\ndata <- read.dta(\"files/CEOSAL1.DTA\")\nmodel <- lm(salary ~ roe, data = data)\nrobust_model <- coeftest(model, vcov = vcovHC(model, type = \"HC3\"))\nSE_beta_robust <- robust_model[\"roe\", \"Std. Error\"]\ncat(\"Robust Standard Error :\", SE_beta_robust, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRobust Standard Error : 6.899434 \n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\ndata = pd.read_stata(\"files/CEOSAL1.DTA\")\nmodel = smf.ols(\"salary ~ roe\", data=data)\nresults = model.fit(cov_type='HC3')  \nSE_beta_robust = results.bse['roe']\nprint(\"Robust Standard Error :\", SE_beta_robust)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRobust Standard Error : 6.899433834797476\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\n\nqui reg salary roe \ngen beta_se_non = _se[roe]\n\nqui reg salary roe , robust\ngen beta_se_summary = _se[roe]\n\ndi \"Standard Error (non-robust): \" sum(beta_se_non)\ndi \"Standard Error (robust): \" sum(beta_se_summary)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (non-robust): 11.123251\n\nStandard Error (robust): 6.8294482\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n##  Robust standard errors {.smaller background=\"#e0cafc\"}\n\n\nNotice that the standard errors have changed quite significantly  in this example. \n\nUsually, the robust standard errors are larger than the traditional ones in empirical works.\n\n**But, in this example, they are smaller.**\n\n. . . \n\nPerhaps more importantly:\n\n**Once the S.e. change, you should expect that the t-stat of the estimates also change.**\n\n\n. . . \n\n\n**Final comment**: robust standard errors are robust in the case of homoskedasticity.\n\n::: {.callout-warning}\nThus, you should always use robust S.E.\n:::\n\n\n\n\n\n\n\n\n\n# Clustered standard errors {.smaller background=\"#edc5d1\"}\n\n## Clustered standard errors {.smaller background=\"#edc5d1\"}\n\nAlmost always, someone will ask you whether you clustered your standard errors.\n\n**The intuition is the following:**\n\n- When you do not cluster, you are assuming that all observations are independently and identically distributed (i.i.d.), which may or may not be true.\n\n- Imagine you are studying the effect of class size on students achievement.\n\n- How much of a effect would **have the teacher of a class**? \n\n. . . \n\n- In this design, the teacher influences the achievement of all the students in the same class, and one teacher cannot be at two classes at the same time.\n\n- Thus, it would be wise to cluster the errors at the class-level. This assumes that the residual of each individual is clustered with the other individuals in the same class.\n\n\n. . .\n\nIn principle, clustering solves any form of dependence of the residuals in your data.\n\n\n\n\n\n\n\n\n## Clustered standard errors {.smaller background=\"#edc5d1\"}\n\nIn corporate finance/accounting research panel data research, the tradition is to cluster at the **firm-level**.\n\n- The reason is that the observations of the same firm are not independent trough time, thus are correlated. \n\nBut, there is a lot of debate about this decision. \n\n. . .\n\nThe tip is to cluster where the **randomness exist**. That is quite subjective. In the class size example, the **randomness** comes out of the teacher, since each teacher has their own ways of teaching (materials, resources, etc.).\n\n. . .\n \nBut, it is a good practice to stress this decision a bit in your own research by **also showing results with clustered s.e. at the industry-level**.\n\n. . .\n\n**Final tip**: usually the minimum number of cluster is about 30. Less than that might be insufficient (but, again, the guidance in this topic is very subjective).  \n\n\n\n \n\n\n## Clustered standard errors {.smaller background=\"#edc5d1\"}\n\nThe clustered standard errors are different because I am fabricating the clusters here for the sake of the coding.\n\nIn your real research, you would have the cluster at hands. \n\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(sandwich)\nlibrary(foreign) \nlibrary(lmtest)\nlibrary(plm)\n\ndata <- read.dta(\"files/CEOSAL1.DTA\")\nmodel <- lm(salary ~ roe, data = data)\nrobust_model <- coeftest(model, vcov = vcovHC(model, type = \"HC3\"))\n#clustered\ndata$cluster <- rep(1:35, length.out = nrow(data))\nmodel <- plm(salary ~ roe, data = data, index = c(\"cluster\"))\n\nclustered_se <- vcovHC(model, type = \"HC3\", cluster = \"group\")\nSE_beta_clustered <- sqrt(clustered_se[\"roe\", \"roe\"])\n\ncat(\"Standard Error (robust):\", SE_beta_robust, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (robust): 6.899434 \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\ncat(\"Standard Error (clustered)::\", SE_beta_clustered, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (clustered):: 12.98492 \n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\n\n# Read the dataset\ndata = pd.read_stata(\"files/CEOSAL1.DTA\")\n\n# Create a new variable 'cluster' with cluster numbers ranging from 1 to 35\ndata['cluster'] = list(range(1, 36)) * (len(data) // 35)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nLength of values (175) does not match length of index (209)\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n# Fit the linear regression model\nmodel = sm.OLS(data['salary'], sm.add_constant(data['roe'])).fit()\n\n# Compute robust standard errors\nrobust_model = model.get_robustcov_results(cov_type='HC3')\nSE_beta_robust = robust_model.cov_params().loc['roe', 'roe'] ** 0.5\n```\n\n::: {.cell-output .cell-output-error}\n\n```\n'numpy.ndarray' object has no attribute 'loc'\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n# Fit the linear regression model with clustered standard errors\nmodel_clustered = sm.OLS(data['salary'], sm.add_constant(data['roe'])).fit(cov_type='cluster', cov_kwds={'groups': data['cluster']})\n```\n\n::: {.cell-output .cell-output-error}\n\n```\n'cluster'\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\n# Extract the clustered standard errors for 'roe'\nclustered_se = model_clustered.HC3_se.loc['roe']\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nname 'model_clustered' is not defined\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nprint(\"Robust Standard Error (HC3):\", SE_beta_robust)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRobust Standard Error (HC3): 6.899433834797476\n```\n\n\n:::\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nprint(\"Clustered Standard Error (HC3):\", clustered_se)\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nname 'clustered_se' is not defined\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CEOSAL1.DTA\" , replace\n\nqui reg salary roe \ngen beta_se_non = _se[roe]\n\nqui reg salary roe , robust\ngen beta_se_summary = _se[roe]\n\negen cluster = seq(), block(6)\nqui regress salary roe , vce(cluster cluster)\ngen SE_beta_clustered = _se[roe]\n\ndi \"Standard Error (non-robust): \" sum(beta_se_non)\ndi \"Standard Error (robust): \" sum(beta_se_summary)\ndi \"Standard Error (clustered): \" sum(SE_beta_clustered)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error (non-robust): 11.123251\n\nStandard Error (robust): 6.8294482\n\nStandard Error (clustered): 6.4122176\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n# Panel Data {.smaller background=\"#dff5ce\"}\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\nAs explained previously, OVB is a significant source of \"endogeneity\" in empirical research.\n\nOVB is a problem because of the considerable heterogeneity in many empirical settings. \n\n**Many of the omitted variables are unobservable to the researcher.**\n\nPanel data can sometimes offer a partial.\n\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\nWe start defining the following:\n\n\n$$y_{i,t} = \\alpha + \\beta_1 x_{i,t} + \\epsilon_{i,t}$$\n\nWhere: \n\n  - $i = 1, . . . , N$\n  - $t = 1, . . . , T$\n\n. . . \n\n\nImagine that the residual can be decomposed in: \n\n$$\\epsilon_{i,t} = c_i + \\mu_{i,t}$$\n\nThe term $c_i$ is constant.\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\nThe term $c_i$ is constant.\n\n**It captures the aggregate effect of all of the unobservable, time-invariant explanatory variables for $y_{it}$.**\n\nTo focus attention on the issues specific to panel data, we assume that $e_{it}$ has a zero mean conditional on $x_{it}$ and $c_i$ for all $t$.\n\n. . .\n\nThe most important thing here is whether $x_{it}$ and $c_i$ are correlated.\n\n**Why?**\n\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\nThe most important thing here is whether $x_{it}$ and $c_i$ are correlated.\n\n\n- If $x_{it}$ and $c_i$ are correlated, then $c_i$  is referred to as a “fixed effect”.\n  \n  - It there is correlation, there is violation of the *Conditional Mean Independence* (CMI) assumption.\n\n    \n- If $x_{it}$ and $c_i$ are not correlated, then $c_i$  is referred to as a “random effect”.\n\n  - Endogeneity is not a concern; however, the computation of standard errors is affected.\n\n\n\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\n**Why might fixed effects arise?**\n\nFE are any time-invariant unit characteristic that cannot be observed in the data.\n\n- education level,\n- firm's culture,\n- technology,\n- managerial talent,\n- investment opportunities,\n- location (economic development, institutions, etc.),\n- etc.\n\n\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\n**We say things like (you have to understand that they refer to FE):** \n\n- \"*Time-invariant heterogeneity at the unit-level*\"\n- \"*Unobserved variation that occur at the unit-level that do not vary over time*\"\n\n**Important**: with FE, you are capturing **all** unobserved heterogeneity that do not vary over time.\n\n\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\nDefinition of *Panel Data*:\n\nYou have multiple observations per unit (individual, firm, etc.)\n\nIn datasets, it is \"one panel below the other\" not \"one panel beside the other\".\n\n. . . \n\n\n**Four main topics in Panel Data:**\n\n1) Pooled cross-sectional\n\n2) Fixed Effect models (including multidimensional FE)\n\n3) Random Effects model\n\n4) First differences\n\n5) Lagged models\n\n\n\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\nFormal definition\n\n$$y_{i,t} = \\alpha + \\beta_1 x_{i,t} + \\delta FE +  \\epsilon_{i,t}$$\n\n- $E(\\epsilon_{i,t}) = 0$\n\n- $corr(x_{i,t},FE) \\neq 0$\n\n- $corr(FE, \\epsilon_{i,t}) = 0$\n\n- $corr(x_{i,t},epsilon_{i,t}) = 0$, for all t\n\nThe last assumption is called *strict exogeneity assumption* and means that the residual of any t is uncorrelated with x of any t.\n\n*That is, under a strict exogeneity assumption on the explanatory variables, the fixed effects estimator is unbiased: the idiosyncratic error should be uncorrelated with each explanatory variable across all time periods.*\n\n\n. . .\n\n**Remember that if we ignore FE, we have OVB.**\n\n\n\n\n\n## Panel Data {.smaller background=\"#dff5ce\"}\n\n**Before we continue...**\n\n**Comment #1**\n\n*The standard errors in this framework must be “clustered” by panel unit (e.g., individual) to allow for correlation in the residual for the same person over time. This yields valid inference as long as the number of clusters is “large.\"*\n\n. . . \n\n**Comment #2**\n\n*FE cannot solve reverse causality, it might help you with OVB.*\n\n. . . \n\n**Comment #3**\n\n*Three main types of FE:*\n\n- Pooled\n- Within-transformation (when someone says FE, it is usually this one)\n- Random Effects\n\n\n\n\n\n\n# Pooling Cross-sections  {.smaller background=\"#e0cafc\"}\n\n## Pooling Cross-Sections  {.smaller background=\"#e0cafc\"}\n\nWhen you have two periods of the same unit, but the periods are not consecutive, you have a pooled cross-sectional data.\n\nThis is common in survey data.\n\nIf you use only one period, you might find biased results.\n\n. . .\n\nLet's practice with the dataset CRIME2 from Wooldridge. \n\nThis dataset contains data (many cities) on the crime rate, unemployment rate and many other city-related variables.\n\nThere are two years, 82 and 87 (this is pooled cross-section). \n\n\n\n\n\n## Pooling Cross-Sections  {.smaller background=\"#e0cafc\"}\n\nIf we estimate only using the year 87, we would interpret that unemployment leads to lower crime rate.\n\n::: panel-tabset\n\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(haven) \ndata <- read_dta(\"files/CRIME2.dta\")\ndata1 <- subset(data, year == 87)\nmodel <- lm(crmrte ~ unem, data = data1)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = crmrte ~ unem, data = data1)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-57.55 -27.01 -10.56  18.01  79.75 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  128.378     20.757   6.185  1.8e-07 ***\nunem          -4.161      3.416  -1.218     0.23    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 34.6 on 44 degrees of freedom\nMultiple R-squared:  0.03262,\tAdjusted R-squared:  0.01063 \nF-statistic: 1.483 on 1 and 44 DF,  p-value: 0.2297\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\n\ndata = pd.read_stata(\"files/CRIME2.dta\")\ndata1 = data[data['year'] == 87]\nmodel = sm.OLS(data1['crmrte'], sm.add_constant(data1['unem'])).fit()\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:                 crmrte   R-squared:                       0.033\nModel:                            OLS   Adj. R-squared:                  0.011\nMethod:                 Least Squares   F-statistic:                     1.483\nDate:                qua, 11 set 2024   Prob (F-statistic):              0.230\nTime:                        16:20:39   Log-Likelihood:                -227.27\nNo. Observations:                  46   AIC:                             458.5\nDf Residuals:                      44   BIC:                             462.2\nDf Model:                           1                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst        128.3781     20.757      6.185      0.000      86.546     170.210\nunem          -4.1611      3.416     -1.218      0.230     -11.047       2.724\n==============================================================================\nOmnibus:                        3.902   Durbin-Watson:                   1.106\nProb(Omnibus):                  0.142   Jarque-Bera (JB):                3.681\nSkew:                           0.641   Prob(JB):                        0.159\nKurtosis:                       2.473   Cond. No.                         25.3\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CRIME2.dta\" , clear\nreg crmrte une if year ==87\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Source |       SS           df       MS      Number of obs   =        46\n-------------+----------------------------------   F(1, 44)        =      1.48\n       Model |  1775.90928         1  1775.90928   Prob > F        =    0.2297\n    Residual |  52674.6428        44  1197.15097   R-squared       =    0.0326\n-------------+----------------------------------   Adj R-squared   =    0.0106\n       Total |  54450.5521        45  1210.01227   Root MSE        =      34.6\n\n------------------------------------------------------------------------------\n      crmrte | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n        unem |  -4.161134   3.416456    -1.22   0.230    -11.04655     2.72428\n       _cons |   128.3781   20.75663     6.18   0.000     86.54589    170.2104\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n## Pooling Cross-Sections  {.smaller background=\"#e0cafc\"}\n\nWhen we consider a panel, we get the expected positive sign. This is evidence that the previous model suffered from OVB. Still, the coefficient of unem is not significant probably because of time-invariant unobserved heterogeneity in the cities.\n\n::: panel-tabset\n\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(haven) \ndata <- read_dta(\"files/CRIME2.dta\")\nmodel <- lm(crmrte ~ d87+ unem, data = data)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = crmrte ~ d87 + unem, data = data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-53.474 -21.794  -6.266  18.297  75.113 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  93.4203    12.7395   7.333 9.92e-11 ***\nd87           7.9404     7.9753   0.996    0.322    \nunem          0.4265     1.1883   0.359    0.720    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.99 on 89 degrees of freedom\nMultiple R-squared:  0.01221,\tAdjusted R-squared:  -0.009986 \nF-statistic: 0.5501 on 2 and 89 DF,  p-value: 0.5788\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\n\ndata = pd.read_stata(\"files/CRIME2.dta\")\nmodel = sm.OLS(data['crmrte'], sm.add_constant(data[['d87','unem']])).fit()\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                            OLS Regression Results                            \n==============================================================================\nDep. Variable:                 crmrte   R-squared:                       0.012\nModel:                            OLS   Adj. R-squared:                 -0.010\nMethod:                 Least Squares   F-statistic:                    0.5501\nDate:                qua, 11 set 2024   Prob (F-statistic):              0.579\nTime:                        16:20:42   Log-Likelihood:                -441.90\nNo. Observations:                  92   AIC:                             889.8\nDf Residuals:                      89   BIC:                             897.4\nDf Model:                           2                                         \nCovariance Type:            nonrobust                                         \n==============================================================================\n                 coef    std err          t      P>|t|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst         93.4203     12.739      7.333      0.000      68.107     118.733\nd87            7.9404      7.975      0.996      0.322      -7.906      23.787\nunem           0.4265      1.188      0.359      0.720      -1.935       2.788\n==============================================================================\nOmnibus:                        8.350   Durbin-Watson:                   1.157\nProb(Omnibus):                  0.015   Jarque-Bera (JB):                8.771\nSkew:                           0.756   Prob(JB):                       0.0125\nKurtosis:                       2.935   Cond. No.                         40.1\n==============================================================================\n\nNotes:\n[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/CRIME2.dta\" , clear\nreg crmrte  d87 une \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Source |       SS           df       MS      Number of obs   =        92\n-------------+----------------------------------   F(2, 89)        =      0.55\n       Model |  989.717314         2  494.858657   Prob > F        =    0.5788\n    Residual |  80055.7864        89  899.503218   R-squared       =    0.0122\n-------------+----------------------------------   Adj R-squared   =   -0.0100\n       Total |  81045.5037        91  890.609931   Root MSE        =    29.992\n\n------------------------------------------------------------------------------\n      crmrte | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n         d87 |   7.940413   7.975324     1.00   0.322    -7.906386    23.78721\n        unem |   .4265461   1.188279     0.36   0.720    -1.934539    2.787631\n       _cons |   93.42026   12.73947     7.33   0.000      68.1072    118.7333\n------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n## Pooling Cross-Sections  {.smaller background=\"#e0cafc\"}\n\nThis shows us that we should also control for the year variable. \n\nWe call this, **Year Fixed Effects.**\n\nWe still most likely have OVB due to the unobserved heterogeneity in cities, that is, we still would need to include **cities FE**. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Demeaned variables  {.smaller background=\"#fccad9\"}\n\n## Demeaned variables  {.smaller background=\"#fccad9\"}\n\n**A first way to eliminate the FE is by demeaning the data.**\n\nConsider the following:\n\n$$\\bar{y_i} = \\alpha +\\beta \\bar{x_i} + \\delta FE + \\bar{\\epsilon_i}$$\n\n$$\\frac{1}{T}\\sum{y_{i,t}} = \\alpha +\\beta \\frac{1}{T}\\sum{x_{i,t}} + \\delta FE + \\frac{1}{T}\\sum{\\epsilon_{i,t}}$$\n\n. . .\n\nIf we subtract the mean of each variable, we have:\n\n$$(y_{i,t} - \\bar{y_i}) = \\beta (x_{i,t} - \\bar{x_i}) + (\\epsilon_{i,t} - \\bar{\\epsilon_i})$$\n\nBecause the FE does not vary over time, each value is equal to the mean.\n\nThus, when you demean, you eliminate the FE from the equation. You also eliminate the intercept $\\alpha$.\n\n. . .\n\n**Takeaway**: OLS will estimate unbiased coefficients if you demean the variables.\n\nThis is called **within-transformation** because you are demeaning \"within\" the group.\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Demeaned variables  {.smaller background=\"#fccad9\"}\n\nLet's use the dataset WAGEPAN to estimate the following equation.\n\n$$Ln(wage)=\\alpha + \\beta_1 exper^2 + \\beta_2 married + \\beta_3 union + \\epsilon$$\n\n\nSome variables in the dataset do not vary over time. These variables cannot be included in this equation. \n\n\n\n\n\n\n\n## Demeaned variables  {.smaller background=\"#fccad9\"}\n\nSee page 495 Wooldridge.\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign)\nlibrary(stargazer)\nlibrary(sandwich)\n\ndata <- read.dta(\"files/WAGEPAN.dta\")\n# Calculate mean by nr for lwage, expersq, married, and union\ndata <- data[order(data$nr), ]  # Sort data by nr for by-group operations\ndata$lwage_mean <- ave(data$lwage, data$nr, FUN = mean)\ndata$expersq_mean <- ave(data$expersq, data$nr, FUN = mean)\ndata$married_mean <- ave(data$married, data$nr, FUN = mean)\ndata$union_mean <- ave(data$union, data$nr, FUN = mean)\n\ndata$lwage_demean <- data$lwage - data$lwage_mean\ndata$expersq_demean <- data$expersq - data$expersq_mean\ndata$married_demean <- data$married - data$married_mean\ndata$union_demean <- data$union - data$union_mean\n\nmodel1 <- lm(lwage ~ educ + black + hisp + exper + expersq + married + union + d81 + d82 + d83 + d84 + d85 + d86 + d87, data = data)\nmodel2 <- lm(lwage_demean ~ expersq_demean + married_demean + union_demean + d81 + d82 + d83 + d84 + d85 + d86 + d87, data = data)\n\nstargazer(model1, model2 ,title = \"Regression Results\", column.labels=c(\"OLS\",\"Demean\"),  type = \"text\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results\n=======================================================================\n                                    Dependent variable:                \n                    ---------------------------------------------------\n                              lwage                 lwage_demean       \n                               OLS                     Demean          \n                               (1)                       (2)           \n-----------------------------------------------------------------------\neduc                        0.091***                                   \n                             (0.005)                                   \n                                                                       \nblack                       -0.139***                                  \n                             (0.024)                                   \n                                                                       \nhisp                          0.016                                    \n                             (0.021)                                   \n                                                                       \nexper                       0.067***                                   \n                             (0.014)                                   \n                                                                       \nexpersq                     -0.002***                                  \n                             (0.001)                                   \n                                                                       \nmarried                     0.108***                                   \n                             (0.016)                                   \n                                                                       \nunion                       0.182***                                   \n                             (0.017)                                   \n                                                                       \nexpersq_demean                                        -0.005***        \n                                                       (0.001)         \n                                                                       \nmarried_demean                                        0.047***         \n                                                       (0.017)         \n                                                                       \nunion_demean                                          0.080***         \n                                                       (0.018)         \n                                                                       \nd81                          0.058*                   0.151***         \n                             (0.030)                   (0.021)         \n                                                                       \nd82                          0.063*                   0.253***         \n                             (0.033)                   (0.023)         \n                                                                       \nd83                          0.062*                   0.354***         \n                             (0.037)                   (0.027)         \n                                                                       \nd84                          0.090**                  0.490***         \n                             (0.040)                   (0.034)         \n                                                                       \nd85                          0.109**                  0.617***         \n                             (0.043)                   (0.042)         \n                                                                       \nd86                         0.142***                  0.765***         \n                             (0.046)                   (0.053)         \n                                                                       \nd87                         0.174***                  0.925***         \n                             (0.049)                   (0.064)         \n                                                                       \nConstant                      0.092                   -0.445***        \n                             (0.078)                   (0.030)         \n                                                                       \n-----------------------------------------------------------------------\nObservations                  4,360                     4,360          \nR2                            0.189                     0.181          \nAdjusted R2                   0.187                     0.179          \nResidual Std. Error     0.480 (df = 4345)         0.328 (df = 4349)    \nF Statistic         72.459*** (df = 14; 4345) 95.840*** (df = 10; 4349)\n=======================================================================\nNote:                                       *p<0.1; **p<0.05; ***p<0.01\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nimport statsmodels.api as sm\nimport statsmodels.formula.api as smf\nfrom statsmodels.iolib.summary2 import summary_col\n\ndata = pd.read_stata(\"files/WAGEPAN.dta\")\n\ndata = data.sort_values(by='nr')  # Sort data by nr for by-group operations\ndata['lwage_mean'] = data.groupby('nr')['lwage'].transform('mean')\ndata['expersq_mean'] = data.groupby('nr')['expersq'].transform('mean')\ndata['married_mean'] = data.groupby('nr')['married'].transform('mean')\ndata['union_mean'] = data.groupby('nr')['union'].transform('mean')\n\ndata['lwage_demean'] = data['lwage'] - data['lwage_mean']\ndata['expersq_demean'] = data['expersq'] - data['expersq_mean']\ndata['married_demean'] = data['married'] - data['married_mean']\ndata['union_demean'] = data['union'] - data['union_mean']\n\nmodel1 = sm.OLS(data['lwage'], sm.add_constant(data[['educ', 'black', 'hisp', 'exper', 'expersq', 'married', 'union', 'd81', 'd82', 'd83', 'd84', 'd85', 'd86', 'd87']])).fit()\nmodel2 = sm.OLS(data['lwage_demean'], sm.add_constant(data[['expersq_demean', 'married_demean', 'union_demean', 'd81', 'd82', 'd83', 'd84', 'd85', 'd86', 'd87']])).fit()\n\n# Display regression results using stargazer\nsummary = summary_col([model1, model2], stars=True)\nprint(summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n======================================\n                 lwage    lwage_demean\n--------------------------------------\nR-squared      0.1893     0.1806      \nR-squared Adj. 0.1867     0.1787      \nblack          -0.1392***             \n               (0.0236)               \nconst          0.0921     -0.4446***  \n               (0.0783)   (0.0297)    \nd81            0.0583*    0.1512***   \n               (0.0304)   (0.0205)    \nd82            0.0628*    0.2530***   \n               (0.0332)   (0.0228)    \nd83            0.0620*    0.3544***   \n               (0.0367)   (0.0274)    \nd84            0.0905**   0.4901***   \n               (0.0401)   (0.0339)    \nd85            0.1092**   0.6175***   \n               (0.0434)   (0.0423)    \nd86            0.1420***  0.7655***   \n               (0.0464)   (0.0525)    \nd87            0.1738***  0.9250***   \n               (0.0494)   (0.0643)    \neduc           0.0913***              \n               (0.0052)               \nexper          0.0672***              \n               (0.0137)               \nexpersq        -0.0024***             \n               (0.0008)               \nexpersq_demean            -0.0052***  \n                          (0.0007)    \nhisp           0.0160                 \n               (0.0208)               \nmarried        0.1083***              \n               (0.0157)               \nmarried_demean            0.0467***   \n                          (0.0171)    \nunion          0.1825***              \n               (0.0172)               \nunion_demean              0.0800***   \n                          (0.0181)    \n======================================\nStandard errors in parentheses.\n* p<.1, ** p<.05, ***p<.01\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/WAGEPAN.dta\" , clear\n\nbys nr:  egen lwage_mean = mean(lwage) \nbys nr:  egen expersq_mean = mean(expersq) \nbys nr:  egen married_mean = mean(married) \nbys nr:  egen union_mean = mean(union)\n\ngen lwage_demean = lwage - lwage_mean\ngen expersq_demean = expersq - expersq_mean\ngen married_demean = married - married_mean\ngen union_demean = union - union_mean\n\neststo: qui reg lwage        educ black hisp exper expersq       married        union d81 d82 d83 d84 d85 d86 d87\neststo: qui reg lwage_demean expersq_demean married_demean union_demean d81 d82 d83 d84 d85 d86 d87\nesttab , mtitles(\"OLS\" \"Demean\") compress\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(est1 stored)\n\n(est2 stored)\n\n\n------------------------------------\n                 (1)          (2)   \n                 OLS       Demean   \n------------------------------------\neduc          0.0913***             \n             (17.44)                \n\nblack         -0.139***             \n             (-5.90)                \n\nhisp          0.0160                \n              (0.77)                \n\nexper         0.0672***             \n              (4.91)                \n\nexpersq     -0.00241**              \n             (-2.94)                \n\nmarried        0.108***             \n              (6.90)                \n\nunion          0.182***             \n             (10.63)                \n\nd81           0.0583        0.151***\n              (1.92)       (7.36)   \n\nd82           0.0628        0.253***\n              (1.89)      (11.08)   \n\nd83           0.0620        0.354***\n              (1.69)      (12.96)   \n\nd84           0.0905*       0.490***\n              (2.26)      (14.46)   \n\nd85            0.109*       0.617***\n              (2.52)      (14.59)   \n\nd86            0.142**      0.765***\n              (3.06)      (14.58)   \n\nd87            0.174***     0.925***\n              (3.52)      (14.38)   \n\nexpe~emean               -0.00519***\n                          (-7.87)   \n\nmarr~emean                 0.0467** \n                           (2.73)   \n\nunion_de~n                 0.0800***\n                           (4.43)   \n\n_cons         0.0921       -0.445***\n              (1.18)     (-14.96)   \n------------------------------------\nN               4360         4360   \n------------------------------------\nt statistics in parentheses\n* p<0.05, ** p<0.01, *** p<0.001\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n# Practical Tips  {.smaller background=\"#fce0cc\"}\n\n\n## Practical Tips  {.smaller background=\"#fce0cc\"}\n\nYou will not need to demean the variables every time you want to estimate a fixed effect models.\n\nThe statistical softwares have packages that do that.\n\nYou only need to know that **Fixed effects model** is a **demeaned model**, i.e., a **within-transformation model**. \n\nBut notice that you will have many different Fixed Effects together:\n\n- Firm Fixed Effects\n- Year Fixed Effects\n- Individual Fixed Effects (if individuals change between firms)\n\n. . . \n\nI am calling a **multidimensional fixed effects design** if you expand the FE to interactions of FE. Most common:\n\n- Year-Industry Fixed Effects.\n- CEO-Firm Fixed Effects.\n\n\n\n\n\n\n\n## Practical Tips  {.smaller background=\"#fce0cc\"}\n\nNotice the number of dummies in the last two columns.\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(foreign)\nlibrary(stargazer)\nlibrary(sandwich)\nlibrary(plm)\n\ndata <- read.dta(\"files/WAGEPAN.dta\")\n# Calculate mean by nr for lwage, expersq, married, and union\ndata <- data[order(data$nr), ]  # Sort data by nr for by-group operations\ndata$lwage_mean <- ave(data$lwage, data$nr, FUN = mean)\ndata$expersq_mean <- ave(data$expersq, data$nr, FUN = mean)\ndata$married_mean <- ave(data$married, data$nr, FUN = mean)\ndata$union_mean <- ave(data$union, data$nr, FUN = mean)\n\ndata$lwage_demean <- data$lwage - data$lwage_mean\ndata$expersq_demean <- data$expersq - data$expersq_mean\ndata$married_demean <- data$married - data$married_mean\ndata$union_demean <- data$union - data$union_mean\n\n# set panel data\npdata <- pdata.frame(data, index = c(\"nr\", \"year\"))\n\n# Random effects regression using plm\nmodel_de <- lm(lwage_demean ~  expersq_demean + married_demean + union_demean +  d81 +d82+ d83+ d84+ d85 +d86 +d87 , data = data)\nmodel_fe <- plm(lwage ~  expersq + married + union + factor(year)              + educ + black + hisp + exper, data = pdata, model = \"within\")\nmodel_du <- lm( lwage ~  expersq + married + union + factor(year) + factor(nr) + educ + black + hisp + exper, data = data)\n\n# Display regression results using stargazer\n#summary(model_de)\n#summary(model_fe)\n#summary(model_du)\nstargazer(model_de, model_fe, model_du ,title = \"Regression Results\",  type = \"text\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results\n==================================================================================================\n                                                 Dependent variable:                              \n                    ------------------------------------------------------------------------------\n                          lwage_demean                               lwage                        \n                               OLS                      panel                      OLS            \n                                                       linear                                     \n                               (1)                       (2)                       (3)            \n--------------------------------------------------------------------------------------------------\nexpersq_demean              -0.005***                                                             \n                             (0.001)                                                              \n                                                                                                  \nmarried_demean              0.047***                                                              \n                             (0.017)                                                              \n                                                                                                  \nunion_demean                0.080***                                                              \n                             (0.018)                                                              \n                                                                                                  \nd81                         0.151***                                                              \n                             (0.021)                                                              \n                                                                                                  \nd82                         0.253***                                                              \n                             (0.023)                                                              \n                                                                                                  \nd83                         0.354***                                                              \n                             (0.027)                                                              \n                                                                                                  \nd84                         0.490***                                                              \n                             (0.034)                                                              \n                                                                                                  \nd85                         0.617***                                                              \n                             (0.042)                                                              \n                                                                                                  \nd86                         0.765***                                                              \n                             (0.053)                                                              \n                                                                                                  \nd87                         0.925***                                                              \n                             (0.064)                                                              \n                                                                                                  \nexpersq                                               -0.005***                 -0.005***         \n                                                       (0.001)                   (0.001)          \n                                                                                                  \nmarried                                                0.047**                   0.047**          \n                                                       (0.018)                   (0.018)          \n                                                                                                  \nunion                                                 0.080***                   0.080***         \n                                                       (0.019)                   (0.019)          \n                                                                                                  \nfactor(year)1981                                      0.151***                   0.151***         \n                                                       (0.022)                   (0.022)          \n                                                                                                  \nfactor(year)1982                                      0.253***                   0.253***         \n                                                       (0.024)                   (0.024)          \n                                                                                                  \nfactor(year)1983                                      0.354***                   0.354***         \n                                                       (0.029)                   (0.029)          \n                                                                                                  \nfactor(year)1984                                      0.490***                   0.490***         \n                                                       (0.036)                   (0.036)          \n                                                                                                  \nfactor(year)1985                                      0.617***                   0.617***         \n                                                       (0.045)                   (0.045)          \n                                                                                                  \nfactor(year)1986                                      0.765***                   0.765***         \n                                                       (0.056)                   (0.056)          \n                                                                                                  \nfactor(year)1987                                      0.925***                   0.925***         \n                                                       (0.069)                   (0.069)          \n                                                                                                  \nfactor(nr)17                                                                     0.579***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)18                                                                     0.929***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)45                                                                     0.554***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)110                                                                    1.046***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)120                                                                     0.239           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)126                                                                    0.783***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)150                                                                     -0.140          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)162                                                                     0.269           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)166                                                                     0.138           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)189                                                                     0.191           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)193                                                                    0.981***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)209                                                                    0.707***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)212                                                                    0.833***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)218                                                                    1.231***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)243                                                                    0.586***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)259                                                                    0.478***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)260                                                                    0.789***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)309                                                                    1.052***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)351                                                                    0.358**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)353                                                                    0.583***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)383                                                                    0.564***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)408                                                                    0.801***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)424                                                                    1.345***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)464                                                                     0.080           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)483                                                                    0.713***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)556                                                                    1.089***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)560                                                                     0.205           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)569                                                                    -0.431**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)583                                                                    0.852***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)647                                                                    0.360**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)658                                                                    0.838***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)684                                                                    1.132***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)711                                                                     -0.097          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)729                                                                    0.837***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)731                                                                    0.574***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)732                                                                    0.531***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)793                                                                    0.498***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)797                                                                    0.841***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)800                                                                    0.380**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)813                                                                   -0.657***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)823                                                                    -0.393**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)827                                                                    0.507***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)847                                                                    0.489***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)851                                                                    0.735***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)863                                                                    0.550***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)873                                                                     -0.127          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)891                                                                    0.735***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)908                                                                    -0.405**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)910                                                                    0.679***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)916                                                                    0.564***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)919                                                                     0.238           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)922                                                                    1.011***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)924                                                                     -0.071          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)925                                                                    0.809***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)944                                                                     0.106           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)945                                                                     0.106           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)947                                                                    1.154***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)955                                                                    1.006***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)965                                                                    0.434**          \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)996                                                                     0.007           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1007                                                                   0.996***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1054                                                                    0.133           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1064                                                                   0.858***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)1081                                                                    0.179           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1085                                                                    0.114           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1091                                                                    0.226           \n                                                                                 (0.183)          \n                                                                                                  \nfactor(nr)1094                                                                   0.600***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1096                                                                    0.251           \n                                                                                 (0.182)          \n                                                                                                  \nfactor(nr)1098                                                                   0.837***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1102                                                                   0.948***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1107                                                                   0.762***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)1142                                                                   0.715***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1156                                                                   0.569***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)1180                                                                   0.636***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1190                                                                    0.119           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1204                                                                   0.888***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)1249                                                                   0.468***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)1272                                                                   0.612***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1311                                                                   0.481***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1316                                                                   0.921***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)1318                                                                   0.625***         \n                                                                                 (0.192)          \n                                                                                                  \nfactor(nr)1345                                                                   0.549***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)1397                                                                   0.653***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)1434                                                                    -0.082          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1492                                                                   0.408**          \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)1496                                                                    -0.219          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1506                                                                    0.082           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1515                                                                    0.281           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1520                                                                   0.375**          \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)1528                                                                    0.136           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1554                                                                    0.312*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1575                                                                   0.577***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1576                                                                   0.504***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1628                                                                   0.440**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1641                                                                   0.974***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)1644                                                                    0.263           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1653                                                                   0.629***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1654                                                                   0.663***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)1721                                                                   1.160***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)1742                                                                   0.861***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1744                                                                   0.557***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1763                                                                    -0.194          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1777                                                                    0.115           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1843                                                                   1.310***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1891                                                                    -0.090          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1895                                                                   0.604***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1899                                                                    0.171           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)1925                                                                   0.488***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1930                                                                    0.251           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1961                                                                   0.745***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)1963                                                                   0.470***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)1979                                                                   0.828***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)1988                                                                    -0.062          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2000                                                                   0.637***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2014                                                                    0.310*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2025                                                                   0.432**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2038                                                                    0.180           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2075                                                                   0.928***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)2101                                                                   1.158***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2106                                                                   0.595***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2107                                                                   0.460***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2108                                                                   0.816***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2147                                                                  -0.860***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2157                                                                    0.055           \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)2163                                                                   1.092***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2173                                                                    0.148           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2180                                                                   0.411**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2183                                                                   0.392**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2216                                                                   0.540***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2220                                                                   0.991***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2227                                                                    0.255           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2264                                                                    -0.093          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2306                                                                    -0.052          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2312                                                                   0.816***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2314                                                                   0.969***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)2329                                                                   0.545***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2335                                                                   0.506***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2341                                                                   0.471***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2351                                                                    0.046           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2386                                                                    -0.154          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2401                                                                   0.644***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)2413                                                                   0.999***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2421                                                                    0.036           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2445                                                                   0.463***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)2451                                                                   0.592***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2494                                                                    0.168           \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2508                                                                   0.848***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2535                                                                   0.486***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2540                                                                    -0.059          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2685                                                                   1.031***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2711                                                                    0.052           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2718                                                                   1.059***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2721                                                                    0.157           \n                                                                                 (0.184)          \n                                                                                                  \nfactor(nr)2733                                                                    -0.146          \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)2741                                                                   0.419**          \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)2745                                                                   0.556***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2751                                                                   0.456**          \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)2774                                                                   0.903***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2801                                                                    0.050           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2813                                                                    0.222           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2833                                                                   0.621***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2839                                                                   0.646***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2842                                                                   0.942***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2866                                                                   0.707***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2868                                                                   0.978***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2874                                                                    0.007           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2916                                                                   0.345**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)2951                                                                    0.313*          \n                                                                                 (0.182)          \n                                                                                                  \nfactor(nr)2980                                                                    0.327*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2994                                                                   0.506***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)2997                                                                   0.601***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3017                                                                   0.936***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3037                                                                   1.040***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)3059                                                                   0.694***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)3062                                                                   1.166***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3100                                                                   0.637***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)3102                                                                    -0.259          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3127                                                                   -0.407**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3136                                                                   0.698***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3137                                                                   0.892***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3138                                                                   0.665***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3140                                                                   0.843***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3193                                                                   0.686***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3196                                                                   0.681***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3200                                                                   0.771***         \n                                                                                 (0.187)          \n                                                                                                  \nfactor(nr)3202                                                                   0.593***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3207                                                                   0.471***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)3208                                                                   0.855***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3210                                                                   0.708***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3215                                                                    0.324*          \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3219                                                                    0.237           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3226                                                                   0.642***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3235                                                                    0.144           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3239                                                                   -0.375**         \n                                                                                 (0.175)          \n                                                                                                  \nfactor(nr)3271                                                                   0.756***         \n                                                                                 (0.182)          \n                                                                                                  \nfactor(nr)3275                                                                   0.542***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3282                                                                   0.660***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3289                                                                   0.454***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3290                                                                   0.456***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3307                                                                   1.321***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3333                                                                    -0.078          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3353                                                                    0.083           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3380                                                                   0.522***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3381                                                                   0.587***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3389                                                                   0.672***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3394                                                                   0.656***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3401                                                                   0.397**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3414                                                                   0.701***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3420                                                                    0.301*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3440                                                                    -0.211          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3461                                                                   0.711***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3468                                                                    0.195           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3482                                                                   1.056***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3495                                                                   0.538***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)3503                                                                   0.965***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3525                                                                   1.040***         \n                                                                                 (0.175)          \n                                                                                                  \nfactor(nr)3526                                                                   0.594***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3538                                                                   0.962***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)3563                                                                   0.636***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3575                                                                   0.997***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3580                                                                   0.361**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3581                                                                   0.671***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3589                                                                    0.287           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3591                                                                   0.674***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3598                                                                   0.864***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3602                                                                   1.082***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)3607                                                                    -0.019          \n                                                                                 (0.187)          \n                                                                                                  \nfactor(nr)3621                                                                   0.528***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3628                                                                   0.984***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3653                                                                   0.723***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3706                                                                   0.650***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3707                                                                   0.556***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3708                                                                   0.617***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3743                                                                   0.607***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3777                                                                   0.732***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)3831                                                                    0.227           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3844                                                                   0.510***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3847                                                                   1.104***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)3848                                                                   0.651***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)3882                                                                    0.047           \n                                                                                 (0.175)          \n                                                                                                  \nfactor(nr)3937                                                                   0.520***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4000                                                                   1.072***         \n                                                                                 (0.201)          \n                                                                                                  \nfactor(nr)4004                                                                   0.976***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4025                                                                    0.135           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4032                                                                    0.157           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4046                                                                   0.564***         \n                                                                                 (0.184)          \n                                                                                                  \nfactor(nr)4088                                                                   1.447***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4091                                                                   1.271***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4122                                                                   0.713***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4127                                                                    0.093           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4128                                                                    0.297*          \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4159                                                                   0.605***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4204                                                                    0.324*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4229                                                                    0.314*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4258                                                                   0.718***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4261                                                                   1.342***         \n                                                                                 (0.200)          \n                                                                                                  \nfactor(nr)4264                                                                    0.073           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4278                                                                   0.594***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4297                                                                   0.538***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4302                                                                    -0.129          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4321                                                                   0.473***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4328                                                                    0.239           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4332                                                                   -0.371**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4335                                                                    0.342*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4357                                                                   0.527***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4365                                                                    -0.039          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4380                                                                   0.880***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4394                                                                   0.724***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4510                                                                   0.643***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4559                                                                   0.374**          \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)4563                                                                    0.019           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4569                                                                   0.791***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4603                                                                   0.734***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4607                                                                    0.166           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4633                                                                   0.505***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4676                                                                    0.125           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4701                                                                   0.952***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4716                                                                    0.122           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4720                                                                   1.137***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)4759                                                                   0.596***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)4791                                                                   0.678***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)4811                                                                    0.096           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4828                                                                    0.108           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4857                                                                    -0.098          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4858                                                                   0.976***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4859                                                                    0.031           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)4866                                                                   0.818***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4881                                                                   0.358**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4884                                                                   0.522***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4888                                                                    0.096           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4901                                                                    0.218           \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)4917                                                                    0.059           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)4926                                                                   0.440**          \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)4982                                                                    0.102           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)5017                                                                   1.088***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5033                                                                   1.061***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5048                                                                    0.315*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5122                                                                   0.657***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5141                                                                   0.711***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5147                                                                   1.045***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)5158                                                                   0.700***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5221                                                                   0.538***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5223                                                                   0.486***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5227                                                                   0.652***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)5248                                                                    0.179           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5252                                                                    0.088           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5263                                                                   0.494***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5274                                                                   0.756***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5335                                                                    0.318*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5345                                                                    0.233           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5359                                                                    -0.082          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5368                                                                    0.060           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5377                                                                   0.382**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5390                                                                    0.288           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5419                                                                    0.125           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5435                                                                    0.033           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5437                                                                    0.265           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5497                                                                    0.195           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5525                                                                    0.315*          \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)5529                                                                   0.573***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)5531                                                                   0.927***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)5579                                                                    0.229           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5588                                                                   0.936***         \n                                                                                 (0.194)          \n                                                                                                  \nfactor(nr)5599                                                                   0.569***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5650                                                                    0.330*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5660                                                                   0.724***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5665                                                                    0.155           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5666                                                                   0.495***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5698                                                                   0.686***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)5699                                                                   0.679***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5731                                                                    0.318*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5750                                                                   0.661***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)5755                                                                   0.546***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)5772                                                                    0.126           \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)5816                                                                    0.211           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)5823                                                                    0.107           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5851                                                                    0.061           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5857                                                                   0.438**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)5859                                                                   0.427**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)6016                                                                   0.794***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6020                                                                    -0.282          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)6025                                                                   -0.425**         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)6056                                                                    -0.104          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6094                                                                   0.484***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)6186                                                                   0.487***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6395                                                                   0.979***         \n                                                                                 (0.188)          \n                                                                                                  \nfactor(nr)6430                                                                   0.403**          \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)6446                                                                   0.555***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)6463                                                                    0.352*          \n                                                                                 (0.187)          \n                                                                                                  \nfactor(nr)6558                                                                   0.807***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6559                                                                   0.581***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6561                                                                   0.953***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6574                                                                    0.098           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)6648                                                                   0.774***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6813                                                                    0.274           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)6824                                                                   0.419**          \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)6888                                                                   0.494***         \n                                                                                 (0.187)          \n                                                                                                  \nfactor(nr)6942                                                                   0.549***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6954                                                                   0.565***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)6955                                                                   0.678***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)6964                                                                   0.473***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)6987                                                                   1.456***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7025                                                                   0.906***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)7043                                                                   0.498***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7060                                                                   0.460***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7087                                                                    -0.207          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7238                                                                   0.680***         \n                                                                                 (0.193)          \n                                                                                                  \nfactor(nr)7279                                                                    0.270           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)7342                                                                   0.432**          \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)7343                                                                   0.350**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7411                                                                    -0.038          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7424                                                                   0.651***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7429                                                                   0.515***         \n                                                                                 (0.182)          \n                                                                                                  \nfactor(nr)7454                                                                   0.730***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7472                                                                   0.402**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)7474                                                                    0.303*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7509                                                                   0.689***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)7539                                                                    -0.012          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7769                                                                   0.655***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)7783                                                                   0.449**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7784                                                                   1.929***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7801                                                                    -0.048          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7824                                                                   0.546***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7874                                                                   1.107***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)7887                                                                   0.639***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)7923                                                                   1.238***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)7926                                                                   0.708***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)8021                                                                   0.824***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8087                                                                   0.460***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8089                                                                    0.222           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8090                                                                   1.226***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8096                                                                   1.299***         \n                                                                                 (0.221)          \n                                                                                                  \nfactor(nr)8106                                                                   0.948***         \n                                                                                 (0.200)          \n                                                                                                  \nfactor(nr)8107                                                                   1.186***         \n                                                                                 (0.221)          \n                                                                                                  \nfactor(nr)8142                                                                    0.182           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8168                                                                   0.551***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8173                                                                   0.909***         \n                                                                                 (0.202)          \n                                                                                                  \nfactor(nr)8203                                                                   1.072***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8211                                                                    0.294           \n                                                                                 (0.183)          \n                                                                                                  \nfactor(nr)8224                                                                   0.807***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)8272                                                                   0.959***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)8300                                                                   0.386**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8304                                                                   0.470***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8364                                                                   0.348**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8370                                                                   0.845***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8381                                                                    0.218           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8388                                                                   0.743***         \n                                                                                 (0.194)          \n                                                                                                  \nfactor(nr)8406                                                                   0.626***         \n                                                                                 (0.184)          \n                                                                                                  \nfactor(nr)8415                                                                    0.054           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8496                                                                    -0.112          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8501                                                                    -0.070          \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)8518                                                                   1.243***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)8520                                                                   -0.353**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8524                                                                    -0.118          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8548                                                                    0.115           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8556                                                                   0.625***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8564                                                                    0.106           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8581                                                                    -0.249          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8586                                                                    0.258           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8587                                                                   -0.370**         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8597                                                                   0.771***         \n                                                                                 (0.183)          \n                                                                                                  \nfactor(nr)8656                                                                    0.153           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8722                                                                   0.637***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8743                                                                   0.515***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8749                                                                   0.940***         \n                                                                                 (0.202)          \n                                                                                                  \nfactor(nr)8758                                                                   0.535***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8796                                                                   0.780***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8838                                                                   0.406**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8842                                                                    0.145           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8846                                                                    0.112           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8860                                                                    0.124           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)8862                                                                   0.399**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8880                                                                   1.219***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)8886                                                                   0.631***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)8903                                                                    -0.239          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8908                                                                    -0.023          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8911                                                                    -0.034          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)8917                                                                   0.796***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)8991                                                                   0.913***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)8997                                                                   0.898***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9014                                                                   0.540***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9015                                                                   0.697***         \n                                                                                 (0.187)          \n                                                                                                  \nfactor(nr)9027                                                                   1.002***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9066                                                                    -0.153          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9082                                                                    0.274           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)9131                                                                   0.758***         \n                                                                                 (0.201)          \n                                                                                                  \nfactor(nr)9132                                                                   0.709***         \n                                                                                 (0.188)          \n                                                                                                  \nfactor(nr)9154                                                                   1.113***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9158                                                                    0.086           \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)9184                                                                    0.164           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9230                                                                    0.158           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9265                                                                   0.437**          \n                                                                                 (0.175)          \n                                                                                                  \nfactor(nr)9367                                                                    0.207           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9390                                                                   0.745***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9391                                                                   0.370**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9418                                                                   1.133***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9424                                                                   0.806***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9447                                                                   0.503***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9449                                                                    0.318*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9453                                                                   0.745***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9468                                                                   0.493***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9502                                                                   0.895***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)9505                                                                    0.046           \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)9603                                                                    0.310*          \n                                                                                 (0.188)          \n                                                                                                  \nfactor(nr)9643                                                                   0.433**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9667                                                                   1.067***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9683                                                                    0.128           \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)9694                                                                   0.847***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9710                                                                    0.280           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9718                                                                   0.938***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9725                                                                    0.322*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9744                                                                   0.689***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9752                                                                   1.390***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9776                                                                   0.953***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)9786                                                                   0.624***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9791                                                                    0.328*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9794                                                                   0.473***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9810                                                                    -0.144          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9846                                                                   0.825***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9859                                                                    0.148           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)9868                                                                    0.029           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9876                                                                   0.853***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)9883                                                                   0.714***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)9889                                                                   0.988***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9901                                                                   0.689***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9936                                                                   0.895***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)9964                                                                   0.412**          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)10043                                                                   -0.172          \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)10067                                                                  0.510***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10091                                                                  0.697***         \n                                                                                 (0.181)          \n                                                                                                  \nfactor(nr)10120                                                                   -0.118          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10121                                                                   0.325*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10167                                                                  0.567***         \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)10209                                                                   0.112           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10230                                                                  0.724***         \n                                                                                 (0.180)          \n                                                                                                  \nfactor(nr)10265                                                                  0.993***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10274                                                                   0.237           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10311                                                                   0.301*          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10392                                                                   0.108           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)10425                                                                  0.945***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)10441                                                                   0.176           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10457                                                                  0.446**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10469                                                                  0.447**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10524                                                                   0.088           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)10552                                                                   -0.185          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)10553                                                                  0.706***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)10570                                                                 -0.747***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)10593                                                                   0.284           \n                                                                                 (0.184)          \n                                                                                                  \nfactor(nr)10666                                                                  -0.324*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)11275                                                                   0.146           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)11328                                                                  0.495***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)11750                                                                  0.384**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)11821                                                                  0.808***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)11857                                                                  0.934***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)11887                                                                  0.396**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)11890                                                                  1.093***         \n                                                                                 (0.211)          \n                                                                                                  \nfactor(nr)11892                                                                  1.132***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)11924                                                                  0.354**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)11925                                                                  0.408**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)11957                                                                   0.004           \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)11973                                                                  0.578***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)11990                                                                  1.010***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12012                                                                   0.224           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12013                                                                  0.568***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12045                                                                   0.200           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12055                                                                  0.674***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)12084                                                                  0.450**          \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)12088                                                                   0.117           \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12122                                                                  0.586***         \n                                                                                 (0.202)          \n                                                                                                  \nfactor(nr)12179                                                                   0.301*          \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)12182                                                                  0.515***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12220                                                                  0.673***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)12221                                                                   -0.121          \n                                                                                 (0.183)          \n                                                                                                  \nfactor(nr)12245                                                                   -0.110          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12276                                                                  0.655***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)12385                                                                  0.819***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)12410                                                                   0.040           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)12420                                                                  0.840***         \n                                                                                 (0.177)          \n                                                                                                  \nfactor(nr)12433                                                                  0.393**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12451                                                                  0.431**          \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12477                                                                  1.004***         \n                                                                                 (0.179)          \n                                                                                                  \nfactor(nr)12500                                                                   0.222           \n                                                                                 (0.178)          \n                                                                                                  \nfactor(nr)12534                                                                  0.942***         \n                                                                                 (0.176)          \n                                                                                                  \nfactor(nr)12548                                                                   0.347*          \n                                                                                 (0.180)          \n                                                                                                  \neduc                                                                                              \n                                                                                                  \n                                                                                                  \nblack                                                                                             \n                                                                                                  \n                                                                                                  \nhisp                                                                                              \n                                                                                                  \n                                                                                                  \nexper                                                                                             \n                                                                                                  \n                                                                                                  \nConstant                    -0.445***                                            0.933***         \n                             (0.030)                                             (0.125)          \n                                                                                                  \n--------------------------------------------------------------------------------------------------\nObservations                  4,360                     4,360                     4,360           \nR2                            0.181                     0.181                     0.621           \nAdjusted R2                   0.179                     0.061                     0.566           \nResidual Std. Error     0.328 (df = 4349)                                   0.351 (df = 3805)     \nF Statistic         95.840*** (df = 10; 4349) 83.851*** (df = 10; 3805) 11.250*** (df = 554; 3805)\n==================================================================================================\nNote:                                                                  *p<0.1; **p<0.05; ***p<0.01\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/WAGEPAN.dta\" , clear\n\nbys nr:  egen lwage_mean = mean(lwage) \nbys nr:  egen expersq_mean = mean(expersq) \nbys nr:  egen married_mean = mean(married) \nbys nr:  egen union_mean = mean(union)\n\ngen lwage_demean = lwage - lwage_mean\ngen expersq_demean = expersq - expersq_mean\ngen married_demean = married - married_mean\ngen union_demean = union - union_mean\n\nxtset nr year \neststo: qui reg lwage_demean expersq_demean married_demean union_demean i.year\neststo: qui xtreg lwage expersq married union i.year  educ black hisp exper , fe\neststo: qui reg lwage expersq married union i.year i.nr  educ black hisp exper \nesttab , mtitles(\"Demean\" \"FE\" \"LSDV\") compress\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPanel variable: nr (strongly balanced)\n Time variable: year, 1980 to 1987\n         Delta: 1 unit\n\n(est1 stored)\n\n(est2 stored)\n\n(est3 stored)\n\n\n-------------------------------------------------\n                 (1)          (2)          (3)   \n              Demean           FE         LSDV   \n-------------------------------------------------\nexpe~emean  -0.00519***                          \n             (-7.87)                             \n\nmarr~emean    0.0467**                           \n              (2.73)                             \n\nunion_de~n    0.0800***                          \n              (4.43)                             \n\n1980.year          0            0            0   \n                 (.)          (.)          (.)   \n\n1981.year      0.151***     0.151***     0.151***\n              (7.36)       (6.89)       (6.89)   \n\n1982.year      0.253***     0.253***     0.253***\n             (11.08)      (10.36)      (10.36)   \n\n1983.year      0.354***     0.354***     0.354***\n             (12.96)      (12.12)      (12.12)   \n\n1984.year      0.490***     0.490***     0.490***\n             (14.46)      (13.53)      (13.53)   \n\n1985.year      0.617***     0.617***     0.617***\n             (14.59)      (13.65)      (13.65)   \n\n1986.year      0.765***     0.765***     0.765***\n             (14.58)      (13.64)      (13.64)   \n\n1987.year      0.925***     0.925***     0.925***\n             (14.38)      (13.45)      (13.45)   \n\nexpersq                  -0.00519***  -0.00519***\n                          (-7.36)      (-7.36)   \n\nmarried                    0.0467*      0.0467*  \n                           (2.55)       (2.55)   \n\nunion                      0.0800***    0.0800***\n                           (4.14)       (4.14)   \n\neduc                            0            0   \n                              (.)          (.)   \n\nblack                           0            0   \n                              (.)          (.)   \n\nhisp                            0            0   \n                              (.)          (.)   \n\nexper                           0            0   \n                              (.)          (.)   \n\n13.nr                                        0   \n                                           (.)   \n\n17.nr                                    0.579** \n                                        (3.26)   \n\n18.nr                                    0.929***\n                                        (5.20)   \n\n45.nr                                    0.554** \n                                        (3.15)   \n\n110.nr                                   1.046***\n                                        (5.82)   \n\n120.nr                                   0.239   \n                                        (1.36)   \n\n126.nr                                   0.783***\n                                        (4.45)   \n\n150.nr                                  -0.140   \n                                       (-0.80)   \n\n162.nr                                   0.269   \n                                        (1.53)   \n\n166.nr                                   0.138   \n                                        (0.78)   \n\n189.nr                                   0.191   \n                                        (1.09)   \n\n193.nr                                   0.981***\n                                        (5.58)   \n\n209.nr                                   0.707***\n                                        (4.01)   \n\n212.nr                                   0.833***\n                                        (4.74)   \n\n218.nr                                   1.231***\n                                        (6.99)   \n\n243.nr                                   0.586***\n                                        (3.29)   \n\n259.nr                                   0.478** \n                                        (2.69)   \n\n260.nr                                   0.789***\n                                        (4.48)   \n\n309.nr                                   1.052***\n                                        (5.95)   \n\n351.nr                                   0.358*  \n                                        (2.02)   \n\n353.nr                                   0.583***\n                                        (3.31)   \n\n383.nr                                   0.564** \n                                        (3.21)   \n\n408.nr                                   0.801***\n                                        (4.54)   \n\n424.nr                                   1.345***\n                                        (7.45)   \n\n464.nr                                  0.0803   \n                                        (0.46)   \n\n483.nr                                   0.713***\n                                        (3.98)   \n\n556.nr                                   1.089***\n                                        (6.20)   \n\n560.nr                                   0.205   \n                                        (1.17)   \n\n569.nr                                  -0.431*  \n                                       (-2.45)   \n\n583.nr                                   0.852***\n                                        (4.80)   \n\n647.nr                                   0.360*  \n                                        (2.04)   \n\n658.nr                                   0.838***\n                                        (4.73)   \n\n684.nr                                   1.132***\n                                        (6.42)   \n\n711.nr                                 -0.0972   \n                                       (-0.55)   \n\n729.nr                                   0.837***\n                                        (4.74)   \n\n731.nr                                   0.574** \n                                        (3.23)   \n\n732.nr                                   0.531** \n                                        (3.02)   \n\n793.nr                                   0.498** \n                                        (2.84)   \n\n797.nr                                   0.841***\n                                        (4.75)   \n\n800.nr                                   0.380*  \n                                        (2.15)   \n\n813.nr                                  -0.657***\n                                       (-3.74)   \n\n823.nr                                  -0.393*  \n                                       (-2.23)   \n\n827.nr                                   0.507** \n                                        (2.88)   \n\n847.nr                                   0.489** \n                                        (2.79)   \n\n851.nr                                   0.735***\n                                        (4.17)   \n\n863.nr                                   0.550** \n                                        (3.13)   \n\n873.nr                                  -0.127   \n                                       (-0.72)   \n\n891.nr                                   0.735***\n                                        (4.16)   \n\n908.nr                                  -0.405*  \n                                       (-2.30)   \n\n910.nr                                   0.679***\n                                        (3.87)   \n\n916.nr                                   0.564** \n                                        (3.21)   \n\n919.nr                                   0.238   \n                                        (1.34)   \n\n922.nr                                   1.011***\n                                        (5.76)   \n\n924.nr                                 -0.0709   \n                                       (-0.40)   \n\n925.nr                                   0.809***\n                                        (4.60)   \n\n944.nr                                   0.106   \n                                        (0.60)   \n\n945.nr                                   0.106   \n                                        (0.60)   \n\n947.nr                                   1.154***\n                                        (6.52)   \n\n955.nr                                   1.006***\n                                        (5.64)   \n\n965.nr                                   0.434*  \n                                        (2.42)   \n\n996.nr                                 0.00740   \n                                        (0.04)   \n\n1007.nr                                  0.996***\n                                        (5.61)   \n\n1054.nr                                  0.133   \n                                        (0.75)   \n\n1064.nr                                  0.858***\n                                        (4.81)   \n\n1081.nr                                  0.179   \n                                        (1.02)   \n\n1085.nr                                  0.114   \n                                        (0.65)   \n\n1091.nr                                  0.226   \n                                        (1.23)   \n\n1094.nr                                  0.600***\n                                        (3.38)   \n\n1096.nr                                  0.251   \n                                        (1.37)   \n\n1098.nr                                  0.837***\n                                        (4.77)   \n\n1102.nr                                  0.948***\n                                        (5.38)   \n\n1107.nr                                  0.762***\n                                        (4.23)   \n\n1142.nr                                  0.715***\n                                        (4.07)   \n\n1156.nr                                  0.569** \n                                        (3.17)   \n\n1180.nr                                  0.636***\n                                        (3.61)   \n\n1190.nr                                  0.119   \n                                        (0.68)   \n\n1204.nr                                  0.888***\n                                        (4.93)   \n\n1249.nr                                  0.468** \n                                        (2.60)   \n\n1272.nr                                  0.612***\n                                        (3.47)   \n\n1311.nr                                  0.481** \n                                        (2.74)   \n\n1316.nr                                  0.921***\n                                        (5.17)   \n\n1318.nr                                  0.625** \n                                        (3.25)   \n\n1345.nr                                  0.549** \n                                        (3.08)   \n\n1397.nr                                  0.653***\n                                        (3.62)   \n\n1434.nr                                -0.0818   \n                                       (-0.46)   \n\n1492.nr                                  0.408*  \n                                        (2.30)   \n\n1496.nr                                 -0.219   \n                                       (-1.24)   \n\n1506.nr                                 0.0822   \n                                        (0.47)   \n\n1515.nr                                  0.281   \n                                        (1.60)   \n\n1520.nr                                  0.375*  \n                                        (2.07)   \n\n1528.nr                                  0.136   \n                                        (0.77)   \n\n1554.nr                                  0.312   \n                                        (1.77)   \n\n1575.nr                                  0.577** \n                                        (3.26)   \n\n1576.nr                                  0.504** \n                                        (2.86)   \n\n1628.nr                                  0.440*  \n                                        (2.50)   \n\n1641.nr                                  0.974***\n                                        (5.46)   \n\n1644.nr                                  0.263   \n                                        (1.50)   \n\n1653.nr                                  0.629***\n                                        (3.58)   \n\n1654.nr                                  0.663***\n                                        (3.73)   \n\n1721.nr                                  1.160***\n                                        (6.47)   \n\n1742.nr                                  0.861***\n                                        (4.90)   \n\n1744.nr                                  0.557** \n                                        (3.16)   \n\n1763.nr                                 -0.194   \n                                       (-1.11)   \n\n1777.nr                                  0.115   \n                                        (0.65)   \n\n1843.nr                                  1.310***\n                                        (7.41)   \n\n1891.nr                                -0.0896   \n                                       (-0.51)   \n\n1895.nr                                  0.604***\n                                        (3.41)   \n\n1899.nr                                  0.171   \n                                        (0.97)   \n\n1925.nr                                  0.488** \n                                        (2.78)   \n\n1930.nr                                  0.251   \n                                        (1.43)   \n\n1961.nr                                  0.745***\n                                        (4.18)   \n\n1963.nr                                  0.470** \n                                        (2.66)   \n\n1979.nr                                  0.828***\n                                        (4.63)   \n\n1988.nr                                -0.0621   \n                                       (-0.35)   \n\n2000.nr                                  0.637***\n                                        (3.60)   \n\n2014.nr                                  0.310   \n                                        (1.77)   \n\n2025.nr                                  0.432*  \n                                        (2.45)   \n\n2038.nr                                  0.180   \n                                        (1.02)   \n\n2075.nr                                  0.928***\n                                        (5.14)   \n\n2101.nr                                  1.158***\n                                        (6.57)   \n\n2106.nr                                  0.595***\n                                        (3.33)   \n\n2107.nr                                  0.460** \n                                        (2.62)   \n\n2108.nr                                  0.816***\n                                        (4.61)   \n\n2147.nr                                 -0.860***\n                                       (-4.90)   \n\n2157.nr                                 0.0546   \n                                        (0.30)   \n\n2163.nr                                  1.092***\n                                        (6.09)   \n\n2173.nr                                  0.148   \n                                        (0.84)   \n\n2180.nr                                  0.411*  \n                                        (2.34)   \n\n2183.nr                                  0.392*  \n                                        (2.23)   \n\n2216.nr                                  0.540** \n                                        (3.07)   \n\n2220.nr                                  0.991***\n                                        (5.63)   \n\n2227.nr                                  0.255   \n                                        (1.44)   \n\n2264.nr                                -0.0930   \n                                       (-0.53)   \n\n2306.nr                                -0.0521   \n                                       (-0.29)   \n\n2312.nr                                  0.816***\n                                        (4.64)   \n\n2314.nr                                  0.969***\n                                        (5.39)   \n\n2329.nr                                  0.545** \n                                        (3.09)   \n\n2335.nr                                  0.506** \n                                        (2.82)   \n\n2341.nr                                  0.471** \n                                        (2.68)   \n\n2351.nr                                 0.0458   \n                                        (0.26)   \n\n2386.nr                                 -0.154   \n                                       (-0.87)   \n\n2401.nr                                  0.644***\n                                        (3.57)   \n\n2413.nr                                  0.999***\n                                        (5.59)   \n\n2421.nr                                 0.0360   \n                                        (0.20)   \n\n2445.nr                                  0.463** \n                                        (2.60)   \n\n2451.nr                                  0.592***\n                                        (3.35)   \n\n2494.nr                                  0.168   \n                                        (0.94)   \n\n2508.nr                                  0.848***\n                                        (4.79)   \n\n2535.nr                                  0.486** \n                                        (2.72)   \n\n2540.nr                                -0.0591   \n                                       (-0.34)   \n\n2685.nr                                  1.031***\n                                        (5.87)   \n\n2711.nr                                 0.0516   \n                                        (0.29)   \n\n2718.nr                                  1.059***\n                                        (5.98)   \n\n2721.nr                                  0.157   \n                                        (0.86)   \n\n2733.nr                                 -0.146   \n                                       (-0.82)   \n\n2741.nr                                  0.419*  \n                                        (2.32)   \n\n2745.nr                                  0.556** \n                                        (3.15)   \n\n2751.nr                                  0.456*  \n                                        (2.55)   \n\n2774.nr                                  0.903***\n                                        (5.09)   \n\n2801.nr                                 0.0497   \n                                        (0.28)   \n\n2813.nr                                  0.222   \n                                        (1.26)   \n\n2833.nr                                  0.621***\n                                        (3.52)   \n\n2839.nr                                  0.646***\n                                        (3.66)   \n\n2842.nr                                  0.942***\n                                        (5.31)   \n\n2866.nr                                  0.707***\n                                        (3.99)   \n\n2868.nr                                  0.978***\n                                        (5.54)   \n\n2874.nr                                0.00693   \n                                        (0.04)   \n\n2916.nr                                  0.345*  \n                                        (1.96)   \n\n2951.nr                                  0.313   \n                                        (1.71)   \n\n2980.nr                                  0.327   \n                                        (1.85)   \n\n2994.nr                                  0.506** \n                                        (2.86)   \n\n2997.nr                                  0.601***\n                                        (3.41)   \n\n3017.nr                                  0.936***\n                                        (5.31)   \n\n3037.nr                                  1.040***\n                                        (5.81)   \n\n3059.nr                                  0.694***\n                                        (3.84)   \n\n3062.nr                                  1.166***\n                                        (6.64)   \n\n3100.nr                                  0.637***\n                                        (3.57)   \n\n3102.nr                                 -0.259   \n                                       (-1.48)   \n\n3127.nr                                 -0.407*  \n                                       (-2.31)   \n\n3136.nr                                  0.698***\n                                        (3.94)   \n\n3137.nr                                  0.892***\n                                        (5.08)   \n\n3138.nr                                  0.665***\n                                        (3.75)   \n\n3140.nr                                  0.843***\n                                        (4.77)   \n\n3193.nr                                  0.686***\n                                        (3.90)   \n\n3196.nr                                  0.681***\n                                        (3.85)   \n\n3200.nr                                  0.771***\n                                        (4.12)   \n\n3202.nr                                  0.593***\n                                        (3.34)   \n\n3207.nr                                  0.471** \n                                        (2.64)   \n\n3208.nr                                  0.855***\n                                        (4.82)   \n\n3210.nr                                  0.708***\n                                        (4.02)   \n\n3215.nr                                  0.324   \n                                        (1.82)   \n\n3219.nr                                  0.237   \n                                        (1.35)   \n\n3226.nr                                  0.642***\n                                        (3.64)   \n\n3235.nr                                  0.144   \n                                        (0.81)   \n\n3239.nr                                 -0.375*  \n                                       (-2.14)   \n\n3271.nr                                  0.756***\n                                        (4.15)   \n\n3275.nr                                  0.542** \n                                        (3.09)   \n\n3282.nr                                  0.660***\n                                        (3.75)   \n\n3289.nr                                  0.454** \n                                        (2.58)   \n\n3290.nr                                  0.456** \n                                        (2.60)   \n\n3307.nr                                  1.321***\n                                        (7.47)   \n\n3333.nr                                -0.0781   \n                                       (-0.44)   \n\n3353.nr                                 0.0825   \n                                        (0.47)   \n\n3380.nr                                  0.522** \n                                        (2.96)   \n\n3381.nr                                  0.587***\n                                        (3.34)   \n\n3389.nr                                  0.672***\n                                        (3.81)   \n\n3394.nr                                  0.656***\n                                        (3.73)   \n\n3401.nr                                  0.397*  \n                                        (2.25)   \n\n3414.nr                                  0.701***\n                                        (3.99)   \n\n3420.nr                                  0.301   \n                                        (1.71)   \n\n3440.nr                                 -0.211   \n                                       (-1.20)   \n\n3461.nr                                  0.711***\n                                        (4.05)   \n\n3468.nr                                  0.195   \n                                        (1.11)   \n\n3482.nr                                  1.056***\n                                        (5.99)   \n\n3495.nr                                  0.538** \n                                        (2.99)   \n\n3503.nr                                  0.965***\n                                        (5.42)   \n\n3525.nr                                  1.040***\n                                        (5.93)   \n\n3526.nr                                  0.594***\n                                        (3.33)   \n\n3538.nr                                  0.962***\n                                        (5.33)   \n\n3563.nr                                  0.636***\n                                        (3.60)   \n\n3575.nr                                  0.997***\n                                        (5.59)   \n\n3580.nr                                  0.361*  \n                                        (2.06)   \n\n3581.nr                                  0.671***\n                                        (3.82)   \n\n3589.nr                                  0.287   \n                                        (1.62)   \n\n3591.nr                                  0.674***\n                                        (3.82)   \n\n3598.nr                                  0.864***\n                                        (4.90)   \n\n3602.nr                                  1.082***\n                                        (6.00)   \n\n3607.nr                                -0.0189   \n                                       (-0.10)   \n\n3621.nr                                  0.528** \n                                        (2.97)   \n\n3628.nr                                  0.984***\n                                        (5.55)   \n\n3653.nr                                  0.723***\n                                        (4.10)   \n\n3706.nr                                  0.650***\n                                        (3.67)   \n\n3707.nr                                  0.556** \n                                        (3.15)   \n\n3708.nr                                  0.617***\n                                        (3.51)   \n\n3743.nr                                  0.607***\n                                        (3.45)   \n\n3777.nr                                  0.732***\n                                        (4.13)   \n\n3831.nr                                  0.227   \n                                        (1.29)   \n\n3844.nr                                  0.510** \n                                        (2.89)   \n\n3847.nr                                  1.104***\n                                        (6.22)   \n\n3848.nr                                  0.651***\n                                        (3.71)   \n\n3882.nr                                 0.0468   \n                                        (0.27)   \n\n3937.nr                                  0.520** \n                                        (2.94)   \n\n4000.nr                                  1.072***\n                                        (5.34)   \n\n4004.nr                                  0.976***\n                                        (5.50)   \n\n4025.nr                                  0.135   \n                                        (0.77)   \n\n4032.nr                                  0.157   \n                                        (0.89)   \n\n4046.nr                                  0.564** \n                                        (3.07)   \n\n4088.nr                                  1.447***\n                                        (8.16)   \n\n4091.nr                                  1.271***\n                                        (7.14)   \n\n4122.nr                                  0.713***\n                                        (4.04)   \n\n4127.nr                                 0.0934   \n                                        (0.53)   \n\n4128.nr                                  0.297   \n                                        (1.67)   \n\n4159.nr                                  0.605***\n                                        (3.43)   \n\n4204.nr                                  0.324   \n                                        (1.82)   \n\n4229.nr                                  0.314   \n                                        (1.79)   \n\n4258.nr                                  0.718***\n                                        (4.07)   \n\n4261.nr                                  1.342***\n                                        (6.70)   \n\n4264.nr                                 0.0729   \n                                        (0.41)   \n\n4278.nr                                  0.594***\n                                        (3.35)   \n\n4297.nr                                  0.538** \n                                        (3.05)   \n\n4302.nr                                 -0.129   \n                                       (-0.74)   \n\n4321.nr                                  0.473** \n                                        (2.68)   \n\n4328.nr                                  0.239   \n                                        (1.35)   \n\n4332.nr                                 -0.371*  \n                                       (-2.11)   \n\n4335.nr                                  0.342   \n                                        (1.93)   \n\n4357.nr                                  0.527** \n                                        (2.98)   \n\n4365.nr                                -0.0388   \n                                       (-0.22)   \n\n4380.nr                                  0.880***\n                                        (4.94)   \n\n4394.nr                                  0.724***\n                                        (4.12)   \n\n4510.nr                                  0.643***\n                                        (3.66)   \n\n4559.nr                                  0.374*  \n                                        (2.08)   \n\n4563.nr                                 0.0190   \n                                        (0.11)   \n\n4569.nr                                  0.791***\n                                        (4.48)   \n\n4603.nr                                  0.734***\n                                        (4.16)   \n\n4607.nr                                  0.166   \n                                        (0.94)   \n\n4633.nr                                  0.505** \n                                        (2.86)   \n\n4676.nr                                  0.125   \n                                        (0.71)   \n\n4701.nr                                  0.952***\n                                        (5.42)   \n\n4716.nr                                  0.122   \n                                        (0.69)   \n\n4720.nr                                  1.137***\n                                        (6.28)   \n\n4759.nr                                  0.596***\n                                        (3.33)   \n\n4791.nr                                  0.678***\n                                        (3.74)   \n\n4811.nr                                 0.0962   \n                                        (0.55)   \n\n4828.nr                                  0.108   \n                                        (0.61)   \n\n4857.nr                                -0.0984   \n                                       (-0.56)   \n\n4858.nr                                  0.976***\n                                        (5.54)   \n\n4859.nr                                 0.0313   \n                                        (0.18)   \n\n4866.nr                                  0.818***\n                                        (4.62)   \n\n4881.nr                                  0.358*  \n                                        (2.02)   \n\n4884.nr                                  0.522** \n                                        (2.93)   \n\n4888.nr                                 0.0963   \n                                        (0.55)   \n\n4901.nr                                  0.218   \n                                        (1.22)   \n\n4917.nr                                 0.0595   \n                                        (0.34)   \n\n4926.nr                                  0.440*  \n                                        (2.47)   \n\n4982.nr                                  0.102   \n                                        (0.57)   \n\n5017.nr                                  1.088***\n                                        (6.19)   \n\n5033.nr                                  1.061***\n                                        (6.03)   \n\n5048.nr                                  0.315   \n                                        (1.79)   \n\n5122.nr                                  0.657***\n                                        (3.70)   \n\n5141.nr                                  0.711***\n                                        (4.03)   \n\n5147.nr                                  1.045***\n                                        (5.84)   \n\n5158.nr                                  0.700***\n                                        (3.97)   \n\n5221.nr                                  0.538** \n                                        (3.04)   \n\n5223.nr                                  0.486** \n                                        (2.76)   \n\n5227.nr                                  0.652***\n                                        (3.63)   \n\n5248.nr                                  0.179   \n                                        (1.02)   \n\n5252.nr                                 0.0879   \n                                        (0.50)   \n\n5263.nr                                  0.494** \n                                        (2.79)   \n\n5274.nr                                  0.756***\n                                        (4.28)   \n\n5335.nr                                  0.318   \n                                        (1.80)   \n\n5345.nr                                  0.233   \n                                        (1.33)   \n\n5359.nr                                -0.0821   \n                                       (-0.46)   \n\n5368.nr                                 0.0598   \n                                        (0.34)   \n\n5377.nr                                  0.382*  \n                                        (2.18)   \n\n5390.nr                                  0.288   \n                                        (1.63)   \n\n5419.nr                                  0.125   \n                                        (0.71)   \n\n5435.nr                                 0.0333   \n                                        (0.19)   \n\n5437.nr                                  0.265   \n                                        (1.50)   \n\n5497.nr                                  0.195   \n                                        (1.10)   \n\n5525.nr                                  0.315   \n                                        (1.75)   \n\n5529.nr                                  0.573** \n                                        (3.21)   \n\n5531.nr                                  0.927***\n                                        (5.16)   \n\n5579.nr                                  0.229   \n                                        (1.30)   \n\n5588.nr                                  0.936***\n                                        (4.83)   \n\n5599.nr                                  0.569** \n                                        (3.23)   \n\n5650.nr                                  0.330   \n                                        (1.87)   \n\n5660.nr                                  0.724***\n                                        (4.11)   \n\n5665.nr                                  0.155   \n                                        (0.88)   \n\n5666.nr                                  0.495** \n                                        (2.81)   \n\n5698.nr                                  0.686***\n                                        (3.84)   \n\n5699.nr                                  0.679***\n                                        (3.85)   \n\n5731.nr                                  0.318   \n                                        (1.80)   \n\n5750.nr                                  0.661***\n                                        (3.66)   \n\n5755.nr                                  0.546** \n                                        (3.06)   \n\n5772.nr                                  0.126   \n                                        (0.71)   \n\n5816.nr                                  0.211   \n                                        (1.19)   \n\n5823.nr                                  0.107   \n                                        (0.61)   \n\n5851.nr                                 0.0606   \n                                        (0.35)   \n\n5857.nr                                  0.438*  \n                                        (2.49)   \n\n5859.nr                                  0.427*  \n                                        (2.42)   \n\n6016.nr                                  0.794***\n                                        (4.52)   \n\n6020.nr                                 -0.282   \n                                       (-1.59)   \n\n6025.nr                                 -0.425*  \n                                       (-2.41)   \n\n6056.nr                                 -0.104   \n                                       (-0.59)   \n\n6094.nr                                  0.484** \n                                        (2.72)   \n\n6186.nr                                  0.487** \n                                        (2.76)   \n\n6395.nr                                  0.979***\n                                        (5.21)   \n\n6430.nr                                  0.403*  \n                                        (2.24)   \n\n6446.nr                                  0.555** \n                                        (3.14)   \n\n6463.nr                                  0.352   \n                                        (1.88)   \n\n6558.nr                                  0.807***\n                                        (4.58)   \n\n6559.nr                                  0.581** \n                                        (3.29)   \n\n6561.nr                                  0.953***\n                                        (5.42)   \n\n6574.nr                                 0.0977   \n                                        (0.55)   \n\n6648.nr                                  0.774***\n                                        (4.40)   \n\n6813.nr                                  0.274   \n                                        (1.55)   \n\n6824.nr                                  0.419*  \n                                        (2.34)   \n\n6888.nr                                  0.494** \n                                        (2.64)   \n\n6942.nr                                  0.549** \n                                        (3.12)   \n\n6954.nr                                  0.565** \n                                        (3.20)   \n\n6955.nr                                  0.678***\n                                        (3.85)   \n\n6964.nr                                  0.473** \n                                        (2.64)   \n\n6987.nr                                  1.456***\n                                        (8.26)   \n\n7025.nr                                  0.906***\n                                        (5.07)   \n\n7043.nr                                  0.498** \n                                        (2.82)   \n\n7060.nr                                  0.460** \n                                        (2.61)   \n\n7087.nr                                 -0.207   \n                                       (-1.18)   \n\n7238.nr                                  0.680***\n                                        (3.52)   \n\n7279.nr                                  0.270   \n                                        (1.51)   \n\n7342.nr                                  0.432*  \n                                        (2.41)   \n\n7343.nr                                  0.350*  \n                                        (1.99)   \n\n7411.nr                                -0.0378   \n                                       (-0.21)   \n\n7424.nr                                  0.651***\n                                        (3.70)   \n\n7429.nr                                  0.515** \n                                        (2.83)   \n\n7454.nr                                  0.730***\n                                        (4.16)   \n\n7472.nr                                  0.402*  \n                                        (2.27)   \n\n7474.nr                                  0.303   \n                                        (1.72)   \n\n7509.nr                                  0.689***\n                                        (3.80)   \n\n7539.nr                                -0.0121   \n                                       (-0.07)   \n\n7769.nr                                  0.655***\n                                        (3.71)   \n\n7783.nr                                  0.449*  \n                                        (2.55)   \n\n7784.nr                                  1.929***\n                                       (10.99)   \n\n7801.nr                                -0.0478   \n                                       (-0.27)   \n\n7824.nr                                  0.546** \n                                        (3.11)   \n\n7874.nr                                  1.107***\n                                        (6.30)   \n\n7887.nr                                  0.639***\n                                        (3.59)   \n\n7923.nr                                  1.238***\n                                        (6.88)   \n\n7926.nr                                  0.708***\n                                        (3.91)   \n\n8021.nr                                  0.824***\n                                        (4.69)   \n\n8087.nr                                  0.460** \n                                        (2.61)   \n\n8089.nr                                  0.222   \n                                        (1.26)   \n\n8090.nr                                  1.226***\n                                        (6.97)   \n\n8096.nr                                  1.299***\n                                        (5.89)   \n\n8106.nr                                  0.948***\n                                        (4.74)   \n\n8107.nr                                  1.186***\n                                        (5.38)   \n\n8142.nr                                  0.182   \n                                        (1.04)   \n\n8168.nr                                  0.551** \n                                        (3.12)   \n\n8173.nr                                  0.909***\n                                        (4.51)   \n\n8203.nr                                  1.072***\n                                        (6.07)   \n\n8211.nr                                  0.294   \n                                        (1.61)   \n\n8224.nr                                  0.807***\n                                        (4.50)   \n\n8272.nr                                  0.959***\n                                        (5.40)   \n\n8300.nr                                  0.386*  \n                                        (2.20)   \n\n8304.nr                                  0.470** \n                                        (2.67)   \n\n8364.nr                                  0.348*  \n                                        (1.96)   \n\n8370.nr                                  0.845***\n                                        (4.78)   \n\n8381.nr                                  0.218   \n                                        (1.24)   \n\n8388.nr                                  0.743***\n                                        (3.83)   \n\n8406.nr                                  0.626***\n                                        (3.41)   \n\n8415.nr                                 0.0542   \n                                        (0.31)   \n\n8496.nr                                 -0.112   \n                                       (-0.64)   \n\n8501.nr                                -0.0699   \n                                       (-0.39)   \n\n8518.nr                                  1.243***\n                                        (6.89)   \n\n8520.nr                                 -0.353*  \n                                       (-2.00)   \n\n8524.nr                                 -0.118   \n                                       (-0.67)   \n\n8548.nr                                  0.115   \n                                        (0.65)   \n\n8556.nr                                  0.625***\n                                        (3.55)   \n\n8564.nr                                  0.106   \n                                        (0.60)   \n\n8581.nr                                 -0.249   \n                                       (-1.41)   \n\n8586.nr                                  0.258   \n                                        (1.47)   \n\n8587.nr                                 -0.370*  \n                                       (-2.10)   \n\n8597.nr                                  0.771***\n                                        (4.21)   \n\n8656.nr                                  0.153   \n                                        (0.87)   \n\n8722.nr                                  0.637***\n                                        (3.59)   \n\n8743.nr                                  0.515** \n                                        (2.90)   \n\n8749.nr                                  0.940***\n                                        (4.67)   \n\n8758.nr                                  0.535** \n                                        (3.02)   \n\n8796.nr                                  0.780***\n                                        (4.42)   \n\n8838.nr                                  0.406*  \n                                        (2.30)   \n\n8842.nr                                  0.145   \n                                        (0.82)   \n\n8846.nr                                  0.112   \n                                        (0.63)   \n\n8860.nr                                  0.124   \n                                        (0.70)   \n\n8862.nr                                  0.399*  \n                                        (2.27)   \n\n8880.nr                                  1.219***\n                                        (6.85)   \n\n8886.nr                                  0.631***\n                                        (3.52)   \n\n8903.nr                                 -0.239   \n                                       (-1.35)   \n\n8908.nr                                -0.0227   \n                                       (-0.13)   \n\n8911.nr                                -0.0340   \n                                       (-0.19)   \n\n8917.nr                                  0.796***\n                                        (4.48)   \n\n8991.nr                                  0.913***\n                                        (5.18)   \n\n8997.nr                                  0.898***\n                                        (5.09)   \n\n9014.nr                                  0.540** \n                                        (3.05)   \n\n9015.nr                                  0.697***\n                                        (3.72)   \n\n9027.nr                                  1.002***\n                                        (5.68)   \n\n9066.nr                                 -0.153   \n                                       (-0.87)   \n\n9082.nr                                  0.274   \n                                        (1.54)   \n\n9131.nr                                  0.758***\n                                        (3.77)   \n\n9132.nr                                  0.709***\n                                        (3.77)   \n\n9154.nr                                  1.113***\n                                        (6.32)   \n\n9158.nr                                 0.0857   \n                                        (0.48)   \n\n9184.nr                                  0.164   \n                                        (0.92)   \n\n9230.nr                                  0.158   \n                                        (0.90)   \n\n9265.nr                                  0.437*  \n                                        (2.49)   \n\n9367.nr                                  0.207   \n                                        (1.18)   \n\n9390.nr                                  0.745***\n                                        (4.20)   \n\n9391.nr                                  0.370*  \n                                        (2.10)   \n\n9418.nr                                  1.133***\n                                        (6.44)   \n\n9424.nr                                  0.806***\n                                        (4.56)   \n\n9447.nr                                  0.503** \n                                        (2.85)   \n\n9449.nr                                  0.318   \n                                        (1.81)   \n\n9453.nr                                  0.745***\n                                        (4.22)   \n\n9468.nr                                  0.493** \n                                        (2.81)   \n\n9502.nr                                  0.895***\n                                        (4.95)   \n\n9505.nr                                 0.0464   \n                                        (0.26)   \n\n9603.nr                                  0.310   \n                                        (1.65)   \n\n9643.nr                                  0.433*  \n                                        (2.46)   \n\n9667.nr                                  1.067***\n                                        (6.07)   \n\n9683.nr                                  0.128   \n                                        (0.71)   \n\n9694.nr                                  0.847***\n                                        (4.82)   \n\n9710.nr                                  0.280   \n                                        (1.58)   \n\n9718.nr                                  0.938***\n                                        (5.34)   \n\n9725.nr                                  0.322   \n                                        (1.84)   \n\n9744.nr                                  0.689***\n                                        (3.92)   \n\n9752.nr                                  1.390***\n                                        (7.88)   \n\n9776.nr                                  0.953***\n                                        (5.37)   \n\n9786.nr                                  0.624***\n                                        (3.55)   \n\n9791.nr                                  0.328   \n                                        (1.86)   \n\n9794.nr                                  0.473** \n                                        (2.67)   \n\n9810.nr                                 -0.144   \n                                       (-0.82)   \n\n9846.nr                                  0.825***\n                                        (4.65)   \n\n9859.nr                                  0.148   \n                                        (0.83)   \n\n9868.nr                                 0.0289   \n                                        (0.16)   \n\n9876.nr                                  0.853***\n                                        (4.78)   \n\n9883.nr                                  0.714***\n                                        (4.05)   \n\n9889.nr                                  0.988***\n                                        (5.59)   \n\n9901.nr                                  0.689***\n                                        (3.88)   \n\n9936.nr                                  0.895***\n                                        (5.06)   \n\n9964.nr                                  0.412*  \n                                        (2.32)   \n\n10043.nr                                -0.172   \n                                       (-0.97)   \n\n10067.nr                                 0.510** \n                                        (2.89)   \n\n10091.nr                                 0.697***\n                                        (3.86)   \n\n10120.nr                                -0.118   \n                                       (-0.67)   \n\n10121.nr                                 0.325   \n                                        (1.85)   \n\n10167.nr                                 0.567** \n                                        (3.18)   \n\n10209.nr                                 0.112   \n                                        (0.63)   \n\n10230.nr                                 0.724***\n                                        (4.03)   \n\n10265.nr                                 0.993***\n                                        (5.63)   \n\n10274.nr                                 0.237   \n                                        (1.35)   \n\n10311.nr                                 0.301   \n                                        (1.71)   \n\n10392.nr                                 0.108   \n                                        (0.61)   \n\n10425.nr                                 0.945***\n                                        (5.34)   \n\n10441.nr                                 0.176   \n                                        (1.00)   \n\n10457.nr                                 0.446*  \n                                        (2.53)   \n\n10469.nr                                 0.447*  \n                                        (2.54)   \n\n10524.nr                                0.0885   \n                                        (0.50)   \n\n10552.nr                                -0.185   \n                                       (-1.05)   \n\n10553.nr                                 0.706***\n                                        (3.96)   \n\n10570.nr                                -0.747***\n                                       (-4.23)   \n\n10593.nr                                 0.284   \n                                        (1.54)   \n\n10666.nr                                -0.324   \n                                       (-1.83)   \n\n11275.nr                                 0.146   \n                                        (0.83)   \n\n11328.nr                                 0.495** \n                                        (2.76)   \n\n11750.nr                                 0.384*  \n                                        (2.19)   \n\n11821.nr                                 0.808***\n                                        (4.60)   \n\n11857.nr                                 0.934***\n                                        (5.27)   \n\n11887.nr                                 0.396*  \n                                        (2.24)   \n\n11890.nr                                 1.093***\n                                        (5.18)   \n\n11892.nr                                 1.132***\n                                        (6.38)   \n\n11924.nr                                 0.354*  \n                                        (2.02)   \n\n11925.nr                                 0.408*  \n                                        (2.31)   \n\n11957.nr                               0.00425   \n                                        (0.02)   \n\n11973.nr                                 0.578** \n                                        (3.26)   \n\n11990.nr                                 1.010***\n                                        (5.73)   \n\n12012.nr                                 0.224   \n                                        (1.27)   \n\n12013.nr                                 0.568** \n                                        (3.24)   \n\n12045.nr                                 0.200   \n                                        (1.13)   \n\n12055.nr                                 0.674***\n                                        (3.81)   \n\n12084.nr                                 0.450*  \n                                        (2.51)   \n\n12088.nr                                 0.117   \n                                        (0.66)   \n\n12122.nr                                 0.586** \n                                        (2.91)   \n\n12179.nr                                 0.301   \n                                        (1.70)   \n\n12182.nr                                 0.515** \n                                        (2.93)   \n\n12220.nr                                 0.673***\n                                        (3.81)   \n\n12221.nr                                -0.121   \n                                       (-0.66)   \n\n12245.nr                                -0.110   \n                                       (-0.63)   \n\n12276.nr                                 0.655***\n                                        (3.69)   \n\n12385.nr                                 0.819***\n                                        (4.57)   \n\n12410.nr                                0.0399   \n                                        (0.22)   \n\n12420.nr                                 0.840***\n                                        (4.74)   \n\n12433.nr                                 0.393*  \n                                        (2.23)   \n\n12451.nr                                 0.431*  \n                                        (2.45)   \n\n12477.nr                                 1.004***\n                                        (5.62)   \n\n12500.nr                                 0.222   \n                                        (1.25)   \n\n12534.nr                                 0.942***\n                                        (5.35)   \n\n12548.nr                                 0.347   \n                                        (1.93)   \n\n_cons         -0.445***     1.426***     0.933***\n            (-14.96)      (77.75)       (7.44)   \n-------------------------------------------------\nN               4360         4360         4360   \n-------------------------------------------------\nt statistics in parentheses\n* p<0.05, ** p<0.01, *** p<0.001\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n## Practical Tips  {.smaller background=\"#fce0cc\"}\n\nNotice that the parameter $\\delta$ does not have meaning. \n\n$$y_{i,t} = \\alpha + \\beta_1 x_{i,t} + \\delta FE +  \\epsilon_{i,t}$$\n\nIn fact, the previous slides have shown that you will find the same results of a FE model if you include the dummies for the units in the panel (i.e., dummies for the firms or individuals, etc.).\n\nThis is called **least squares dummy variable (LSDV) model**.\n\n- the SE are also identical to the within-transformation model.\n\n- But the R2 of the LSDV will be very high because you are including a lot of \"explanatory variables\".\n\n::: {.callout-note}\nAt the end of the day, you will use the package for the unit's FE (i.e., the firm), and will include the additional FE as dummies, just like a LSDV model.\n:::\n\n\n\n\n## Practical Tips  {.smaller background=\"#fce0cc\"}\n\nWhen you estimate a LSDV, the software will inform an $\\alpha$. \n\nBut this coefficient **has no interpretation whatsoever.** \n\n- it will be FE for the dropped unit of FE. \n\nYou can simply ignore it, you even don't need to include in your final table. \n\nNo problem if you do, just **don't make inferences from it**.\n\n\n\n\n\n## Practical Tips  {.smaller background=\"#fce0cc\"}\n\nA FE model helps a lot, but it only does what it can do.\n\nThat is, FE models do not capture **time-variant unobserved heterogeneity**.\n\n. . .\n\nAlso, if you have constant Xs in your model, you will have to drop them.\n\n- More technically, if there is no within-variation in a X, you cannot include it (the software will drop them).\n\n- For instance, the software will drop $year_{birth}$ below if you include CEO FE.\n\n$$Y_{i,t} = \\alpha + \\beta_1 year_{birth} + CEO \\;FE + ... + \\epsilon_{i,t}$$\n\nIf you attempt to include the CEO FE manually, the software will drop a random CEO FE or the variable $year_{birth}$. If you get a beta for $year_{birth}$ it has no meaning.\n\n\n\n\n\n\n## Practical Tips  {.smaller background=\"#fce0cc\"}\n\nAdding many FE can demand a lot of computational power.\n\nConsider the multidimensional model as follows:\n\n$$Y_{i,t} = \\alpha + \\beta_1 X_{i,t} + Firm \\;FE + Year\\; FE + Year.Industry \\;FE + CEO \\;FE + ... + \\epsilon_{i,t}$$\n\nIt would take a while to estimate in an average computer.\n\n\n\n\n\n\n\n\n# Random Effects  {.smaller background=\"#c6f7ec\"}\n\n## Random Effects  {.smaller background=\"#c6f7ec\"}\n\nRemember that:\n\n$$\\epsilon_{i,t} = c_i + \\mu_{i,t}$$\n\nThe most important thing here is whether $x_{it}$ and $c_i$ are correlated.\n    \n- If they are, you should estimate Fixed Effects\n\n- If $x_{it}$ and $c_i$ are not correlated, then $c_i$  is referred to as a **random effect**.\n\n  - Endogeneity is not a concern; however, the computation of standard errors is affected.\n\nBut, if the $x_{it}$ and $c_i$ are not correlated, there is **no endogeneity concern**. \n\n$c_i$ can be let as part of the $\\epsilon_{i,t}$ without bias in the estimated betas.\n\n\n\n\n\n\n\n## Random Effects  {.smaller background=\"#c6f7ec\"}\n\nAdditionally, the assumption that $x_{it}$ and $c_i$ are not correlated is rather strong and not practical to most applications of corporate finance, economics or public policy.\n\nRE is a model not used often. Cunningham does not even discuss it.\n\n*If the key explanatory variable is constant over time, we cannot use FE to estimate its effect on y.*\n\n*Of course, we can only use RE because we are willing to assume the unobserved effect is uncorrelated with all explanatory variables.*\n\n*Typically, if one uses RE, and as many time-constant controls as possible are included among the explanatory variables (with an FE analysis, it is not necessary to include such controls) RE is preferred to pooled OLS because RE is generally more efficient.*\n\n(Wooldridge, p.496)\n\n\n\n\n\n\n\n\n## Random Effects  {.smaller background=\"#c6f7ec\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\nlibrary(plm)\nlibrary(jtools)\nlibrary(foreign)\ndata <- read.dta(\"files/WAGEPAN.dta\")\npdata <- pdata.frame(data, index = c(\"nr\", \"year\"))\n\npo_model <- lm(lwage ~ expersq + married + union + factor(year) + educ + black + hisp + exper, data = data)\nfe_model <- plm(lwage ~ expersq + married + union + factor(year) + educ + black + hisp + exper, data = pdata, model = \"within\")\nre_model <- plm(lwage ~ expersq + married + union + factor(year) + educ + black + hisp + exper, data = pdata, model = \"random\")\n\nstargazer(po_model, fe_model , re_model ,title = \"Regression Results\", column.labels=c(\"OLS\",\"FE\",\"RE\"),  type = \"text\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results\n==================================================================================\n                                         Dependent variable:                      \n                    --------------------------------------------------------------\n                                                lwage                             \n                               OLS                           panel                \n                                                             linear               \n                               OLS                       FE                 RE    \n                               (1)                       (2)               (3)    \n----------------------------------------------------------------------------------\nexpersq                     -0.002***                 -0.005***         -0.005*** \n                             (0.001)                   (0.001)           (0.001)  \n                                                                                  \nmarried                     0.108***                   0.047**           0.064*** \n                             (0.016)                   (0.018)           (0.017)  \n                                                                                  \nunion                       0.182***                  0.080***           0.106*** \n                             (0.017)                   (0.019)           (0.018)  \n                                                                                  \nfactor(year)1981             0.058*                   0.151***            0.040   \n                             (0.030)                   (0.022)           (0.025)  \n                                                                                  \nfactor(year)1982             0.063*                   0.253***            0.031   \n                             (0.033)                   (0.024)           (0.032)  \n                                                                                  \nfactor(year)1983             0.062*                   0.354***            0.020   \n                             (0.037)                   (0.029)           (0.042)  \n                                                                                  \nfactor(year)1984             0.090**                  0.490***            0.043   \n                             (0.040)                   (0.036)           (0.051)  \n                                                                                  \nfactor(year)1985             0.109**                  0.617***            0.058   \n                             (0.043)                   (0.045)           (0.061)  \n                                                                                  \nfactor(year)1986            0.142***                  0.765***            0.092   \n                             (0.046)                   (0.056)           (0.071)  \n                                                                                  \nfactor(year)1987            0.174***                  0.925***            0.135*  \n                             (0.049)                   (0.069)           (0.081)  \n                                                                                  \neduc                        0.091***                                     0.092*** \n                             (0.005)                                     (0.011)  \n                                                                                  \nblack                       -0.139***                                   -0.139*** \n                             (0.024)                                     (0.048)  \n                                                                                  \nhisp                          0.016                                       0.022   \n                             (0.021)                                     (0.043)  \n                                                                                  \nexper                       0.067***                                     0.106*** \n                             (0.014)                                     (0.015)  \n                                                                                  \nConstant                      0.092                                       0.024   \n                             (0.078)                                     (0.151)  \n                                                                                  \n----------------------------------------------------------------------------------\nObservations                  4,360                     4,360             4,360   \nR2                            0.189                     0.181             0.181   \nAdjusted R2                   0.187                     0.061             0.178   \nResidual Std. Error     0.480 (df = 4345)                                         \nF Statistic         72.459*** (df = 14; 4345) 83.851*** (df = 10; 3805) 957.774***\n==================================================================================\nNote:                                                  *p<0.1; **p<0.05; ***p<0.01\n```\n\n\n:::\n:::\n\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/WAGEPAN.dta\" , clear\n\nxtset nr year \neststo: qui reg   lwage expersq married union i.year  educ black hisp exper \neststo: qui xtreg lwage expersq married union i.year  educ black hisp exper , fe\neststo: qui xtreg lwage expersq married union i.year  educ black hisp exper , re\n\nesttab , mtitles(\"OLS\" \"FE\" \"RE\") compress\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPanel variable: nr (strongly balanced)\n Time variable: year, 1980 to 1987\n         Delta: 1 unit\n\n(est1 stored)\n\n(est2 stored)\n\n(est3 stored)\n\n\n-------------------------------------------------\n                 (1)          (2)          (3)   \n                 OLS           FE           RE   \n-------------------------------------------------\nexpersq     -0.00241**   -0.00519***  -0.00472***\n             (-2.94)      (-7.36)      (-6.85)   \n\nmarried        0.108***    0.0467*      0.0640***\n              (6.90)       (2.55)       (3.81)   \n\nunion          0.182***    0.0800***     0.106***\n             (10.63)       (4.14)       (5.94)   \n\n1980.year          0            0            0   \n                 (.)          (.)          (.)   \n\n1981.year     0.0583        0.151***    0.0405   \n              (1.92)       (6.89)       (1.64)   \n\n1982.year     0.0628        0.253***    0.0309   \n              (1.89)      (10.36)       (0.96)   \n\n1983.year     0.0620        0.354***    0.0203   \n              (1.69)      (12.12)       (0.49)   \n\n1984.year     0.0905*       0.490***    0.0431   \n              (2.26)      (13.53)       (0.84)   \n\n1985.year      0.109*       0.617***    0.0578   \n              (2.52)      (13.65)       (0.94)   \n\n1986.year      0.142**      0.765***    0.0919   \n              (3.06)      (13.64)       (1.29)   \n\n1987.year      0.174***     0.925***     0.135   \n              (3.52)      (13.45)       (1.66)   \n\neduc          0.0913***         0       0.0919***\n             (17.44)          (.)       (8.62)   \n\nblack         -0.139***         0       -0.139** \n             (-5.90)          (.)      (-2.92)   \n\nhisp          0.0160            0       0.0217   \n              (0.77)          (.)       (0.51)   \n\nexper         0.0672***         0        0.106***\n              (4.91)          (.)       (6.88)   \n\n_cons         0.0921        1.426***    0.0236   \n              (1.18)      (77.75)       (0.16)   \n-------------------------------------------------\nN               4360         4360         4360   \n-------------------------------------------------\nt statistics in parentheses\n* p<0.05, ** p<0.01, *** p<0.001\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n# FE vs. RE    {.smaller background=\"#5c97f7\" }\n\n\n## FE vs. RE    {.smaller background=\"#5c97f7\" }\n\n*The idea is that one uses the random effects estimates unless the Hausman test rejects.* \n\n*In practice, a failure to reject means either that the RE and FE estimates are sufficiently close so that it does not matter which is used, or the sampling variation is so large in the FE estimates that one cannot conclude practically significant differences are statistically significant.* (Wooldridge)\n\n\n**If the p-value of the Hausman test is significant then use FE, if not use RE.**\n\n\n\n\n\n## FE vs. RE   {.smaller background=\"#5c97f7\" }\n\n\n::: panel-tabset\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/WAGEPAN.dta\", clear\nxtset nr year\nqui xtreg lwage expersq married union i.year educ black hisp exper, fe\nestimates store fe_model\nqui xtreg lwage expersq married union i.year educ black hisp exper, re\nestimates store re_model\nhausman fe_model re_model\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPanel variable: nr (strongly balanced)\n Time variable: year, 1980 to 1987\n         Delta: 1 unit\n\n                 ---- Coefficients ----\n             |      (b)          (B)            (b-B)     sqrt(diag(V_b-V_B))\n             |    fe_model     re_model      Difference       Std. err.\n-------------+----------------------------------------------------------------\n     expersq |   -.0051855    -.0047239       -.0004616        .0001443\n     married |    .0466804      .063986       -.0173057        .0073414\n       union |    .0800019     .1061344       -.0261326        .0073572\n        year |\n       1981  |    .1511912      .040462        .1107292               .\n       1982  |    .2529709     .0309212        .2220497               .\n       1983  |    .3544437     .0202806        .3341631               .\n       1984  |    .4901148     .0431187        .4469961               .\n       1985  |    .6174822     .0578154        .5596668               .\n       1986  |    .7654965     .0919475         .673549               .\n       1987  |    .9250249     .1349289         .790096               .\n------------------------------------------------------------------------------\n                          b = Consistent under H0 and Ha; obtained from xtreg.\n           B = Inconsistent under Ha, efficient under H0; obtained from xtreg.\n\nTest of H0: Difference in coefficients not systematic\n\n   chi2(10) = (b-B)'[(V_b-V_B)^(-1)](b-B)\n            =  26.36\nProb > chi2 = 0.0033\n(V_b-V_B is not positive definite)\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n# First differences   {.smaller background=\"#e3e2b8\"}\n\n## First differences   {.smaller background=\"#e3e2b8\"}\n\nIn most applications, the main reason for collecting panel data is **to allow for the unobserved effect, $c_i$, to be correlated with the explanatory variables**. \n\nFor example, in the crime equation, we want to allow the unmeasured city factors in $c_i$ that affect the crime rate also to be correlated with the unemployment rate. \n\nIt turns out that this is simple to allow: **because $c_i$ is constant over time, we can difference the data across the two years.** \n\nMore precisely, for a cross-sectional observation $i$, write the two years as:\n\n\n$$y_{i,1} = \\beta_0 + \\beta_1 x_{i,1} + c_i + \\mu_{i,1}, t=1$$ \n\n$$y_{i,2} = (\\beta_0 + \\delta_0) + \\beta_1 x_{i,2} + c_i + \\mu_{i,2}, t=2$$ \n\nIf we subtract the second equation from the first, we obtain\n\n$$(y_{i,2} - y_{i,1}) = \\delta_0 + \\beta_1 (x_{i,2} - x_{i,1}) + (\\mu_{i,2}-\\mu_{i,1})$$ \n\n\n$$\\Delta y_{i} = \\delta_0 + \\beta_1 \\Delta x_{i} + \\Delta \\mu_{i}$$ \n\n\n\n\n\n\n\n\n\n## First differences   {.smaller background=\"#e3e2b8\"}\n\n**So, rather than subtracting the group mean of each variable, you  subtract the lagged observation.**\n\nNot hard to see that, when t=2, FE and FD will give identical solutions\n\n. . .\n\n- FE is more efficient if disturbances $\\mu_{i,t}$ have low serial correlation\n\n- FD is more efficient if disturbance $\\mu_{i,t}$ follow a random walk\n\nAt the end of the day, you can estimate both. \n\nEmpirical research usually estimate FD only in specific circumstances, when they are interested in how changes of X affect changes of Y.\n\nThings like stationarity or trends are often not concerns in panel data\n\n- where N is 10 to 20 \n\n\n\n\n\n\n## First differences   {.smaller background=\"#e3e2b8\"}\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\n# Load necessary libraries\nlibrary(plm)\nlibrary(lmtest)\nlibrary(stargazer)\n\ndata <- read.dta(\"files/WAGEPAN.dta\")\npdata <- pdata.frame(data, index = c(\"nr\", \"year\"))\n\nols_model <- lm(lwage ~ expersq + married + union + factor(year) + educ + black + hisp + exper, data = pdata)\nfe_model <- plm(lwage ~ expersq + married + union + educ + black + hisp + exper, data = pdata, model = \"within\")\nre_model <- plm(lwage ~ expersq + married + union + educ + black + hisp + exper, data = pdata, model = \"random\")\nfd_model <- plm(lwage ~ expersq + married + union + educ + black + hisp + exper, data = pdata, model = \"fd\")\n\nstargazer(ols_model, fe_model ,re_model, fd_model,title = \"Regression Results\",   type = \"text\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results\n==========================================================================================================\n                                                     Dependent variable:                                  \n                    --------------------------------------------------------------------------------------\n                                                            lwage                                         \n                               OLS                                       panel                            \n                                                                         linear                           \n                               (1)                       (2)               (3)               (4)          \n----------------------------------------------------------------------------------------------------------\nexpersq                     -0.002***                 -0.004***         -0.004***         -0.004***       \n                             (0.001)                   (0.001)           (0.001)           (0.001)        \n                                                                                                          \nmarried                     0.108***                   0.045**           0.063***          0.038*         \n                             (0.016)                   (0.018)           (0.017)           (0.023)        \n                                                                                                          \nunion                       0.182***                  0.082***           0.107***          0.043**        \n                             (0.017)                   (0.019)           (0.018)           (0.020)        \n                                                                                                          \nfactor(year)1981             0.058*                                                                       \n                             (0.030)                                                                      \n                                                                                                          \nfactor(year)1982             0.063*                                                                       \n                             (0.033)                                                                      \n                                                                                                          \nfactor(year)1983             0.062*                                                                       \n                             (0.037)                                                                      \n                                                                                                          \nfactor(year)1984             0.090**                                                                      \n                             (0.040)                                                                      \n                                                                                                          \nfactor(year)1985             0.109**                                                                      \n                             (0.043)                                                                      \n                                                                                                          \nfactor(year)1986            0.142***                                                                      \n                             (0.046)                                                                      \n                                                                                                          \nfactor(year)1987            0.174***                                                                      \n                             (0.049)                                                                      \n                                                                                                          \neduc                        0.091***                                     0.101***                         \n                             (0.005)                                     (0.009)                          \n                                                                                                          \nblack                       -0.139***                                   -0.144***                         \n                             (0.024)                                     (0.048)                          \n                                                                                                          \nhisp                          0.016                                       0.020                           \n                             (0.021)                                     (0.043)                          \n                                                                                                          \nexper                       0.067***                  0.117***           0.112***                         \n                             (0.014)                   (0.008)           (0.008)                          \n                                                                                                          \nConstant                      0.092                                       -0.107          0.116***        \n                             (0.078)                                     (0.111)           (0.020)        \n                                                                                                          \n----------------------------------------------------------------------------------------------------------\nObservations                  4,360                     4,360             4,360             3,815         \nR2                            0.189                     0.178             0.178             0.004         \nAdjusted R2                   0.187                     0.060             0.177             0.003         \nResidual Std. Error     0.480 (df = 4345)                                                                 \nF Statistic         72.459*** (df = 14; 4345) 206.375*** (df = 4; 3811) 943.951*** 5.362*** (df = 3; 3811)\n==========================================================================================================\nNote:                                                                          *p<0.1; **p<0.05; ***p<0.01\n```\n\n\n:::\n:::\n\n\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse \"files/WAGEPAN.dta\" , clear\n\nxtset nr year \neststo: qui reg   lwage expersq married union i.year  educ black hisp exper \neststo: qui xtreg lwage expersq married union i.year  educ black hisp exper , fe\neststo: qui xtreg lwage expersq married union i.year  educ black hisp exper , re\neststo: qui reg D.lwage D.expersq D.married D.union i.year  D.educ D.black D.hisp D.exper \n\nesttab , mtitles(\"OLS\" \"FE\" \"RE\" \"FD\") compress\n\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPanel variable: nr (strongly balanced)\n Time variable: year, 1980 to 1987\n         Delta: 1 unit\n\n(est1 stored)\n\n(est2 stored)\n\n(est3 stored)\n\n(est4 stored)\n\n\n--------------------------------------------------------------\n                 (1)          (2)          (3)          (4)   \n                 OLS           FE           RE           FD   \n--------------------------------------------------------------\nexpersq     -0.00241**   -0.00519***  -0.00472***             \n             (-2.94)      (-7.36)      (-6.85)                \n\nmarried        0.108***    0.0467*      0.0640***             \n              (6.90)       (2.55)       (3.81)                \n\nunion          0.182***    0.0800***     0.106***             \n             (10.63)       (4.14)       (5.94)                \n\n1980.year          0            0            0                \n                 (.)          (.)          (.)                \n\n1981.year     0.0583        0.151***    0.0405            0   \n              (1.92)       (6.89)       (1.64)          (.)   \n\n1982.year     0.0628        0.253***    0.0309      -0.0482   \n              (1.89)      (10.36)       (0.96)      (-1.77)   \n\n1983.year     0.0620        0.354***    0.0203      -0.0479   \n              (1.69)      (12.12)       (0.49)      (-1.70)   \n\n1984.year     0.0905*       0.490***    0.0431      -0.0122   \n              (2.26)      (13.53)       (0.84)      (-0.41)   \n\n1985.year      0.109*       0.617***    0.0578      -0.0208   \n              (2.52)      (13.65)       (0.94)      (-0.65)   \n\n1986.year      0.142**      0.765***    0.0919      0.00151   \n              (3.06)      (13.64)       (1.29)       (0.04)   \n\n1987.year      0.174***     0.925***     0.135       0.0167   \n              (3.52)      (13.45)       (1.66)       (0.45)   \n\neduc          0.0913***         0       0.0919***             \n             (17.44)          (.)       (8.62)                \n\nblack         -0.139***         0       -0.139**              \n             (-5.90)          (.)      (-2.92)                \n\nhisp          0.0160            0       0.0217                \n              (0.77)          (.)       (0.51)                \n\nexper         0.0672***         0        0.106***             \n              (4.91)          (.)       (6.88)                \n\nD.expersq                                          -0.00575** \n                                                    (-2.65)   \n\nD.married                                            0.0381   \n                                                     (1.66)   \n\nD.union                                              0.0411*  \n                                                     (2.09)   \n\noD.educ                                                   0   \n                                                        (.)   \n\noD.black                                                  0   \n                                                        (.)   \n\noD.hisp                                                   0   \n                                                        (.)   \n\noD.exper                                                  0   \n                                                        (.)   \n\n_cons         0.0921        1.426***    0.0236        0.156***\n              (1.18)      (77.75)       (0.16)       (6.36)   \n--------------------------------------------------------------\nN               4360         4360         4360         3815   \n--------------------------------------------------------------\nt statistics in parentheses\n* p<0.05, ** p<0.01, *** p<0.001\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n# Lagged independent variables   {.smaller background=\"#e3bfc3\"}\n\n## Lagged independent variables   {.smaller background=\"#e3bfc3\"}\n\nWhen you have a panel data and are concerned with simultaneity between Y and X, you can endeavor in lagging the Xs.\n\n\n$$y_{i,t} = \\beta_0 + \\beta_1 x_{i,t-1} + c_i + \\mu_{i,t}$$ \n\nAs a matter of fact, this is often expected in finance research. \n\n. . . \n\nThere is a limitation, however.\n\nThe usual proxy of corporate finance research is highly autocorrelated. \n \n - e.g., total assets do not vary much throughout  time. \n \nThus, lagging the X often does not make much of a difference. \n \n::: {.callout-tip}\nAlways do it. Otherwise, you will have to explain why you didn't do it.\n:::\n\n\n\n\n\n\n\n# Lagged dependent variables   {.smaller background=\"#d6cbf5\"}\n\n## Lagged dependent variables   {.smaller background=\"#d6cbf5\"}\n\nSometimes you may have something like\n\n$$y_{i,t} = \\beta_0 + \\beta_1 y_{i,t-1}+ \\beta_2 x_{i,t} + c_i + \\mu_{i,t}$$ \n\nThis is called a **Dynamic Panel Model**. It includes $y_{i,t-1}$ as X.\n\n. . .\n\nConsider a FE model.\n\n$$y_{i,t} - \\bar{y_i} = \\beta_0 + \\gamma_1 (y_{i,t-1} - \\bar{y}_{i,t-1}) + \\omega_2 (x_{i,t-1} - \\bar{x_i} )   + (FE_i - \\bar{FE}_i)  + (\\mu_{i,t} - \\bar{\\mu}_i )$$ \n\nThe within transformation removes the time-invariant unobserved heterogeneity from the model. \n\nHowever, it introduces a correlation between the transformed lag $(y_{i,t−1}−\\bar{y}_{i,t-1})$ and the transformed error $(\\mu_{i,t−1}−\\bar{\\mu}_{i,t-1})$ because the average error ($\\bar{\\mu} = \\sum_{i=1}^{T} \\mu_{i,t}$) includes $\\mu_{i,t-1}$, which is also \"included\" in $y_{i,t−1}$ \n\n- $y_{i,t-1} = \\beta_0 + \\beta_1 y_{i,t-2}+ \\beta_2 x_{i,t-1} + c_i + \\mu_{i,t-1}$ \n\n\n\n\n\n\n\n\n## Lagged dependent variables   {.smaller background=\"#d6cbf5\"}\n\nThe bias declines with panel length because $\\epsilon_{i,t−1}$ becomes a smaller component of the average error term as T increases. \n\nIn other words, with higher T the correlation between the lagged dependent variable and the regression errors becomes smaller.\n\n**[Flannery and Hankins (2013)](https://doi.org/10.1016/j.jcorpfin.2012.09.004)** have a good review with applications in corporate finance.\n\nThey conclude that FE is biased when estimating these models.\n\nThey suggest to estimate **Sys-GMM** or **Least Squares Dummy Variable Correction**. We do not discuss these models in the course.\n\n\n\n\n\n\n\n\n\n\n# Selection Bias {.smaller background=\"#e3e2b8\"}\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nBack to the selection bias example of before.\n\n-   Imagine that John and Mary are moving to the north of Canada.\n\n-   John has a history of respiratory disease and decide to buy insurance.\n\n-   Mary does not have a history of respiratory disease and decide not to buy insurance.\n\n\n\n| Default                     | John | Mary |\n|-----------------------------|:-----|-----:|\n| State of insurance          | 1    |    0 |\n| Situation without insurance | `3`  |    5 |\n| Situation with insurance    | 4    |  `5` |\n| Observed                    | 4    |    5 |\n| Effect                      | ?    |    ? |\n\n$$(Y_{1,john} - Y_{0,john}) + (Y_{1,Mary}- Y_{0,Mary}) = 4 - 3 + 5 - 5 = 0.5$$\n\n\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nRearranging the terms:\n\n\n$$(Y_{1,john} - Y_{0,Mary})   + (Y_{1,Mary}  - Y_{0,john})  = (4 - 5) + (5 - 3)  = 0.5$$\n$$We\\;see   + We\\;do\\;not\\;see  = (4 - 5) + (5 - 3)  = 0.5$$\n\nThe term $(Y_{1,Mary}  - Y_{0,john}) =  (5 - 3) = 2$ is the **selection bias**.\n\nIt exists because we are comparing two people that should not be compared.\n\n\n\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nSome notation:\n\n$d=1$ for the treated units (treatment group)\n\n$d=0$ for the treated units (control group)\n\n\n. . . \n\n\n$Y_{i}$ = Potential outcome of individual *i*.\n\n$Y_{i,1}$ or  $Y(1)$ = Potential outcome of individual *i*, treatement group.\n\n$Y_{i,0}$ or  $Y(0)$ = Potential outcome of individual *i*, control group.\n\n\n\n\n\n\n\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nSome notation:\n\nThese are the representations of the **causal effect** we often want to estimate.\n\n**Average Treatment Effect:**\n\nATE = $\\frac{1}{N} (E[Y_{i,1}] - E[Y_{i,0}])$\n\n. . . \n\n**Average Treatment Effect on the treated:**\n\nATET = $\\frac{1}{N} (E[Y_{i,1}|D_i=1] - E[Y_{i,0}|D_i=1])$\n\n. . . \n\n**Average Treatment Effect on the untreated:**\n\nATEU = $\\frac{1}{N} (E[Y_{i,1}|D_i=0] - E[Y_{i,0}|D_i=0])$\n\n. . . \n\nOf course, again, we cannot observe both potential outcomes of the same unit *i*.\n\n\n\n\n\n\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nWhen dealing with **causal inference**, we have to find ways to approximate what the hidden potential outcome of the treated units is. \n\nThat is, the challenge in identifying causal effects is that the untreated potential outcomes, $Y_{i,0}$, are never\nobserved for the treated group ($D_i= 1$). The \"second\" term in the following equation:\n\nATET = $\\frac{1}{N} (E[Y_{i,1}|D_i=1] - E[Y_{i,0}|D_i=1])$\n\n\nWe need an empirical design to **\"observe\"** what we do not really observe (i.e., the counterfactual). \n\n\n\n\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nMany options:\n\n- Matching/Balancing\n- Difference-in-differences (DiD)\n- Instrumental variables\n- Regression discontinuity design (RDD)\n- Synthetic control (Synth)\n\n\n\n\n\n\n\n\n## Selection Bias {.smaller background=\"#e3e2b8\"}\n\nThe process of finding units that are comparable is called **matching**.\n\n. . .\n\n**Before we continue...**\n\n**We will match on observables. We cannot be on unobservables.**\n\nThus, you may want to write in your article \"selection bias due to observables\".\n\n. . .\n\n**Cunningham:**\n\n*Propensity score matching has not seen as wide adoption among economists as in other nonexperimental methods like regression discontinuity or difference-in-differences. The most common reason given for this is that economists are oftentimes skeptical that CIA can be achieved in any dataset almost as an article of faith. This is because for many applications, economists as a group are usually more concerned about selection on unobservables than they are selection on observables, and as such, they reach for matching methods less often.*\n\nCIA = CMI\n\n\n\n\n\n\n\n\n# Matching  {.smaller background=\"#e0cafc\"}\n\n## Matching   {.smaller background=\"#e0cafc\"}\n\n**Matching** aims to compare the outcomes between observations that have the same values of all control variables, except that one unit is treated and the other is not. \n\n. . .\n\nIn this literature, the control variables used to matched are often called **covariates**.\n\nThat is, for each treated unit, the researcher finds an untreated unit that is similar in all covariates.\n\nThe implication is that the researcher can argue that \"*units are comparable after matching*\". \n\n\n\n\n\n\n\n## Matching   {.smaller background=\"#e0cafc\"}\n\nThe easiest to see is **exact matching**: *it matches observations that have the exact same values*. \n\n- It might be doable if you have only one covariate. \n\n- Naturally, if you have only one covariate, you might still be left with some selection bias.\n\n  - In the previous example, health history is one important covariate that makes John and Mary different. \n  \n  - But what about life style? Nutrition? Etc. \n  \n\nAs the number of covariates grow, you cannot pursue exact matching. That is the job of PSM.\n\n\n\n\n\n\n\n## Matching   {.smaller background=\"#e0cafc\"}\n\n**In exact matching, the causal effect estimator (ATET) is:**\n\n$$ATET = \\frac{1}{N} \\sum (E[Y_{i}] - E[Y_{j(i)}] | D_i=1)$$\n\nWhere $Y_{j(i)}$ is the j-th unit matched to the i-th unit based on the j-th being “closest to” the i-th unit for some  covariate. \n\nFor instance, let’s say that a unit in the treatment group has a covariate with a value of 2 and we find another unit in the control group (exactly one unit) with a covariate value of 2. \n\nThen we will impute the treatment unit’s missing counterfactual with the matched unit’s, and take a difference.\n\n\n\n\n\n\n\n## Matching {.smaller background=\"#e0cafc\"}\n\nConsider the following dataset from Cunningham:\n\n![](figs/scott.png)\n\n\n\n\n\n## Matching   {.smaller background=\"#e0cafc\"}\n\n::: panel-tabset\n### R Averages\n\nAverage ages are very different. The salary of a 24 yrs old person is quite different than the salary of a 32 yrs person.\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(knitr)\nlibrary(kableExtra)\n\nread_data <- function(df)\n{\n  full_path <- paste(\"https://github.com/scunning1975/mixtape/raw/master/\",df, sep = \"\")\n  df <- read_dta(full_path)\n  return(df)\n}\ntraining_example <- read_data(\"training_example.dta\") %>% slice(1:20)\nsummary(training_example$age_treat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n  18.00   20.25   23.00   24.30   28.50   33.00      10 \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nsummary(training_example$age_control)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  18.00   23.50   31.50   31.95   39.00   51.00 \n```\n\n\n:::\n:::\n\n\n\n### R Treated\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(knitr)\nlibrary(kableExtra)\n\nread_data <- function(df)\n{\n  full_path <- paste(\"https://github.com/scunning1975/mixtape/raw/master/\",df, sep = \"\")\n  df <- read_dta(full_path)\n  return(df)\n}\n\ntraining_example <- read_data(\"training_example.dta\") %>% slice(1:20)\n\nggplot(training_example, aes(x=age_treat)) +\n  stat_bin(bins = 10, na.rm = TRUE)\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-80-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n### R Control\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(knitr)\nlibrary(kableExtra)\n\nread_data <- function(df)\n{\n  full_path <- paste(\"https://github.com/scunning1975/mixtape/raw/master/\",df, sep = \"\")\n  df <- read_dta(full_path)\n  return(df)\n}\n\ntraining_example <- read_data(\"training_example.dta\") %>% slice(1:20)\n\nggplot(training_example, aes(x=age_control)) +\n  stat_bin(bins = 10, na.rm = TRUE)\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-81-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n### R Matched\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(knitr)\nlibrary(kableExtra)\n\nread_data <- function(df)\n{\n  full_path <- paste(\"https://github.com/scunning1975/mixtape/raw/master/\",df, sep = \"\")\n  df <- read_dta(full_path)\n  return(df)\n}\n\ntraining_example <- read_data(\"training_example.dta\") %>% slice(1:20)\n\nggplot(training_example, aes(x=age_matched)) +\n  stat_bin(bins = 10, na.rm = TRUE)\n```\n\n::: {.cell-output-display}\n![](part_3_files/figure-revealjs/unnamed-chunk-82-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n:::\n\n\n\n\n## Matching   {.smaller background=\"#e0cafc\"}\n\nIn this example, you are literally finding the units in the control group that have the same age as the units in the treatment group.\n\nYou are exact matching 1-by-1 in this example.\n\nYou have only one covariate, i.e., age.\n\n\n\n\n\n\n\n\n\n\n\n# Distance Matching  {.smaller background=\"#c6f7ec\"}\n\n## Distance Matching  {.smaller background=\"#c6f7ec\"}\n\nThe last example was simple because you could *exact match*.\n\nIf you cannot find one exact match, you need an approximate match. \n\n. . .\n\nIn order to do that, you have to use distance matching.\n\n**Distance matching** minimizes the distance (i.e., how far the covariates are from each other) between the treatment and control groups.\n\n\n\n\n\n\n\n\n## Distance Matching  {.smaller background=\"#c6f7ec\"}\n\n**Euclidean distance** = $|X_i-X_j|=\\sqrt{(X_i-X_j)'(X_i-X_j)}=\\sqrt{\\sum_{n=1}^k(X_{n,i}-X_{n,j})^2}$\n\n![](figs/euclidian.png)\n\n\n\n## Distance Matching  {.smaller background=\"#c6f7ec\"}\n\n**Normalized Euclidean distance** = $|X_i-X_j|=\\sqrt{(X_i-X_j)'\\hat{V}^{-1}(X_i-X_j)}=\\sqrt{\\sum_{n=1}^k\\frac{(X_{n,i}-X_{n,j})}{\\sigma^2_n}}$\n\nThe problem with this measure of distance is that the distance measure itself depends on the **scale of the variables themselves**. \n\nFor this reason, researchers typically will use some modification of the Euclidean distance, such as the **normalized Euclidean distance**, or they’ll use a wholly different alternative distance. \n\nThe normalized Euclidean distance is a commonly used distance, and what makes it different is that the distance of each variable is scaled by the variable’s variance. \n\n\n \n \n \n \n \n## Distance Matching  {.smaller background=\"#c6f7ec\"}\n\n**Mahalanobis  distance** = $|X_i-X_j|=\\sqrt{(X_i-X_j)'\\hat{\\sum_x}^{-1}(X_i-X_j)}$\n\nWhere $\\hat{\\sum_x}$ is the sample covariance matrix of X.\n\n. . . \n\n![](figs/malahanobis_king_nielsen.png)\n\n\n\n\n\n## Distance Matching  {.smaller background=\"#c6f7ec\"}\n\nDistance matching only goes so far...\n\n... **the larger the dimensionality, the harder is to use distance matching**.\n\nAs sample size increases, for a given N of covariates, the matching discrepancies tend to zero.\n\nBut, the more covariates, the longer it takes.\n\n. . . \n\nAt the end of the day, it is preferable to have many covariates, but it is makes distance matching harder.\n\n\n\n\n\n\n\n\n# Coarsened Exact Matching (CER)  {.smaller background=\"#fce0cc\"}\n\n## Coarsened Exact Matching (CER)  {.smaller background=\"#fce0cc\"}\n\nIn coarsened exact matching, something only counts as a match if it exactly matches on each matching variable. \n\n**The “coarsened” part comes in because, if you have any continuous variables to match on, you need to “coarsen” them first by putting them into bins, rather than matching on exact values.**\n\nCoarsening means creating bins. Fewer bins makes exact matches more likely. \n\n. . .\n\nCER is not used much in empirical research in finance. It is used more in the big data realm when you have many variables to match. \n\n\n\n\n\n\n\n# Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n**PSM is one way to matching using many covariates.** \n\n**PSM aggregates all covariates into one score (propensity-score), which is the likelihood of receiving the treatment.**\n\nThe idea is to match units that, based on observables, have the same probability (called propensity-score) of being treated. \n\n. . .\n\nThe idea is to estimate a probit (default in stata) or logit model (fist stage):\n\n$$P(D=1|X)$$\n\n**The propensity-score is the predicted probability of a unit being treated given all covariates X**. The p-score is just a single number.\n\n\n\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\nConsiderations in PSM.\n\n1) How many neighbors to match?\n\n- Nearest neighbor, radius or kernel?\n\n2) With or without replacement?\n\n3) With or without common support?\n\n- *Common support*: imposes a common support by dropping treatment observations whose pscore is higher than the maximum or less than the minimum pscore of the controls.\n\n4) It is expected that, after PSM, you show the overlap of propensity-scores.\n\n\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n[Source](https://sites.google.com/site/econometricsacademy/home)\n\n**The y-axis is the propensity-score**.\n\n![](figs/ani_katchova1.png)\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n[Source](https://sites.google.com/site/econometricsacademy/home)\n\n**Nearest matching:** Find the observation closest to ($min|p_i-p_j|$)\n\n![](figs/ani_katchova3.png)\n\n\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n[Source](https://sites.google.com/site/econometricsacademy/home)\n\n**Kernel matching:** Each treated observation i is matched with several control observations, with weights inversely proportional to the distance between treated and control observations.\n\n![](figs/ani_katchova2.png)\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n[Source](https://sites.google.com/site/econometricsacademy/home)\n\n**Radius matching**: Each treated observation i is matched with control observations j that fall within a specified radius.\n\n$$|p_i-p_j| <r$$\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n[Source](https://sites.google.com/site/econometricsacademy/home)\n\n**Common support:** Restrict matching only based on the common range of propensity scores.\n\n![](figs/ani_katchova5.png)\n\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\nSeems good overlap, but \"good\" is arbitrary.\n\n![](figs/psm1.png)\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\nSeems bad overlap\n\n![](figs/psm2.png)\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\nSeems good overlap, but \"good\" is arbitrary.\n\n![](figs/psm_graph1.png)\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\nSeems bad overlap\n\n![](figs/psm_graph2.png)\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n![](figs/psm_bias.png)\n\n\n\n\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n![](figs/psm_ttest1.png)\n\n\n## Propensity-score matching (PSM)  {.smaller background=\"#e3bfc3\"}\n\n![](figs/psm_ttest2.png)\n\n\n\n\n\n\n\n\n\n\n# Example  {.smaller background=\"#dff5ce\"}\n\n## Example  {.smaller background=\"#dff5ce\"}\n\nLet's practice with an example. 185 treated units vs 15,992 control units. \n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# Load necessary packages\n# Load necessary libraries\nlibrary(haven)\nlibrary(psych)\ndata <- read_dta(\"files/cps1re74.dta\")\nsummary_stats <- by(data, data$treat, FUN = function(group) {\n  c(\n    mean = mean(group$age, na.rm = TRUE),\n    variance = var(group$age, na.rm = TRUE),\n    skewness = skew(group$age, na.rm = TRUE),\n    count = length(group$age)\n  )\n})\nsummary_df <- as.data.frame(do.call(rbind, summary_stats))\ncolnames(summary_df) <- c(\"mean\", \"variance\", \"skewness\", \"count\")\nprint(summary_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      mean variance  skewness count\n0 33.22524 121.9968 0.3477684 15992\n1 25.81622  51.1943 1.1063375   185\n```\n\n\n:::\n:::\n\n\n### Python\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.python .cell-code  code-fold=\"true\" code-summary=\"Python\" code-line-numbers=\"true\"}\nimport pandas as pd\nfrom scipy.stats import skew\nimport statsmodels.api as sm\ndata = pd.read_stata(\"files/cps1re74.dta\")\ngrouped_data = data.groupby('treat')['age'].agg(['mean', 'var', lambda x: skew(x, nan_policy='omit'), 'count']).reset_index()\ngrouped_data.columns = ['treat', 'mean', 'variance', 'skewness', 'count']\nprint(grouped_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   treat       mean    variance  skewness  count\n0      0  33.225238  121.996792  0.347801  15992\n1      1  25.816216   51.194301  1.115369    185\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/cps1re74.dta, clear\nqui estpost tabstat age black educ , by(treat) c(s) s(me v sk n) nototal\nesttab . \t,varwidth(20) cells(\"mean(fmt(3)) variance(fmt(3)) skewness(fmt(3)) count(fmt(0))\") noobs nonumber compress \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(DW Subset of LaLonde Data)\n\n\n\n------------------------------------------------------------\n                                                            \n                          mean  variance  skewness     count\n------------------------------------------------------------\n0                                                           \nage                     33.225   121.997     0.348     15992\nblack                    0.074     0.068     3.268     15992\neduc                    12.028     8.242    -0.423     15992\n------------------------------------------------------------\n1                                                           \nage                     25.816    51.194     1.115       185\nblack                    0.843     0.133    -1.888       185\neduc                    10.346     4.043    -0.721       185\n------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n## Example  {.smaller background=\"#dff5ce\"}\n\nClearly, the treated group is younger, mainly black, and less educated.\n\nAlso note that the **variance and skewness** of the two subsamples are **different**.\n\nIf we were to use these two subsamples in any econometric analysis **without preprocessing to make them comparable**, we would likely have coefficients biased by **selection bias**.\n\nTherefore, it is important to perform some matching method.\n\nLet's start with Propensity Score Matching (PSM). We will use the simplest matching, that is, without using any additional functions.\n\n\n\n\n\n\n\n\n\n\n## Example  {.smaller background=\"#dff5ce\"}\n\n**Nearest with noreplacement.**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# install.packages(\"MatchIt\")\nlibrary(haven)\nlibrary(psych)\nlibrary(MatchIt)\ndata <- read_dta(\"files/cps1re74.dta\")\nmodel <- matchit(treat ~ age + black + educ, data = data, method = \"nearest\")\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nmatchit(formula = treat ~ age + black + educ, data = data, method = \"nearest\")\n\nSummary of Balance for All Data:\n         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance        0.1445        0.0099          1.3615     7.5662    0.4987\nage            25.8162       33.2252         -1.0355     0.4196    0.1863\nblack           0.8432        0.0735          2.1171          .    0.7697\neduc           10.3459       12.0275         -0.8363     0.4905    0.0908\n         eCDF Max\ndistance   0.7741\nage        0.3427\nblack      0.7697\neduc       0.4123\n\nSummary of Balance for Matched Data:\n         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance        0.1445        0.1443          0.0020     1.0039    0.0002\nage            25.8162       25.7081          0.0151     0.9244    0.0073\nblack           0.8432        0.8432          0.0000          .    0.0000\neduc           10.3459       10.4054         -0.0296     0.7190    0.0117\n         eCDF Max Std. Pair Dist.\ndistance   0.0162          0.0029\nage        0.0270          0.1481\nblack      0.0000          0.0000\neduc       0.0432          0.2554\n\nSample Sizes:\n          Control Treated\nAll         15992     185\nMatched       185     185\nUnmatched   15807       0\nDiscarded       0       0\n```\n\n\n:::\n:::\n\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/cps1re74.dta, clear\npsmatch2 treat age black educ , n(1) noreplacement\nsum _weight , d\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(DW Subset of LaLonde Data)\n\n\nProbit regression                                       Number of obs = 16,177\n                                                        LR chi2(3)    = 752.47\n                                                        Prob > chi2   = 0.0000\nLog likelihood = -634.83401                             Pseudo R2     = 0.3721\n\n------------------------------------------------------------------------------\n       treat | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n         age |  -.0379829   .0042976    -8.84   0.000     -.046406   -.0295598\n       black |   1.700675   .0793898    21.42   0.000     1.545074    1.856277\n        educ |  -.0806962   .0142167    -5.68   0.000    -.1085604    -.052832\n       _cons |  -.9031083   .2123282    -4.25   0.000    -1.319264   -.4869526\n------------------------------------------------------------------------------\n\n            psmatch2: weight of matched controls\n-------------------------------------------------------------\n      Percentiles      Smallest\n 1%            1              1\n 5%            1              1\n10%            1              1       Obs                 370\n25%            1              1       Sum of wgt.         370\n\n50%            1                      Mean                  1\n                        Largest       Std. dev.             0\n75%            1              1\n90%            1              1       Variance              0\n95%            1              1       Skewness              .\n99%            1              1       Kurtosis              .\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n## Example  {.smaller background=\"#dff5ce\"}\n\n**Notice that we are creating weights now**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# install.packages(\"MatchIt\")\nlibrary(haven)\nlibrary(MatchIt)\ndata <- read_dta(\"files/cps1re74.dta\")\nmodel <- matchit(treat ~ age + black + educ, data = data, method = \"exact\")\nsummary(model$weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n 0.0000  0.0000  0.0000  0.1457  0.0000 52.7952 \n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/cps1re74.dta, clear\nqui psmatch2 treat age black educ , kernel\nsum _weight , d\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(DW Subset of LaLonde Data)\n\n            psmatch2: weight of matched controls\n-------------------------------------------------------------\n      Percentiles      Smallest\n 1%     .0024355       .0007862\n 5%     .0024375       .0024348\n10%       .00244       .0024348       Obs              16,177\n25%     .0024517       .0024348       Sum of wgt.      16,177\n\n50%     .0024919                      Mean            .022872\n                        Largest       Std. dev.      .1130791\n75%     .0026476              1\n90%     .0038379              1       Variance       .0127869\n95%     .0876547              1       Skewness       7.604874\n99%            1              1       Kurtosis       64.26276\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n## Example  {.smaller background=\"#dff5ce\"}\n\n**Now, the descriptive statistics are much closer**\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(haven)\nlibrary(MatchIt)\n#install.packages(\"e1071\")\nlibrary(e1071)\ndata <- read_dta(\"files/cps1re74.dta\")\nmodel <- matchit(treat ~ age + black + educ, data = data, method = \"exact\")\nmatched_data <- match.data(model)\nsummary_stats <- by(matched_data, matched_data$treat, function(x) {\n  c(mean(x$age), var(x$age), skewness(x$age), length(x$age))\n})\n\nresult_df <- data.frame(\n  Treatment = c(\"Control\", \"Treated\"),\n  Mean_Age = sapply(summary_stats, function(x) x[1]),\n  Variance_Age = sapply(summary_stats, function(x) x[2]),\n  Skewness_Age = sapply(summary_stats, function(x) x[3]),\n  Count = sapply(summary_stats, function(x) x[4])\n)\nprint(result_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Treatment Mean_Age Variance_Age Skewness_Age Count\n0   Control 25.58786     39.16294    0.7826941  2191\n1   Treated 25.51807     51.59664    1.1298334   166\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/cps1re74.dta, clear\nqui psmatch2 treat age black educ , kernel\nqui estpost tabstat age black educ [aweight = _weight], by(treat) c(s) s(me v sk n) nototal\nesttab . \t,varwidth(20) cells(\"mean(fmt(3)) variance(fmt(3)) skewness(fmt(3)) count(fmt(0))\") noobs  nonumber compress \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(DW Subset of LaLonde Data)\n\n\n\n\n------------------------------------------------------------\n                                                            \n                          mean  variance  skewness     count\n------------------------------------------------------------\n0                                                           \nage                     27.033    85.548     1.077     15992\nblack                    0.791     0.165    -1.434     15992\neduc                    10.710     8.146    -0.883     15992\n------------------------------------------------------------\n1                                                           \nage                     25.816    51.194     1.115       185\nblack                    0.843     0.133    -1.888       185\neduc                    10.346     4.043    -0.721       185\n------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Entropy Balancing  {.smaller background=\"#fccad9\"}\n\n## Entropy Balancing  {.smaller background=\"#fccad9\"}\n\n**Here, instead of matching units, we reweight the observations such that the moments of the distributions (mean, variance, skewness) are similar.**\n\n- The ebalance function implements a reweighting scheme. The user starts by choosing the covariates that should be included in the reweighting. \n\n- For each covariate, the user then specifies a set of balance constraints (in Equation 5) to equate the moments of the covariate distribution between the treatment and the reweighted control group. \n\n- The moment constraints may include the mean (first moment), the variance (second moment), and the skewness (third moment).\n\n**The outcome is a vector containing the weights to weight the observations, such that the weighted average, weighted variance, and weighted skewness of the covariates in control group are similar to those in the treatment group**\n\n\n\n\n\n\n\n\n\n\n## Entropy Balancing  {.smaller background=\"#fccad9\"}\n\n\n::: panel-tabset\n### R\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\nlibrary(haven)\n#install.packages(\"ebal\")\nlibrary(ebal)\ndata <- read_dta(\"files/cps1re74.dta\")\ntreatment <-cbind(data$treat)\nvars <-cbind(data$age, data$educ, data$black)\neb <- ebalance(treatment, vars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConverged within tolerance \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# means in treatment group data\napply(vars[treatment==1,],2,mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 25.8162162 10.3459459  0.8432432\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# means in reweighted control group data\napply(vars[treatment==0,],2,weighted.mean,w=eb$w)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 25.8163688 10.3460391  0.8431526\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R\" code-line-numbers=\"true\"}\n# means in raw data control group data\napply(vars[treatment==0,],2,mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 33.22523762 12.02751376  0.07353677\n```\n\n\n:::\n:::\n\n\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/cps1re74.dta, clear\nebalance treat age black educ, targets(3)\n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(DW Subset of LaLonde Data)\n\n\n\nData Setup\nTreatment variable:   treat\nCovariate adjustment: age black educ (1st order). age black educ (2nd order). a\n> ge black educ (3rd order).\n\n\nOptimizing...\nIteration 1: Max Difference = 580799.347\nIteration 2: Max Difference = 213665.688\nIteration 3: Max Difference = 78604.7628\nIteration 4: Max Difference = 28918.6249\nIteration 5: Max Difference = 10640.1108\nIteration 6: Max Difference = 3915.82197\nIteration 7: Max Difference = 1442.09731\nIteration 8: Max Difference = 532.07826\nIteration 9: Max Difference = 197.376777\nIteration 10: Max Difference = 74.6380533\nIteration 11: Max Difference = 29.9524313\nIteration 12: Max Difference = 11.4337344\nIteration 13: Max Difference = 4.43722698\nIteration 14: Max Difference = 1.76899046\nIteration 15: Max Difference = .420548538\nIteration 16: Max Difference = .037814194\nIteration 17: Max Difference = .001164231\nmaximum difference smaller than the tolerance level; convergence achieved\n\n\nTreated units: 185     total of weights: 185\nControl units: 15992   total of weights: 185\n\n\nBefore: without weighting\n\n             |              Treat              |        Control       \n             |      mean   variance   skewness |      mean   variance \n-------------+---------------------------------+----------------------\n         age |     25.82      51.19      1.115 |     33.23        122 \n       black |     .8432      .1329     -1.888 |    .07354     .06813 \n        educ |     10.35      4.043     -.7212 |     12.03      8.242 \n\n             |  Control  \n             |  skewness \n-------------+-----------\n         age |     .3478 \n       black |     3.268 \n        educ |    -.4233 \n\n\nAfter:  _webal as the weighting variable\n\n             |              Treat              |        Control       \n             |      mean   variance   skewness |      mean   variance \n-------------+---------------------------------+----------------------\n         age |     25.82      51.19      1.115 |      25.8      51.17 \n       black |     .8432      .1329     -1.888 |     .8421       .133 \n        educ |     10.35      4.043     -.7212 |     10.34       4.04 \n\n             |  Control  \n             |  skewness \n-------------+-----------\n         age |     1.122 \n       black |    -1.877 \n        educ |    -.7121 \n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n## Entropy Balancing  {.smaller background=\"#fccad9\"}\n\n\n::: panel-tabset\n### Stata\n\n\n::: {.cell layout-align=\"center\" output-location='default'}\n\n```{.stata .cell-code  code-fold=\"true\" code-summary=\"Stata\" code-line-numbers=\"true\"}\nuse files/cps1re74.dta, clear\nqui ebalance treat age black educ, targets(3)\nqui estpost tabstat age black educ [aweight = _webal], by(treat) c(s) s(me v sk n) nototal\nesttab . \t,varwidth(20) cells(\"mean(fmt(3)) variance(fmt(3)) skewness(fmt(3)) count(fmt(0))\") noobs  nonumber compress \n```\n\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(DW Subset of LaLonde Data)\n\n\n\n\n------------------------------------------------------------\n                                                            \n                          mean  variance  skewness     count\n------------------------------------------------------------\n0                                                           \nage                     25.801    51.167     1.122     15992\nblack                    0.842     0.133    -1.877     15992\neduc                    10.340     4.040    -0.712     15992\n------------------------------------------------------------\n1                                                           \nage                     25.816    51.194     1.115       185\nblack                    0.843     0.133    -1.888       185\neduc                    10.346     4.043    -0.721       185\n------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n:::\n\n\n\n\n\n## THANK YOU!\n\n::: columns\n::: {.column width=\"30%\"}\n![](figs/fgv.png){fig-align=\"right\"}\n:::\n\n::: {.column width=\"70%\"}\n**Henrique Castro Martins**\n\n-   [henrique.martins\\@fgv.br](henrique.martins@fgv.br)\n-   <https://eaesp.fgv.br/en/people/henrique-castro-martins>\n-   [henriquemartins.net](https://henriquemartins.net/)\n-   <https://www.linkedin.com/in/henriquecastror/>\n:::\n:::\n",
    "supporting": [
      "part_3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{"title":"Empirical Methods in Finance","markdown":{"yaml":{"title":"Empirical Methods in Finance","subtitle":"Part 11","author":"Henrique C. Martins","format":{"revealjs":{"slide-number":true,"theme":"simple","chalkboard":true,"preview-links":"auto","logo":"figs/background8.png","css":"logo.css","footer":"**[**Henrique C. Martins**] [[henrique.martins@fgv.br](mailto:henrique.martins@fgv.br)][Do not use without permission]**  ","scrollable":true}},"title-slide-attributes":{"data-background-color":"#b1cafa"},"include-after":"<script type=\"text/javascript\">\n  Reveal.on('ready', event => {\n    if (event.indexh === 0) {\n      document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n    }\n  });\n  Reveal.addEventListener('slidechanged', (event) => {\n    if (event.indexh === 0) {\n      Reveal.configure({ slideNumber: null });\n      document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n    }\n    if (event.indexh === 1) {\n      Reveal.configure({ slideNumber: 'c' });\n      document.querySelector(\"div.has-logo > img.slide-logo\").style.display = null;\n    }\n  });\n</script>\n"},"headingText":"Introduction","headingAttr":{"id":"","classes":["smaller"],"keyvalue":[["background","#bcd3f7"]]},"containsRefs":false,"markdown":"\n\n\n\n\n\n```{r setup}\n#| include: false\n#| warning: false\n\nlibrary(quantmod)\nlibrary(tidyverse)\n```\n\n\n\n\n\n## Introduction {.smaller background=\"#bcd3f7\"}\n\n- *Event studies* measure the impact of a specific event on stock returns.  \n- Widely used in empirical finance:  \n  - Earnings announcements  \n  - Mergers and acquisitions  \n  - SEOs/IPOs  \n  - Credit rating downgrades  \n  - Regulatory changes  \n\n\n> “Using financial market data, an event study measures the impact of a specific event on the value of a firm.” (MacKinlay, 1997)\n\n\n## Introduction {.smaller background=\"#bcd3f7\"}\n\n\n_The event study is probably the oldest and simplest causal inference research design._\n\n_It predates experiments. It predates statistics. It probably predates human language. It might predate humans._\n\n_The idea is this: at a certain time, an event occured, leading a treatment to be put into place at that time. Whatever changed from before the event to after is the effect of that treatment._\n\n[(The Effect)](https://theeffectbook.net/ch-EventStudies.html)\n\n\n\n## {.smaller background=\"#bcd3f7\"}\n\n\n![](figs/eventstudies.png)\n\n## Introduction [(The Effect)](https://theeffectbook.net/ch-EventStudies.html) {.smaller background=\"#bcd3f7\"}\n\n\n**The process for doing one of these event studies is as follows:**\n\n1) Pick an “estimation period” a fair bit before the event, and an “observation period” from just before the event to the period of interest after the event.\n\n. . .\n\n2) Use the data from the estimation period to estimate a model that can make a prediction of the stock’s return in each period. A popular way of doing this are:\n\n- Risk-adjusted returns model. Use the data from the estimation period to fit a regression describing how related the return \n is to other market portfolios, like the market return: $R=\\alpha + \\beta \\times R_m$. Then, in the observation period, use that model and the actual \n to predict in each period.\n\n## Introduction [(The Effect)](https://theeffectbook.net/ch-EventStudies.html) {.smaller background=\"#bcd3f7\"}\n\n3) In the observation period, subtract the prediction from the actual return to get the “abnormal return.” \n\n - $AR = R - \\hat{R}$\n \n. . . \n\n4) Look at $AR$ in the observation period. Nonzero values before the event imply the event was anticipated, and nonzero values after the event give the effect of the event on the stock’s return. \n\n\n \n## Introduction {.smaller background=\"#bcd3f7\"}\n\n \n![](figs/eventstudies2.png)\n\n\n\n\n\n\n\n\n\n\n# Methodology {.smaller background=\"#8eadde\"}\n\n## Steps of an Event Study {.smaller background=\"#8eadde\"}\n\nThe central idea: measure **abnormal returns (AR)**.\n\n$$AR_{it} = R_{it} - E[R_{it}|X_t]$$\n\n\n1. Define **event date** (day 0).  \n2. Select **event window** (e.g., [-1,+1], [-5,+5]).  \n3. Select **estimation window** (e.g., -120 to -20 days).  \n4. Estimate expected returns (Market Model, CAPM, Fama-French).  \n5. Compute **abnormal returns (AR)**.  \n6. Compute **cumulative abnormal returns (CAR)**.  \n7. Test statistical significance.  \n\n\n\n\n## Expected Return Models {.smaller background=\"#8eadde\"}\n\n- **Market Model**:  \n  $$R_{it} = \\alpha_i + \\beta_i R_{mt} + \\epsilon_{it}$$  \n\n- **CAPM**: includes risk-free rate.  \n- **Fama-French**: adds size (SMB), value (HML), momentum (MOM).  \n\n. . .\n\nChoice of model depends on context, data availability, and assumptions.\n\n\n\n\n\n\n\n\n\n\n## Visualizing an Event {.smaller background=\"#d2e2fc\"}\n\n\n\n\n- Day 0 = Event date  \n- Look at pre- and post-event stock returns  \n- Identify abnormal spikes relative to “normal” variation  \n\n\n\n\n\n\n\n\n## Example: Earnings Announcement {.smaller background=\"#d2e2fc\"}\n\n**Objective:** Does Apple’s quarterly earnings announcement affect its stock price?  \n\n- Event: 15 July 2023  \n- Estimation window: 120 days before event  \n- Event window: [-5,+5]  \n\n\n\n\n\n\n\n# Example in R {.smaller background=\"#abc8f5\"}\n\n---\n\n## Apple closing price (Adjusted) {.smaller background=\"#e9f7ef\"}\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Data\ngetSymbols(\"AAPL\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\n\n# Ajustado (considera splits/dividendos). Se preferir o close \"bruto\", troque Ad(AAPL) por Cl(AAPL).\naapl_xts <- Ad(AAPL)\naapl_df  <- tibble(\n  date = as.Date(index(aapl_xts)),\n  adj_close = as.numeric(aapl_xts)\n)\n\n# Plot clean em azul-escuro\nggplot(aapl_df, aes(x = date, y = adj_close)) +\n  geom_line(linewidth = 1.1, color = \"#0b3d91\") +\n  labs(title = \"Apple – Adjusted Closing Price (2023)\",\n       x = NULL, y = \"USD\") +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\"),\n    axis.title.y = element_text(margin = margin(r = 8))\n  )\n```\n\n---\n\n## S&P 500 closing price (Adjusted) {.smaller background=\"#e9f7ef\"}\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Data\ngetSymbols(\"^GSPC\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\n\nsp500_xts <- Ad(GSPC)\nsp500_df  <- tibble(\n  date = as.Date(index(sp500_xts)),\n  adj_close = as.numeric(sp500_xts)\n)\n\n# Plot clean em verde-escuro\nggplot(sp500_df, aes(x = date, y = adj_close)) +\n  geom_line(linewidth = 1.1, color = \"#006400\") +\n  labs(title = \"S&P 500 – Adjusted Closing Price (2023)\",\n       x = NULL, y = \"Index Points\") +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\"),\n    axis.title.y = element_text(margin = margin(r = 8))\n  )\n```\n\n\n\n\n\n\n## Apple vs S&P 500 (Normalized to 100) {.smaller background=\"#e9f7ef\"}\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Data\ngetSymbols(\"AAPL\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\ngetSymbols(\"^GSPC\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\n\n# Preços ajustados\naapl_xts  <- Ad(AAPL)\nsp500_xts <- Ad(GSPC)\n\n# Normalizar para 100 no início\naapl_norm  <- as.numeric(aapl_xts)  / as.numeric(first(aapl_xts))  * 100\nsp500_norm <- as.numeric(sp500_xts) / as.numeric(first(sp500_xts)) * 100\n\ndf <- tibble(\n  date = as.Date(index(aapl_xts)),\n  Apple = aapl_norm,\n  SP500 = sp500_norm\n) %>% pivot_longer(-date, names_to = \"Asset\", values_to = \"Index\")\n\n# Plot\nggplot(df, aes(x = date, y = Index, color = Asset)) +\n  geom_line(linewidth = 1.1) +\n  scale_color_manual(values = c(\"Apple\" = \"#0b3d91\", \"SP500\" = \"#006400\")) +\n  labs(title = \"Apple vs S&P 500 (Normalized Prices, 2023)\",\n       x = NULL, y = \"Index (start = 100)\", color = NULL) +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\"),\n    legend.position = \"bottom\",\n    axis.title.y = element_text(margin = margin(r = 8))\n  )\n```\n\n\n\n\n\n\n## Step 1 – Compute Returns and  Market Model {.smaller background=\"#e9f7ef\"}\n\nWe now move from **prices** to **daily returns**.  \nThis allows us to estimate the *Market Model* using OLS on the **estimation window**.\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Compute daily returns\nret_aapl <- dailyReturn(Ad(AAPL))\nret_mkt  <- dailyReturn(Ad(GSPC))\n\n# Define event date and estimation window (120 days before)\nevent_date <- as.Date(\"2023-07-15\")\nestimation_window <- index(ret_aapl) < event_date & \n                     index(ret_aapl) >= (event_date - 180)  # ~6 months before\n\n# Estimate Market Model via OLS\nfit <- lm(ret_aapl[estimation_window] ~ ret_mkt[estimation_window])\n\nsummary(fit)\n```\n\n\n\n\n\n## Step 2 – Compute Abnormal Returns (AR) {.smaller background=\"#e9f7ef\"}\n\nOnce we have the estimated parameters ($\\hat{\\alpha}$, $\\hat{\\beta}$),we can compute **expected returns** and the **abnormal returns**:\n\n$\\hat{R}_{i,t} = \\hat{\\alpha} + \\hat{\\beta} R_{m,t}$\n\n$AR_{i,t} = R_{i,t} - \\hat{R}_{i,t}$\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n# Predicted returns from the Market Model\npred <- predict(fit, newdata = data.frame(ret_mkt = ret_mkt))\n\n# Abnormal returns\nar <- ret_aapl - pred\n\nhead(ar, 10)   # first 10 abnormal returns\n```\n\nAR > 0: Apple outperformed the market on that day\n\nAR < 0: Apple underperformed the market on that day\n\n\n\n\n\n\n\n\n## Step 3 – Compute CAR {.smaller background=\"#e9f7ef\"}\n\nTo capture the **aggregate effect** of the event, we sum abnormal returns over the event window:\n\n$CAR_{i}(t_1,t_2) = \\sum_{t=t_1}^{t_2} AR_{i,t}$\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n# Define event window: 5 days before and after\nwindow <- (index(ret_aapl) >= (event_date - 5)) &\n          (index(ret_aapl) <= (event_date + 5))\n\n# Cumulative abnormal returns\ncar <- cumsum(ar[window])\n\ncar\n```\n\nA positive CAR suggests good news (value creation).\n\nA negative CAR suggests bad news (value destruction).\n\n\n\n\n\n\n\n## Step 4 – Visualize CAR {.smaller background=\"#e9f7ef\"}\n\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n# Extract abnormal returns only for the event window\nar_window <- ar[window]\n\n# Recalculate CAR starting at 0\ncar <- cumsum(as.numeric(ar_window))\n\n# Plot corrected CAR\nplot(index(ar_window), car, type = \"l\", col = \"#0b3d91\", lwd = 2,\n     main = \"Cumulative Abnormal Returns (CAR) – Event Window\",\n     xlab = \"Date\", ylab = \"CAR\")\nabline(v = event_date, col = \"red\", lwd = 2, lty = 2)\n```\n\n\n\n## {.smaller background=\"#e9f7ef\"}\n\nWhat is the CAR in this window?\n\n- **Estimation window**: 120 trading days before the event (used to estimate the market model).  \n- **Event window**: [-5, +5] days around the event date (used to measure the abnormal impact).  \n- The **CAR (Cumulative Abnormal Return)** is the sum of abnormal returns across this event window.  \n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\nar_window <- ar[window]                  # abnormal returns in the event window [-5,+5]\ncar <- cumsum(as.numeric(ar_window))     # cumulative abnormal returns, starting at 0\nCAR_total <- last(car)                   # CAR over the full event window\nCAR_total\n\n\n```\n\n\n\n\n\n## Robustness table {.smaller background=\"#e9f7ef\"}\n\n```{r}\n\n#| warning: false\n#| message: false\n#| echo: true\n#| code-fold: true\nlibrary(quantmod)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(knitr)\n\n# 1) Garantir dados alinhados e sem NAs (usaremos 'ret_aapl' e 'ret_mkt' já criados)\ndf_ret <- tibble(\n  date = as.Date(index(ret_aapl)),\n  aapl = as.numeric(ret_aapl),\n  mkt  = as.numeric(ret_mkt)\n) %>% drop_na()\n\n# 2) Parâmetros de robustez\nest_days_vec  <- c(60, 120, 180)                       # estimation windows (days before event)\nevent_windows <- list(c(-3, 3), c(-5, 5), c(-10, 10))  # event windows [t1, t2]\n\nrobust_tbl <- list()\n\nfor (E in est_days_vec) {\n  # Estimation window: E dias antes do evento (usando datas do df_ret)\n  est_mask <- df_ret$date < event_date & df_ret$date >= (event_date - E)\n  df_est   <- df_ret[est_mask, ]\n\n  # Estima Market Model no período de estimação\n  fit_E <- lm(aapl ~ mkt, data = df_est)\n  summ  <- summary(fit_E)\n\n  alpha <- coef(fit_E)[1]\n  beta  <- coef(fit_E)[2]\n  r2    <- summ$r.squared\n  n_est <- nrow(df_est)\n\n  for (ew in event_windows) {\n    t1 <- ew[1]; t2 <- ew[2]\n    ev_mask <- df_ret$date >= (event_date + t1) & df_ret$date <= (event_date + t2)\n    df_ev   <- df_ret[ev_mask, ]\n    n_ev    <- nrow(df_ev)\n\n    # Predição no event window usando o MESMO nome de regressor ('mkt')\n    pred_ev <- predict(fit_E, newdata = df_ev)\n\n    # AR e CAR (CAR começa em 0 dentro da janela)\n    ar_ev     <- df_ev$aapl - pred_ev\n    CAR_total <- sum(ar_ev, na.rm = TRUE)\n\n    # t-stat didático para o CAR: t = CAR / (sd(AR) * sqrt(n))\n    t_car <- if (n_ev > 1 && sd(ar_ev, na.rm = TRUE) > 0) {\n      CAR_total / (sd(ar_ev, na.rm = TRUE) * sqrt(n_ev))\n    } else { NA_real_ }\n\n    robust_tbl[[length(robust_tbl) + 1]] <- tibble(\n      est_window_days = E,\n      event_window    = sprintf(\"[%+d,%+d]\", t1, t2),\n      n_est           = n_est,\n      n_event         = n_ev,\n      alpha_hat       = alpha,\n      beta_hat        = beta,\n      CAR             = CAR_total,\n      t_CAR           = t_car\n    )\n  }\n}\n\nrobust_tbl <- bind_rows(robust_tbl) %>% arrange(est_window_days, event_window)\n\n# 3) Tabela bonita\nrobust_tbl %>%\n  mutate(\n    alpha_hat     = round(alpha_hat, 5),\n    beta_hat      = round(beta_hat, 3),\n    CAR           = round(CAR, 4),\n    t_CAR         = round(t_CAR, 2)\n  ) %>%\n  kable(caption = \"CAR robustness across estimation and event windows\")\n```\n\n\n\n# Extensions  {.smaller background=\"#e9f7ef\"}\n\n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Multiple events**  \n  - Often researchers examine a *wave* of events (e.g., several M&As in one industry, multiple SEOs).  \n  - Challenge: heterogeneity across firms and event timing. Aggregation must be justified.  \n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Clustering of events**  \n  - Many events occur on the same date (e.g., quarterly earnings announcements).  \n  - Standard errors may be underestimated if cross-sectional dependence is ignored.  \n  - Solutions: event-time portfolios, clustered or robust standard errors.  \n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Confounding events**  \n  - Other major news may coincide with the focal event (e.g., macro policy change).  \n  - Makes it difficult to attribute abnormal returns exclusively to the event of interest.  \n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Long-horizon event studies**  \n  - Extending the event window to months/years raises econometric issues.  \n  - CARs accumulate model error and are sensitive to the choice of expected-return model.  \n  - Interpretation becomes less about short-term information effects, more about long-run performance.  \n\n\n\n\n\n\n# Final Comments {.smaller background=\"#95a9c7\"}\n\n## Final Comments {.smaller background=\"#95a9c7\"}\n\n- Event studies are powerful and widely used.  \n- Results depend heavily on:  \n  - Correct identification of the event  \n  - Appropriate choice of estimation model  \n  - Robustness checks  \n\n. . .\n\n**Easy to run, hard to interpret.**\n\n\n\n\n\n## 🙋‍♂️ **Any Questions?**{ .smaller  background=\"#fdf6e3\"}\n\n::: columns\n::: {.column width=\"50%\"}\n### Thank You!\n\n![](figs/qa2.png){width=\"110%\" style=\"box-shadow: none;\"}\n\n:::\n\n::: {.column width=\"50%\"}\n<div style=\"text-align:right;\">\n  <img src=\"figs/avatar.jpg\" width=\"120px\" style=\"border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);\" />\n</div>\n\n### **Henrique C. Martins**\n\n- 🌐 [FGV/EAESP](https://eaesp.fgv.br/en/people/henrique-castro-martins)  \n- 💼 [LinkedIn](https://www.linkedin.com/in/henriquecastror/)  \n- 🧠 [Google Scholar](https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&hl=pt-BR&oi=ao)  \n- 📄 [Lattes CV](http://lattes.cnpq.br/6076997472159785)  \n- 🏠 [Personal Website](https://henriquemartins.net/)  \n:::\n:::\n\n\n","srcMarkdownNoYaml":"\n\n\n\n\n\n```{r setup}\n#| include: false\n#| warning: false\n\nlibrary(quantmod)\nlibrary(tidyverse)\n```\n\n\n\n\n# Introduction {.smaller background=\"#bcd3f7\"}\n\n## Introduction {.smaller background=\"#bcd3f7\"}\n\n- *Event studies* measure the impact of a specific event on stock returns.  \n- Widely used in empirical finance:  \n  - Earnings announcements  \n  - Mergers and acquisitions  \n  - SEOs/IPOs  \n  - Credit rating downgrades  \n  - Regulatory changes  \n\n\n> “Using financial market data, an event study measures the impact of a specific event on the value of a firm.” (MacKinlay, 1997)\n\n\n## Introduction {.smaller background=\"#bcd3f7\"}\n\n\n_The event study is probably the oldest and simplest causal inference research design._\n\n_It predates experiments. It predates statistics. It probably predates human language. It might predate humans._\n\n_The idea is this: at a certain time, an event occured, leading a treatment to be put into place at that time. Whatever changed from before the event to after is the effect of that treatment._\n\n[(The Effect)](https://theeffectbook.net/ch-EventStudies.html)\n\n\n\n## {.smaller background=\"#bcd3f7\"}\n\n\n![](figs/eventstudies.png)\n\n## Introduction [(The Effect)](https://theeffectbook.net/ch-EventStudies.html) {.smaller background=\"#bcd3f7\"}\n\n\n**The process for doing one of these event studies is as follows:**\n\n1) Pick an “estimation period” a fair bit before the event, and an “observation period” from just before the event to the period of interest after the event.\n\n. . .\n\n2) Use the data from the estimation period to estimate a model that can make a prediction of the stock’s return in each period. A popular way of doing this are:\n\n- Risk-adjusted returns model. Use the data from the estimation period to fit a regression describing how related the return \n is to other market portfolios, like the market return: $R=\\alpha + \\beta \\times R_m$. Then, in the observation period, use that model and the actual \n to predict in each period.\n\n## Introduction [(The Effect)](https://theeffectbook.net/ch-EventStudies.html) {.smaller background=\"#bcd3f7\"}\n\n3) In the observation period, subtract the prediction from the actual return to get the “abnormal return.” \n\n - $AR = R - \\hat{R}$\n \n. . . \n\n4) Look at $AR$ in the observation period. Nonzero values before the event imply the event was anticipated, and nonzero values after the event give the effect of the event on the stock’s return. \n\n\n \n## Introduction {.smaller background=\"#bcd3f7\"}\n\n \n![](figs/eventstudies2.png)\n\n\n\n\n\n\n\n\n\n\n# Methodology {.smaller background=\"#8eadde\"}\n\n## Steps of an Event Study {.smaller background=\"#8eadde\"}\n\nThe central idea: measure **abnormal returns (AR)**.\n\n$$AR_{it} = R_{it} - E[R_{it}|X_t]$$\n\n\n1. Define **event date** (day 0).  \n2. Select **event window** (e.g., [-1,+1], [-5,+5]).  \n3. Select **estimation window** (e.g., -120 to -20 days).  \n4. Estimate expected returns (Market Model, CAPM, Fama-French).  \n5. Compute **abnormal returns (AR)**.  \n6. Compute **cumulative abnormal returns (CAR)**.  \n7. Test statistical significance.  \n\n\n\n\n## Expected Return Models {.smaller background=\"#8eadde\"}\n\n- **Market Model**:  \n  $$R_{it} = \\alpha_i + \\beta_i R_{mt} + \\epsilon_{it}$$  \n\n- **CAPM**: includes risk-free rate.  \n- **Fama-French**: adds size (SMB), value (HML), momentum (MOM).  \n\n. . .\n\nChoice of model depends on context, data availability, and assumptions.\n\n\n\n\n\n\n\n\n\n\n## Visualizing an Event {.smaller background=\"#d2e2fc\"}\n\n\n\n\n- Day 0 = Event date  \n- Look at pre- and post-event stock returns  \n- Identify abnormal spikes relative to “normal” variation  \n\n\n\n\n\n\n\n\n## Example: Earnings Announcement {.smaller background=\"#d2e2fc\"}\n\n**Objective:** Does Apple’s quarterly earnings announcement affect its stock price?  \n\n- Event: 15 July 2023  \n- Estimation window: 120 days before event  \n- Event window: [-5,+5]  \n\n\n\n\n\n\n\n# Example in R {.smaller background=\"#abc8f5\"}\n\n---\n\n## Apple closing price (Adjusted) {.smaller background=\"#e9f7ef\"}\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Data\ngetSymbols(\"AAPL\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\n\n# Ajustado (considera splits/dividendos). Se preferir o close \"bruto\", troque Ad(AAPL) por Cl(AAPL).\naapl_xts <- Ad(AAPL)\naapl_df  <- tibble(\n  date = as.Date(index(aapl_xts)),\n  adj_close = as.numeric(aapl_xts)\n)\n\n# Plot clean em azul-escuro\nggplot(aapl_df, aes(x = date, y = adj_close)) +\n  geom_line(linewidth = 1.1, color = \"#0b3d91\") +\n  labs(title = \"Apple – Adjusted Closing Price (2023)\",\n       x = NULL, y = \"USD\") +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\"),\n    axis.title.y = element_text(margin = margin(r = 8))\n  )\n```\n\n---\n\n## S&P 500 closing price (Adjusted) {.smaller background=\"#e9f7ef\"}\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Data\ngetSymbols(\"^GSPC\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\n\nsp500_xts <- Ad(GSPC)\nsp500_df  <- tibble(\n  date = as.Date(index(sp500_xts)),\n  adj_close = as.numeric(sp500_xts)\n)\n\n# Plot clean em verde-escuro\nggplot(sp500_df, aes(x = date, y = adj_close)) +\n  geom_line(linewidth = 1.1, color = \"#006400\") +\n  labs(title = \"S&P 500 – Adjusted Closing Price (2023)\",\n       x = NULL, y = \"Index Points\") +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\"),\n    axis.title.y = element_text(margin = margin(r = 8))\n  )\n```\n\n\n\n\n\n\n## Apple vs S&P 500 (Normalized to 100) {.smaller background=\"#e9f7ef\"}\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Data\ngetSymbols(\"AAPL\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\ngetSymbols(\"^GSPC\", from = \"2023-01-01\", to = \"2023-12-31\", auto.assign = TRUE)\n\n# Preços ajustados\naapl_xts  <- Ad(AAPL)\nsp500_xts <- Ad(GSPC)\n\n# Normalizar para 100 no início\naapl_norm  <- as.numeric(aapl_xts)  / as.numeric(first(aapl_xts))  * 100\nsp500_norm <- as.numeric(sp500_xts) / as.numeric(first(sp500_xts)) * 100\n\ndf <- tibble(\n  date = as.Date(index(aapl_xts)),\n  Apple = aapl_norm,\n  SP500 = sp500_norm\n) %>% pivot_longer(-date, names_to = \"Asset\", values_to = \"Index\")\n\n# Plot\nggplot(df, aes(x = date, y = Index, color = Asset)) +\n  geom_line(linewidth = 1.1) +\n  scale_color_manual(values = c(\"Apple\" = \"#0b3d91\", \"SP500\" = \"#006400\")) +\n  labs(title = \"Apple vs S&P 500 (Normalized Prices, 2023)\",\n       x = NULL, y = \"Index (start = 100)\", color = NULL) +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\"),\n    legend.position = \"bottom\",\n    axis.title.y = element_text(margin = margin(r = 8))\n  )\n```\n\n\n\n\n\n\n## Step 1 – Compute Returns and  Market Model {.smaller background=\"#e9f7ef\"}\n\nWe now move from **prices** to **daily returns**.  \nThis allows us to estimate the *Market Model* using OLS on the **estimation window**.\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n\n\nlibrary(quantmod)\nlibrary(tidyverse)\n\n# Compute daily returns\nret_aapl <- dailyReturn(Ad(AAPL))\nret_mkt  <- dailyReturn(Ad(GSPC))\n\n# Define event date and estimation window (120 days before)\nevent_date <- as.Date(\"2023-07-15\")\nestimation_window <- index(ret_aapl) < event_date & \n                     index(ret_aapl) >= (event_date - 180)  # ~6 months before\n\n# Estimate Market Model via OLS\nfit <- lm(ret_aapl[estimation_window] ~ ret_mkt[estimation_window])\n\nsummary(fit)\n```\n\n\n\n\n\n## Step 2 – Compute Abnormal Returns (AR) {.smaller background=\"#e9f7ef\"}\n\nOnce we have the estimated parameters ($\\hat{\\alpha}$, $\\hat{\\beta}$),we can compute **expected returns** and the **abnormal returns**:\n\n$\\hat{R}_{i,t} = \\hat{\\alpha} + \\hat{\\beta} R_{m,t}$\n\n$AR_{i,t} = R_{i,t} - \\hat{R}_{i,t}$\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n# Predicted returns from the Market Model\npred <- predict(fit, newdata = data.frame(ret_mkt = ret_mkt))\n\n# Abnormal returns\nar <- ret_aapl - pred\n\nhead(ar, 10)   # first 10 abnormal returns\n```\n\nAR > 0: Apple outperformed the market on that day\n\nAR < 0: Apple underperformed the market on that day\n\n\n\n\n\n\n\n\n## Step 3 – Compute CAR {.smaller background=\"#e9f7ef\"}\n\nTo capture the **aggregate effect** of the event, we sum abnormal returns over the event window:\n\n$CAR_{i}(t_1,t_2) = \\sum_{t=t_1}^{t_2} AR_{i,t}$\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n# Define event window: 5 days before and after\nwindow <- (index(ret_aapl) >= (event_date - 5)) &\n          (index(ret_aapl) <= (event_date + 5))\n\n# Cumulative abnormal returns\ncar <- cumsum(ar[window])\n\ncar\n```\n\nA positive CAR suggests good news (value creation).\n\nA negative CAR suggests bad news (value destruction).\n\n\n\n\n\n\n\n## Step 4 – Visualize CAR {.smaller background=\"#e9f7ef\"}\n\n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\n# Extract abnormal returns only for the event window\nar_window <- ar[window]\n\n# Recalculate CAR starting at 0\ncar <- cumsum(as.numeric(ar_window))\n\n# Plot corrected CAR\nplot(index(ar_window), car, type = \"l\", col = \"#0b3d91\", lwd = 2,\n     main = \"Cumulative Abnormal Returns (CAR) – Event Window\",\n     xlab = \"Date\", ylab = \"CAR\")\nabline(v = event_date, col = \"red\", lwd = 2, lty = 2)\n```\n\n\n\n## {.smaller background=\"#e9f7ef\"}\n\nWhat is the CAR in this window?\n\n- **Estimation window**: 120 trading days before the event (used to estimate the market model).  \n- **Event window**: [-5, +5] days around the event date (used to measure the abnormal impact).  \n- The **CAR (Cumulative Abnormal Return)** is the sum of abnormal returns across this event window.  \n\n```{r}\n#| warning: false\n#| message: false\n#| fig-align: center\n#| echo: true\n#| code-fold: true\nar_window <- ar[window]                  # abnormal returns in the event window [-5,+5]\ncar <- cumsum(as.numeric(ar_window))     # cumulative abnormal returns, starting at 0\nCAR_total <- last(car)                   # CAR over the full event window\nCAR_total\n\n\n```\n\n\n\n\n\n## Robustness table {.smaller background=\"#e9f7ef\"}\n\n```{r}\n\n#| warning: false\n#| message: false\n#| echo: true\n#| code-fold: true\nlibrary(quantmod)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(knitr)\n\n# 1) Garantir dados alinhados e sem NAs (usaremos 'ret_aapl' e 'ret_mkt' já criados)\ndf_ret <- tibble(\n  date = as.Date(index(ret_aapl)),\n  aapl = as.numeric(ret_aapl),\n  mkt  = as.numeric(ret_mkt)\n) %>% drop_na()\n\n# 2) Parâmetros de robustez\nest_days_vec  <- c(60, 120, 180)                       # estimation windows (days before event)\nevent_windows <- list(c(-3, 3), c(-5, 5), c(-10, 10))  # event windows [t1, t2]\n\nrobust_tbl <- list()\n\nfor (E in est_days_vec) {\n  # Estimation window: E dias antes do evento (usando datas do df_ret)\n  est_mask <- df_ret$date < event_date & df_ret$date >= (event_date - E)\n  df_est   <- df_ret[est_mask, ]\n\n  # Estima Market Model no período de estimação\n  fit_E <- lm(aapl ~ mkt, data = df_est)\n  summ  <- summary(fit_E)\n\n  alpha <- coef(fit_E)[1]\n  beta  <- coef(fit_E)[2]\n  r2    <- summ$r.squared\n  n_est <- nrow(df_est)\n\n  for (ew in event_windows) {\n    t1 <- ew[1]; t2 <- ew[2]\n    ev_mask <- df_ret$date >= (event_date + t1) & df_ret$date <= (event_date + t2)\n    df_ev   <- df_ret[ev_mask, ]\n    n_ev    <- nrow(df_ev)\n\n    # Predição no event window usando o MESMO nome de regressor ('mkt')\n    pred_ev <- predict(fit_E, newdata = df_ev)\n\n    # AR e CAR (CAR começa em 0 dentro da janela)\n    ar_ev     <- df_ev$aapl - pred_ev\n    CAR_total <- sum(ar_ev, na.rm = TRUE)\n\n    # t-stat didático para o CAR: t = CAR / (sd(AR) * sqrt(n))\n    t_car <- if (n_ev > 1 && sd(ar_ev, na.rm = TRUE) > 0) {\n      CAR_total / (sd(ar_ev, na.rm = TRUE) * sqrt(n_ev))\n    } else { NA_real_ }\n\n    robust_tbl[[length(robust_tbl) + 1]] <- tibble(\n      est_window_days = E,\n      event_window    = sprintf(\"[%+d,%+d]\", t1, t2),\n      n_est           = n_est,\n      n_event         = n_ev,\n      alpha_hat       = alpha,\n      beta_hat        = beta,\n      CAR             = CAR_total,\n      t_CAR           = t_car\n    )\n  }\n}\n\nrobust_tbl <- bind_rows(robust_tbl) %>% arrange(est_window_days, event_window)\n\n# 3) Tabela bonita\nrobust_tbl %>%\n  mutate(\n    alpha_hat     = round(alpha_hat, 5),\n    beta_hat      = round(beta_hat, 3),\n    CAR           = round(CAR, 4),\n    t_CAR         = round(t_CAR, 2)\n  ) %>%\n  kable(caption = \"CAR robustness across estimation and event windows\")\n```\n\n\n\n# Extensions  {.smaller background=\"#e9f7ef\"}\n\n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Multiple events**  \n  - Often researchers examine a *wave* of events (e.g., several M&As in one industry, multiple SEOs).  \n  - Challenge: heterogeneity across firms and event timing. Aggregation must be justified.  \n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Clustering of events**  \n  - Many events occur on the same date (e.g., quarterly earnings announcements).  \n  - Standard errors may be underestimated if cross-sectional dependence is ignored.  \n  - Solutions: event-time portfolios, clustered or robust standard errors.  \n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Confounding events**  \n  - Other major news may coincide with the focal event (e.g., macro policy change).  \n  - Makes it difficult to attribute abnormal returns exclusively to the event of interest.  \n\n## Extensions and Practical Challenges {.smaller background=\"#e9f7ef\"}\n\n- **Long-horizon event studies**  \n  - Extending the event window to months/years raises econometric issues.  \n  - CARs accumulate model error and are sensitive to the choice of expected-return model.  \n  - Interpretation becomes less about short-term information effects, more about long-run performance.  \n\n\n\n\n\n\n# Final Comments {.smaller background=\"#95a9c7\"}\n\n## Final Comments {.smaller background=\"#95a9c7\"}\n\n- Event studies are powerful and widely used.  \n- Results depend heavily on:  \n  - Correct identification of the event  \n  - Appropriate choice of estimation model  \n  - Robustness checks  \n\n. . .\n\n**Easy to run, hard to interpret.**\n\n\n\n\n\n## 🙋‍♂️ **Any Questions?**{ .smaller  background=\"#fdf6e3\"}\n\n::: columns\n::: {.column width=\"50%\"}\n### Thank You!\n\n![](figs/qa2.png){width=\"110%\" style=\"box-shadow: none;\"}\n\n:::\n\n::: {.column width=\"50%\"}\n<div style=\"text-align:right;\">\n  <img src=\"figs/avatar.jpg\" width=\"120px\" style=\"border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);\" />\n</div>\n\n### **Henrique C. Martins**\n\n- 🌐 [FGV/EAESP](https://eaesp.fgv.br/en/people/henrique-castro-martins)  \n- 💼 [LinkedIn](https://www.linkedin.com/in/henriquecastror/)  \n- 🧠 [Google Scholar](https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&hl=pt-BR&oi=ao)  \n- 📄 [Lattes CV](http://lattes.cnpq.br/6076997472159785)  \n- 🏠 [Personal Website](https://henriquemartins.net/)  \n:::\n:::\n\n\n"},"formats":{"revealjs":{"identifier":{"display-name":"RevealJS","target-format":"revealjs","base-format":"revealjs"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","css":["logo.css"],"output-file":"part_11.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.4.549","auto-stretch":true,"html":{"css":"webex.css","include-after-body":"webex.js"},"editor":"visual","title":"Empirical Methods in Finance","subtitle":"Part 11","author":"Henrique C. Martins","title-slide-attributes":{"data-background-color":"#b1cafa"},"include-after":["<script type=\"text/javascript\">\n  Reveal.on('ready', event => {\n    if (event.indexh === 0) {\n      document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n    }\n  });\n  Reveal.addEventListener('slidechanged', (event) => {\n    if (event.indexh === 0) {\n      Reveal.configure({ slideNumber: null });\n      document.querySelector(\"div.has-logo > img.slide-logo\").style.display = \"none\";\n    }\n    if (event.indexh === 1) {\n      Reveal.configure({ slideNumber: 'c' });\n      document.querySelector(\"div.has-logo > img.slide-logo\").style.display = null;\n    }\n  });\n</script>\n"],"slideNumber":true,"theme":"simple","chalkboard":true,"previewLinks":"auto","logo":"figs/background8.png","footer":"**[**Henrique C. Martins**] [[henrique.martins@fgv.br](mailto:henrique.martins@fgv.br)][Do not use without permission]**  ","scrollable":true}}},"projectFormats":["html"]}
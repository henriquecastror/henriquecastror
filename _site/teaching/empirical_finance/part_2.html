<!DOCTYPE html>
<html lang="en"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Henrique C. Martins">
  <title>Henrique Castro Martins - Inferência Causal</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="styles.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-771J5563G0"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-771J5563G0', { 'anonymize_ip': true});
  </script>
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta name="twitter:title" content="Henrique Castro Martins - Inferência Causal">
<meta name="twitter:description" content="Part 2">
<meta name="twitter:card" content="summary">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Inferência Causal</h1>
  <p class="subtitle">Part 2</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Henrique C. Martins 
</div>
</div>
</div>

</section>
<section>
<section id="selection-bias" class="title-slide slide level1 smaller center" data-background="#f7e8dc">
<h1>Selection Bias</h1>

</section>
<section id="selection-bias-1" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>Back to the selection bias example of before.</p>
<ul>
<li><p>Imagine that John and Mary are moving to the north of Canada.</p></li>
<li><p>John has a history of respiratory disease and decide to buy insurance.</p></li>
<li><p>Mary does not have a history of respiratory disease and decide not to buy insurance.</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Default</th>
<th style="text-align: left;">John</th>
<th style="text-align: right;">Mary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>State of insurance</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>Situation without insurance</td>
<td style="text-align: left;"><code>3</code></td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td>Situation with insurance</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;"><code>5</code></td>
</tr>
<tr class="even">
<td>Observed</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td>Effect</td>
<td style="text-align: left;">?</td>
<td style="text-align: right;">?</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[(Y_{1,john} - Y_{0,john}) + (Y_{1,Mary}- Y_{0,Mary}) = 4 - 3 + 5 - 5 = 0.5\]</span></p>
</section>
<section id="selection-bias-2" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>Rearranging the terms:</p>
<p><span class="math display">\[(Y_{1,john} - Y_{0,Mary})   + (Y_{1,Mary}  - Y_{0,john})  = (4 - 5) + (5 - 3)  = 0.5\]</span> <span class="math display">\[We\;see   + We\;do\;not\;see  = (4 - 5) + (5 - 3)  = 0.5\]</span></p>
<p>The term <span class="math inline">\((Y_{1,Mary}  - Y_{0,john}) =  (5 - 3) = 2\)</span> is the <strong>selection bias</strong>.</p>
<p>It exists because we are comparing two people that should not be compared.</p>
</section>
<section id="selection-bias-3" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>Some notation:</p>
<p><span class="math inline">\(d=1\)</span> for the treated units (treatment group)</p>
<p><span class="math inline">\(d=0\)</span> for the treated units (control group)</p>
<div class="fragment">
<p><span class="math inline">\(Y_{i}\)</span> = Potential outcome of individual <em>i</em>.</p>
<p><span class="math inline">\(Y_{i,1}\)</span> or <span class="math inline">\(Y(1)\)</span> = Potential outcome of individual <em>i</em>, treatement group.</p>
<p><span class="math inline">\(Y_{i,0}\)</span> or <span class="math inline">\(Y(0)\)</span> = Potential outcome of individual <em>i</em>, control group.</p>
</div>
</section>
<section id="selection-bias-4" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>Some notation:</p>
<p>These are the representations of the <strong>causal effect</strong> we often want to estimate.</p>
<p><strong>Average Treatment Effect:</strong></p>
<p>ATE = <span class="math inline">\(\frac{1}{N} (E[Y_{i,1}] - E[Y_{i,0}])\)</span></p>
<div class="fragment">
<p><strong>Average Treatment Effect on the treated:</strong></p>
<p>ATET = <span class="math inline">\(\frac{1}{N} (E[Y_{i,1}|D_i=1] - E[Y_{i,0}|D_i=1])\)</span></p>
</div>
<div class="fragment">
<p><strong>Average Treatment Effect on the untreated:</strong></p>
<p>ATEU = <span class="math inline">\(\frac{1}{N} (E[Y_{i,1}|D_i=0] - E[Y_{i,0}|D_i=0])\)</span></p>
</div>
<div class="fragment">
<p>Of course, again, we cannot observe both potential outcomes of the same unit <em>i</em>.</p>
</div>
</section>
<section id="selection-bias-5" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>When dealing with <strong>causal inference</strong>, we have to find ways to approximate what the hidden potential outcome of the treated units is.</p>
<p>That is, the challenge in identifying causal effects is that the untreated potential outcomes, <span class="math inline">\(Y_{i,0}\)</span>, are never observed for the treated group (<span class="math inline">\(D_i= 1\)</span>). The “second” term in the following equation:</p>
<p>ATET = <span class="math inline">\(\frac{1}{N} (E[Y_{i,1}|D_i=1] - E[Y_{i,0}|D_i=1])\)</span></p>
<p>We need an empirical design to <strong>“observe”</strong> what we do not really observe (i.e., the counterfactual).</p>
</section>
<section id="selection-bias-6" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>Many options:</p>
<ul>
<li>Matching/Balancing</li>
<li>Difference-in-differences (DiD)</li>
<li>Instrumental variables</li>
<li>Regression discontinuity design (RDD)</li>
<li>Synthetic control (Synth)</li>
</ul>
</section>
<section id="selection-bias-7" class="slide level2 smaller" data-background="#f7e8dc">
<h2>Selection Bias</h2>
<p>The process of finding units that are comparable is called <strong>matching</strong>.</p>
<div class="fragment">
<p><strong>Before we continue…</strong></p>
<p><strong>We will match on observables. We cannot be on unobservables.</strong></p>
<p>Thus, you may want to write in your article “selection bias due to observables”.</p>
</div>
<div class="fragment">
<p><strong>Cunningham:</strong></p>
<p><em>Propensity score matching has not seen as wide adoption among economists as in other nonexperimental methods like regression discontinuity or difference-in-differences. The most common reason given for this is that economists are oftentimes skeptical that CIA can be achieved in any dataset almost as an article of faith. This is because for many applications, economists as a group are usually more concerned about selection on unobservables than they are selection on observables, and as such, they reach for matching methods less often.</em></p>
<p>CIA = CMI</p>
</div>
</section></section>
<section>
<section id="matching" class="title-slide slide level1 smaller center" data-background="#f2d5bf">
<h1>Matching</h1>

</section>
<section id="matching-1" class="slide level2 smaller" data-background="#f2d5bf">
<h2>Matching</h2>
<p><strong>Matching</strong> aims to compare the outcomes between observations that have the same values of all control variables, except that one unit is treated and the other is not.</p>
<div class="fragment">
<p>In this literature, the control variables used to matched are often called <strong>covariates</strong>.</p>
<p>That is, for each treated unit, the researcher finds an untreated unit that is similar in all covariates.</p>
<p>The implication is that the researcher can argue that “<em>units are comparable after matching</em>”.</p>
</div>
</section>
<section id="matching-2" class="slide level2 smaller" data-background="#f2d5bf">
<h2>Matching</h2>
<p>The easiest to see is <strong>exact matching</strong>: <em>it matches observations that have the exact same values</em>.</p>
<ul>
<li><p>It might be doable if you have only one covariate.</p></li>
<li><p>Naturally, if you have only one covariate, you might still be left with some selection bias.</p>
<ul>
<li><p>In the previous example, health history is one important covariate that makes John and Mary different.</p></li>
<li><p>But what about life style? Nutrition? Etc.</p></li>
</ul></li>
</ul>
<p>As the number of covariates grow, you cannot pursue exact matching. That is the job of PSM.</p>
</section>
<section id="matching-3" class="slide level2 smaller" data-background="#f2d5bf">
<h2>Matching</h2>
<p><strong>In exact matching, the causal effect estimator (ATET) is:</strong></p>
<p><span class="math display">\[ATET = \frac{1}{N} \sum (E[Y_{i}] - E[Y_{j(i)}] | D_i=1)\]</span></p>
<p>Where <span class="math inline">\(Y_{j(i)}\)</span> is the j-th unit matched to the i-th unit based on the j-th being “closest to” the i-th unit for some covariate.</p>
<p>For instance, let’s say that a unit in the treatment group has a covariate with a value of 2 and we find another unit in the control group (exactly one unit) with a covariate value of 2.</p>
<p>Then we will impute the treatment unit’s missing counterfactual with the matched unit’s, and take a difference.</p>
</section>
<section id="matching-4" class="slide level2 smaller" data-background="#f2d5bf">
<h2>Matching</h2>
<p>Consider the following dataset from Cunningham:</p>

<img data-src="figs/scott.png" class="r-stretch"></section>
<section id="matching-5" class="slide level2 smaller" data-background="#f2d5bf">
<h2>Matching</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">R Averages</a></li><li><a href="#tabset-1-2">R Treated</a></li><li><a href="#tabset-1-3">R Control</a></li><li><a href="#tabset-1-4">R Matched</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<p>Average ages are very different. The salary of a 24 yrs old person is quite different than the salary of a 32 yrs person.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># Load necessary packages</span></span>
<span id="cb1-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb1-4"><a></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-5"><a></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-6"><a></a></span>
<span id="cb1-7"><a></a>read_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb1-8"><a></a>{</span>
<span id="cb1-9"><a></a>  full_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://github.com/scunning1975/mixtape/raw/master/"</span>,df, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb1-10"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(full_path)</span>
<span id="cb1-11"><a></a>  <span class="fu">return</span>(df)</span>
<span id="cb1-12"><a></a>}</span>
<span id="cb1-13"><a></a>training_example <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"training_example.dta"</span>) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb1-14"><a></a><span class="fu">summary</span>(training_example<span class="sc">$</span>age_treat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  18.00   20.25   23.00   24.30   28.50   33.00      10 </code></pre>
</div>
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">summary</span>(training_example<span class="sc">$</span>age_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  18.00   23.50   31.50   31.95   39.00   51.00 </code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="co"># Load necessary packages</span></span>
<span id="cb5-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb5-4"><a></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-5"><a></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb5-6"><a></a></span>
<span id="cb5-7"><a></a>read_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb5-8"><a></a>{</span>
<span id="cb5-9"><a></a>  full_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://github.com/scunning1975/mixtape/raw/master/"</span>,df, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb5-10"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(full_path)</span>
<span id="cb5-11"><a></a>  <span class="fu">return</span>(df)</span>
<span id="cb5-12"><a></a>}</span>
<span id="cb5-13"><a></a></span>
<span id="cb5-14"><a></a>training_example <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"training_example.dta"</span>) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb5-15"><a></a></span>
<span id="cb5-16"><a></a><span class="fu">ggplot</span>(training_example, <span class="fu">aes</span>(<span class="at">x=</span>age_treat)) <span class="sc">+</span></span>
<span id="cb5-17"><a></a>  <span class="fu">stat_bin</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-2-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="co"># Load necessary packages</span></span>
<span id="cb6-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-3"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb6-4"><a></a><span class="fu">library</span>(knitr)</span>
<span id="cb6-5"><a></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb6-6"><a></a></span>
<span id="cb6-7"><a></a>read_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb6-8"><a></a>{</span>
<span id="cb6-9"><a></a>  full_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://github.com/scunning1975/mixtape/raw/master/"</span>,df, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb6-10"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(full_path)</span>
<span id="cb6-11"><a></a>  <span class="fu">return</span>(df)</span>
<span id="cb6-12"><a></a>}</span>
<span id="cb6-13"><a></a></span>
<span id="cb6-14"><a></a>training_example <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"training_example.dta"</span>) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb6-15"><a></a></span>
<span id="cb6-16"><a></a><span class="fu">ggplot</span>(training_example, <span class="fu">aes</span>(<span class="at">x=</span>age_control)) <span class="sc">+</span></span>
<span id="cb6-17"><a></a>  <span class="fu">stat_bin</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-3-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># Load necessary packages</span></span>
<span id="cb7-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-3"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb7-4"><a></a><span class="fu">library</span>(knitr)</span>
<span id="cb7-5"><a></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb7-6"><a></a></span>
<span id="cb7-7"><a></a>read_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb7-8"><a></a>{</span>
<span id="cb7-9"><a></a>  full_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://github.com/scunning1975/mixtape/raw/master/"</span>,df, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb7-10"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(full_path)</span>
<span id="cb7-11"><a></a>  <span class="fu">return</span>(df)</span>
<span id="cb7-12"><a></a>}</span>
<span id="cb7-13"><a></a></span>
<span id="cb7-14"><a></a>training_example <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"training_example.dta"</span>) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb7-15"><a></a></span>
<span id="cb7-16"><a></a><span class="fu">ggplot</span>(training_example, <span class="fu">aes</span>(<span class="at">x=</span>age_matched)) <span class="sc">+</span></span>
<span id="cb7-17"><a></a>  <span class="fu">stat_bin</span>(<span class="at">bins =</span> <span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-4-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="matching-6" class="slide level2 smaller" data-background="#f2d5bf">
<h2>Matching</h2>
<p>In this example, you are literally finding the units in the control group that have the same age as the units in the treatment group.</p>
<p>You are exact matching 1-by-1 in this example.</p>
<p>You have only one covariate, i.e., age.</p>
</section></section>
<section>
<section id="distance-matching" class="title-slide slide level1 smaller center" data-background="#d4b8a3">
<h1>Distance Matching</h1>

</section>
<section id="distance-matching-1" class="slide level2 smaller" data-background="#d4b8a3">
<h2>Distance Matching</h2>
<p>The last example was simple because you could <em>exact match</em>.</p>
<p>If you cannot find one exact match, you need an approximate match.</p>
<div class="fragment">
<p>In order to do that, you have to use distance matching.</p>
<p><strong>Distance matching</strong> minimizes the distance (i.e., how far the covariates are from each other) between the treatment and control groups.</p>
</div>
</section>
<section id="distance-matching-2" class="slide level2 smaller" data-background="#d4b8a3">
<h2>Distance Matching</h2>
<p><strong>Euclidean distance</strong> = <span class="math inline">\(|X_i-X_j|=\sqrt{(X_i-X_j)'(X_i-X_j)}=\sqrt{\sum_{n=1}^k(X_{n,i}-X_{n,j})^2}\)</span></p>

<img data-src="figs/euclidian.png" class="r-stretch"></section>
<section id="distance-matching-3" class="slide level2 smaller" data-background="#d4b8a3">
<h2>Distance Matching</h2>
<p><strong>Normalized Euclidean distance</strong> = <span class="math inline">\(|X_i-X_j|=\sqrt{(X_i-X_j)'\hat{V}^{-1}(X_i-X_j)}=\sqrt{\sum_{n=1}^k\frac{(X_{n,i}-X_{n,j})}{\sigma^2_n}}\)</span></p>
<p>The problem with this measure of distance is that the distance measure itself depends on the <strong>scale of the variables themselves</strong>.</p>
<p>For this reason, researchers typically will use some modification of the Euclidean distance, such as the <strong>normalized Euclidean distance</strong>, or they’ll use a wholly different alternative distance.</p>
<p>The normalized Euclidean distance is a commonly used distance, and what makes it different is that the distance of each variable is scaled by the variable’s variance.</p>
</section>
<section id="distance-matching-4" class="slide level2 smaller" data-background="#d4b8a3">
<h2>Distance Matching</h2>
<p><strong>Mahalanobis distance</strong> = <span class="math inline">\(|X_i-X_j|=\sqrt{(X_i-X_j)'\hat{\sum_x}^{-1}(X_i-X_j)}\)</span></p>
<p>Where <span class="math inline">\(\hat{\sum_x}\)</span> is the sample covariance matrix of X.</p>
<div class="fragment">
<p><img data-src="figs/malahanobis_king_nielsen.png"></p>
</div>
</section>
<section id="distance-matching-5" class="slide level2 smaller" data-background="#d4b8a3">
<h2>Distance Matching</h2>
<p>Distance matching only goes so far…</p>
<p>… <strong>the larger the dimensionality, the harder is to use distance matching</strong>.</p>
<p>As sample size increases, for a given N of covariates, the matching discrepancies tend to zero.</p>
<p>But, the more covariates, the longer it takes.</p>
<div class="fragment">
<p>At the end of the day, it is preferable to have many covariates, but it is makes distance matching harder.</p>
</div>
</section></section>
<section>
<section id="coarsened-exact-matching-cer" class="title-slide slide level1 smaller center" data-background="#fce0cc">
<h1>Coarsened Exact Matching (CER)</h1>

</section>
<section id="coarsened-exact-matching-cer-1" class="slide level2 smaller" data-background="#fce0cc">
<h2>Coarsened Exact Matching (CER)</h2>
<p>In coarsened exact matching, something only counts as a match if it exactly matches on each matching variable.</p>
<p><strong>The “coarsened” part comes in because, if you have any continuous variables to match on, you need to “coarsen” them first by putting them into bins, rather than matching on exact values.</strong></p>
<p>Coarsening means creating bins. Fewer bins makes exact matches more likely.</p>
<div class="fragment">
<p>CER is not used much in empirical research in finance. It is used more in the big data realm when you have many variables to match.</p>
</div>
</section></section>
<section>
<section id="propensity-score-matching-psm" class="title-slide slide level1 smaller center" data-background="#f7dfcd">
<h1>Propensity-score matching (PSM)</h1>

</section>
<section id="propensity-score-matching-psm-1" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p><strong>PSM is one way to matching using many covariates.</strong></p>
<p><strong>PSM aggregates all covariates into one score (propensity-score), which is the likelihood of receiving the treatment.</strong></p>
<p>The idea is to match units that, based on observables, have the same probability (called propensity-score) of being treated.</p>
<div class="fragment">
<p>The idea is to estimate a probit (default in stata) or logit model (fist stage):</p>
<p><span class="math display">\[P(D=1|X)\]</span></p>
<p><strong>The propensity-score is the predicted probability of a unit being treated given all covariates X</strong>. The p-score is just a single number.</p>
</div>
</section>
<section id="propensity-score-matching-psm-2" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p>Considerations in PSM.</p>
<ol type="1">
<li>How many neighbors to match?</li>
</ol>
<ul>
<li>Nearest neighbor, radius or kernel?</li>
</ul>
<ol start="2" type="1">
<li><p>With or without replacement?</p></li>
<li><p>With or without common support?</p></li>
</ol>
<ul>
<li><em>Common support</em>: imposes a common support by dropping treatment observations whose pscore is higher than the maximum or less than the minimum pscore of the controls.</li>
</ul>
<ol start="4" type="1">
<li>It is expected that, after PSM, you show the overlap of propensity-scores.</li>
</ol>
</section>
<section id="propensity-score-matching-psm-3" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p><a href="https://sites.google.com/site/econometricsacademy/home">Source</a></p>
<p><strong>The y-axis is the propensity-score</strong>.</p>

<img data-src="figs/ani_katchova1.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-4" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p><a href="https://sites.google.com/site/econometricsacademy/home">Source</a></p>
<p><strong>Nearest matching:</strong> Find the observation closest to (<span class="math inline">\(min|p_i-p_j|\)</span>)</p>

<img data-src="figs/ani_katchova3.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-5" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p><a href="https://sites.google.com/site/econometricsacademy/home">Source</a></p>
<p><strong>Kernel matching:</strong> Each treated observation i is matched with several control observations, with weights inversely proportional to the distance between treated and control observations.</p>

<img data-src="figs/ani_katchova2.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-6" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p><a href="https://sites.google.com/site/econometricsacademy/home">Source</a></p>
<p><strong>Radius matching</strong>: Each treated observation i is matched with control observations j that fall within a specified radius.</p>
<p><span class="math display">\[|p_i-p_j| &lt;r\]</span></p>
</section>
<section id="propensity-score-matching-psm-7" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p><a href="https://sites.google.com/site/econometricsacademy/home">Source</a></p>
<p><strong>Common support:</strong> Restrict matching only based on the common range of propensity scores.</p>

<img data-src="figs/ani_katchova5.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-8" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p>Seems good overlap, but “good” is arbitrary.</p>

<img data-src="figs/psm1.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-9" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p>Seems bad overlap</p>

<img data-src="figs/psm2.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-10" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p>Seems good overlap, but “good” is arbitrary.</p>

<img data-src="figs/psm_graph1.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-11" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>
<p>Seems bad overlap</p>

<img data-src="figs/psm_graph2.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-12" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>

<img data-src="figs/psm_bias.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-13" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>

<img data-src="figs/psm_ttest1.png" class="r-stretch"></section>
<section id="propensity-score-matching-psm-14" class="slide level2 smaller" data-background="#f7dfcd">
<h2>Propensity-score matching (PSM)</h2>

<img data-src="figs/psm_ttest2.png" class="r-stretch"></section></section>
<section>
<section id="example" class="title-slide slide level1 smaller center" data-background="#debda4">
<h1>Example</h1>

</section>
<section id="example-1" class="slide level2 smaller" data-background="#debda4">
<h2>Example</h2>
<p>Let’s practice with an example. 185 treated units vs 15,992 control units.</p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">R</a></li><li><a href="#tabset-2-2">Python</a></li><li><a href="#tabset-2-3">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co"># Load necessary packages</span></span>
<span id="cb8-2"><a></a><span class="co"># Load necessary libraries</span></span>
<span id="cb8-3"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb8-4"><a></a><span class="fu">library</span>(psych)</span>
<span id="cb8-5"><a></a>data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"files/cps1re74.dta"</span>)</span>
<span id="cb8-6"><a></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">by</span>(data, data<span class="sc">$</span>treat, <span class="at">FUN =</span> <span class="cf">function</span>(group) {</span>
<span id="cb8-7"><a></a>  <span class="fu">c</span>(</span>
<span id="cb8-8"><a></a>    <span class="at">mean =</span> <span class="fu">mean</span>(group<span class="sc">$</span>age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-9"><a></a>    <span class="at">variance =</span> <span class="fu">var</span>(group<span class="sc">$</span>age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-10"><a></a>    <span class="at">skewness =</span> <span class="fu">skew</span>(group<span class="sc">$</span>age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-11"><a></a>    <span class="at">count =</span> <span class="fu">length</span>(group<span class="sc">$</span>age)</span>
<span id="cb8-12"><a></a>  )</span>
<span id="cb8-13"><a></a>})</span>
<span id="cb8-14"><a></a>summary_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, summary_stats))</span>
<span id="cb8-15"><a></a><span class="fu">colnames</span>(summary_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"variance"</span>, <span class="st">"skewness"</span>, <span class="st">"count"</span>)</span>
<span id="cb8-16"><a></a><span class="fu">print</span>(summary_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mean variance  skewness count
0 33.22524 121.9968 0.3477684 15992
1 25.81622  51.1943 1.1063375   185</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Python</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a></a><span class="im">from</span> scipy.stats <span class="im">import</span> skew</span>
<span id="cb10-3"><a></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb10-4"><a></a>data <span class="op">=</span> pd.read_stata(<span class="st">"files/cps1re74.dta"</span>)</span>
<span id="cb10-5"><a></a>grouped_data <span class="op">=</span> data.groupby(<span class="st">'treat'</span>)[<span class="st">'age'</span>].agg([<span class="st">'mean'</span>, <span class="st">'var'</span>, <span class="kw">lambda</span> x: skew(x, nan_policy<span class="op">=</span><span class="st">'omit'</span>), <span class="st">'count'</span>]).reset_index()</span>
<span id="cb10-6"><a></a>grouped_data.columns <span class="op">=</span> [<span class="st">'treat'</span>, <span class="st">'mean'</span>, <span class="st">'variance'</span>, <span class="st">'skewness'</span>, <span class="st">'count'</span>]</span>
<span id="cb10-7"><a></a><span class="bu">print</span>(grouped_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   treat       mean    variance  skewness  count
0      0  33.225238  121.996792  0.347801  15992
1      1  25.816216   51.194301  1.115369    185</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><a></a><span class="kw">use</span> files/cps1re74.dta, <span class="kw">clear</span></span>
<span id="cb12-2"><a></a><span class="kw">qui</span> estpost <span class="kw">tabstat</span> age <span class="bn">black</span> educ , <span class="kw">by</span>(treat) c(<span class="fu">s</span>) <span class="fu">s</span>(me v sk n) <span class="kw">nototal</span></span>
<span id="cb12-3"><a></a>esttab .    ,varwidth(20) cells(<span class="st">"mean(fmt(3)) variance(fmt(3)) skewness(fmt(3)) count(fmt(0))"</span>) <span class="kw">noobs</span> nonumber <span class="kw">compress</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(DW Subset of LaLonde Data)



------------------------------------------------------------
                                                            
                          mean  variance  skewness     count
------------------------------------------------------------
0                                                           
age                     33.225   121.997     0.348     15992
black                    0.074     0.068     3.268     15992
educ                    12.028     8.242    -0.423     15992
------------------------------------------------------------
1                                                           
age                     25.816    51.194     1.115       185
black                    0.843     0.133    -1.888       185
educ                    10.346     4.043    -0.721       185
------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-2" class="slide level2 smaller" data-background="#debda4">
<h2>Example</h2>
<p>Clearly, the treated group is younger, mainly black, and less educated.</p>
<p>Also note that the <strong>variance and skewness</strong> of the two subsamples are <strong>different</strong>.</p>
<p>If we were to use these two subsamples in any econometric analysis <strong>without preprocessing to make them comparable</strong>, we would likely have coefficients biased by <strong>selection bias</strong>.</p>
<p>Therefore, it is important to perform some matching method.</p>
<p>Let’s start with Propensity Score Matching (PSM). We will use the simplest matching, that is, without using any additional functions.</p>
</section>
<section id="example-3" class="slide level2 smaller" data-background="#debda4">
<h2>Example</h2>
<p><strong>Nearest with noreplacement.</strong></p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">R</a></li><li><a href="#tabset-3-2">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="co"># install.packages("MatchIt")</span></span>
<span id="cb14-2"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb14-3"><a></a><span class="fu">library</span>(psych)</span>
<span id="cb14-4"><a></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb14-5"><a></a>data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"files/cps1re74.dta"</span>)</span>
<span id="cb14-6"><a></a>model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> black <span class="sc">+</span> educ, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"nearest"</span>)</span>
<span id="cb14-7"><a></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = treat ~ age + black + educ, data = data, method = "nearest")

Summary of Balance for All Data:
         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance        0.1445        0.0099          1.3615     7.5662    0.4987
age            25.8162       33.2252         -1.0355     0.4196    0.1863
black           0.8432        0.0735          2.1171          .    0.7697
educ           10.3459       12.0275         -0.8363     0.4905    0.0908
         eCDF Max
distance   0.7741
age        0.3427
black      0.7697
educ       0.4123

Summary of Balance for Matched Data:
         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance        0.1445        0.1443          0.0020     1.0039    0.0002
age            25.8162       25.7081          0.0151     0.9244    0.0073
black           0.8432        0.8432          0.0000          .    0.0000
educ           10.3459       10.4054         -0.0296     0.7190    0.0117
         eCDF Max Std. Pair Dist.
distance   0.0162          0.0029
age        0.0270          0.1481
black      0.0000          0.0000
educ       0.0432          0.2554

Sample Sizes:
          Control Treated
All         15992     185
Matched       185     185
Unmatched   15807       0
Discarded       0       0</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><a></a><span class="kw">use</span> files/cps1re74.dta, <span class="kw">clear</span></span>
<span id="cb16-2"><a></a>psmatch2 treat age <span class="bn">black</span> educ , n(1) noreplacement</span>
<span id="cb16-3"><a></a><span class="kw">sum</span> _weight , <span class="kw">d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(DW Subset of LaLonde Data)


Probit regression                                       Number of obs = 16,177
                                                        LR chi2(3)    = 752.47
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -634.83401                             Pseudo R2     = 0.3721

------------------------------------------------------------------------------
       treat | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         age |  -.0379829   .0042976    -8.84   0.000     -.046406   -.0295598
       black |   1.700675   .0793898    21.42   0.000     1.545074    1.856277
        educ |  -.0806962   .0142167    -5.68   0.000    -.1085604    -.052832
       _cons |  -.9031083   .2123282    -4.25   0.000    -1.319264   -.4869526
------------------------------------------------------------------------------

            psmatch2: weight of matched controls
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs                 370
25%            1              1       Sum of wgt.         370

50%            1                      Mean                  1
                        Largest       Std. dev.             0
75%            1              1
90%            1              1       Variance              0
95%            1              1       Skewness              .
99%            1              1       Kurtosis              .</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-4" class="slide level2 smaller" data-background="#debda4">
<h2>Example</h2>
<p><strong>Notice that we are creating weights now</strong></p>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">R</a></li><li><a href="#tabset-4-2">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="co"># install.packages("MatchIt")</span></span>
<span id="cb18-2"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb18-3"><a></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb18-4"><a></a>data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"files/cps1re74.dta"</span>)</span>
<span id="cb18-5"><a></a>model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> black <span class="sc">+</span> educ, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb18-6"><a></a><span class="fu">summary</span>(model<span class="sc">$</span>weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.1457  0.0000 52.7952 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb20-1"><a></a><span class="kw">use</span> files/cps1re74.dta, <span class="kw">clear</span></span>
<span id="cb20-2"><a></a><span class="kw">qui</span> psmatch2 treat age <span class="bn">black</span> educ , kernel</span>
<span id="cb20-3"><a></a><span class="kw">sum</span> _weight , <span class="kw">d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(DW Subset of LaLonde Data)

            psmatch2: weight of matched controls
-------------------------------------------------------------
      Percentiles      Smallest
 1%     .0024355       .0007862
 5%     .0024375       .0024348
10%       .00244       .0024348       Obs              16,177
25%     .0024517       .0024348       Sum of wgt.      16,177

50%     .0024919                      Mean            .022872
                        Largest       Std. dev.      .1130791
75%     .0026476              1
90%     .0038379              1       Variance       .0127869
95%     .0876547              1       Skewness       7.604874
99%            1              1       Kurtosis       64.26276</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-5" class="slide level2 smaller" data-background="#debda4">
<h2>Example</h2>
<p><strong>Now, the descriptive statistics are much closer</strong></p>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">R</a></li><li><a href="#tabset-5-2">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb22-2"><a></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb22-3"><a></a><span class="co">#install.packages("e1071")</span></span>
<span id="cb22-4"><a></a><span class="fu">library</span>(e1071)</span>
<span id="cb22-5"><a></a>data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"files/cps1re74.dta"</span>)</span>
<span id="cb22-6"><a></a>model <span class="ot">&lt;-</span> <span class="fu">matchit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> black <span class="sc">+</span> educ, <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"exact"</span>)</span>
<span id="cb22-7"><a></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(model)</span>
<span id="cb22-8"><a></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">by</span>(matched_data, matched_data<span class="sc">$</span>treat, <span class="cf">function</span>(x) {</span>
<span id="cb22-9"><a></a>  <span class="fu">c</span>(<span class="fu">mean</span>(x<span class="sc">$</span>age), <span class="fu">var</span>(x<span class="sc">$</span>age), <span class="fu">skewness</span>(x<span class="sc">$</span>age), <span class="fu">length</span>(x<span class="sc">$</span>age))</span>
<span id="cb22-10"><a></a>})</span>
<span id="cb22-11"><a></a></span>
<span id="cb22-12"><a></a>result_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-13"><a></a>  <span class="at">Treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treated"</span>),</span>
<span id="cb22-14"><a></a>  <span class="at">Mean_Age =</span> <span class="fu">sapply</span>(summary_stats, <span class="cf">function</span>(x) x[<span class="dv">1</span>]),</span>
<span id="cb22-15"><a></a>  <span class="at">Variance_Age =</span> <span class="fu">sapply</span>(summary_stats, <span class="cf">function</span>(x) x[<span class="dv">2</span>]),</span>
<span id="cb22-16"><a></a>  <span class="at">Skewness_Age =</span> <span class="fu">sapply</span>(summary_stats, <span class="cf">function</span>(x) x[<span class="dv">3</span>]),</span>
<span id="cb22-17"><a></a>  <span class="at">Count =</span> <span class="fu">sapply</span>(summary_stats, <span class="cf">function</span>(x) x[<span class="dv">4</span>])</span>
<span id="cb22-18"><a></a>)</span>
<span id="cb22-19"><a></a><span class="fu">print</span>(result_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Treatment Mean_Age Variance_Age Skewness_Age Count
0   Control 25.58786     39.16294    0.7826941  2191
1   Treated 25.51807     51.59664    1.1298334   166</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb24-1"><a></a><span class="kw">use</span> files/cps1re74.dta, <span class="kw">clear</span></span>
<span id="cb24-2"><a></a><span class="kw">qui</span> psmatch2 treat age <span class="bn">black</span> educ , kernel</span>
<span id="cb24-3"><a></a><span class="kw">qui</span> estpost <span class="kw">tabstat</span> age <span class="bn">black</span> educ [<span class="kw">aweight</span> = _weight], <span class="kw">by</span>(treat) c(<span class="fu">s</span>) <span class="fu">s</span>(me v sk n) <span class="kw">nototal</span></span>
<span id="cb24-4"><a></a>esttab .    ,varwidth(20) cells(<span class="st">"mean(fmt(3)) variance(fmt(3)) skewness(fmt(3)) count(fmt(0))"</span>) <span class="kw">noobs</span>  nonumber <span class="kw">compress</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(DW Subset of LaLonde Data)




------------------------------------------------------------
                                                            
                          mean  variance  skewness     count
------------------------------------------------------------
0                                                           
age                     27.033    85.548     1.077     15992
black                    0.791     0.165    -1.434     15992
educ                    10.710     8.146    -0.883     15992
------------------------------------------------------------
1                                                           
age                     25.816    51.194     1.115       185
black                    0.843     0.133    -1.888       185
educ                    10.346     4.043    -0.721       185
------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="entropy-balancing" class="title-slide slide level1 smaller center" data-background="#fac9a7">
<h1>Entropy Balancing</h1>

</section>
<section id="entropy-balancing-1" class="slide level2 smaller" data-background="#fac9a7">
<h2>Entropy Balancing</h2>
<p><strong>Here, instead of matching units, we reweight the observations such that the moments of the distributions (mean, variance, skewness) are similar.</strong></p>
<ul>
<li><p>The ebalance function implements a reweighting scheme. The user starts by choosing the covariates that should be included in the reweighting.</p></li>
<li><p>For each covariate, the user then specifies a set of balance constraints (in Equation 5) to equate the moments of the covariate distribution between the treatment and the reweighted control group.</p></li>
<li><p>The moment constraints may include the mean (first moment), the variance (second moment), and the skewness (third moment).</p></li>
</ul>
<p><strong>The outcome is a vector containing the weights to weight the observations, such that the weighted average, weighted variance, and weighted skewness of the covariates in control group are similar to those in the treatment group</strong></p>
</section>
<section id="entropy-balancing-2" class="slide level2 smaller" data-background="#fac9a7">
<h2>Entropy Balancing</h2>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">R</a></li><li><a href="#tabset-6-2">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">library</span>(haven)</span>
<span id="cb26-2"><a></a><span class="co">#install.packages("ebal")</span></span>
<span id="cb26-3"><a></a><span class="fu">library</span>(ebal)</span>
<span id="cb26-4"><a></a>data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"files/cps1re74.dta"</span>)</span>
<span id="cb26-5"><a></a>treatment <span class="ot">&lt;-</span><span class="fu">cbind</span>(data<span class="sc">$</span>treat)</span>
<span id="cb26-6"><a></a>vars <span class="ot">&lt;-</span><span class="fu">cbind</span>(data<span class="sc">$</span>age, data<span class="sc">$</span>educ, data<span class="sc">$</span>black)</span>
<span id="cb26-7"><a></a>eb <span class="ot">&lt;-</span> <span class="fu">ebalance</span>(treatment, vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Converged within tolerance </code></pre>
</div>
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="co"># means in treatment group data</span></span>
<span id="cb28-2"><a></a><span class="fu">apply</span>(vars[treatment<span class="sc">==</span><span class="dv">1</span>,],<span class="dv">2</span>,mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.8162162 10.3459459  0.8432432</code></pre>
</div>
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="co"># means in reweighted control group data</span></span>
<span id="cb30-2"><a></a><span class="fu">apply</span>(vars[treatment<span class="sc">==</span><span class="dv">0</span>,],<span class="dv">2</span>,weighted.mean,<span class="at">w=</span>eb<span class="sc">$</span>w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.8163688 10.3460391  0.8431526</code></pre>
</div>
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="co"># means in raw data control group data</span></span>
<span id="cb32-2"><a></a><span class="fu">apply</span>(vars[treatment<span class="sc">==</span><span class="dv">0</span>,],<span class="dv">2</span>,mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33.22523762 12.02751376  0.07353677</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb34-1"><a></a><span class="kw">use</span> files/cps1re74.dta, <span class="kw">clear</span></span>
<span id="cb34-2"><a></a>ebalance treat age <span class="bn">black</span> educ, targets(3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(DW Subset of LaLonde Data)



Data Setup
Treatment variable:   treat
Covariate adjustment: age black educ (1st order). age black educ (2nd order). a
&gt; ge black educ (3rd order).


Optimizing...
Iteration 1: Max Difference = 580799.347
Iteration 2: Max Difference = 213665.688
Iteration 3: Max Difference = 78604.7628
Iteration 4: Max Difference = 28918.6249
Iteration 5: Max Difference = 10640.1108
Iteration 6: Max Difference = 3915.82197
Iteration 7: Max Difference = 1442.09731
Iteration 8: Max Difference = 532.07826
Iteration 9: Max Difference = 197.376777
Iteration 10: Max Difference = 74.6380533
Iteration 11: Max Difference = 29.9524313
Iteration 12: Max Difference = 11.4337344
Iteration 13: Max Difference = 4.43722698
Iteration 14: Max Difference = 1.76899046
Iteration 15: Max Difference = .420548538
Iteration 16: Max Difference = .037814194
Iteration 17: Max Difference = .001164231
maximum difference smaller than the tolerance level; convergence achieved


Treated units: 185     total of weights: 185
Control units: 15992   total of weights: 185


Before: without weighting

             |              Treat              |        Control       
             |      mean   variance   skewness |      mean   variance 
-------------+---------------------------------+----------------------
         age |     25.82      51.19      1.115 |     33.23        122 
       black |     .8432      .1329     -1.888 |    .07354     .06813 
        educ |     10.35      4.043     -.7212 |     12.03      8.242 

             |  Control  
             |  skewness 
-------------+-----------
         age |     .3478 
       black |     3.268 
        educ |    -.4233 


After:  _webal as the weighting variable

             |              Treat              |        Control       
             |      mean   variance   skewness |      mean   variance 
-------------+---------------------------------+----------------------
         age |     25.82      51.19      1.115 |      25.8      51.17 
       black |     .8432      .1329     -1.888 |     .8421       .133 
        educ |     10.35      4.043     -.7212 |     10.34       4.04 

             |  Control  
             |  skewness 
-------------+-----------
         age |     1.122 
       black |    -1.877 
        educ |    -.7121 </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="entropy-balancing-3" class="slide level2 smaller" data-background="#fac9a7">
<h2>Entropy Balancing</h2>
<div class="panel-tabset">
<ul id="tabset-7" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-7-1">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb36-1"><a></a><span class="kw">use</span> files/cps1re74.dta, <span class="kw">clear</span></span>
<span id="cb36-2"><a></a><span class="kw">qui</span> ebalance treat age <span class="bn">black</span> educ, targets(3)</span>
<span id="cb36-3"><a></a><span class="kw">qui</span> estpost <span class="kw">tabstat</span> age <span class="bn">black</span> educ [<span class="kw">aweight</span> = _webal], <span class="kw">by</span>(treat) c(<span class="fu">s</span>) <span class="fu">s</span>(me v sk n) <span class="kw">nototal</span></span>
<span id="cb36-4"><a></a>esttab .    ,varwidth(20) cells(<span class="st">"mean(fmt(3)) variance(fmt(3)) skewness(fmt(3)) count(fmt(0))"</span>) <span class="kw">noobs</span>  nonumber <span class="kw">compress</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(DW Subset of LaLonde Data)




------------------------------------------------------------
                                                            
                          mean  variance  skewness     count
------------------------------------------------------------
0                                                           
age                     25.801    51.167     1.122     15992
black                    0.842     0.133    -1.877     15992
educ                    10.340     4.040    -0.712     15992
------------------------------------------------------------
1                                                           
age                     25.816    51.194     1.115       185
black                    0.843     0.133    -1.888       185
educ                    10.346     4.043    -0.721       185
------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="did-introduction" class="title-slide slide level1 smaller center" data-background="#c4f5d7">
<h1>DiD Introduction</h1>

</section>
<section id="did-introduction-1" class="slide level2 smaller" data-background="#c4f5d7">
<h2>DiD Introduction</h2>
<p>Let’s introduce DiD using the most famous example in the topic: John Snow’s 1855 findings that demonstrated to the world that cholera was spread by fecally-contaminated water and not via the air (Snow 1855)</p>
<ul>
<li>Snow compared the periods of 1849 and 1854 to analyze the impact of a change in London’s water supply dynamics.</li>
<li>Various water companies, each drawing water from different sections of the Thames river, served the city’s water needs.</li>
<li>The downstream areas of the Thames, where some companies sourced their water, were susceptible to contamination due to the disposal of various substances, including fecal matter from cholera-infected individuals.</li>
<li>In the interim between 1849 and 1854, a pivotal policy was implemented: the Lambeth Company was mandated by an Act of Parliament to relocate its water intake upstream of London.</li>
</ul>
</section>
<section id="did-introduction-2" class="slide level2 smaller" data-background="#c4f5d7">
<h2>DiD Introduction</h2>
<p><strong>This is what happened.</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 52%">
<col style="width: 23%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Region Supplier</th>
<th>Death Rates 1849</th>
<th>Death Rates 1854</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Non-Lambeth Only (Dirty)</td>
<td>134.9</td>
<td>146.6</td>
</tr>
<tr class="even">
<td>Lambeth + Others (Mix Dirty and Clean)</td>
<td>130.1</td>
<td>84.9</td>
</tr>
</tbody>
</table>
<div class="fragment">
<p>The specific DID estimate we can get here is:</p>
<ul>
<li><span class="math inline">\((84.9-130.1)-(146.9-134.9)=-57.2\)</span>.</li>
</ul>
<p>This resembles a “modern” DiD.</p>
</div>
</section></section>
<section>
<section id="shocks" class="title-slide slide level1 smaller center" data-background="#95c9a9">
<h1>Shocks</h1>

</section>
<section id="shocks-1" class="slide level2 smaller" data-background="#95c9a9">
<h2>Shocks</h2>
<p><strong>Shock-based designs use an external shock to limit selection bias. </strong></p>
<p>They are very hard to find, but if you do, you can reasonably estimate causal effects.</p>
<p>They are sources of exogenous variations in the X, which are crucial to causality when we have some of the problems discussed before.</p>
<p>A shock is often considered the first-best solution to causal inference (randomized control trials are the second-best).</p>
<div class="fragment">
<p>In social sciences, we cannot have randomized control trials. It is not feasible to have experiments.</p>
<p>That is why we often explore the idea of “Natural experiments” or “Natural shocks” (I often use the terms interchangeably)</p>
</div>
</section>
<section id="shocks-2" class="slide level2 smaller" data-background="#95c9a9">
<h2>Shocks</h2>
<p>A <strong>Natural experiment</strong> is an exogenous variation that change a variable in a random subset of firms.</p>
<ul>
<li>Regulations, laws, etc.</li>
<li>Natural disasters.</li>
<li>Sudden death of CEOs or a product, etc.</li>
<li>The gender of a newborn.</li>
</ul>
<p>Because the variation that occur in x is truly exogenous, the CMI holds and thus we can infer causality.</p>
</section>
<section id="shocks-3" class="slide level2 smaller" data-background="#95c9a9">
<h2>Shocks</h2>
<p>A good shock has some conditions <a href="https://cfr.pub/published/papers/cfr-0036.pdf">source</a>:</p>
<ol type="1">
<li><strong>Shock Strength</strong>: The shock is strong enough to significantly change firm behavior or incentives.</li>
</ol>
<div class="fragment">
<ol start="2" type="1">
<li><strong>Exogenous Shock</strong>: The shock came from “outside” the system one is studying.</li>
</ol>
<ul>
<li>Treated firms did not choose whether to be treated,</li>
<li>cannot anticipate the shock,</li>
<li>the shock is expected to be permanent, and</li>
<li>there is no reason to believe that which firms were treated depends on unobserved firm characteristics.</li>
</ul>
<p>If the shock is exogenous, or appears to be, we are less worried that unobservables might be correlated with both assignment to treatment and the potential outcomes, and thus generate omitted variable bias.</p>
<p>Shock exogeneity should be defended, not just assumed.</p>
</div>
</section>
<section id="shocks-4" class="slide level2 smaller" data-background="#95c9a9">
<h2>Shocks</h2>
<p>A good shock has some conditions <a href="https://cfr.pub/published/papers/cfr-0036.pdf">source</a>:</p>
<ol start="3" type="1">
<li><strong>“As If Random” Assignment</strong>: The shock must separate firms into treated and controls in a manner which is close to random.</li>
</ol>
<div class="fragment">
<ol start="4" type="1">
<li><strong>Covariate balance:</strong> The forcing and forced variables aside, the shock should produce reasonable covariate balance between treated and control firms, including “common support” (reasonable overlap between treated and control firms on all covariates).</li>
</ol>
<p>Somewhat imperfect balance can be address with balancing methods, but severe imbalance undermines shock credibility, even if the reason for imbalance is not obvious. Covariate balance should be reported.</p>
</div>
</section>
<section id="shocks-5" class="slide level2 smaller" data-background="#95c9a9">
<h2>Shocks</h2>
<p>A good shock has some conditions <a href="https://cfr.pub/published/papers/cfr-0036.pdf">source</a>:</p>
<ol start="5" type="1">
<li><strong>Only-Through Condition(s):</strong> We must have reason to believe that the apparent effect of the shock on the outcome came only through the shock (sometimes, through a specific channel).</li>
</ol>
<p>The shock must be “isolated”, there must be no other shock, at around the same time, that could also affect treated firms differently than control firms. And if one expects the shock to affect outcomes through a particular channel, the shock must also affect the outcome only through that channel.</p>
<div class="fragment">
<p>In IV analysis, this is called an <strong>“exclusion restriction”</strong> or <strong>“only-through condition”</strong>, because one assumes away (excludes) other channels.</p>
</div>
</section>
<section id="shocks-6" class="slide level2 smaller" data-background="#95c9a9">
<h2>Shocks</h2>
<p>The idea of a natural shock is often mixed with the difference-in-differences (DiD) design.</p>
<p>It is more common that it should that people refer to shocks when they want to refer to DiD.</p>
<p>A Did design explores a Natural shock to estimate causal effects.</p>
<p><strong>A good shock generates, by nature, random assignment</strong>.</p>
</section>
<section id="remember" class="slide level2 smaller" data-background="#693d3a">
<h2>Remember</h2>
<p><strong>Remember:</strong></p>
<p>When dealing with <strong>causal inference</strong>, we have to find ways to approximate what the hidden potential outcome of the treated units is.</p>
<p>That is, the challenge in identifying causal effects is that the untreated potential outcomes, <span class="math inline">\(Y_{i,0}\)</span>, are never observed for the treated group (<span class="math inline">\(D_i= 1\)</span>). The “second” term in the following equation:</p>
<p>ATET = <span class="math inline">\(\frac{1}{N} (E[Y_{i,1}|D_i=1] - E[Y_{i,0}|D_i=1])\)</span></p>
<p>We need an empirical design to <strong>“observe”</strong> what we do not really observe (i.e., the counterfactual).</p>
</section></section>
<section>
<section id="single-differences" class="title-slide slide level1 smaller center" data-background="#a4baac">
<h1>Single differences</h1>

</section>
<section id="single-differences-1" class="slide level2 smaller" data-background="#a4baac">
<h2>Single differences</h2>
<p>There are two single differences we can use to estimate the causal effect of a treatments (i.e., a shock).</p>
<p><strong>1) Single Cross-Sectional Differences After Treatment</strong></p>
<p><strong>2) Single Time-Series Difference Before and After Treatment</strong></p>
</section>
<section id="single-differences-2" class="slide level2 smaller" data-background="#a4baac">
<h2>Single differences</h2>
<p><strong>1) Single Cross-Sectional Differences After Treatment</strong></p>
<p>One approach to estimating a parameter that summarizes the treatment effect is to compare the post-treatment outcomes of the treatment and control groups.</p>
<p>This method is often used when there is no data available on pre-treatment outcomes.</p>
<p>It takes the form:</p>
<p><span class="math display">\[y=\beta_0+\beta_1d_i+\epsilon\]</span></p>
<p>where <span class="math inline">\(d_i\)</span> is a dummy marking the units that are treated. The treatment effect is given by <span class="math inline">\(\beta_1\)</span></p>
<p>This is a cross-sectional comparison, using only post-treatment values.</p>
</section>
<section id="single-differences-3" class="slide level2 smaller" data-background="#a4baac">
<h2>Single differences</h2>
<p><strong>1) Single Cross-Sectional Differences After Treatment</strong></p>
<p>You may add the interaction between the treatment dummy and the years.</p>
<p><span class="math display">\[y=\beta_0+\beta_1d_i\times year_1+\beta_2d_i\times year_2 +\beta_3d_i\times year_3+ . . . +\epsilon\]</span></p>
<p>This design allows the treatment effect to vary over time by interacting the treatment dummy with period dummies.</p>
<div class="fragment">
<p><strong>What is the endogeneity concern here?</strong></p>
</div>
<div class="fragment">
<p>The endogeneity concern is that these firms’ <span class="math inline">\(y\)</span> were different and could become more different between the treated and control groups even if the shock had not happened.</p>
<p>That is, there is something in the residual that explains the differences in <span class="math inline">\(y\)</span> that is correlated with the <span class="math inline">\(d\)</span>.</p>
</div>
</section>
<section id="single-differences-4" class="slide level2 smaller" data-background="#a4baac">
<h2>Single differences</h2>
<p><strong>2) Single Time-Series Difference Before and After Treatment</strong></p>
<p>A second way to estimate the treatment effect is to compare the outcome after the treatment with the outcome before the treatment for <strong>just those units that are treated.</strong></p>
<p>The difference from before is that you have data before the treatment, but you only have data for the treated units.</p>
<p><span class="math display">\[y=\beta_0+\beta_1 time+\epsilon\]</span></p>
<p>where <span class="math inline">\(time\)</span> marks the years after the treatment. The treatment effect is given by <span class="math inline">\(\beta_1\)</span></p>
</section>
<section id="single-differences-5" class="slide level2 smaller" data-background="#a4baac">
<h2>Single differences</h2>
<p><strong>2) Single Time-Series Difference Before and After Treatment</strong></p>
<p>You can also estimate a multi-year regression.</p>
<p><span class="math display">\[y=\beta_0+\beta_1year_1 +\beta_2\times year_2 +\beta_3\times year_3+ . . . +\epsilon\]</span></p>
<div class="fragment">
<p><strong>What is the endogeneity concern here?</strong></p>
</div>
<div class="fragment">
<p>The endogeneity concern is that these firms’ <span class="math inline">\(y\)</span> could have changed over the period of observation even if the shock had not happened.</p>
<p>That is, there is something in the error term that explains <span class="math inline">\(y\)</span> that is correlated with the <span class="math inline">\(year\)</span> dummies.</p>
</div>
</section>
<section id="single-differences-6" class="slide level2 smaller" data-background="#a4baac">
<h2>Single differences</h2>
<p>The combination of the <strong>1) Single Cross-Sectional Differences After Treatment</strong> and <strong>2) Single Time-Series Difference Before and After Treatment</strong> is called <strong>Difference-in-Differences</strong>.</p>
</section></section>
<section>
<section id="difference-in-differences" class="title-slide slide level1 smaller center" data-background="#8bc9a2">
<h1>Difference-in-Differences</h1>

</section>
<section id="difference-in-differences-1" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p>This is one of the most popular methods in social sciences for estimating causal effects in non-experimental settings.</p>
<p>The literature is exploding over the recent years.</p>
<div class="fragment">
<p>There is one group that is treated, another is the control.</p>
<p>There are two periods of time, before and after the treatment.</p>
<p>And the treated group receives the treatment in the second period.</p>
<p><strong>The key identifying assumption is that the average outcome among the treated and comparison populations would have followed “parallel trends” in the absence of treatment.</strong></p>
</div>
</section>
<section id="difference-in-differences-2" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p><em>The two single difference estimators complement one another.</em></p>
<p><em>The cross-sectional comparison avoids the problem of omitted trends by comparing two groups over the same time period.</em></p>
<p><em>The time series comparison avoids the problem of unobserved differences between two different groups of firms by looking at the same firms before and after the change.</em></p>
<p><em>The double difference, difference-in-differences (DD), estimator combines these two estimators to take advantage of both estimators’ strengths.</em></p>
<p>(<a href="https://doi.org/10.1016/B978-0-44-453594-8.00007-0">Roberts and Whited, 2014</a>)</p>
</section>
<section id="difference-in-differences-3" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p>Difference-in-differences methods overcome the identification challenge via assumptions that allow us to impute the mean counterfactual untreated outcomes for the treated group by using</p>
<ul>
<li><ol type="a">
<li>the change in outcomes for the untreated group and</li>
</ol></li>
<li><ol start="2" type="a">
<li>the baseline outcomes for the treated group.</li>
</ol></li>
</ul>
<p>The key assumption for identifying the causal effect is the <strong>parallel trends assumption</strong>, which intuitively states that <strong>the average outcome for the treated and untreated units would have evolved in parallel if treatment had not occurred</strong>.</p>
<p><strong>Assumption 1 (Parallel Trends).</strong></p>
<p><span class="math inline">\(E[Y_{i,1,t=2}-Y_{i,0,t=1}|D_i=1] = E[Y_{i,1,t=2}-Y_{i,0,t=1}|D_i=0]\)</span></p>
<p>In other words: <strong>this condition means that in the absence of treatment, the average change in the <span class="math inline">\(y\)</span> would have been the same for both the treatment and control groups.</strong></p>
</section>
<section id="difference-in-differences-4" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p><strong>The counterfactual is determined by the assumption of a parallel trend between the treated and control groups.</strong> <strong><a href="https://www.masteringmetrics.com/">MM</a></strong></p>

<img data-src="figs/did1.png" class="r-stretch"></section>
<section id="difference-in-differences-5" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>

<img data-src="figs/slides4-did.png" class="r-stretch"></section>
<section id="difference-in-differences-6" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p>Inserting more periods.</p>

<img data-src="figs/did2.png" class="r-stretch"></section>
<section id="difference-in-differences-7" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p>A more realistic example. (<a href="https://theeffectbook.net/ch-DifferenceinDifference.html">The effect</a>)</p>

<img data-src="figs/theeffect1.png" class="r-stretch"></section>
<section id="difference-in-differences-8" class="slide level2 smaller" data-background="#8bc9a2">
<h2>Difference-in-Differences</h2>
<p><strong>Assumption 2 (No anticipatory effects).</strong></p>
<p><em>The treatment has no causal effect prior to its implementation.</em></p>
<p><span class="math display">\[Y_{i,0,t=1}=Y_{i,1,t=1}\]</span></p>
<p>Prior to the treatment (t=1), there is no effect of the treatment.</p>
</section></section>
<section>
<section id="estimation" class="title-slide slide level1 smaller center" data-background="#c6f7ec">
<h1>Estimation</h1>

</section>
<section id="estimation-1" class="slide level2 smaller" data-background="#c6f7ec">
<h2>Estimation</h2>
<p>Let’s see how to implement a DiD model. The canonical DiD model is the followin:</p>
<p><span class="math display">\[y_{i,t} = \beta_0 + \beta_1 time_t + \beta_2 treated_i  + \beta_3 treated_i \times time_t + \epsilon_{i,t}\]</span></p>
<p>Where:</p>
<p><span class="math inline">\(treated_i\)</span> is a dummy marking the units that received the treatment.</p>
<p><span class="math inline">\(time_t\)</span> is a dummy marking the year of the treatment and the years after.</p>
</section>
<section id="estimation-2" class="slide level2 smaller" data-background="#c6f7ec">
<h2>Estimation</h2>
<p>Let’s see how to implement a DiD model. The canonical DiD model is the followin:</p>
<p><span class="math display">\[y_{i,t} = \beta_0 + \beta_1 time_t + \beta_2 treated_i  + \beta_3 treated_i \times time_t + \epsilon_{i,t}\]</span></p>
<p><span class="math inline">\(\beta_0\)</span> is the <strong>average <span class="math inline">\(y_{i,t}\)</span></strong> for the <strong>control units before the treatment (<span class="math inline">\(time_t\)</span> =0 and <span class="math inline">\(treated_i\)</span> = 0)</strong>.</p>
<p><span class="math inline">\(\beta_0+\beta_1\)</span> is the <strong>average <span class="math inline">\(y_{i,t}\)</span></strong> for the <strong>control units after the treatment (<span class="math inline">\(time_t\)</span> =1 and <span class="math inline">\(treated_i\)</span> = 0)</strong>.</p>
<p><span class="math inline">\(\beta_0+\beta_2\)</span> is the <strong>average <span class="math inline">\(y_{i,t}\)</span></strong> for the <strong>treated units before the treatment (<span class="math inline">\(time_t\)</span> =0 and <span class="math inline">\(treated_i\)</span> = 1)</strong>.</p>
<p><span class="math inline">\(\beta_0+\beta_1+\beta_2+\beta_3\)</span> is the <strong>average <span class="math inline">\(y_{i,t}\)</span></strong> for the <strong>treated units after the treatment (<span class="math inline">\(time_t\)</span> =1 and <span class="math inline">\(treated_i\)</span> = 1)</strong>.</p>
</section>
<section id="estimation-3" class="slide level2 smaller" data-background="#c6f7ec">
<h2>Estimation</h2>
<table style="width:98%;">
<colgroup>
<col style="width: 18%">
<col style="width: 35%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<tbody>
<tr class="odd">
<td></td>
<td>Post-treat. (1)</td>
<td>Pre-treat. (2)</td>
<td><strong>Diff. (1-2)</strong></td>
</tr>
<tr class="even">
<td>Treated (a)</td>
<td><span class="math inline">\(\beta_0+\beta_1+\beta_2+\beta_3\)</span></td>
<td><span class="math inline">\(\beta_0+\beta_2\)</span></td>
<td><strong><span class="math inline">\(\beta_1+\beta_3\)</span></strong></td>
</tr>
<tr class="odd">
<td>Control (b)</td>
<td><span class="math inline">\(\beta_0+\beta_1\)</span></td>
<td><span class="math inline">\(\beta_0\)</span></td>
<td><strong><span class="math inline">\(\beta_1\)</span></strong></td>
</tr>
<tr class="even">
<td><strong>Diff. (a-b)</strong></td>
<td><strong><span class="math inline">\(\beta_2+\beta_3\)</span></strong></td>
<td><strong><span class="math inline">\(\beta_2\)</span></strong></td>
<td><strong><span class="math inline">\(\beta_3\)</span></strong></td>
</tr>
</tbody>
</table>
<p><strong>This is why we call difference-in-differences.</strong></p>
<p><strong><span class="math inline">\(\beta_3\)</span></strong> gives us an estimate of the treatment effect on the treated units (ATE).</p>
<p>This is very popular because you can run as a regression.</p>
<div class="fragment">
<p>Many papers simply show this table as final result.</p>
<p>However, it is also possible that you include additional covariates (i.e., controls) in a DiD design.</p>
<p>You can also modify this to test the timing of the treatment (discussed later).</p>
</div>
</section></section>
<section>
<section id="controls-in-did" class="title-slide slide level1 smaller center" data-background="#d5f5ee">
<h1>Controls in DiD</h1>

</section>
<section id="controls-in-did-1" class="slide level2 smaller" data-background="#d5f5ee">
<h2>Controls in DiD</h2>
<p>If you add controls, you have something in the form:</p>
<p><span class="math display">\[y_{i,t} = \beta_0 + \beta_1 time_t + \beta_2 treated_i  + \beta_3 treated_i \times time_t + \beta_4x_{1,i,t}+ \beta_5x_{2,i,t}+ ...+ \epsilon_{i,t}\]</span></p>
<div class="fragment">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Bad Controls problem: Never add a control that is also affected by the treatment.</p>
</div>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p>Using pre-treatment values is good practice.</p>
</div>
</div>
</div>
<p>If you are including a <em>good control</em>, you should get lower standard deviations of the estimated effects.</p>
</div>
</section>
<section id="controls-in-did-2" class="slide level2 smaller" data-background="#d5f5ee">
<h2>Controls in DiD</h2>
<p>One way of adding more controls is by adding FEs.</p>
<p><span class="math display">\[y_{i,t} = \beta_0 + \beta_1 time_t + \beta_2 treated_i  + \beta_3 treated_i \times time_t + FirmFE+ YearFE + \epsilon_{i,t}\]</span></p>
<p>They help control for unobserved heterogeneity at the firm-level and in each year.</p>
<div class="fragment">
<p><strong>But what do <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> mean now?</strong></p>
</div>
<div class="fragment">
<p><strong>Answer:</strong> They are perfectly correlated with the <span class="math inline">\(FirmFE\)</span> and <span class="math inline">\(YearFE\)</span>, respectively.</p>
<p>Reason: because they don’t vary across each firm and year, respectively.</p>
<p>The software will most likely drop one <span class="math inline">\(FirmFE\)</span> and one <span class="math inline">\(YearFE\)</span>, thus <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> mean nothing.</p>
</div>
<div class="fragment">
<p>I am guilty of this mistake because a referee asked and I couldn’t reply properly.</p>
</div>
</section>
<section id="controls-in-did-3" class="slide level2 smaller" data-background="#d5f5ee">
<h2>Controls in DiD</h2>
<p>You will be better off if you estimate:</p>
<p><span class="math display">\[y_{i,t} = \beta_0 + \beta_3 treated_i \times time_t + FirmFE+ YearFE + \epsilon_{i,t}\]</span></p>
<p>This is called a <strong>generalized DiD</strong>.</p>
<p>The <span class="math inline">\(FirmFE\)</span> allow that each firm has one intercept (i.e., one average <span class="math inline">\(y_{i,t}\)</span>).</p>
<p>The <span class="math inline">\(YearFE\)</span> accommodate a potential shock in <span class="math inline">\(y_{i,t}\)</span> in each year.</p>
</section>
<section id="controls-in-did-4" class="slide level2 smaller" data-background="#d5f5ee">
<h2>Controls in DiD</h2>
<p>Additionally, adding <em>good</em> controls can be helpful to maintain the shock <strong>exogenous (i.e., random) after controlling by X.</strong></p>
<div class="fragment">
<p>Imagine that a financial shock is more likely to affect high leveraged firms than low-leverage ones.</p>
<ol type="1">
<li><p>the shock will not change the leverage decision of each firm.</p></li>
<li><p>we believe that high leveraged firms will have a different <span class="math inline">\(y_{i,t}\)</span> after the treatment.</p></li>
</ol>
<p>You may add leverage as a control to make sure the shock is random given the firms’ levels of leverage.</p>
</div>
<div class="fragment">
<p>If you may believe that the leverage will change after the treatment, you can use pre-treatment values (interacted with the time dummies).</p>
<p>In this case, you are controlling for the pre-treatment condition but are not including the bias that might come due to changes in leverage after the treatment.</p>
</div>
</section>
<section id="controls-in-did-5" class="slide level2 smaller" data-background="#d5f5ee">
<h2>Controls in DiD</h2>
<p><em>If assignment is random, then including additional covariates should have a negligible effect on the estimated treatment effect.</em></p>
<p><em>Thus, a large discrepancy between the treatment effect estimates with and without additional controls raises a red flag.</em></p>
<p><em>If assignment to treatment and control groups is not random but dictated by an observable rule, then controlling for this rule via covariates in the regression satisfies the conditional mean zero assumption required for unbiased estimates.</em></p>
<p><em>Regardless of the motivation, it is crucial to remember that any covariates included as controls must be unaffected by the treatment, a condition that eliminates other outcome variables and restricts most covariates to pre-treatment values.</em></p>
<p>(<a href="https://doi.org/10.1016/B978-0-44-453594-8.00007-0">Roberts and Whited, 2014</a>)</p>
</section></section>
<section>
<section id="comment-about-did" class="title-slide slide level1 smaller center" data-background="#aecfc7">
<h1>Comment about DiD</h1>

</section>
<section id="comment-about-did-1" class="slide level2 smaller" data-background="#aecfc7">
<h2>Comment about DiD</h2>
<p>(<a href="https://theeffectbook.net/ch-DifferenceinDifference.html">The effect</a>)</p>
<p><em>Parallel trends means we have to think very carefully about how our dependent variable is measured and transformed.</em></p>
<p><em>Because parallel trends is an assumption about the size of a gap remaining constant, which means something different depending on how you measure that gap.</em></p>
<p><em>For example, if parallel trends holds for dependent variable <span class="math inline">\(Y\)</span>, then it doesn’t hold for <span class="math inline">\(ln(y)\)</span>, and vice versa</em></p>
<div class="fragment">
<p><em>For example, say that in the pre-treatment period <span class="math inline">\(y\)</span> is 10 for the control group and 20 for the treated group. In the post-treatment period, in the counterfactual world where treatment never happened,<span class="math inline">\(y\)</span> would be 15 for the control group and 25 for the treated group. Gap of <span class="math inline">\(20-10=10\)</span> before, and <span class="math inline">\(25-15=10\)</span> after. Parallel trends holds!</em></p>
</div>
<div class="fragment">
<p><em>However: <span class="math inline">\(Ln(20)-ln(10)=.693\)</span> before, and <span class="math inline">\(ln(25)-ln(15)=.51\)</span> after. </em></p>
</div>
</section></section>
<section>
<section id="example-of-did" class="title-slide slide level1 smaller center" data-background="#98b8b0">
<h1>Example of DiD</h1>

</section>
<section id="example-of-did-1" class="slide level2 smaller" data-background="#98b8b0">
<h2>Example of DiD</h2>
<div class="panel-tabset">
<ul id="tabset-8" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-8-1">R</a></li><li><a href="#tabset-8-2">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a><span class="co"># Load the necessary library</span></span>
<span id="cb38-2"><a></a><span class="fu">library</span>(foreign)</span>
<span id="cb38-3"><a></a>data <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(<span class="st">"files/kielmc.dta"</span>)</span>
<span id="cb38-4"><a></a>data<span class="sc">$</span>y81_nearinc <span class="ot">&lt;-</span> data<span class="sc">$</span>y81 <span class="sc">*</span> data<span class="sc">$</span>nearinc</span>
<span id="cb38-5"><a></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(rprice <span class="sc">~</span> y81 <span class="sc">+</span> nearinc <span class="sc">+</span> y81_nearinc, <span class="at">data =</span> data)</span>
<span id="cb38-6"><a></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(rprice <span class="sc">~</span> y81 <span class="sc">+</span> nearinc <span class="sc">+</span> y81_nearinc <span class="sc">+</span> age <span class="sc">+</span> agesq, <span class="at">data =</span> data)</span>
<span id="cb38-7"><a></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(rprice <span class="sc">~</span> y81 <span class="sc">+</span> nearinc <span class="sc">+</span> y81_nearinc <span class="sc">+</span> age <span class="sc">+</span> agesq <span class="sc">+</span> intst <span class="sc">+</span> land <span class="sc">+</span> area <span class="sc">+</span> rooms <span class="sc">+</span> baths, <span class="at">data =</span> data)</span>
<span id="cb38-8"><a></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rprice ~ y81 + nearinc + y81_nearinc + age + agesq + 
    intst + land + area + rooms + baths, data = data)

Residuals:
   Min     1Q Median     3Q    Max 
-76721  -8885   -252   8433 136649 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.381e+04  1.117e+04   1.237  0.21720    
y81          1.393e+04  2.799e+03   4.977 1.07e-06 ***
nearinc      3.780e+03  4.453e+03   0.849  0.39661    
y81_nearinc -1.418e+04  4.987e+03  -2.843  0.00477 ** 
age         -7.395e+02  1.311e+02  -5.639 3.85e-08 ***
agesq        3.453e+00  8.128e-01   4.248 2.86e-05 ***
intst       -5.386e-01  1.963e-01  -2.743  0.00643 ** 
land         1.414e-01  3.108e-02   4.551 7.69e-06 ***
area         1.809e+01  2.306e+00   7.843 7.16e-14 ***
rooms        3.304e+03  1.661e+03   1.989  0.04758 *  
baths        6.977e+03  2.581e+03   2.703  0.00725 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 19620 on 310 degrees of freedom
Multiple R-squared:   0.66, Adjusted R-squared:  0.6491 
F-statistic: 60.19 on 10 and 310 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb40-1"><a></a><span class="kw">use</span> <span class="st">"files/kielmc.dta"</span>, <span class="kw">clear</span></span>
<span id="cb40-2"><a></a><span class="kw">gen</span> y81_nearinc = y81 * nearinc</span>
<span id="cb40-3"><a></a>eststo:<span class="kw">qui</span> <span class="kw">reg</span> rprice y81 nearinc y81_nearinc </span>
<span id="cb40-4"><a></a>eststo:<span class="kw">qui</span> <span class="kw">reg</span> rprice y81 nearinc y81_nearinc age agesq </span>
<span id="cb40-5"><a></a>eststo:<span class="kw">qui</span> <span class="kw">reg</span> rprice y81 nearinc y81_nearinc age agesq intst land area rooms baths</span>
<span id="cb40-6"><a></a>esttab , <span class="kw">compress</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(est1 stored)

(est2 stored)

(est3 stored)


-------------------------------------------------
                 (1)          (2)          (3)   
              rprice       rprice       rprice   
-------------------------------------------------
y81          18790.3***   21321.0***   13928.5***
              (4.64)       (6.19)       (4.98)   

nearinc     -18824.4***    9397.9       3780.3   
             (-3.86)       (1.95)       (0.85)   

y81_near~c  -11863.9     -21920.3***  -14177.9** 
             (-1.59)      (-3.45)      (-2.84)   

age                       -1494.4***    -739.5***
                         (-11.33)      (-5.64)   

agesq                       8.691***     3.453***
                          (10.25)       (4.25)   

intst                                   -0.539** 
                                       (-2.74)   

land                                     0.141***
                                        (4.55)   

area                                     18.09***
                                        (7.84)   

rooms                                   3304.2*  
                                        (1.99)   

baths                                   6977.3** 
                                        (2.70)   

_cons        82517.2***   89116.5***   13807.7   
             (30.26)      (37.04)       (1.24)   
-------------------------------------------------
N                321          321          321   
-------------------------------------------------
t statistics in parentheses
* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="regression-discontinuity-design-rdd" class="title-slide slide level1 smaller center" data-background="#e3e2b8">
<h1>Regression Discontinuity Design (RDD)</h1>

</section>
<section id="regression-discontinuity-design-rdd-1" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><strong>The regression-discontinuity (RD) research design is a quasi experimental method.</strong></p>
<p>Here the <em>treatment</em> is not a binary as before.</p>
<p><strong>Treated units are assigned based on a cutoff score of a continuous variable.</strong></p>
<div class="fragment">
<p>In a RDD the treatment assignment is not random…</p>
<p>… but it is based in the value of an observed covariate, in which the units lie on either side of the threshold.</p>
</div>
</section>
<section id="regression-discontinuity-design-rdd-2" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><strong><a href="https://www.masteringmetrics.com/">Example Mastering Metrics</a>:</strong></p>
<ul>
<li>Age for drinking is 18 in Brazil.</li>
</ul>
<p>Why prohibiting younger than 18?</p>
<p>The theory behind this effort is that legal drinking at age 18 discourages binge drinking and promotes a culture of mature alcohol consumption.</p>
<p>The cutoff splits who can drink and who can’t.</p>
</section>
<section id="regression-discontinuity-design-rdd-3" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>The name RDD comes from a <em>jump</em>, a discontinuity that occurs in a continuous variable.</p>
<p>In its simplest form, the design has a:</p>
<ul>
<li><p>The assignment variable (e.g., age),</p></li>
<li><p>Two groups (above and below the cutoff),</p></li>
<li><p>The outcome variable.</p></li>
<li><p>You may include nonlinearities and control variables.</p></li>
</ul>
</section>
<section id="regression-discontinuity-design-rdd-4" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>RDD is:</p>
<p><span class="math display">\[D_i = 1(x_i&gt;c) \;\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math display">\[\;D = 1 \; if \;X \;_i&gt;c \]</span></p></li>
<li><p><span class="math display">\[\;D = 0 \; if \;X \;_i&lt;c \]</span></p></li>
</ul>
<p><span class="math inline">\(X\)</span> is called the forcing variable because it “forces” units into treatment or control groups.</p>
<p><span class="math inline">\(X\)</span> may be correlated with <span class="math inline">\(Y_1\)</span> or <span class="math inline">\(Y_0\)</span>, so simply comparing treated and control units would not provide causal effects</p>
<p>However, if the units are randomly assigned into treatment around the cutoff, we would have causal effects.</p>
</section>
<section id="regression-discontinuity-design-rdd-5" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>The main assumption that allows using RDD as a causal method is that</p>
<p><strong>Next to the cut, the participants are similar. The only difference is that one individual is in each of the “sides”.</strong> <a href="http://dx.doi.org/10.1016/B978-0-08-097086-8.44049-3">Source</a></p>
<p><img data-src="figs/rdd0.png" style="width:60.0%;height:60.0%"></p>
</section>
<section id="regression-discontinuity-design-rdd-6" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<ul>
<li><p>The cutoff value <strong>occurs at 50</strong></p></li>
<li><p>What are the differences between someone that scores 49.99 and 50.01 in the X variable?</p></li>
<li><p>The intuition is that these individuals are similar and comparable.</p></li>
</ul>
<p>In the absence of <strong>treatment</strong>, the assumption is that the solid line would “continue” with the same inclination and values.</p>
<p>There is a discontinuity, however. This implies that the pretreatment in the absence of the treatment should be the dashed line.</p>
<p>The discontinuity is the causal effect of X (at the cutoff) to Y.</p>
</section>
<section id="regression-discontinuity-design-rdd-7" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><em>Unlike the matching and regression strategies based on treatment-control comparisons conditional on covariates, the validity of RDD is based on our willingness to extrapolate across values of the running variable, at least for values in the neighborhood of the cutoff at which treatment switches on.</em> <a href="https://www.masteringmetrics.com/">MM</a></p>
</section>
<section id="regression-discontinuity-design-rdd-8" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><strong>Again the drinking example:</strong></p>
<p><strong>In the US it is 21 years (age &amp; alcohol).</strong> <strong><a href="https://www.masteringmetrics.com/">Example Mastering Metrics</a>:</strong></p>
<p><em>Notice the x-axis.</em></p>

<img data-src="figs/rdd1.png" class="r-stretch"></section>
<section id="regression-discontinuity-design-rdd-9" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><strong>In the US it is 21 years.</strong> <strong><a href="https://www.masteringmetrics.com/">Example Mastering Metrics</a>:</strong></p>
<p><em>Notice the x-axis.</em></p>

<img data-src="figs/rdd2.png" class="r-stretch"></section>
<section id="regression-discontinuity-design-rdd-10" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>Examples <a href="https://doi.org/10.1016/j.jfineco.2015.08.008">Almeida et al 2016</a></p>

<img data-src="figs/almeida.png" class="r-stretch"></section>
<section id="regression-discontinuity-design-rdd-11" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>Examples <a href="https://doi.org/10.1287/mnsc.2014.2038">Flammer 2015</a></p>

<img data-src="figs/flammer.png" class="r-stretch"></section>
<section id="regression-discontinuity-design-rdd-12" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>This is (legally, it should be) an example of a <strong>Sharp RDD</strong></p>
<p>A <strong>Sharp RDD</strong> occurs when the cutoff is mandatory. There are no exceptions. In this case, there are no 17 years old drinking and driving.</p>
<p>The treatment is</p>
<p><span class="math display">\[D_a= 1, \;if \;a \;&gt;=\; 18, \;0 \;if \;a\; &lt;\; 18\]</span></p>
<div class="fragment">
<p>The alternative is a <strong>fuzzy RDD</strong>, which occurs when there is some misassignment.</p>
<ul>
<li>People from under the cut also receiving the treatment.</li>
<li>Ex. students that receive 5,96 usually are <em>approved</em> in a course (this is a misassignment).</li>
<li>To estimate a Fuzzy RDD, you can use the treatment as an instrumental variable (Angrist &amp; Pischke, 2009).</li>
</ul>
</div>
</section>
<section id="regression-discontinuity-design-rdd-13" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><strong>fuzzy RDD</strong> (<a href="https://theeffectbook.net/ch-DifferenceinDifference.html">The effect</a> )</p>

<img data-src="figs/fuzzy.png" class="r-stretch"></section>
<section id="regression-discontinuity-design-rdd-14" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p><strong>fuzzy RDD</strong></p>
<p><em>Compliers</em>: Takes treatment if above threshold but not if below threshold.</p>
<p><em>Always-Takers</em>: Always takes the treatment, ignores the cut.</p>
<p><em>Never-Takers</em>: Never takes the treatment, ignores the cut.</p>
<p><em>Defiers</em>: Takes treatment if below the threshold, does not take the treatment if above the threshold.</p>
</section>
<section id="regression-discontinuity-design-rdd-15" class="slide level2 smaller" data-background="#e3e2b8">
<h2>Regression Discontinuity Design (RDD)</h2>
<p>Things that are “good” to a RDD.</p>
<ul>
<li>Age</li>
<li>Dates (you need 6 years to start school, 5,99 years is not allowed)
<ul>
<li>Great example: Most of NHL players are those with anniversaries just after the enrollment date</li>
</ul></li>
<li>Ranking systems</li>
<li>Location (when people cannot “move” easily)</li>
</ul>
</section></section>
<section>
<section id="estimation-4" class="title-slide slide level1 smaller center" data-background="#d4d3bc">
<h1>Estimation</h1>

</section>
<section id="estimation-5" class="slide level2 smaller" data-background="#d4d3bc">
<h2>Estimation</h2>
<p>A <strong>Sharp RDD</strong> can take the form of:</p>
<p><span class="math display">\[Y_i = \alpha + \beta_1 D_a + \beta_2 \tilde{x}_1 + \epsilon\]</span></p>
<p>Where <span class="math inline">\(D_a\)</span> is the treatment based on the cutoff.</p>
<p><span class="math inline">\(x\)</span> is the running variable (the difference between the actual <span class="math inline">\(X\)</span> and the cutoff in <span class="math inline">\(X_0\)</span>).</p>
<ul>
<li><p>For instance, months until the 18 years birthday.</p></li>
<li><p>We can also use the notation: <span class="math inline">\(\tilde{X}=x-x_0\)</span> regarding the difference.</p></li>
</ul>
</section>
<section id="estimation-6" class="slide level2 smaller" data-background="#d4d3bc">
<h2>Estimation</h2>
<p>You also should trim the sample to a reasonable window around the cutoff <span class="math inline">\(c\)</span></p>
<ul>
<li><p>Something like: <span class="math inline">\(c-h&lt;X_i&lt;c+h\)</span>, where <span class="math inline">\(h\)</span> is a positive value that determines the window</p></li>
<li><p>There is no theoretical solution to how big should <span class="math inline">\(h\)</span> be. It invites robustness tests.</p></li>
</ul>
</section>
<section id="estimation-7" class="slide level2 smaller" data-background="#d4d3bc">
<h2>Estimation</h2>
<p><strong>Final Step:</strong></p>
<p>Decide on the model of E[Y|X]:</p>
<ul>
<li><p>linear in both “sides” with same slope</p></li>
<li><p>linear with different slopes</p></li>
<li><p>non-linear</p></li>
</ul>
<p><strong>Tip</strong>: always execute a visual inspection to check which model os appropriate.</p>
<p>Also, always estimate different models and discuss the results.</p>
</section>
<section id="estimation-8" class="slide level2 smaller" data-background="#d4d3bc">
<h2>Estimation</h2>
<p><strong>fuzzy RDD</strong></p>
<p><span class="math display">\[Y_i = \alpha + \beta_1 D_a + \beta_2 \tilde{x}_1 + \beta_3(Z \times \tilde{x}_1) \epsilon\]</span></p>
<p>Where Z is 1 if unit is above the cut or 0 if unit is below the cut.</p>
<p>Notice that D is not equal to Z, in these cases.</p>
</section></section>
<section>
<section id="rdd-nonlinearities" class="title-slide slide level1 smaller center" data-background="#f2f1d5">
<h1>RDD Nonlinearities</h1>

</section>
<section id="rdd-nonlinearities-1" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p><strong><a href="https://www.masteringmetrics.com/">Example Mastering Metrics</a>:</strong></p>
<p>This is a linear relationship, with the same slopes.</p>

<img data-src="figs/rdd3.png" class="r-stretch"><p><span class="math display">\[E[Y|X,D] = \alpha + \beta_1 \times D + \beta_2 \times \tilde{X}\]</span></p>
</section>
<section id="rdd-nonlinearities-2" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p><a href="https://theeffectbook.net/ch-DifferenceinDifference.html">The effect</a> This is a linear relationship, with different slopes.</p>

<img data-src="figs/rdd_diff_slope.png" class="r-stretch"></section>
<section id="rdd-nonlinearities-3" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p><strong><a href="https://www.masteringmetrics.com/">Example Mastering Metrics</a>:</strong></p>
<p>This is a nonlinear relationship.</p>

<img data-src="figs/rdd4.png" class="r-stretch"></section>
<section id="rdd-nonlinearities-4" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p><strong><a href="https://www.masteringmetrics.com/">Example Mastering Metrics</a>:</strong></p>
<p>Is the relationship linear or nonlinear here? If you misjudge the relationship, it will be hard to tell a story credibly.</p>

<img data-src="figs/rdd5.png" class="r-stretch"></section>
<section id="rdd-nonlinearities-5" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p><strong>The takeaway:</strong> <strong>RDD is a graphical method. You need to show the graphs</strong>.</p>
<p><strong>Nobody will believe your story without the correct specification of the model</strong>.</p>
<div class="fragment">
<p>In the first case:</p>
<p><span class="math display">\[Y_i = \alpha + \beta_1 D_a + \beta_2 x_1 + \epsilon\]</span></p>
<p>In the second case:</p>
<p><span class="math display">\[Y_i = \alpha + \beta_1 D_a + \beta_2 x_1 + \beta_3 x_1^2 + \epsilon\]</span></p>
</div>
</section>
<section id="rdd-nonlinearities-6" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p>We can also add an interaction term (notice that I am changing the notation now to make it similar to MM)</p>
<p><span class="math display">\[Y_i = \alpha + \beta_1 D_a + \beta_2 (x - x_0) + \beta_3 (x - x_0) D_a + \epsilon\]</span></p>
<p>This allows for different inclinations before and after the cut.</p>
</section>
<section id="rdd-nonlinearities-7" class="slide level2 smaller" data-background="#f2f1d5">
<h2>RDD Nonlinearities</h2>
<p>Or even different nonlinearities before and after the cut:</p>
<p><span class="math display">\[Y_i = \alpha + \beta_1 D_a + \beta_2 (x - x_0) + \beta_3 (x - x_0)^2 + \beta_4 (x - x_0) D_a  + \beta_5 (x - x_0)^2 D_a + \epsilon\]</span></p>

<img data-src="figs/rdd6.png" class="r-stretch"></section></section>
<section>
<section id="example-rdd" class="title-slide slide level1 smaller center" data-background="#edecc0">
<h1>Example RDD</h1>

</section>
<section id="example-rdd-clearly-this-is-not-linear." class="slide level2 smaller" data-background="#edecc0">
<h2>Example RDD <strong>Clearly, this is not linear.</strong></h2>
<div class="panel-tabset">
<ul id="tabset-9" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-9-1">R</a></li><li><a href="#tabset-9-2">Python</a></li><li><a href="#tabset-9-3">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a><span class="fu">library</span>(readxl)</span>
<span id="cb42-2"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-3"><a></a>data  <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb42-4"><a></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y))  <span class="sc">+</span> </span>
<span id="cb42-5"><a></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span> </span>
<span id="cb42-6"><a></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">title =</span> <span class="st">"Evolution of Y"</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">20</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb42-8"><a></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">colour =</span> <span class="st">"grey95"</span>),</span>
<span id="cb42-9"><a></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb42-10"><a></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb42-11"><a></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb42-12"><a></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb42-13"><a></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-19-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Python</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb43-2"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb43-3"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb43-4"><a></a><span class="co"># Read Excel file</span></span>
<span id="cb43-5"><a></a>data <span class="op">=</span> pd.read_excel(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb43-6"><a></a><span class="co"># Generate line graph - Including all observations together</span></span>
<span id="cb43-7"><a></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb43-8"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb43-9"><a></a>scatter_plot <span class="op">=</span> sns.scatterplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, data<span class="op">=</span>data, s<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb43-10"><a></a>scatter_plot.set_title(<span class="st">"Evolution of Y"</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-11"><a></a>scatter_plot.set_xlabel(<span class="st">""</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-12"><a></a>scatter_plot.set_ylabel(<span class="st">""</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-13"><a></a><span class="co"># Add regression line</span></span>
<span id="cb43-14"><a></a>sns.regplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, data<span class="op">=</span>data, scatter<span class="op">=</span><span class="va">False</span>, line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'blue'</span>})</span>
<span id="cb43-15"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-20-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-3">
<div class="cell" data-layout-align="center">

</div>
<p><img data-src="figs/graph1.svg"></p>
</div>
</div>
</div>
</section>
<section id="example-rdd-1" class="slide level2 smaller" data-background="#edecc0">
<h2>Example RDD</h2>
<div class="panel-tabset">
<ul id="tabset-10" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-10-1">R</a></li><li><a href="#tabset-10-2">Python</a></li><li><a href="#tabset-10-3">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a><span class="fu">library</span>(readxl)</span>
<span id="cb44-2"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb44-3"><a></a>data  <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb44-4"><a></a><span class="co"># Creating  groups</span></span>
<span id="cb44-5"><a></a>data<span class="sc">$</span>treated <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb44-6"><a></a>data<span class="sc">$</span>treated[data<span class="sc">$</span>x <span class="sc">&gt;=</span> <span class="dv">101</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb44-7"><a></a><span class="co"># Generate a line graph - two groups</span></span>
<span id="cb44-8"><a></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y, <span class="at">group=</span>treated, <span class="at">color =</span> <span class="fu">factor</span>(treated)))  <span class="sc">+</span> </span>
<span id="cb44-9"><a></a>    <span class="fu">geom_point</span>( <span class="at">size=</span><span class="fl">1.25</span>) <span class="sc">+</span> </span>
<span id="cb44-10"><a></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">title =</span> <span class="st">"RDD exemplo"</span>)<span class="sc">+</span></span>
<span id="cb44-11"><a></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">25</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb44-12"><a></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">colour =</span> <span class="st">"grey95"</span>),</span>
<span id="cb44-13"><a></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb44-14"><a></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb44-15"><a></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb44-16"><a></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb44-17"><a></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-22-3.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Python</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-2"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-3"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb45-4"><a></a><span class="co"># Read Excel file</span></span>
<span id="cb45-5"><a></a>data <span class="op">=</span> pd.read_excel(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb45-6"><a></a><span class="co"># Create treated variable</span></span>
<span id="cb45-7"><a></a>data[<span class="st">'treated'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb45-8"><a></a>data.loc[data[<span class="st">'x'</span>] <span class="op">&gt;=</span> <span class="dv">101</span>, <span class="st">'treated'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb45-9"><a></a><span class="co"># Generate line graph with two groups</span></span>
<span id="cb45-10"><a></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb45-11"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb45-12"><a></a>scatter_plot <span class="op">=</span> sns.scatterplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, hue<span class="op">=</span><span class="st">'treated'</span>, style<span class="op">=</span><span class="st">'treated'</span>, data<span class="op">=</span>data, s<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb45-13"><a></a>scatter_plot.set_title(<span class="st">"RDD exemplo"</span>, fontsize<span class="op">=</span><span class="dv">25</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb45-14"><a></a>scatter_plot.set_xlabel(<span class="st">""</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb45-15"><a></a>scatter_plot.set_ylabel(<span class="st">""</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb45-16"><a></a>scatter_plot.legend().set_title(<span class="st">''</span>)</span>
<span id="cb45-17"><a></a>scatter_plot.legend(title<span class="op">=</span><span class="st">''</span>, loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="st">'small'</span>)</span>
<span id="cb45-18"><a></a><span class="co"># Add regression lines</span></span>
<span id="cb45-19"><a></a>sns.regplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, data<span class="op">=</span>data[data[<span class="st">'treated'</span>] <span class="op">==</span> <span class="dv">0</span>], scatter<span class="op">=</span><span class="va">False</span>, line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'blue'</span>})</span>
<span id="cb45-20"><a></a>sns.regplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, data<span class="op">=</span>data[data[<span class="st">'treated'</span>] <span class="op">==</span> <span class="dv">1</span>], scatter<span class="op">=</span><span class="va">False</span>, line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'orange'</span>})</span>
<span id="cb45-21"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-23-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-3">
<div class="cell" data-layout-align="center">

</div>
<p><img data-src="figs/graph2.svg"></p>
</div>
</div>
</div>
</section>
<section id="example-rdd-2" class="slide level2 smaller" data-background="#edecc0">
<h2>Example RDD</h2>
<div class="panel-tabset">
<ul id="tabset-11" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-11-1">R</a></li><li><a href="#tabset-11-2">Python</a></li><li><a href="#tabset-11-3">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a><span class="fu">library</span>(readxl)</span>
<span id="cb46-2"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb46-3"><a></a>data  <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb46-4"><a></a><span class="co"># Creating  groups</span></span>
<span id="cb46-5"><a></a>data<span class="sc">$</span>treated <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb46-6"><a></a>data<span class="sc">$</span>treated[data<span class="sc">$</span>x <span class="sc">&gt;=</span> <span class="dv">101</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb46-7"><a></a><span class="co"># define cut</span></span>
<span id="cb46-8"><a></a>cut <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb46-9"><a></a>band <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb46-10"><a></a>xlow <span class="ot">=</span> cut <span class="sc">-</span> band</span>
<span id="cb46-11"><a></a>xhigh <span class="ot">=</span> cut <span class="sc">+</span> band</span>
<span id="cb46-12"><a></a><span class="co"># subset the data for the bandwidth</span></span>
<span id="cb46-13"><a></a>data <span class="ot">&lt;-</span> <span class="fu">subset</span>(data, x <span class="sc">&gt;</span> xlow <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> xhigh, <span class="at">select=</span><span class="fu">c</span>(x, y,  treated))</span>
<span id="cb46-14"><a></a><span class="co"># Generate a line graph - two groups</span></span>
<span id="cb46-15"><a></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y, <span class="at">group=</span>treated, <span class="at">color =</span> <span class="fu">factor</span>(treated)))  <span class="sc">+</span> </span>
<span id="cb46-16"><a></a>  <span class="fu">geom_point</span>( <span class="at">size=</span><span class="fl">1.25</span>) <span class="sc">+</span> </span>
<span id="cb46-17"><a></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>, <span class="at">x=</span><span class="st">""</span>, <span class="at">title =</span> <span class="st">"RDD example"</span>)<span class="sc">+</span></span>
<span id="cb46-18"><a></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">25</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb46-19"><a></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">colour =</span> <span class="st">"grey95"</span>),</span>
<span id="cb46-20"><a></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb46-21"><a></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb46-22"><a></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb46-23"><a></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb46-24"><a></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-25-3.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-11-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Python</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-2"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb47-3"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb47-4"><a></a><span class="co"># Read Excel file</span></span>
<span id="cb47-5"><a></a>data <span class="op">=</span> pd.read_excel(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb47-6"><a></a><span class="co"># Create treated variable</span></span>
<span id="cb47-7"><a></a>data[<span class="st">'treated'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-8"><a></a>data.loc[data[<span class="st">'x'</span>] <span class="op">&gt;=</span> <span class="dv">101</span>, <span class="st">'treated'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb47-9"><a></a><span class="co"># Define cut, band, and subset data</span></span>
<span id="cb47-10"><a></a>cut <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb47-11"><a></a>band <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb47-12"><a></a>xlow <span class="op">=</span> cut <span class="op">-</span> band</span>
<span id="cb47-13"><a></a>xhigh <span class="op">=</span> cut <span class="op">+</span> band</span>
<span id="cb47-14"><a></a>data <span class="op">=</span> data[(data[<span class="st">'x'</span>] <span class="op">&gt;</span> xlow) <span class="op">&amp;</span> (data[<span class="st">'x'</span>] <span class="op">&lt;=</span> xhigh)][[<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'treated'</span>]]</span>
<span id="cb47-15"><a></a><span class="co"># Generate line graph with two groups</span></span>
<span id="cb47-16"><a></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb47-17"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb47-18"><a></a>scatter_plot <span class="op">=</span> sns.scatterplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, hue<span class="op">=</span><span class="st">'treated'</span>, style<span class="op">=</span><span class="st">'treated'</span>, data<span class="op">=</span>data, s<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb47-19"><a></a>scatter_plot.set_title(<span class="st">"RDD example"</span>, fontsize<span class="op">=</span><span class="dv">25</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-20"><a></a>scatter_plot.set_xlabel(<span class="st">""</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-21"><a></a>scatter_plot.set_ylabel(<span class="st">""</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-22"><a></a>scatter_plot.legend().set_title(<span class="st">''</span>)</span>
<span id="cb47-23"><a></a>scatter_plot.legend(title<span class="op">=</span><span class="st">''</span>, loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="st">'small'</span>)</span>
<span id="cb47-24"><a></a><span class="co"># Add regression lines</span></span>
<span id="cb47-25"><a></a>sns.regplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, data<span class="op">=</span>data[data[<span class="st">'treated'</span>] <span class="op">==</span> <span class="dv">0</span>], scatter<span class="op">=</span><span class="va">False</span>, line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'blue'</span>})</span>
<span id="cb47-26"><a></a>sns.regplot(x<span class="op">=</span><span class="st">'x'</span>, y<span class="op">=</span><span class="st">'y'</span>, data<span class="op">=</span>data[data[<span class="st">'treated'</span>] <span class="op">==</span> <span class="dv">1</span>], scatter<span class="op">=</span><span class="va">False</span>, line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'orange'</span>})</span>
<span id="cb47-27"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="part_2_files/figure-revealjs/unnamed-chunk-26-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-11-3">
<div class="cell" data-layout-align="center">

</div>
<p><img data-src="figs/graph3.svg"></p>
</div>
</div>
</div>
</section>
<section id="example-rdd-3" class="slide level2 smaller" data-background="#edecc0">
<h2>Example RDD</h2>
<div class="panel-tabset">
<ul id="tabset-12" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-12-1">R</a></li><li><a href="#tabset-12-2">Python</a></li><li><a href="#tabset-12-3">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>R</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a><span class="fu">library</span>(readxl)</span>
<span id="cb48-2"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb48-3"><a></a>data  <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb48-4"><a></a>data<span class="sc">$</span>treated <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb48-5"><a></a>data<span class="sc">$</span>treated[data<span class="sc">$</span>x <span class="sc">&gt;=</span> <span class="dv">101</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb48-6"><a></a>cut <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb48-7"><a></a>band <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb48-8"><a></a>xlow <span class="ot">=</span> cut <span class="sc">-</span> band</span>
<span id="cb48-9"><a></a>xhigh <span class="ot">=</span> cut <span class="sc">+</span> band</span>
<span id="cb48-10"><a></a>data <span class="ot">&lt;-</span> <span class="fu">subset</span>(data, x <span class="sc">&gt;</span> xlow <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> xhigh, <span class="at">select=</span><span class="fu">c</span>(x, y,  treated))</span>
<span id="cb48-11"><a></a><span class="co"># Generating xhat - Now we are going to the RDD</span></span>
<span id="cb48-12"><a></a>data<span class="sc">$</span>xhat <span class="ot">&lt;-</span> data<span class="sc">$</span>x <span class="sc">-</span> cut</span>
<span id="cb48-13"><a></a><span class="co"># Generating xhat * treated to allow different inclinations (we will use the findings of the last graph, i.e. that each group has a different trend.)</span></span>
<span id="cb48-14"><a></a>data<span class="sc">$</span>xhat_treated <span class="ot">&lt;-</span> data<span class="sc">$</span>xhat <span class="sc">*</span> data<span class="sc">$</span>treated</span>
<span id="cb48-15"><a></a><span class="co"># RDD Assuming different trends</span></span>
<span id="cb48-16"><a></a>rdd <span class="ot">&lt;-</span> <span class="fu">lm</span>(y  <span class="sc">~</span> xhat <span class="sc">+</span> treated  <span class="sc">+</span> xhat_treated, <span class="at">data =</span> data)</span>
<span id="cb48-17"><a></a><span class="fu">summary</span>(rdd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ xhat + treated + xhat_treated, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.9477  -3.2607   0.6875   3.2227  12.2004 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  55.83059    1.53681  36.329  &lt; 2e-16 ***
xhat          0.29431    0.05405   5.445 3.97e-07 ***
treated      28.93921    2.20672  13.114  &lt; 2e-16 ***
xhat_treated -0.51587    0.07644  -6.749 1.13e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.515 on 96 degrees of freedom
Multiple R-squared:  0.8942,    Adjusted R-squared:  0.8909 
F-statistic: 270.3 on 3 and 96 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Python</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb50-2"><a></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb50-3"><a></a>data <span class="op">=</span> pd.read_excel(<span class="st">"files/RDD.xlsx"</span>)</span>
<span id="cb50-4"><a></a><span class="co"># Generate treated variable</span></span>
<span id="cb50-5"><a></a>data[<span class="st">'treated'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb50-6"><a></a>data.loc[data[<span class="st">'x'</span>] <span class="op">&gt;=</span> <span class="dv">101</span>, <span class="st">'treated'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb50-7"><a></a><span class="co"># Define cut and band</span></span>
<span id="cb50-8"><a></a>cut <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb50-9"><a></a>band <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb50-10"><a></a>xlow <span class="op">=</span> cut <span class="op">-</span> band</span>
<span id="cb50-11"><a></a>xhigh <span class="op">=</span> cut <span class="op">+</span> band</span>
<span id="cb50-12"><a></a><span class="co"># Subset data</span></span>
<span id="cb50-13"><a></a>data <span class="op">=</span> data[(data[<span class="st">'x'</span>] <span class="op">&gt;</span> xlow) <span class="op">&amp;</span> (data[<span class="st">'x'</span>] <span class="op">&lt;=</span> xhigh)]</span>
<span id="cb50-14"><a></a><span class="co"># Generate xhat and xhat_treated</span></span>
<span id="cb50-15"><a></a>data[<span class="st">'xhat'</span>] <span class="op">=</span> data[<span class="st">'x'</span>] <span class="op">-</span> cut</span>
<span id="cb50-16"><a></a>data[<span class="st">'xhat_treated'</span>] <span class="op">=</span> data[<span class="st">'xhat'</span>] <span class="op">*</span> data[<span class="st">'treated'</span>]</span>
<span id="cb50-17"><a></a><span class="co"># Regression</span></span>
<span id="cb50-18"><a></a>X <span class="op">=</span> data[[<span class="st">'xhat'</span>, <span class="st">'treated'</span>, <span class="st">'xhat_treated'</span>]]</span>
<span id="cb50-19"><a></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add a constant term</span></span>
<span id="cb50-20"><a></a>y <span class="op">=</span> data[<span class="st">'y'</span>]</span>
<span id="cb50-21"><a></a>model <span class="op">=</span> sm.OLS(y, X).fit()</span>
<span id="cb50-22"><a></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.894
Model:                            OLS   Adj. R-squared:                  0.891
Method:                 Least Squares   F-statistic:                     270.3
Date:                ter, 30 jan 2024   Prob (F-statistic):           1.14e-46
Time:                        15:36:45   Log-Likelihood:                -310.60
No. Observations:                 100   AIC:                             629.2
Df Residuals:                      96   BIC:                             639.6
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
const           55.8306      1.537     36.329      0.000      52.780      58.881
xhat             0.2943      0.054      5.445      0.000       0.187       0.402
treated         28.9392      2.207     13.114      0.000      24.559      33.320
xhat_treated    -0.5159      0.076     -6.749      0.000      -0.668      -0.364
==============================================================================
Omnibus:                        0.995   Durbin-Watson:                   2.114
Prob(Omnibus):                  0.608   Jarque-Bera (JB):                1.079
Skew:                          -0.221   Prob(JB):                        0.583
Kurtosis:                       2.747   Cond. No.                         151.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</div>
<div id="tabset-12-3">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb52-1"><a></a>import excel <span class="st">"files/RDD.xlsx"</span>, firstrow <span class="kw">clear</span></span>
<span id="cb52-2"><a></a><span class="kw">gen</span> treated = 0</span>
<span id="cb52-3"><a></a><span class="kw">replace</span> treated = 1 <span class="kw">if</span> x &gt;= 101</span>
<span id="cb52-4"><a></a><span class="kw">gen</span> <span class="fu">cut</span> = 100</span>
<span id="cb52-5"><a></a><span class="kw">gen</span> band = 50</span>
<span id="cb52-6"><a></a><span class="kw">gen</span> xlow = <span class="fu">cut</span> - band</span>
<span id="cb52-7"><a></a><span class="kw">gen</span> xhigh = <span class="fu">cut</span> + band</span>
<span id="cb52-8"><a></a><span class="kw">keep</span> <span class="kw">if</span> x &gt; xlow &amp; x &lt;= xhigh</span>
<span id="cb52-9"><a></a><span class="kw">gen</span> xhat = x - <span class="fu">cut</span></span>
<span id="cb52-10"><a></a><span class="kw">gen</span> xhat_treated = xhat * treated</span>
<span id="cb52-11"><a></a><span class="kw">regress</span> <span class="fu">y</span> xhat treated xhat_treated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(2 vars, 200 obs)


(100 real changes made)





(100 observations deleted)

      Source |       SS           df       MS      Number of obs   =       100
-------------+----------------------------------   F(3, 96)        =    270.35
       Model |  24669.3025         3  8223.10084   Prob &gt; F        =    0.0000
    Residual |  2920.00749        96  30.4167447   R-squared       =    0.8942
-------------+----------------------------------   Adj R-squared   =    0.8909
       Total |    27589.31        99  278.679899   Root MSE        =    5.5151

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        xhat |   .2943097   .0540479     5.45   0.000     .1870255     .401594
     treated |   28.93921   2.206717    13.11   0.000     24.55891    33.31951
xhat_treated |  -.5158703   .0764353    -6.75   0.000    -.6675932   -.3641475
       _cons |   55.83059   1.536805    36.33   0.000     52.78005    58.88112
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-rdd-4" class="slide level2 smaller" data-background="#edecc0">
<h2>Example RDD</h2>
<p>The coefficient of x before the cut is 0.29 (t-stat 5.45), and after the cut, it is -0.51 (t-stat -6.75).</p>
<p>We also have the coefficient of the treatment, which is measured by the “jump” that occurs near the cut: <strong>an estimated coefficient of 28.9 (t-stat 13.11). </strong></p>
<p>If this were a real example, this would be the causal effect of receiving the treatment (i.e., being beyond the cut).</p>
</section></section>
<section>
<section id="final-comments-rdd" class="title-slide slide level1 smaller center" data-background="#f0eeb4">
<h1>Final comments RDD</h1>

</section>
<section id="final-comments-rdd-1" class="slide level2 smaller" data-background="#f0eeb4">
<h2>Final comments RDD</h2>
<p><strong>Sensitivity to specification</strong></p>
<p>Misspecification can lead to a “spurious jump”. <strong>Do not mix nonlinearity with a discontinuity</strong>.</p>
<div class="fragment">
<p><strong>Sensitivity to window</strong></p>
<p>Also, need to check many alternative <span class="math inline">\(h\)</span>.</p>
</div>
<div class="fragment">
<p><strong>Smoothness of the running around the cut</strong></p>
<p>The distribution of X should be smooth around the cut. If it is not, it might indicate that the treatment assignment was not random.</p>
</div>
<div class="fragment">
<p><strong>Test comparability of units around the cut</strong></p>
<p>Covariates balance. You can check whether there are jumps in control variables as an additional robustness.</p>
</div>
<div class="fragment">
<p><strong>Placebo tests</strong></p>
<p>Test whether the treatment is zero when it should be zero.</p>
</div>
</section></section>
<section>
<section id="synthetic-control" class="title-slide slide level1 smaller center" data-background="#f2c7c4">
<h1>Synthetic Control</h1>

</section>
<section id="synthetic-control-1" class="slide level2 smaller" data-background="#f2c7c4">
<h2>Synthetic Control</h2>
<p>It is a method to estimate the effect of events or policy interventions, often at an <strong>aggregate level</strong> (cities, states, etc.)</p>
<p>The event occurs often in <strong>only one unit</strong>.</p>
<p>It compares the evolution of the outcome for the treated unit to the evolution of the control group.</p>
<ul>
<li>The control group contains many units.</li>
</ul>
<div class="fragment">
<p>The limitation is often the selection of the control group. It is very <strong>ambiguous</strong>.</p>
</div>
</section>
<section id="synthetic-control-2" class="slide level2 smaller" data-background="#f2c7c4">
<h2>Synthetic Control</h2>
<p><a href="https://doi.org/10.1198/jasa.2009.ap08746">Abadie, Diamond, and Hainmueller (2010)</a> apply synth by using a cigarette tax in California called Proposition 99.</p>
<p><em>In 1988, California passed comprehensive tobacco control legislation called Proposition 99.</em></p>
<p><em>Proposition 99 increased cigarette taxes by $0.25 a pack, spurred clean-air ordinances throughout the state, funded anti-smoking media campaigns, earmarked tax revenues to health and anti-smoking budgets, and produced more than $100 million a year in anti-tobacco projects.</em></p>
<p><em>Other states had similar control programs, and they were dropped from their analysis.</em> <a href="https://mixtape.scunning.com/10-synthetic_control#cuba-miami-and-the-mariel-boatlift">Mastering Metrics</a></p>
</section>
<section id="synthetic-control-3" class="slide level2 smaller" data-background="#f2c7c4">
<h2>Synthetic Control</h2>
<p>There was a trend before the treatment. <strong>How can we estimate the causal effect?</strong></p>

<img data-src="figs/synth1.png" class="r-stretch"></section>
<section id="synthetic-control-4" class="slide level2 smaller" data-background="#f2c7c4">
<h2>Synthetic Control</h2>
<p>The goal is to elect an optimal set of weights that when applied to the rest of the country produces the following figure:</p>

<img data-src="figs/synth3.png" class="r-stretch"></section>
<section id="synthetic-control-5" class="slide level2 smaller" data-background="#f2c7c4">
<h2>Synthetic Control</h2>
<p>The variables used for computing the weights are the following. You are creating weights such that weighting the other states, you can create a synthetic California. <strong>Notice that, so far, the product of this analysis is only two data points per period.</strong></p>

<img data-src="figs/synth2.png" class="r-stretch"></section>
<section id="synthetic-control-6" class="slide level2 smaller" data-background="#f2c7c4">
<h2>Synthetic Control</h2>
<p><strong>Tip</strong>: Synth is also an graphical method, so graphs like the following are common. This is the difference between the two series.</p>

<img data-src="figs/synth4.png" class="r-stretch"></section></section>
<section>
<section id="inference" class="title-slide slide level1 smaller center" data-background="#d49692">
<h1>Inference</h1>

</section>
<section id="inference-1" class="slide level2 smaller" data-background="#d49692">
<h2>Inference</h2>
<p><strong>Notice that, so far, the product of this analysis is only two data points per period.</strong> How can you stablish a “significant” causal effect?</p>
<p><strong>Steps</strong></p>
<ol type="1">
<li><p>Apply synth to each state in the control group (also called “donor pool”).</p></li>
<li><p>Obtain a distribution of placebos.</p></li>
<li><p>Compare the gap for California to the distribution of the placebo gaps.</p></li>
<li><p>Then, test whether the effect for the treated unit is large enough relative to the placebos (i.e., to the effect estimated for a placebo unit randomly selected).</p></li>
</ol>
</section>
<section id="inference-2" class="slide level2 smaller" data-background="#d49692">
<h2>Inference</h2>
<p>Notice the bold line (treated unit) after the treatment. It is at the bottom.</p>

<img data-src="figs/synth5.png" class="r-stretch"></section>
<section id="inference-3" class="slide level2 smaller" data-background="#d49692">
<h2>Inference</h2>
<p><em>Abadie, Diamond, and Hainmueller (2010) recommend iteratively dropping the states whose pre-treatment RMSPE is considerably different than California’s because as you can see, they’re kind of blowing up the scale and making it hard to see what’s going on.</em> <a href="https://mixtape.scunning.com/10-synthetic_control#cuba-miami-and-the-mariel-boatlift">Mastering Metrics</a></p>

<img data-src="figs/synth6.png" class="r-stretch"></section>
<section id="inference-4" class="slide level2 smaller" data-background="#d49692">
<h2>Inference</h2>
<p>The previous figure suggests the effect is large enough relative to the placebo effects.</p>
<div class="fragment">
<ol type="1">
<li>The root mean squared prediction error (RMSPE) is:</li>
</ol>
<p><span class="math display">\[RMSPE = \bigg (\dfrac{1}{T-T_0} \sum_{t=T_0+t}^T \bigg (Y_{1t} - \sum_{j=2}^{J+1} w_j^* Y_{jt} \bigg )^2 \bigg )^{\tfrac{1}{2}}\]</span></p>
<p><em>It shows how far predictions fall from measured true values using Euclidean distance.</em></p>
<ol start="2" type="1">
<li><p>Sort the ratio post- to pre-treatment RMSPE in descending order</p></li>
<li><p>Calculate the p-value as <span class="math inline">\(\frac{Rank}{Total}\)</span>.</p></li>
</ol>
</div>
<div class="fragment">
<p>Basically, these steps give how likely is the occurrence of the treated unit distance vis-a-vis the average placebo.</p>
</div>
</section>
<section id="inference-5" class="slide level2 smaller" data-background="#d49692">
<h2>Inference</h2>
<p><strong>RMSPE</strong>: in the previous example, California has the largest increase in the error after the treatment. Position 1 out of 39 states, implying an exact p-value of <span class="math inline">\(\frac{1}{38}=0.026\)</span> (significant).</p>

<img data-src="figs/synth7.png" class="r-stretch"></section></section>
<section>
<section id="example-synth" class="title-slide slide level1 smaller center" data-background="#f5a7a2">
<h1>Example Synth</h1>

</section>
<section id="example-synth-1" class="slide level2 smaller" data-background="#f5a7a2">
<h2>Example Synth</h2>
<div class="panel-tabset">
<ul id="tabset-13" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-13-1">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb54-1"><a></a><span class="kw">use</span> files/synth_smoking.dta , <span class="kw">clear</span></span>
<span id="cb54-2"><a></a><span class="kw">tsset</span> state <span class="fu">year</span></span>
<span id="cb54-3"><a></a>synth cigsale beer(1984(1)1988) lnincome retprice age15to24 cigsale(1988) cigsale(1980) cigsale(1975), trunit(3) trperiod(1989) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Tobacco Sales in 39 US States)


Panel variable: state (strongly balanced)
 Time variable: year, 1970 to 2000
         Delta: 1 unit

-------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-------------------------------------------------------------------------------

First Step: Data Setup
-------------------------------------------------------------------------------
control units: for 38 of out 38 units missing obs for predictor lnincome in per
&gt; iod 1970 -ignored for averaging
control units: for 38 of out 38 units missing obs for predictor lnincome in per
&gt; iod 1971 -ignored for averaging
treated unit: for 1 of out 1 units missing obs for predictor lnincome in period
&gt;  1970 -ignored for averaging
treated unit: for 1 of out 1 units missing obs for predictor lnincome in period
&gt;  1971 -ignored for averaging
-------------------------------------------------------------------------------
Data Setup successful
-------------------------------------------------------------------------------
                Treated Unit: California
               Control Units: Alabama, Arkansas, Colorado, Connecticut,
                              Delaware, Georgia, Idaho, Illinois, Indiana,
                              Iowa, Kansas, Kentucky, Louisiana, Maine,
                              Minnesota, Mississippi, Missouri, Montana,
                              Nebraska, Nevada, New Hampshire, New Mexico,
                              North Carolina, North Dakota, Ohio, Oklahoma,
                              Pennsylvania, Rhode Island, South Carolina, South
                              Dakota, Tennessee, Texas, Utah, Vermont,
                              Virginia, West Virginia, Wisconsin, Wyoming
-------------------------------------------------------------------------------
          Dependent Variable: cigsale
  MSPE minimized for periods: 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979
                              1980 1981 1982 1983 1984 1985 1986 1987 1988
Results obtained for periods: 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979
                              1980 1981 1982 1983 1984 1985 1986 1987 1988 1989
                              1990 1991 1992 1993 1994 1995 1996 1997 1998 1999
                              2000
-------------------------------------------------------------------------------
                  Predictors: beer(1984(1)1988) lnincome retprice age15to24
                              cigsale(1988) cigsale(1980) cigsale(1975)
-------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979
                              1980 1981 1982 1983 1984 1985 1986 1987 1988
-------------------------------------------------------------------------------

Second Step: Run Optimization
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
Optimization done
-------------------------------------------------------------------------------

Third Step: Obtain Results
-------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  1.943233 
---------------------
-------------------------------------------------------------------------------
Unit Weights:

----------------------------
         Co_No | Unit_Weight
---------------+------------
       Alabama |           0
      Arkansas |           0
      Colorado |        .285
   Connecticut |        .101
      Delaware |           0
       Georgia |           0
         Idaho |           0
      Illinois |           0
       Indiana |           0
          Iowa |           0
        Kansas |           0
      Kentucky |           0
     Louisiana |           0
         Maine |           0
     Minnesota |           0
   Mississippi |           0
      Missouri |           0
       Montana |           0
      Nebraska |           0
        Nevada |        .245
 New Hampshire |           0
    New Mexico |           0
North Carolina |           0
  North Dakota |           0
          Ohio |           0
      Oklahoma |           0
  Pennsylvania |           0
  Rhode Island |           0
South Carolina |           0
  South Dakota |           0
     Tennessee |           0
         Texas |           0
          Utah |        .369
       Vermont |           0
      Virginia |           0
 West Virginia |           0
     Wisconsin |           0
       Wyoming |           0
----------------------------
-------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
             beer(1984(1)1988) |     24.28   23.22596 
                      lnincome |  10.03176   9.867266 
                      retprice |  66.63684   65.40743 
                     age15to24 |  .1786624   .1825559 
                 cigsale(1988) |      90.1    92.6063 
                 cigsale(1980) |     120.2   120.3907 
                 cigsale(1975) |     127.1   126.7094 
------------------------------------------------------
-------------------------------------------------------------------------------

counter | pri_inf  | dual_inf  | pri_obj   | dual_obj  | sigfig | alpha  | nu 
----------------------------------------------------------------------------------
      0 | 8.29e+001 | 7.80e-006 | -1.26e+001 | -3.93e+002 |  0.000 | 0.0000 | 1.00e+002
      1 | 5.04e-001 | 4.74e-008 | -1.26e+001 | -7.02e+002 |  0.000 | 0.9939 | 3.05e-005
      2 | 2.85e-003 | 2.68e-010 | -1.25e+001 | -2.80e+001 |  0.000 | 0.9943 | 2.70e-006
      3 | 1.60e-004 | 1.51e-011 | -1.26e+001 | -1.34e+001 |  1.193 | 0.9438 | 5.40e-006
      4 | 1.57e-005 | 1.47e-012 | -1.26e+001 | -1.27e+001 |  2.000 | 0.9022 | 9.21e-007
      5 | 9.72e-006 | 9.13e-013 | -1.26e+001 | -1.27e+001 |  2.207 | 0.3806 | 6.37e-006
      6 | 2.91e-006 | 2.73e-013 | -1.26e+001 | -1.26e+001 |  2.714 | 0.7006 | 8.69e-007
      7 | 5.05e-007 | 4.75e-014 | -1.26e+001 | -1.26e+001 |  3.414 | 0.8263 | 8.90e-008
      8 | 1.70e-007 | 1.60e-014 | -1.26e+001 | -1.26e+001 |  3.881 | 0.6640 | 6.85e-008
      9 | 2.24e-008 | 2.10e-015 | -1.26e+001 | -1.26e+001 |  4.685 | 0.8682 | 3.46e-009
     10 | 2.57e-010 | 2.43e-017 | -1.26e+001 | -1.26e+001 |  6.512 | 0.9885 | 4.02e-012
     11 | 1.28e-012 | 1.87e-018 | -1.26e+001 | -1.26e+001 |  8.807 | 0.9950 | 1.14e-014
     12 | 6.45e-015 | 1.86e-018 | -1.26e+001 | -1.26e+001 | 11.104 | 0.9950 | 5.78e-017
     13 | 8.88e-016 | 2.02e-018 | -1.26e+001 | -1.26e+001 | 13.407 | 0.9950 | 2.91e-019
----------------------------------------------------------------------------------
optimization converged</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-synth-2" class="slide level2 smaller" data-background="#f5a7a2">
<h2>Example Synth</h2>
<div class="panel-tabset">
<ul id="tabset-14" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-14-1">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb56-1"><a></a><span class="kw">use</span> files/synth_smoking.dta , <span class="kw">clear</span></span>
<span id="cb56-2"><a></a>synth cigsale beer lnincome(1980&amp;1985) retprice cigsale(1988) cigsale(1980) cigsale(1975), trunit(3) trperiod(1989) fig</span>
<span id="cb56-3"><a></a><span class="kw">quietly</span> <span class="kw">graph</span> <span class="kw">export</span> figs/synth1.svg, <span class="kw">replace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img data-src="figs/synth1.svg"></p>
</div>
</div>
</div>
</section>
<section id="example-synth-3" class="slide level2 smaller" data-background="#f5a7a2">
<h2>Example Synth</h2>
<p><em>Authors using synthetic control must do more than merely run the synth command when doing comparative case studies.</em></p>
<p><em>They must find the exact-values through placebo-based inference, check for the quality of the pre-treatment fit, investigate the balance of the covariates used for matching, and check for the validity of the model through placebo estimation (e.g., rolling back the treatment date).</em></p>
</section></section>
<section>
<section id="mastering-metrics" class="title-slide slide level1 smaller center" data-background="#de938e">
<h1><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h1>

</section>
<section id="mastering-metrics-1" class="slide level2 smaller" data-background="#de938e">
<h2><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h2>
<p>In 1992, Texas expanded the prision system operational capacity.</p>

<img data-src="figs/synth8.png" class="r-stretch"></section>
<section id="mastering-metrics-2" class="slide level2 smaller" data-background="#de938e">
<h2><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h2>
<p>This is what happened.</p>

<img data-src="figs/synth9.png" class="r-stretch"></section>
<section id="mastering-metrics-3" class="slide level2 smaller" data-background="#de938e">
<h2><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h2>
<p>Synthetic Texas.</p>

<img data-src="figs/synth10.png" class="r-stretch"></section>
<section id="mastering-metrics-4" class="slide level2 smaller" data-background="#de938e">
<h2><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h2>
<p>Gap between Synthetic Texas and Texas.</p>

<img data-src="figs/synth11.png" class="r-stretch"></section>
<section id="mastering-metrics-5" class="slide level2 smaller" data-background="#de938e">
<h2><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h2>
<p>Building Placebos.</p>

<img data-src="figs/synth13.png" class="r-stretch"></section>
<section id="mastering-metrics-6" class="slide level2 smaller" data-background="#de938e">
<h2><a href="https://mixtape.scunning.com/10-synthetic_control#prison-construction-and-black-male-incarceration">Mastering Metrics</a></h2>
<p>Texas is the one in the far right tail.</p>

<img data-src="figs/synth12.png" class="r-stretch"></section></section>
<section>
<section id="introduction-iv" class="title-slide slide level1 smaller center" data-background="#bcd3f7">
<h1>Introduction IV</h1>

</section>
<section id="introduction-iv-1" class="slide level2 smaller" data-background="#bcd3f7">
<h2>Introduction IV</h2>
<p>Imagine the following model</p>
<p><span class="math display">\[Ln(wage)=\alpha + \beta_1 educ + \epsilon\]</span></p>
<p>We can infer that <em>educ</em> is correlated with <em>ability</em>, but the latter is in the error term.</p>
<p><em>educ</em> in this case is “endogenous”.</p>
<p><span class="math display">\[Cov(educ, \epsilon) \neq 0\]</span></p>
</section>
<section id="introduction-iv-2" class="slide level2 smaller" data-background="#bcd3f7">
<h2>Introduction IV</h2>
<p><strong>The setup of an IV is</strong></p>
<p>Suppose that we have an observable variable z that satisfies these two assumptions:</p>
<ol type="1">
<li>z is uncorrelated with u:</li>
</ol>
<p><span class="math display">\[Cov(z, \epsilon) = 0\]</span></p>
<ol start="2" type="1">
<li>z is correlated with x:</li>
</ol>
<p><span class="math display">\[Cov(z, x) \neq 0\]</span></p>
<p>Then, we call z an instrumental variable for x, or sometimes simply an instrument for x.</p>
</section>
<section id="introduction-iv-3" class="slide level2 smaller" data-background="#bcd3f7">
<h2>Introduction IV</h2>
<p>Before we continue,</p>
<p>IV is not a model, it is an <strong>estimation method</strong></p>
<p>I’ll call it a <strong>Design</strong>.</p>
<p>Do not say, I estimated an IV model (more often than it should be).</p>
</section></section>
<section>
<section id="instrumental-variables" class="title-slide slide level1 smaller center" data-background="#8eadde">
<h1>Instrumental Variables</h1>

</section>
<section id="instrumental-variables-1" class="slide level2 smaller" data-background="#8eadde">
<h2>Instrumental Variables</h2>
<p>Imagine that you have one independent variable that is “endogenous”:</p>
<ul>
<li><p><span class="math inline">\(Cov(x_k,\mu)\neq 0\)</span></p></li>
<li><p>You may have many other independent variables not “endogenous”</p></li>
</ul>
<div class="fragment">
<p>In this situation:</p>
<ul>
<li><p><span class="math inline">\(B_k\)</span> is biased</p></li>
<li><p>The other betas will likely be biased as well, since it is unlikely that all other Xs are not correlated with <span class="math inline">\(x_k\)</span></p></li>
</ul>
</div>
</section>
<section id="instrumental-variables-2" class="slide level2 smaller" data-background="#8eadde">
<h2>Instrumental Variables</h2>
<p><span class="math inline">\(x_k\)</span> is the endogenous variable.</p>
<ul>
<li><p>It has “good” variation:</p>
<ul>
<li>the part that varies that is not correlated with <span class="math inline">\(\mu\)</span></li>
</ul></li>
<li><p>It has “bad” variation:</p>
<ul>
<li>the part that varies that is correlated with <span class="math inline">\(\mu\)</span></li>
</ul></li>
</ul>
<div class="fragment">
<p>Let’s assume now that you can find an instrument <span class="math inline">\(z\)</span></p>
<ul>
<li><p>The instrument <span class="math inline">\(z\)</span> is correlated with <span class="math inline">\(X_k\)</span>, but only the “good” variation, not the “bad”.</p></li>
<li><p>The instrument <span class="math inline">\(z\)</span> does not explain <span class="math inline">\(y\)</span> directly, only through <span class="math inline">\(x_k\)</span>.</p>
<ul>
<li><strong>Only through</strong> condition.</li>
</ul></li>
</ul>
</div>
</section>
<section id="instrumental-variables-3" class="slide level2 smaller" data-background="#8eadde">
<h2>Instrumental Variables</h2>
<p><strong>Relevance Condition</strong></p>
<p>The instrument <span class="math inline">\(z\)</span> is correlated with <span class="math inline">\(x_k\)</span>.</p>
<ul>
<li><p>This assumption is easy to test. Simply run a regression of <span class="math inline">\(x=f(z, all\; Xs)\)</span> and check the significance of the <span class="math inline">\(\beta_z\)</span>.</p></li>
<li><p>This is called the <strong>first stage of an IV regression</strong></p>
<ul>
<li><strong>Tip</strong>: Always show the beta coefficient and the R2 (even if low) of the first-stage.</li>
</ul></li>
</ul>
<div class="fragment">
<p><strong>Exclusion Condition</strong></p>
<p>The instrument <span class="math inline">\(z\)</span> is not correlated with <span class="math inline">\(\mu\)</span>.</p>
<ul>
<li><p>That is <span class="math inline">\(cov(z,\mu) = 0\)</span></p></li>
<li><p>As all correlations with <span class="math inline">\(\mu\)</span>, you cannot test this prediction. You have to rely on the theory, create a story about that.</p></li>
</ul>
</div>
</section>
<section id="instrumental-variables-4" class="slide level2 smaller" data-background="#8eadde">
<h2>Instrumental Variables</h2>
<p><strong>An example of IV</strong> <a href="https://doi.org/10.1257/jep.20.4.111">Murray</a>.</p>

<img data-src="figs/iv2.png" class="r-stretch"></section>
<section id="instrumental-variables-5" class="slide level2 smaller" data-background="#8eadde">
<h2>Instrumental Variables</h2>
<p><strong>An example of IV</strong> <a href="http://dx.doi.org/10.1016/j.jcorpfin.2013.12.013">Murray</a>.</p>

<img data-src="figs/iv6.png" class="r-stretch"></section>
<section id="instrumental-variables-6" class="slide level2 smaller" data-background="#8eadde">
<h2>Instrumental Variables</h2>
<p><a href="https://mixtape.scunning.com/07-instrumental_variables#good-instruments-should-feel-weird">Mixtape</a></p>
<p><strong>Good instruments should feel weird</strong></p>
<p>Parents with two same-gender kids are more likely to try a third kid than a diverse-gender pair of parents.</p>
<p>So, you may use the gender of the kids as instrument for the likelihood of the mother go back to the labor market.</p>
</section></section>
<section>
<section id="angrists-example" class="title-slide slide level1 smaller center" data-background="#d2e2fc">
<h1>Angrist’s example</h1>

</section>
<section id="angrists-example-1" class="slide level2 smaller" data-background="#d2e2fc">
<h2>Angrist’s example</h2>
<p>Remember the <strong>Fuzzy RDD</strong>.</p>
<ul>
<li>There is the <em>treatment</em></li>
<li>There is the <em>position</em> (before or after the cut)</li>
</ul>
<p>The <em>position</em> is an indication of receiving or not the treatment, but it is not definitive.</p>
<p>Thus, we can use the <em>position</em> as an IV for the treatment.</p>
</section>
<section id="angrists-example-2" class="slide level2 smaller" data-background="#d2e2fc">
<h2>Angrist’s example</h2>
<p><a href="https://mixtape.scunning.com/07-instrumental_variables#the-problem-of-weak-instruments">Mixtape</a></p>
<p><em>One of the more seminal papers in instrumental variables for the modern period is Angrist and Krueger (1991).</em></p>
<p><em>Their idea is simple and clever; a quirk in the United States educational system is that a child enters a grade on the basis of his or her birthday.</em></p>
<p><em>For a long time, that cutoff was late December. If children were born on or before December 31, then they were assigned to the first grade. But if their birthday was on or after January 1, they were assigned to kindergarten. </em></p>
<p><em>Thus two people—one born on December 31 and one born on January 1—were exogenously assigned different grades.</em></p>
<p>Everyone is forced to leave school when 16.</p>
</section>
<section id="angrists-example-3" class="slide level2 smaller" data-background="#d2e2fc">
<h2>Angrist’s example</h2>
<p><a href="https://mixtape.scunning.com/07-instrumental_variables#the-problem-of-weak-instruments">Mixtape</a></p>

<img data-src="figs/iv3.png" class="r-stretch"><p><em>Angrist and Krueger had the insight that that small quirk was exogenously assigning more schooling to people born later in the year.</em></p>
<p><em>The person born in December would reach age 16 with more education than the person born in January</em></p>
</section>
<section id="angrists-example-4" class="slide level2 smaller" data-background="#d2e2fc">
<h2>Angrist’s example</h2>
<p><a href="https://mixtape.scunning.com/07-instrumental_variables#the-problem-of-weak-instruments">Mixtape</a></p>

<img data-src="figs/iv4.jpg" class="r-stretch"><p><strong>What is the instrument here?</strong></p>
</section>
<section id="angrists-example-5" class="slide level2 smaller" data-background="#d2e2fc">
<h2>Angrist’s example</h2>
<p><a href="https://mixtape.scunning.com/07-instrumental_variables#the-problem-of-weak-instruments">Mixtape</a></p>
<p><strong>What is the instrument here?</strong></p>
<p>The instrument is the quarter of birth.</p>
<ul>
<li>People born in the 3rd and 4th quarter receive more education than others due to <strong>compulsory schooling</strong>.</li>
</ul>
</section></section>
<section>
<section id="two-stage-least-squares-2sls" class="title-slide slide level1 smaller center" data-background="#abc8f5">
<h1>Two-stage least squares (2SLS)</h1>

</section>
<section id="two-stage-least-squares-2sls-1" class="slide level2 smaller" data-background="#abc8f5">
<h2>Two-stage least squares (2SLS)</h2>
<p>One of the more intuitive instrumental variables estimators is the 2SLS.</p>
<p><strong>The first stage is</strong></p>
<p><span class="math display">\[x_k = \delta + \delta_1 z + \delta_2 x_1 + . . .+ \delta_n x_n + \mu\]</span></p>
<p>Then, you predict <span class="math inline">\(x_k\)</span> using the first stage.</p>
<ul>
<li>“predict” means that you are finding the “response” Y of the equation after estimating the coefficients</li>
</ul>
<p><span class="math display">\[\hat{x_k} = \hat{\delta} + \hat{\delta_1} z + \hat{\delta_2} x_1 + . . . + \hat{\delta_n} x_n \]</span></p>
<div class="fragment">
<p>Then, <strong>the second stage</strong> is:</p>
<p><span class="math display">\[y = \alpha + \beta_1 \hat{x_k} + \beta_2 x_1 + . . .+  \beta_n x_n + \mu\]</span></p>
<p>The idea using <span class="math inline">\(\hat{x_k}\)</span> is that it represents only the variation that is not correlated with <span class="math inline">\(\mu\)</span>.</p>
</div>
</section>
<section id="instrumental-variables-7" class="slide level2 smaller" data-background="#abc8f5">
<h2>Instrumental Variables</h2>
<p>We can write that:</p>
<p><span class="math display">\[\beta_1= \frac{Cov(z,y)}{Cov(z,x_k)}\]</span></p>
<ul>
<li><p>It shows that <span class="math inline">\(\beta_1\)</span> is the population covariance between z and y divided by the population covariance between z and x.</p></li>
<li><p>Notice how this fails if z and x are uncorrelated, that is, if <span class="math inline">\(Cov(z, x) = 0\)</span></p></li>
</ul>
<div class="fragment">
<p><span class="math display">\[\beta_1= \frac{\sum_{i=1}^n(z_i-\bar{z})(y_i-\bar{y})}{\sum_{i=1}^n(z_i-\bar{z})(x_i-\bar{x})}\]</span></p>
<p>Notice that if <span class="math inline">\(z\)</span> and <span class="math inline">\(x\)</span> are the same (i.e., perfect correlation), <span class="math inline">\(\beta_1\)</span> above is the OLS <span class="math inline">\(\beta\)</span></p>
<p><span class="math display">\[\beta_1= \frac{\sum_{i=1}^n(x_i-\bar{x})(y_i-\bar{y})}{\sum_{i=1}^n(x_i-\bar{x})^2}\]</span></p>
</div>
</section></section>
<section>
<section id="weak-instruments" class="title-slide slide level1 smaller center" data-background="#8da6cc">
<h1>Weak Instruments</h1>

</section>
<section id="weak-instruments-1" class="slide level2 smaller" data-background="#8da6cc">
<h2>Weak Instruments</h2>
<p>I did not demonstrate here, but we can say that (see pp; 517-18 Wooldridge):</p>
<ul>
<li>though IV is consistent when <span class="math inline">\(z\)</span> and <span class="math inline">\(u\)</span> are uncorrelated and <span class="math inline">\(z\)</span> and <span class="math inline">\(x\)</span> have any positive or negative correlation, IV estimates can have large standard errors, especially if <span class="math inline">\(z\)</span> and <span class="math inline">\(x\)</span> are only weakly correlated.</li>
</ul>
<p>This gives rise to the week instruments problem.</p>
<p>We can write the probability limit of the IV estimator:</p>
<p><span class="math display">\[plim \hat{\beta_{iv}} = \beta_1 + \frac{Corr(z,\mu)}{Corr(z,x)} \times \frac{\sigma_{\mu}}{\sigma_x}\]</span></p>
<p>It shows that, even if <span class="math inline">\(Corr(z,\mu)\)</span> is small, the inconsistency in the IV estimator can be very large if <span class="math inline">\(Corr(z,x)\)</span> is also small.</p>
</section>
<section id="weak-instruments-2" class="slide level2 smaller" data-background="#8da6cc">
<h2>Weak Instruments</h2>
<p>Two tips:</p>
<ol type="1">
<li><p>Look at the F-stat of the first-stage. It should not be low.</p></li>
<li><p>The sign of the coefficient in the first stage should be as expected.</p></li>
<li><p>Look at the S.E. When the instrument is week, the S.E., are even larger than it should be.</p></li>
</ol>
<div class="fragment">
<p>One more tip,</p>
<ol start="4" type="1">
<li>Avoid computing the first stage by hand, it would give wrong estimates of the S.E. in the second stage.</li>
</ol>
</div>
</section></section>
<section>
<section id="example-6" class="title-slide slide level1 smaller center" data-background="#95a9c7">
<h1>Example</h1>

</section>
<section id="example-7" class="slide level2 smaller" data-background="#95a9c7">
<h2>Example</h2>
<p>OLS</p>
<div class="panel-tabset">
<ul id="tabset-15" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-15-1">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb57-1"><a></a><span class="kw">use</span> files/mroz.dta , <span class="kw">clear</span></span>
<span id="cb57-2"><a></a><span class="kw">reg</span> lwage educ </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Source |       SS           df       MS      Number of obs   =       428
-------------+----------------------------------   F(1, 426)       =     56.93
       Model |  26.3264237         1  26.3264237   Prob &gt; F        =    0.0000
    Residual |  197.001028       426  .462443727   R-squared       =    0.1179
-------------+----------------------------------   Adj R-squared   =    0.1158
       Total |  223.327451       427  .523015108   Root MSE        =    .68003

------------------------------------------------------------------------------
       lwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        educ |   .1086487   .0143998     7.55   0.000     .0803451    .1369523
       _cons |  -.1851969   .1852259    -1.00   0.318    -.5492674    .1788735
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-8" class="slide level2 smaller" data-background="#95a9c7">
<h2>Example</h2>
<p>The IV estimate of the return to education is 5.9%, which is barely more than one-half of the OLS estimate. This suggests that the OLS estimate is too high and is consistent with omitted ability bias.</p>
<div class="panel-tabset">
<ul id="tabset-16" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-16-1">Stata</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Stata</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb59-1"><a></a><span class="kw">use</span> files/mroz.dta , <span class="kw">clear</span></span>
<span id="cb59-2"><a></a><span class="kw">ivreg</span> lwage (educ =fatheduc ) , first</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>First-stage regressions
-----------------------

      Source |       SS           df       MS      Number of obs   =       428
-------------+----------------------------------   F(1, 426)       =     88.84
       Model |  384.841983         1  384.841983   Prob &gt; F        =    0.0000
    Residual |  1845.35428       426  4.33181756   R-squared       =    0.1726
-------------+----------------------------------   Adj R-squared   =    0.1706
       Total |  2230.19626       427  5.22294206   Root MSE        =    2.0813

------------------------------------------------------------------------------
        educ | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
    fatheduc |   .2694416   .0285863     9.43   0.000     .2132538    .3256295
       _cons |   10.23705   .2759363    37.10   0.000     9.694685    10.77942
------------------------------------------------------------------------------


Instrumental variables 2SLS regression

      Source |       SS           df       MS      Number of obs   =       428
-------------+----------------------------------   F(1, 426)       =      2.84
       Model |  20.8673618         1  20.8673618   Prob &gt; F        =    0.0929
    Residual |  202.460089       426  .475258426   R-squared       =    0.0934
-------------+----------------------------------   Adj R-squared   =    0.0913
       Total |  223.327451       427  .523015108   Root MSE        =    .68939

------------------------------------------------------------------------------
       lwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        educ |   .0591735   .0351418     1.68   0.093    -.0098994    .1282463
       _cons |   .4411035   .4461018     0.99   0.323    -.4357311    1.317938
------------------------------------------------------------------------------
Instrumented: educ
 Instruments: fatheduc</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="final-comments" class="title-slide slide level1 smaller center" data-background="#bcd3f7">
<h1>Final Comments</h1>

</section>
<section id="final-comments-1" class="slide level2 smaller" data-background="#bcd3f7">
<h2>Final Comments</h2>
<p>When you have only one Z, you can say that the model is <strong>just identified</strong>.</p>
<p>But you can have multiple IVs, in which case you will say that the model is <strong>overidentified</strong>.</p>
<ul>
<li><p>You can implement IV design just as before</p></li>
<li><p>The relevance and exclusion assumptions are there as well.</p></li>
</ul>
<div class="fragment">
<p>Assuming that both conditions are satisfied, you will have more asymptotic efficiency in the IV estimates.</p>
</div>
</section>
<section id="final-comments-2" class="slide level2 smaller" data-background="#bcd3f7">
<h2>Final Comments</h2>
<p><strong>It is rare to have multiple Zs. You should be happy if you have a good one!</strong></p>
<div class="fragment">
<p>But if you do have multiple IVs, you can test their quality…</p>
<ul>
<li><p>If they are all valid, you should get consistent estimates…</p></li>
<li><p>… even if you use only a subset of them.</p></li>
<li><p>So the test is about how similar the estimates are if you use subsets of IVs.</p></li>
</ul>
<p><strong>But this test does not give really an answer about whether the IVs are good.</strong></p>
<p>This always come from theory.</p>
</div>
</section>
<section id="final-comments-3" class="slide level2 smaller" data-background="#bcd3f7">
<h2>Final Comments</h2>
<p><strong>Some more comments:</strong></p>
<ol type="1">
<li>If you have an interaction term between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, and <span class="math inline">\(z\)</span> is the instrument for <span class="math inline">\(x_1\)</span>, you can “create” the instrument <span class="math inline">\(zx_2\)</span> for <span class="math inline">\(x_2\)</span>.</li>
</ol>
<div class="fragment">
<ol start="2" type="1">
<li>GMM uses lagged variables as instruments. But, this is not a good decision if the variables are highly serially correlated.</li>
</ol>
<ul>
<li>Lagged total assets is not a good instrument for total assets.</li>
</ul>
</div>
<div class="fragment">
<ol start="3" type="1">
<li>Using the average-group of variable X is also problematic (i.e., the industry average own. concentration as IV of firm-level own. concentration)</li>
</ol>
<ul>
<li>This is no different than a group FE, making hard to believe in the exclusion restriction.</li>
</ul>
</div>
</section>
<section id="thank-you" class="slide level2">
<h2>THANK YOU!</h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-right">
<figure>
<p><img data-src="figs/fgv.png" class="quarto-figure quarto-figure-right"></p>
</figure>
</div>
</div><div class="column" style="width:70%;">
<p><strong>Henrique Castro Martins</strong></p>
<ul>
<li><a href="henrique.martins@fgv.br">henrique.martins@fgv.br</a></li>
<li><a href="https://eaesp.fgv.br/en/people/henrique-castro-martins" class="uri">https://eaesp.fgv.br/en/people/henrique-castro-martins</a></li>
<li><a href="https://henriquemartins.net/">henriquemartins.net</a></li>
<li><a href="https://www.linkedin.com/in/henriquecastror/" class="uri">https://www.linkedin.com/in/henriquecastror/</a></li>
</ul>
</div>
</div>

<div class="quarto-auto-generated-content">
<p><img src="figs/background2.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://eaesp.fgv.br/" class="uri">https://eaesp.fgv.br/</a></p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":null,"id":"a0e0858bddc43b62","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>
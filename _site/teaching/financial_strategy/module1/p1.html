<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Henrique C. Martins">
  <title>Henrique Castro Martins - Estrat√©gia Financeira</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="../logo.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-771J5563G0"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-771J5563G0', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <!-- === login-start.html (com prote√ß√£o para p√°ginas e slides + turbo + warmup + remember blindado) === -->

  <style>
    /* Card padr√£o (p√°ginas normais) */
    #login-form {
      max-width: 300px;
      margin: 100px auto 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background: #fff;
      box-sizing: border-box;
    }
    #login-form input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    /* ‚úÖ FIX layout do checkbox: n√£o herdar width/padding dos inputs de texto */
    #login-form input[type="checkbox"] {
      width: auto !important;
      padding: 0 !important;
      margin: 0 !important;
      border: none !important;
      box-shadow: none !important;
      vertical-align: middle;
    }

    #login-form button {
      width: 100%; padding: 10px; margin-top: 10px;
      background-color: #0066cc; color: #fff; border: 0; border-radius: 5px; cursor: pointer;
    }
    #login-error { color: red; text-align: center; margin-top: 10px; }
    #loading-msg{ display:none; text-align:center; margin-top:10px; color:gray; }

    /* Desabilitado durante autentica√ß√£o */
    #login-form button:disabled { opacity:.6; cursor:not-allowed; }
    #login-form input:disabled  { opacity:.7; }

    /* Conte√∫do de p√°ginas normais (fica atr√°s do login at√© destravar) */
    html.locked #after-login-content,
    body.locked #after-login-content { display: none !important; }

    /* Slides (Reveal.js): desfoca deck e bloqueia intera√ß√£o */
    html.locked.reveal-page .reveal,
    body.locked.reveal-page .reveal { filter: blur(4px); pointer-events: none; user-select: none; }

    #login-scrim { display:none; }
    html.locked.reveal-page #login-scrim,
    body.locked.reveal-page #login-scrim{
      display:block; position:fixed; inset:0; background:rgba(255,255,255,.92); z-index:9998;
    }
    html.locked.reveal-page #login-form,
    body.locked.reveal-page #login-form{
      position: fixed; top:50%; left:50%; transform: translate(-50%,-50%);
      margin:0; max-width:340px; width:min(340px,92vw); z-index:9999;
    }

    /* Oculta o "Welcome" nos slides */
    .reveal-page #welcome-message { display: none !important; }

    /* Remember me */
    .remember-row{
      display:flex; align-items:center; gap:8px; margin-top:6px; font-size:.95rem; color:#444; white-space:nowrap;
    }
    .remember-row label{ display:flex; align-items:center; gap:6px; cursor:pointer; }

    /* Fallback duro para p√°ginas comuns: esconde TUDO (qualquer descendente) menos o form/scrim) */
    html.locked body:not(.reveal-page) :not(#login-form):not(#login-form *):not(#login-scrim):not(script):not(style):not(link) {
      display: none !important;
    }

    /* Garante que o form fique acima de qualquer layout do tema */
    #login-form { position: relative; z-index: 10000; }
    #login-scrim { z-index: 9998; }

    /* Scrim e formul√°rio fixos tamb√©m em p√°ginas N√ÉO-reveal enquanto locked */
    html.locked #login-scrim,
    body.locked #login-scrim {
      display: block !important;
      position: fixed !important;
      inset: 0 !important;
      background: #ffffff !important;
      z-index: 2147483646 !important;
    }
    html.locked #login-form,
    body.locked #login-form {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      margin: 0 !important;
      max-width: 340px !important;
      width: min(340px, 92vw) !important;
      z-index: 2147483647 !important;
    }

    /* Evita rolagem/scroll do conte√∫do ao fundo enquanto locked */
    html.locked, body.locked { overflow: hidden !important; }

    /* üîí Blindagem extra contra webexercises esconder a checkbox */
    #login-form .remember-row { display:flex !important; visibility:visible !important; }
    #login-form #remember-me { display:inline-block !important; }

    /* üßº Esconde imediatamente artefatos escapados (qualquer descendente code/pre/sourceCode etc) DENTRO do form */
    #login-form pre,
    #login-form code,
    #login-form .sourceCode,
    #login-form .sourcecode,
    #login-form .quarto-code-cell,
    #login-form .cell-output,
    #login-form .cell-output-display,
    #login-form .cell { display: none !important; }
  </style>

  <!-- Aplica 'locked' em <html> imediatamente e em <body> quando dispon√≠vel + preconnect -->
  <script>
    (function(){
      const addLocked = el => { if (el && !el.classList.contains('locked')) el.classList.add('locked'); };
      addLocked(document.documentElement);
      if (document.body) { addLocked(document.body); }
      else { document.addEventListener('DOMContentLoaded', () => addLocked(document.body)); }

      // preconnect/dns-prefetch para acelerar chamadas ao GAS de login
      try {
        const l1=document.createElement('link'); l1.rel='preconnect';   l1.href='https://script.google.com'; document.head.appendChild(l1);
        const l2=document.createElement('link'); l2.rel='dns-prefetch'; l2.href='https://script.google.com'; document.head.appendChild(l2);
      } catch(_) {}
    })();
  </script>

  <!-- shim seguro: define onLoginSuccess se ainda n√£o existir -->
  <script>
    if (typeof window.onLoginSuccess !== 'function') {
      window.onLoginSuccess = function(studentId){
        try {
          const sid = String(studentId || '').trim();
          window.studentId = sid;
          localStorage.setItem('studentId', sid);
          // compat com widgets antigos
          document.dispatchEvent(new CustomEvent('auth:login',   { detail: { studentId: sid } }));
          setTimeout(() => window.dispatchEvent(new CustomEvent('login:success', { detail:{ studentId: sid } })), 0);
          // hook imediato para o notice center (se j√° carregado)
          if (window.noticeCenter && typeof window.noticeCenter.onLogin === 'function') {
            window.noticeCenter.onLogin(sid);
          }
          if (window.VHCM) window.VHCM.lastLoginAt = Date.now();
          console.debug('[Login] onLoginSuccess ‚Üí', sid);
        } catch(e) {
          console.warn('onLoginSuccess shim warn:', e);
        }
      };
    }
  </script>

  <meta property="og:title" content="Henrique Castro Martins - Estrat√©gia Financeira">
<meta property="og:description" content="Module 1 - ch.23 Raising Equity Capital">
<meta property="og:site_name" content="Henrique Castro Martins">
<meta name="twitter:title" content="Henrique Castro Martins - Estrat√©gia Financeira">
<meta name="twitter:description" content="Module 1 - ch.23 Raising Equity Capital">
<meta name="twitter:card" content="summary">
</head><body class="quarto-light"><form id="login-form" onsubmit="event.preventDefault(); validateLogin();">
    <h3 style="text-align:center;">Login</h3>
    <input type="text" id="username" placeholder="Username" autocomplete="username" required="">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" required="">

    <!-- Remember: input separado + label com 'for' (alinhado como na 2¬™ imagem) -->
    <div class="remember-row">
      <input type="checkbox" id="remember-me" checked="">
      <label for="remember-me">Remember me</label>
    </div>

    <button type="submit" id="login-submit">Enter</button>
    <div id="loading-msg"></div>
    <div id="login-error"></div>
  </form>

  <div id="login-scrim" aria-hidden="true"></div>

  <div id="after-login-content" style="display:none;">
    <h4 id="welcome-message" style="text-align:center; display:none; margin-top:10px; font-size:1.8em; color:#333;"></h4>
  </div>

  <script>
    /***** CONFIG *****/
    const REMEMBER_PASSWORD  = true;
    const GAS_URL            = 'https://course-chat.hcmrtns.workers.dev/auth/login';
    const SESSION_MAX_HOURS  = 8;     // validade do "lembrado"
    const FAST_WINDOW_HOURS  = 2;     // turbo: libera instant√¢neo
    const VALIDATE_TIMEOUTMS = 3000;  // timeout da valida√ß√£o

    /* üî• Warm-up silencioso do GAS: acorda a fun√ß√£o antes do 1¬∫ login real */
    window.addEventListener('load', () => {
      try {
        const warm = new Image();
        warm.referrerPolicy = 'no-referrer';
        warm.src = `${GAS_URL}?username=&password=&page=WARMUP&t=${Date.now()}`;
      } catch(_) {}
    });

    /***** Marca slides (se houver Reveal) *****/
    document.addEventListener('DOMContentLoaded', () => {
      if (document.querySelector('.reveal')) document.body.classList.add('reveal-page');
    });

    /***** Pr√©-preenche campos com Remember (se houver) *****/
    document.addEventListener('DOMContentLoaded', () => {
      try{
        const u = localStorage.getItem('fs_user');
        const p = localStorage.getItem('fs_pass');
        if (u) document.getElementById('username').value = u;
        if (REMEMBER_PASSWORD && p) document.getElementById('password').value = p;
      }catch(_){}
    });

    /***** Storage helpers *****/
    function saveRemember(u,p,checked){
      try{
        if(checked){
          localStorage.setItem('fs_user', u);
          localStorage.setItem('fs_last_login_at', Date.now().toString());
          if (REMEMBER_PASSWORD) localStorage.setItem('fs_pass', p); else localStorage.removeItem('fs_pass');
        }else{
          localStorage.removeItem('fs_user'); localStorage.removeItem('fs_pass'); localStorage.removeItem('fs_last_login_at');
        }
      }catch(_){}
    }
    function getRemember(){
      try{
        const u=localStorage.getItem('fs_user');
        const p=localStorage.getItem('fs_pass');
        const t=parseInt(localStorage.getItem('fs_last_login_at')||'0',10);
        if(!u||!t) return null; return {u,p,t};
      }catch(_){ return null; }
    }
    const within=(ts,h)=> (Date.now()-ts) < h*3600*1000;

    /* üîí Desativa/Reativa o form durante autentica√ß√£o */
    function setAuthLoading(isLoading){
      const btn = document.getElementById('login-submit');
      const u   = document.getElementById('username');
      const p   = document.getElementById('password');
      const cb  = document.getElementById('remember-me');
      if (btn){
        btn.disabled = isLoading;
        btn.textContent = isLoading ? 'Signing in...' : 'Enter';
      }
      [u,p,cb].forEach(el => { if (el) el.disabled = isLoading; });
    }

    /***** GAS helpers *****/
    function logWithImage(u,p,page){
      const img=new Image(); img.referrerPolicy='no-referrer';
      img.src=`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}&t=${Date.now()}`;
    }
    async function gasAuth(u,p,page,timeoutMs){
      async function _once(ms){
        const ctrl=new AbortController();
        const timer=setTimeout(()=>ctrl.abort('timeout'), ms||0);
        try{
          const res=await fetch(`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}`, {signal:ctrl.signal, cache:'no-store'});
          return (await res.text()||'').trim();
        } finally { clearTimeout(timer); }
      }
      try{
        return await _once(timeoutMs||12000);   // 1¬™ tentativa
      }catch(_){
        return await _once(15000);              // retry mais folgado
      }
    }

    /***** UI helpers *****/
    function unlockAs(u){
      const welcome=document.getElementById('welcome-message');
      if (welcome && !document.body.classList.contains('reveal-page')){
        welcome.textContent=`Welcome, ${u}!`; welcome.style.display='block';
      }
      document.getElementById('login-form').style.display='none';
      const after=document.getElementById('after-login-content'); if(after) after.style.display='block';

      // Remover 'locked' de html e body
      document.documentElement.classList.remove('locked');
      if (document.body) document.body.classList.remove('locked');

      const scrim=document.getElementById('login-scrim'); if(scrim) scrim.style.display='none';
    }

    /***** Auto-login com janela turbo (tamb√©m nos slides) *****/
    document.addEventListener('DOMContentLoaded', async () => {
      const saved=getRemember(); if(!saved) return;
      const page=location.pathname;

      if (within(saved.t, FAST_WINDOW_HOURS)) {
        // libera j√° e registra em background
        unlockAs(saved.u);
        onLoginSuccess(saved.u); // mant√©m studentId para outros scripts

        saveRemember(saved.u, saved.p, true);
        logWithImage(saved.u, saved.p, page);

        // checagem silenciosa (opcional)
        try { const r=await gasAuth(saved.u, saved.p, 'CHECK', 12000); if(r!=='OK'){ /* opcional: relock */ } } catch(_) {}
        return;
      }

      if (within(saved.t, SESSION_MAX_HOURS)) {
        const loading=document.getElementById('loading-msg');
        loading.textContent='Checking saved login...'; loading.style.display='block';
        try{
          const r=await gasAuth(saved.u, saved.p, page, VALIDATE_TIMEOUTMS);
          loading.style.display='none';
          if(r==='OK'){ unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); }
        }catch(_){
          // timeout: libera e registra em background
          loading.style.display='none';
          unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); logWithImage(saved.u, saved.p, page);
        }
      }
    });

    /***** Login manual *****/
    async function validateLogin(rememberOverride){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      const cb=document.getElementById('remember-me');
      const remember = (rememberOverride!==undefined) ? rememberOverride : (cb? cb.checked : true);

      const err=document.getElementById('login-error');
      const load=document.getElementById('loading-msg');
      err.textContent='';
      load.textContent='Authenticating your credentials. This may take a few seconds...';
      load.style.display='block';
      setAuthLoading(true);

      const page=location.pathname;
      try{
        const r=await gasAuth(u,p,page,VALIDATE_TIMEOUTMS);
        load.style.display='none';
        if (r==='OK'){ saveRemember(u,p,remember); unlockAs(u); onLoginSuccess(u); }
        else if (r==='FAIL'){ err.textContent='Invalid username or password.'; }
        else { err.textContent='Missing credentials.'; }
      }catch(_){
        load.textContent=''; err.textContent='Network error. Please try again.';
      }finally{
        if (document.getElementById('login-form').style.display !== 'none') {
          setAuthLoading(false);
        }
      }
    }

    // Auto preenche (se j√° houver credenciais lembradas)
    document.addEventListener('DOMContentLoaded', ()=>{
      try{
        const u=localStorage.getItem('fs_user'); const p=localStorage.getItem('fs_pass');
        if(u){ document.getElementById('username').value=u; }
        if(p && REMEMBER_PASSWORD){ document.getElementById('password').value=p; }
        const cb=document.getElementById('remember-me'); if(cb) cb.checked=true;
      }catch(_){}
    });

    /* Auto-wrap robusto ‚Äî apenas para p√°ginas N√ÉO-Reveal */
    document.addEventListener('DOMContentLoaded', () => {
      try {
        if (document.querySelector('.reveal') || document.body.classList.contains('reveal-page')) return;

        const wrapper = document.getElementById('after-login-content');
        if (!wrapper) return;

        const root = wrapper.parentElement || document.body;
        const loginForm  = document.getElementById('login-form');
        const loginScrim = document.getElementById('login-scrim');

        const isKeep = (el) =>
          el === wrapper || el === loginForm || el === loginScrim ||
          el.tagName === 'SCRIPT' || el.tagName === 'STYLE' || el.tagName === 'LINK';

        Array.from(root.children).forEach(el => {
          if (!isKeep(el) && !wrapper.contains(el)) {
            wrapper.appendChild(el);
          }
        });
      } catch (e) {
        console.warn('auto-wrap (non-reveal) warn:', e);
      }
    });

    /* üîí Fallback: recria a checkbox se webexercises a remover (estrutura input+label) */
    document.addEventListener('DOMContentLoaded', () => {
      const form=document.getElementById('login-form');
      if(!form) return;
      if(!document.getElementById('remember-me')){
        const row=document.createElement('div');
        row.className='remember-row';

        const input=document.createElement('input');
        input.type='checkbox';
        input.id='remember-me';
        input.checked=true;

        const label=document.createElement('label');
        label.htmlFor='remember-me';
        label.appendChild(document.createTextNode(' Remember me'));

        row.appendChild(input);
        row.appendChild(label);

        const btn=document.getElementById('login-submit');
        form.insertBefore(row, btn);
      }
    });

    /* üßπ Sanitizador: remove artefatos (pre/code/sourceCode/cell) do remember dentro do form (em QUALQUER profundidade) */
    (function(){
      function looksLikeRememberLine(txt){
        if(!txt) return false;
        const t = txt.trim();
        return /<\s*input[^>]*type=["']checkbox["'][^>]*id=["']remember-me["']/i.test(t) ||
               /<\s*label[^>]*for=["']remember-me["'][^>]*>/i.test(t);
      }
      function cleanRememberArtifacts(){
        const form = document.getElementById('login-form');
        if(!form) return;

        // Remove blocos t√≠picos do Quarto/knitr que cont√™m o HTML escapado
        form.querySelectorAll('pre, code, .sourceCode, .sourcecode, .quarto-code-cell, .cell-output, .cell-output-display, .cell')
          .forEach(el => { if(looksLikeRememberLine(el.textContent)) el.remove(); });

        // Remove n√≥s de texto ‚Äúcrus‚Äù em qualquer n√≠vel
        const treeWalker = document.createTreeWalker(form, NodeFilter.SHOW_TEXT, null);
        const toRemove = [];
        while(treeWalker.nextNode()){
          const n = treeWalker.currentNode;
          if(looksLikeRememberLine(n.textContent)) toRemove.push(n);
        }
        toRemove.forEach(n => n.parentNode && n.parentNode.removeChild(n));
      }

      if (document.readyState !== 'loading') cleanRememberArtifacts();
      else document.addEventListener('DOMContentLoaded', cleanRememberArtifacts);

      // Observa mudan√ßas no form inteiro (subtree) para limpar assim que surgir
      const formObs = document.getElementById('login-form');
      if (formObs) new MutationObserver(cleanRememberArtifacts)
        .observe(formObs, { childList: true, subtree: true });
    })();

  </script>


  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#b1cafa" class="quarto-title-block center">
  <h1 class="title">Estrat√©gia Financeira</h1>
  <p class="subtitle"><strong>Module 1 - ch.23 Raising Equity Capital</strong></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<strong>Henrique C. Martins</strong> 
</div>
        <p class="quarto-title-affiliation">
            <strong><a href="https://eaesp.fgv.br/en"><img data-src="../figs/background6.png" style="box-shadow: none;" width="300"></a></strong>
          </p>
    </div>
</div>

  <p class="date">30-01-2026</p>
</section>
<section>

<section id="section" class="slide level2" data-background="#A91B0D">
<h2></h2>
<div title="‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses</strong></p>
</div>
<div class="callout-content">
<p>The <strong>Virtual HCM</strong> is powered by <strong>AI</strong> to assist you with course materials.<br>
While it is trained on the course‚Äôs content, <strong>it may occasionally</strong>:</p>
<ul>
<li>Misinterpret the question or context.<br>
</li>
<li>Generate <strong>inaccurate or incomplete</strong> information.<br>
</li>
<li>Provide answers <strong>not explicitly included</strong> in the materials.</li>
</ul>
<p><strong>Your responsibility:</strong><br>
Always cross-check the answers with the book, slides, readings, and feedback provided in the course. In case you are not sure, ask the instructor.</p>
<p>üí° <em>Use Virtual HCM as a <strong>learning aid</strong>, not as the sole source of truth.</em></p>
<div class="like-container">
<p><button class="like-btn" title="Click if you got this"> ‚úÖ <span class="like-text">Got it</span> <span class="like-count">(0)</span> </button></p>
</div>
<script>
(function () {
  const root = document.currentScript && document.currentScript.previousElementSibling;
  if (!root || !root.matches('.like-container')) return;

  const btn = root.querySelector('.like-btn');
  const textSpan = btn && btn.querySelector('.like-text');
  const countSpan = btn && btn.querySelector('.like-count');
  if (!btn || !textSpan || !countSpan) return;

  const scriptURL = "https://course-chat.hcmrtns.workers.dev";

  function pageId() {
    const sec = root.closest('section');
    function getSlideHashForSection(sec) {
      if (sec && sec.id) return `#/${sec.id}`;
      if (window.Reveal && Reveal.getIndices) {
        const idx = Reveal.getIndices(sec || Reveal.getCurrentSlide());
        if (idx && typeof idx.h === 'number') {
          return (typeof idx.v === 'number' && idx.v > 0) ? `#/${idx.h}/${idx.v}` : `#/${idx.h}`;
        }
      }
      return location.hash || '#';
    }
    const hash = getSlideHashForSection(sec);
    return location.origin + location.pathname + location.search + hash;
  }
  function getStudentId(){
    return (window.studentId || localStorage.getItem("studentId") || localStorage.getItem("fs_user") || "");
  }
  function hasLogin(){ return !!getStudentId(); }

  function setGotItState() {
    textSpan.textContent = "Got it ‚úî";
    btn.classList.add("liked");
    btn.title = "You have already confirmed";
  }
  function clearGotItState() {
    textSpan.textContent = "Got it";
    btn.classList.remove("liked");
    btn.title = hasLogin() ? "Click if you got this" : "Please log in to confirm";
  }

  function syncButtonLock() {
    if (!hasLogin()) {
      btn.setAttribute('disabled', 'disabled');
      btn.style.opacity = 0.6;
      btn.title = "Please log in to confirm";
    } else {
      btn.removeAttribute('disabled');
      btn.style.opacity = "";
      btn.title = "Click if you got this";
    }
  }
  syncButtonLock();
  document.addEventListener('auth:login', () => { syncButtonLock(); updateCount(); });

  // Envia ponto (opcional; n√£o bloqueia)
  async function awardLikePoint(student, pid){
    try{
      await fetch(`${scriptURL}/ranking`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          student,
          event_type:'like',
          module:(window.moduleId||'module'),
          page: pid,
          details:'source=like_button',
          fingerprint:`${student}:like:${pid}`
        })
      });
      if (typeof window.leaderboardLogEvent === 'function') {
        window.leaderboardLogEvent('like', { details:'mirrored_to_cloudflare' });
      }
    }catch(_){}
  }

  btn.addEventListener('click', () => {
    const pid = pageId();
    if (!hasLogin()) { alert("Please log in first."); return; }
    if (localStorage.getItem(`liked_${pid}`)) return;

    btn.disabled = true;
    btn.classList.add('pulse');
    setTimeout(() => btn.classList.remove('pulse'), 300);

    const student = getStudentId();
    fetch(`${scriptURL}/likes?like=1&page=${encodeURIComponent(pid)}&student=${encodeURIComponent(student)}`)
      .then(r=>r.json())
      .then(async data=>{
        if (data && data.status === 'liked') {
          await awardLikePoint(student, pid);
        }
        if (data && (data.status === 'liked' || data.status === 'already')) {
          localStorage.setItem(`liked_${pid}`,"true");
          setGotItState();
        }
        updateCount();
      })
      .catch(console.error)
      .finally(()=>{ btn.disabled = false; });
  });

  function updateCount(){
    const pid = pageId();
    const student = getStudentId() || "anon";
    fetch(`${scriptURL}/likes?state=1&page=${encodeURIComponent(pid)}&student=${encodeURIComponent(student)}`)
      .then(r=>r.json())
      .then(data=>{
        const count = Number(data && data.count) || 0;
        countSpan.textContent = `(${count})`;
        if (data && data.liked) {
          // servidor confirma like ‚Üí garante UI e storage
          localStorage.setItem(`liked_${pid}`,"true");
          setGotItState();
        } else {
          // servidor diz que N√ÉO h√° like ‚Üí limpa UI e storage
          localStorage.removeItem(`liked_${pid}`);
          clearGotItState();
        }
      })
      .catch(()=>{ /* ignora */ });
  }

  updateCount();
  const interval = setInterval(updateCount, 3000);

  const obs = new MutationObserver(() => {
    if (!document.body.contains(root)) { clearInterval(interval); obs.disconnect(); }
  });
  obs.observe(document.body, { childList:true, subtree:true });

  if (window.Reveal && Reveal.addEventListener) {
    Reveal.addEventListener('slidechanged', updateCount);
  }
})();
</script>
<style>
.like-container { position: relative; margin-top: 20px; text-align: right; }
.like-btn {
  background-color:#f0fdf4; border:2px solid #86efac; color:#15803d;
  padding:8px 16px; font-size:16px; border-radius:25px;
  display:inline-flex; align-items:center; gap:8px; font-weight:500;
  box-shadow:1px 1px 4px rgba(0,0,0,0.08);
  transition: background-color .2s, color .2s, opacity .2s, transform .15s;
  cursor:pointer;
}
.like-btn:hover{ background-color:#dcfce7; border-color:#4ade80; color:#166534; }
.like-btn.liked{ background:#f0f0f0; color:#888; border-color:#ddd; opacity:.6; cursor:default; }
.like-btn .like-count{
  background:#86efac; color:#064e3b; padding:2px 8px; border-radius:12px;
  font-size:14px; font-weight:bold;
}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
.pulse{animation:pulse .3s ease;}
</style>
</div>
</div>
</div>
</div>
</section>
<section id="section-1" class="slide level2" data-background-image="../figs/cha23.png" data-background-size="1300px">
<h2></h2>
</section>
<section id="chapter-outline" class="slide level2" style="color: #000;">
<h2>Chapter Outline</h2>
<p>23.1 Equity Financing for Private Companies</p>
<p>23.2 The Initial Public Offering</p>
<p>23.3 IPO Puzzles</p>
<p>23.4 The Seasoned Equity Offering</p>
</section></section>
<section>
<section id="equity-financing-for-private" class="title-slide slide level1 smaller center" data-background="#ead1dc">
<h1>23.1 Equity Financing for Private</h1>

</section>
<section id="equity-financing-for-private-1" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<ul>
<li>The initial capital that is required to start a business is usually provided by the entrepreneur.</li>
<li>Often, a private company must seek outside sources that can provide additional capital for growth.</li>
<li>It is important to understand how the infusion of outside capital will affect the control of the company.</li>
</ul>
<!-- Define unique ID for this slide -->
</section>
<section id="equity-financing-for-private-2" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Sources of funding: Angel Investors</strong></p>
<ul>
<li>Individual Investors who buy equity in small private firms. Angel investors are often rich, successful entrepreneurs themselves who are willing to help new companies get started in exchange for a share of the business.</li>
<li>The angel investment is usually necessary to kick off the business and the angel market is more well organized these days.</li>
<li>Angel financing often occurs at such an early stage in the business that it is difficult to assess a value for the firm. Angel investors often circumvent this problem by holding either a convertible note or a SAFE (simple agreement for future equity) rather than equity.
<ul>
<li>Usually, angel investors have a share price discount over new investors.</li>
<li>Structuring the deal in this way allows <strong>angels and entrepreneurs to agree on terms without agreeing on a value for the firm</strong>, instead postponing the valuation decision until the firm is more mature and attractive to venture capitalists.</li>
</ul></li>
</ul>
</section>
<section id="equity-financing-for-private-3" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Venture Capital Firm</strong></p>
<p>A limited partnership that specializes in raising money to invest in the private equity of young firms.</p>
<p><strong>Venture Capitalists</strong></p>
<p>One of the general partners who work for and run a venture capital firm.</p>
<div class="fragment">
<p>VC firms offer limited partners advantages over investing directly in start-ups themselves as angel investors.</p>
<ul>
<li><p>Limited partners are more diversified.</p></li>
<li><p>They also benefit from the expertise of the general partners.</p></li>
<li><p>General partners usually charge substantial fees: over the return they make (carried interest) plus a an annual management fee of about 2% of the fund‚Äôs committed capital.</p></li>
<li><p>Usually, they demand great control (e.g., board seats).</p></li>
</ul>
</div>
</section>
<section id="section-2" class="slide level2 smaller" data-background="#ead1dc">
<h2></h2>

<img data-src="../figs/bm_23_1.jpg" class="r-stretch"></section>
<section id="equity-financing-for-private-4" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Private Equity Firms</strong></p>
<ul>
<li>Organized very much like a venture capital firm, but it <strong>invests in the equity of existing privately held firms</strong> rather than start-up companies.</li>
<li>Private equity firms also might initiate their investment by finding a publicly traded firm and purchasing the outstanding equity, thereby taking the company private in a transaction called a leveraged buyout (LBO).</li>
<li>In most cases, the private equity firms use debt as well as equity to finance the purchase.</li>
<li>Private equity firms also charge fees.</li>
<li>Market value of PE firms greater than VC.</li>
</ul>
</section>
<section id="section-3" class="slide level2 smaller" data-background="#ead1dc">
<h2></h2>

<img data-src="../figs/bm_23_2.jpg" class="r-stretch"></section>
<section id="equity-financing-for-private-5" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Institutional Investors</strong></p>
<ul>
<li>Institutional investors, such as pension funds, insurance companies, endowments, and foundations, are <strong>active investors in private companies</strong>.</li>
<li>Institutional investors <strong>may invest directly</strong> in private firms or they <strong>may invest indirectly by becoming limited partners in venture capital firms</strong>.</li>
</ul>
<p>Ex. Blackrock funds, Vanguard funds.</p>
</section>
<section id="equity-financing-for-private-6" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Corporate Investors</strong></p>
<ul>
<li>A corporation that invests in private companies.</li>
<li>Also known as corporate partner, strategic partner, and strategic investor.</li>
<li>Although most other types of investors in private firms are primarily interested in the financial returns of their investments, <strong>corporate investors might invest for corporate strategic objectives</strong>, in addition to the financial returns.</li>
</ul>
<p>Ex. Google.</p>
</section>
<section id="equity-financing-for-private-7" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Venture capital investing</strong></p>
<p>When a company founder decides to sell equity to outside investors for the first time, <strong>it is common practice for private companies to issue preferred stock rather than common stock to raise capital</strong>.</p>
<p><strong>Preferred Stock</strong></p>
<ul>
<li>Preferred stock issued by mature companies usually has a preferential dividend and seniority in any liquidation and sometimes special voting rights.</li>
<li>Preferred stock issued by young companies has seniority in any liquidation but typically <strong>does not pay regular cash dividends and often contains a right to convert to common stock</strong>.</li>
</ul>
<div class="fragment">
<p><strong>Convertible Preferred Stock</strong></p>
<p>Preferred stock that gives the owner an option to convert it into common stock on some future date.</p>
</div>
</section>
<section id="equity-financing-for-private-8" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<ul>
<li><p>Each time the firm raises money is referred to as a funding round, and each round will have its own set of securities with special terms and provisions.</p></li>
<li><p>After a potential initial ‚Äúseed round,‚Äù it is common to name the securities alphabetically, starting with Series A, Series B, etc</p></li>
<li><p>Only then, the company has a market value.</p></li>
</ul>
</section>
<section id="equity-financing-for-private-9" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Book‚Äôs example.</strong></p>
<ul>
<li>Real Networks, which was founded by Robert Glaser in 1993, with an investment of approximately 1 million by Glaser.</li>
<li>In April 1995, Glaser‚Äôs 1 million initial investment represented 13,713,439 shares of Series A preferred stock, implying an initial price of about $0.07 per share.</li>
<li>The company‚Äôs <strong>first round of outside equity funding was Series B preferred stock</strong>. Real Networks sold 2,686,567 shares of Series B preferred stock at 0.67 per share.</li>
<li>At the price the new shares were sold for, Glaser‚Äôs shares were worth 9.2 million and represented 83.6% of the outstanding shares.</li>
</ul>
<center>
<p><img data-src="../figs/bm_23_ex.png"></p>
</center>
</section>
<section id="equity-financing-for-private-10" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p><strong>Pre-Money Valuation</strong></p>
<ul>
<li>At the issuance of new equity, the value of the firm‚Äôs prior shares outstanding at the price in the funding round
<ul>
<li>9.2 million in the RealNetworks example</li>
</ul></li>
</ul>
<p><strong>Post-Money Valuation</strong></p>
<ul>
<li>At the issue of new equity, the value of the whole firm (old plus new shares) at the price at which the new equity sold
<ul>
<li>11.0 million in the RealNetworks example</li>
</ul></li>
</ul>
</section>
<section id="equity-financing-for-private-11" class="slide level2 smaller" data-background="#ead1dc">
<h2>23.1 Equity Financing for Private</h2>
<p>Over the next few years, Real Networks raised three more rounds of outside equity in addition to the Series B funding round</p>

<img data-src="../figs/bm_23_ex2.png" class="r-stretch"></section>






<section id="section-4" class="slide level2 smaller" data-background="#FFFFFF">
<h2></h2>
<div style="font-size: 40%; text-align: right;">
<p>Key: <em>module1_slide2</em> <input type="hidden" id="slide-id" value="module1_slide2"></p>
</div>
<div class="question">
<p><strong>Post-money valuation and VC ownership</strong></p>
<p>You founded a firm three years ago. You started with $0.3 million, which gave you 1.5 million shares. You later sold 1 million shares to angel investors. Now, a VC firm wants to invest $6.7 million in exchange for 3 million new shares.</p>
<div class="question-block">
<form onsubmit="event.preventDefault();" style="display: flex; align-items: center; gap: 12px;">
<label for="module1_num_q3a"><strong>1. What is the post-money valuation (in million)?</strong></label> <input type="number" id="module1_num_q3a" name="module1_num_q3a" placeholder="Enter value" style="width: 120px;" data-correct-answer="12.28" data-tolerance="0.1">
</form>
<div id="feedback-module1_num_q3a" class="feedback" data-status="" style="display:none;">
<p>‚úÖ Post-money = Total shares √ó Price per share = (5.5) √ó (2.23) = <strong>12.28 million</strong></p>
</div>
</div>
<div class="question-block">
<form onsubmit="event.preventDefault();" style="display: flex; align-items: center; gap: 12px;">
<label for="module1_num_q3b"><strong>2. What percentage of the firm will the VC own?</strong></label> <input type="number" id="module1_num_q3b" name="module1_num_q3b" placeholder="Enter %" style="width: 100px;" data-correct-answer="54.55" data-tolerance="0.1">
</form>
<div id="feedback-module1_num_q3b" class="feedback" data-status="" style="display:none;">
<p>‚úÖ VC Ownership = 3 / (5.5) √ó 100 = <strong>54.55%</strong></p>
</div>
</div>
</div>
<div style="text-align: right;">
<script>
// Fun√ß√£o auxiliar para verificar e definir o status de uma quest√£o.
function checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance = 0) {
  const feedbackDiv = document.getElementById(feedbackDivId);
  if (!feedbackDiv) return;

  let isCorrect = false;

  // Trata respostas num√©ricas com toler√¢ncia
 if (typeof correctAnswer === 'number' && typeof userAnswer === 'number' && !isNaN(userAnswer)) {
    const lowerBound = correctAnswer - tolerance;
    const upperBound = correctAnswer + tolerance;
    isCorrect = (userAnswer >= lowerBound && userAnswer <= upperBound);
  } else if (typeof userAnswer === 'string') {
    // Para respostas de texto (T/F, M√∫ltipla Escolha)
    isCorrect = (userAnswer.trim().toUpperCase() === correctAnswer.toUpperCase());
  }
  // Adicione outras l√≥gicas de compara√ß√£o aqui se necess√°rio (ex: arrays para m√∫ltiplos checkboxes)

  if (isCorrect) {
    feedbackDiv.dataset.status = "correct";
  } else {
    feedbackDiv.dataset.status = "incorrect";
  }
  feedbackDiv.style.display = "none"; // Mant√©m o feedback oculto
}

// Fun√ß√£o para obter a resposta de um grupo de radio buttons
function getSelectedRadioValue(name) {
    const radios = document.querySelectorAll(`input[type="radio"][name="${name}"]:checked`);
    if (radios.length > 0) {
        return radios[0].value;
    }
    return ''; // Retorna string vazia se nada for selecionado
}

function toggleFeedback() {
  const questionBlocks = document.querySelectorAll('.question-block');
  const feedbacks = document.querySelectorAll('.feedback');
  const scoreDiv = document.getElementById('score-summary');
  const toggleButton = document.getElementById('toggle-feedback-btn');

  let showing = feedbacks.length > 0 && feedbacks[0].style.display === 'block';

  if (showing) {
    // Esconder feedback
    feedbacks.forEach(f => {
      f.style.display = 'none';
      f.style.color = 'black'; // Reseta a cor ao esconder
    });
    scoreDiv.textContent = '';
    toggleButton.textContent = 'Show Feedback';
  } else {
    // Mostrar feedback
    let correctCount = 0;
    let totalQuestions = 0;

    questionBlocks.forEach(block => {
      totalQuestions++;
      const textInput = block.querySelector('input[type="text"]');
      const numberInput = block.querySelector('input[type="number"]'); // Novo: input num√©rico
      const form = block.querySelector('form');

      let questionId, userAnswer, correctAnswer, tolerance = 0;
      let feedbackDivId;

      if (textInput && textInput.dataset.correctAnswer) {
        // Quest√£o de texto (T/F)
        questionId = textInput.id;
        userAnswer = textInput.value;
        correctAnswer = textInput.dataset.correctAnswer;
      } else if (numberInput && numberInput.dataset.correctAnswer) {
        // Quest√£o num√©rica
        questionId = numberInput.id;
        // Converte para n√∫mero. Se n√£o for um n√∫mero v√°lido, NaN.
        userAnswer = parseFloat(numberInput.value);
        correctAnswer = parseFloat(numberInput.dataset.correctAnswer);
        if (numberInput.dataset.tolerance) {
          tolerance = parseFloat(numberInput.dataset.tolerance);
        }
        // Se a resposta do usu√°rio n√£o for um n√∫mero v√°lido, trate como incorreta
        if (isNaN(userAnswer)) {
             userAnswer = null; // Mant√©m como valor num√©rico inv√°lido
        }
      } else if (form && form.querySelector('input[type="radio"]') && form.dataset.correctAnswer) {
        // Quest√£o de m√∫ltipla escolha (radio)
        questionId = form.querySelector('input[type="radio"]').name;
        userAnswer = getSelectedRadioValue(questionId);
        correctAnswer = form.dataset.correctAnswer;
      } else {
        // Se n√£o for um tipo de quest√£o reconhecido ou n√£o tem resposta correta
        totalQuestions--; // N√£o conta esta quest√£o no total se n√£o puder ser avaliada
        return; // Pula para a pr√≥xima quest√£o
      }

      feedbackDivId = 'feedback-' + questionId;
      const feedbackDiv = document.getElementById(feedbackDivId);

      if (feedbackDiv) { // Apenas processa se h√° um feedback div
        checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance);

        // Agora, exibe e colore o feedback ap√≥s a verifica√ß√£o
        if (feedbackDiv.dataset.status === 'correct') {
          feedbackDiv.style.color = 'green';
          correctCount++;
        } else if (feedbackDiv.dataset.status === 'incorrect') {
          feedbackDiv.style.color = 'red';
        } else {
          feedbackDiv.style.color = 'black'; // Se n√£o foi respondida ou n√£o tem status
        }
        feedbackDiv.style.display = 'block'; // Exibe o feedback
      }
    });

    scoreDiv.textContent = `‚úÖ  You answered ${correctCount} out of  ${totalQuestions}  correctly.`;
    toggleButton.textContent = 'Hide Feedback';
  }
}
</script>
<button id="toggle-feedback-btn" onclick="toggleFeedback()" style="background-color:#007BFF; color:white; padding:8px 16px; border:none; border-radius:5px; cursor:pointer;">
Show Feedback
</button>
<div id="score-summary" style="margin-top: 15px; font-weight: bold;">

</div>
</div>
</section></section>
<section>
<section id="the-initial-public-offering" class="title-slide slide level1 smaller center" data-background="#d9ead3">
<h1>23.2 The Initial Public Offering</h1>

</section>
<section id="the-initial-public-offering-1" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Initial Public Offering (IPO)</strong></p>
<p>The process of selling stock to the public for the first time.</p>
<p>It allows <strong>greater liquidity</strong>, and <strong>better access to capital</strong> at the cost of <strong>more external monitoring</strong> and <strong>more demand for transparency</strong>.</p>
<div class="fragment">
<p><strong>Primary Offering</strong>: New shares available in a public offering that raise new capital</p>
<p><strong>Secondary Offering</strong>: Shares sold by existing shareholders in an equity offering</p>
</div>
<div class="fragment">
<p><strong>Underwriter</strong></p>
<p>An investment banking firm that manages a security issuance and designs its structure.</p>
</div>
</section>
<section id="the-initial-public-offering-2" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Best-Efforts Basis</strong>: For smaller IPOs, a situation in which the underwriter does not guarantee that the stock will be sold, but instead tries to sell the sock for the best possible price. Often such deals have an all-or-none clause: either all of the shares are sold on the IPO or the deal is called off.</p>
<div class="fragment">
<p><strong>Firm Commitment</strong>: An agreement between an underwriter and an issuing firm in which the underwriter guarantees that it will sell all of the stock at the offer price. Most common.</p>
</div>
<div class="fragment">
<p><strong>Auction IPO</strong>: A method of selling new issues directly to the public rather than setting a price itself and then allocating shares to buyers, the underwriter in an auction IPO takes bids from investors and then sets the price that clears the market.</p>
</div>
</section>
<section id="the-initial-public-offering-3" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Problem</strong></p>
<ul>
<li>Ashton, Inc., is selling 900,000 shares of stock in an <strong>auction IPO</strong>.</li>
<li>At the end of the bidding period, Ashton‚Äôs investment bank has received the following bids. <strong>What will be the offer price of the shares?</strong></li>
</ul>

<img data-src="../figs/bm_23_2_table.png" class="r-stretch"><div class="fragment">
<p><strong>Solution</strong>: The winning auction price would be 9.25.</p>
</div>
</section>
<section id="the-initial-public-offering-4" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Lead Underwriter</strong>: The primary investment banking firm responsible for managing a security issuance.</p>
<p><strong>Syndicate</strong>: A group of underwriters who jointly underwrite and distribute a security issuance.</p>
<ul>
<li>Underwriters market the IPO, and they help the company with all the necessary filings.</li>
<li>More importantly, they actively participate in determining the offer price.</li>
<li>In many cases, the underwriter will also commit to making a market in the stock after the issue, thereby guaranteeing that the stock will be liquid.</li>
</ul>
</section>
<section id="the-initial-public-offering-5" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Filings</strong></p>
<p><strong>Registration Statement</strong>: A legal document that provides financial and other information about a company to investors prior to a security issuance. Company managers work closely with the underwriters to prepare this registration statement.</p>
<p><strong>Preliminary Prospectus</strong>: Part of the registration statement prepared by a company prior to an IPO that is circulated to investors before the stock is offered.</p>
<p><strong>Final Prospectus</strong>: Part of the final registration statement prepared by a company prior to an IPO that contains all the details of the offering, including the number of shares offered and the offer price. This document is created only after carefull revision.</p>
</section>
<section id="the-initial-public-offering-6" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Valuation</strong>: There are two ways to value a company: a) Compute the present value of the estimated future cash flows, or B) Estimate the value by examining comparables (recent IPOs).</p>
<p><strong>Road Show</strong>: During an IPO, when a company‚Äôs senior management and its underwriters travel around promoting the company and explaining their rationale for an offer price to the underwriters‚Äô largest customers, mainly institutional investors such as mutual funds and pension funds.</p>
<p><strong>Book Building</strong>: A process used by underwriters for coming up with an offer price based on customers‚Äô expressions of interest. The book-building process provides an early indication of demand for the IPO. If demand appears to be weak in the target price range, the firm may choose to withdraw from the IPO process.</p>
</section>

<section id="the-initial-public-offering-8" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Spread</strong>: The fee a company pays to its underwriters that is a percentage of the issue price of a share of stock.</p>
<ul>
<li>For instance, consider the final offer price is 12.50 per share, and the company paid the underwriters a spread of $0.875 per share, exactly 7% of the issue price.</li>
<li>The underwriters buy the stock for 11.625 per share and then resold it to their customers for $12.50 per share.</li>
</ul>
<div class="fragment">
<ul>
<li>When an underwriter provides a <strong>firm commitment</strong>, it is potentially exposing itself to the risk that the banking firm might have to sell the shares at less than the offer price and take a loss.
<ul>
<li>However, research shows that about 75% of IPOs experience an increase in share price on the first day (only 9% experience a decrease).</li>
</ul></li>
</ul>
</div>
</section>
<section id="the-initial-public-offering-9" class="slide level2 smaller" data-background="#d9ead3">
<h2>23.2 The Initial Public Offering</h2>
<p><strong>Over-allotment allocation (greenshoe provision)</strong>: In an IPO, an option that allows the underwriter to issue more stock, usually amounting to some % of the original offer size, at the IPO offer price.</p>
<div class="fragment">
<p><strong>Lockup</strong>: A restriction that prevents existing shareholders from selling their shares for some period, usually 180 days, after an IPO.</p>
</div>
</section></section>
<section>
<section id="ipo-puzzles" class="title-slide slide level1 smaller center" data-background="#FFD6A4">
<h1>23.3 IPO Puzzles</h1>

</section>
<section id="ipo-puzzles-1" class="slide level2 smaller scrollable" data-background="#FFD6A4">
<h2>23.3 IPO Puzzles</h2>
<ol type="1">
<li><p>On average, IPOs appear to be <strong>underpriced</strong>: The price at the end of trading on the first day is often substantially higher than the IPO price.</p></li>
<li><p>The number of issues is <strong>highly cyclical</strong>: When times are good, the market is flooded with new issues; when times are bad, the number of issues dries up.</p></li>
<li><p>The <strong>costs of an IPO are very high</strong>, and it is unclear why firms willingly incur them (source: Berk &amp; DeMarzo).</p></li>
<li><p>The <strong>long-run performance of a newly public company (three to five years from the date of issue) is poor</strong>. That is, on average, a three- to five-year buy and hold strategy appears to be a bad investment.</p></li>
</ol>
</section>
<section id="ipo-puzzles-2" class="slide level2 smaller" data-background="#FFD6A4">
<h2>23.3 IPO Puzzles</h2>
<p><strong>Underpricing</strong></p>
<ul>
<li>Generally, underwriters set the issue price so that the average first-day return is positive.</li>
<li>Research has found that about 75% of first-day returns are positive. The average first-day return in the United States is 17%.</li>
<li>The underwriters benefit from the under pricing because it allows them to manage their risk.</li>
<li>The pre-IPO shareholders bear the cost of underpricing.</li>
<li>In effect, these owners are selling stock in their firm for less than they could get in the aftermarket.</li>
</ul>
</section>

<section id="ipo-puzzles-4" class="slide level2 smaller" data-background="#FFD6A4">
<h2>23.3 IPO Puzzles</h2>
<p><strong>Cyclicality and Recent Trends</strong></p>
<ul>
<li>The number of issues is highly cyclical.</li>
<li>When times are good, the market is flooded with new issues; when times are bad, the number of issues dries up.</li>
<li>What is surprising is the magnitude of the swings.</li>
<li>Another striking feature of the data in the following figure is that while the average dollar volume of IPOs since 2000 has been similar to that in the 1990s, the average number of IPOs per year has fallen significantly.</li>
</ul>
</section>
<section id="section-5" class="slide level2 smaller" data-background="#FFD6A4">
<h2></h2>

<img data-src="../figs/bm_23_5.jpg" class="r-stretch"></section>
<section id="ipo-puzzles-5" class="slide level2 smaller" data-background="#FFD6A4">
<h2>23.3 IPO Puzzles</h2>
<p><strong>Costs of an IPO</strong></p>
<ul>
<li>A typical spread is 7% of the issue price.</li>
<li>By most standards, this fee is large, especially considering the additional cost to the firm associated with underpricing.</li>
<li>It is puzzling that there seems to be a lack of sensitivity of fees to issue size.</li>
<li>One possible explanation is that by charging lower fees, an underwriter may risk signaling that it is not the same quality as its higher priced competitors.</li>
</ul>
</section>
<section id="section-6" class="slide level2 smaller" data-background="#FFD6A4">
<h2></h2>

<img data-src="../figs/bm_23_6.jpg" class="r-stretch"></section>
<section id="ipo-puzzles-6" class="slide level2 smaller" data-background="#FFD6A4">
<h2>23.3 IPO Puzzles</h2>
<p><strong>Long-Run Underperformance</strong></p>
<p>Although shares of IPOs generally perform very well immediately following the public offering, it has been shown that newly listed firms subsequently appear to perform relatively poorly over the following three to five years after their IPOs.</p>
</section></section>
<section>
<section id="seasoned-equity-offering" class="title-slide slide level1 smaller center" data-background="#f1f2c9">
<h1>23.4 Seasoned Equity Offering</h1>

</section>
<section id="seasoned-equity-offering-1" class="slide level2 smaller" data-background="#f1f2c9">
<h2>23.4 Seasoned Equity Offering</h2>
<p><strong>Seasoned Equity Offering (SEO)</strong></p>
<ul>
<li>When a public company offers new shares for sale</li>
<li>Public firms use SEOs to raise additional equity.</li>
<li>When a firm issues stock using an SEO, it follows many of the same steps as for an IPO.</li>
<li>The main difference is that a market price for the stock already exists, so the price-setting process is not necessary.</li>
</ul>
<div class="fragment">
<p><strong>Primary Shares</strong>: New shares issued by a company in an equity offering.</p>
<p><strong>Secondary Shares</strong>: Shares sold by existing shareholders in an equity offering.</p>
</div>
</section>
<section id="seasoned-equity-offering-2" class="slide level2 smaller" data-background="#f1f2c9">
<h2>23.4 Seasoned Equity Offering</h2>
<p><strong>There are two types of seasoned equity offerings.</strong></p>
<p><strong>Cash Offer</strong>: A type of SEO in which a firm offers the new shares to investors at large.</p>
<p><strong>Rights Offer</strong>: A type of SEO in which a firm offers the new shares only to existing shareholders.</p>
<ul>
<li>Rights offers protect existing shareholders from underpricing.</li>
</ul>
</section>
<section id="seasoned-equity-offering-3" class="slide level2 smaller" data-background="#f1f2c9">
<h2>23.4 Seasoned Equity Offering</h2>
<p><strong>Rights offers protect existing shareholders from underpricing.</strong></p>
<ul>
<li>Suppose a firm holds 100 in cash and has 50 shares out. Each share is worth 2.</li>
<li>It announces a cash offer for 50 shares at 1 per share. Once this offer is complete, the company will have 150 in cash and 100 shares outstanding. The price per share is now 1.50. <strong>The new shareholders therefore receive a 0.50 windfall at the expense of the old shareholders</strong>.</li>
<li>If it announces a rights offer, shareholders have the right to purchase an additional share for 1. If all shareholders chose to exercise their rights, then after the sale, the value of the firm is 150 with 100 shares outstanding and a price of 1.50 per share. <strong>In this case, however, the 0.50 windfall accrues to existing shareholders, which exactly offsets the drop in the stock price.</strong></li>
<li>By using a <strong>rights offering</strong> the firm can continue to issue equity without imposing a loss on its current shareholders.</li>
</ul>
</section>
<section id="seasoned-equity-offering-4" class="slide level2 smaller" data-background="#f1f2c9">
<h2>23.4 Seasoned Equity Offering</h2>
<p><strong>Price Reaction</strong></p>
<ul>
<li>Researchers have found that, on average, the market greets the news of an SEO with a price decline. This is consistent with the adverse selection discussed in Chapter 16.</li>
</ul>
<p><strong>Issuance Costs</strong></p>
<ul>
<li>Although not as costly as IPOs, seasoned offerings are still expensive. Underwriting fees amount to 5% of the proceeds of the issue. Rights offers have lower costs than cash offers.</li>
</ul>
</section>
<section id="section-7" class="slide level2 smaller" data-background="#FFFFFF">
<h2></h2>
<div style="font-size: 40%; text-align: right;">
<p>Key: <em>module1_question3</em> <input type="hidden" id="slide-id" value="module1_question3"></p>
</div>
<div class="question">
<p><strong>Net Proceeds in an SEO</strong></p>
<p>Orion AutoTech executed a seasoned equity offering (SEO) of 10 million shares at $31.09 per share. Of these, 4.8 million were primary (new shares issued by the company) and 5.2 million were secondary (sold by existing investors). Assume the underwriter charges 4.5% of the gross proceeds as an underwriting fee which is shared proportionately between the primary and secondary shares.</p>
<div class="question-block">
<form onsubmit="event.preventDefault();" style="display:flex;align-items:center;gap:8px;">
<span><strong>1. The amount of money raised by the company (in million USD) is:</strong></span> <input type="number" id="module1_num_q7a" name="module1_num_q7a" placeholder="Value" style="width:110px;" data-correct-answer="142.5" data-tolerance="0.5">
</form>
<div id="feedback-module1_num_q7a" class="feedback" data-status="" style="display:none;">
‚úÖ Net to issuer = (Primary Shares √ó Price) ‚àí Underwriter fee on primary = (4.8 √ó $31.09) ‚àí (4.5% √ó $149.23 million) = $149.23 million ‚àí $6.72 million = <strong>$142.5 million</strong>.
</div>
</div>
<div class="question-block">
<form onsubmit="event.preventDefault();" style="display:flex;align-items:center;gap:8px;">
<span><strong>2. The amount of money raised by the VC (in million USD) is:</strong></span> <input type="number" id="module1_num_q7b" name="module1_num_q7b" placeholder="Value" style="width:110px;" data-correct-answer="154.4" data-tolerance="0.5">
</form>
<div id="feedback-module1_num_q7b" class="feedback" data-status="" style="display:none;">
‚úÖ Net to VCs = (Secondary Shares √ó Price) ‚àí Underwriter fee on secondary = (5.2 √ó $31.09) ‚àí (4.5% √ó $161.67 million) = $161.67 million ‚àí $7.28 million = <strong>$154.4 million</strong>.
</div>
</div>
<div class="question-block">
<form onsubmit="event.preventDefault();" style="display:flex;align-items:center;gap:8px;">
<span><strong>3. The amount of money the underwriter will earn (in million USD) is:</strong></span> <input type="number" id="module1_num_q7c" name="module1_num_q7c" placeholder="Value" style="width:110px;" data-correct-answer="14" data-tolerance="0.5">
</form>
<div id="feedback-module1_num_q7c" class="feedback" data-status="" style="display:none;">
‚úÖ Fee = (Total Shares √ó Price) √ó Fee Rate = (10 √ó $31.09) √ó 4.5% = $310.9 million √ó 4.5% = <strong>$14 million</strong>.
</div>
</div>
</div>
<div style="text-align: right;">
<script>
// Fun√ß√£o auxiliar para verificar e definir o status de uma quest√£o.
function checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance = 0) {
  const feedbackDiv = document.getElementById(feedbackDivId);
  if (!feedbackDiv) return;

  let isCorrect = false;

  // Trata respostas num√©ricas com toler√¢ncia
 if (typeof correctAnswer === 'number' && typeof userAnswer === 'number' && !isNaN(userAnswer)) {
    const lowerBound = correctAnswer - tolerance;
    const upperBound = correctAnswer + tolerance;
    isCorrect = (userAnswer >= lowerBound && userAnswer <= upperBound);
  } else if (typeof userAnswer === 'string') {
    // Para respostas de texto (T/F, M√∫ltipla Escolha)
    isCorrect = (userAnswer.trim().toUpperCase() === correctAnswer.toUpperCase());
  }
  // Adicione outras l√≥gicas de compara√ß√£o aqui se necess√°rio (ex: arrays para m√∫ltiplos checkboxes)

  if (isCorrect) {
    feedbackDiv.dataset.status = "correct";
  } else {
    feedbackDiv.dataset.status = "incorrect";
  }
  feedbackDiv.style.display = "none"; // Mant√©m o feedback oculto
}

// Fun√ß√£o para obter a resposta de um grupo de radio buttons
function getSelectedRadioValue(name) {
    const radios = document.querySelectorAll(`input[type="radio"][name="${name}"]:checked`);
    if (radios.length > 0) {
        return radios[0].value;
    }
    return ''; // Retorna string vazia se nada for selecionado
}

function toggleFeedback() {
  const questionBlocks = document.querySelectorAll('.question-block');
  const feedbacks = document.querySelectorAll('.feedback');
  const scoreDiv = document.getElementById('score-summary');
  const toggleButton = document.getElementById('toggle-feedback-btn');

  let showing = feedbacks.length > 0 && feedbacks[0].style.display === 'block';

  if (showing) {
    // Esconder feedback
    feedbacks.forEach(f => {
      f.style.display = 'none';
      f.style.color = 'black'; // Reseta a cor ao esconder
    });
    scoreDiv.textContent = '';
    toggleButton.textContent = 'Show Feedback';
  } else {
    // Mostrar feedback
    let correctCount = 0;
    let totalQuestions = 0;

    questionBlocks.forEach(block => {
      totalQuestions++;
      const textInput = block.querySelector('input[type="text"]');
      const numberInput = block.querySelector('input[type="number"]'); // Novo: input num√©rico
      const form = block.querySelector('form');

      let questionId, userAnswer, correctAnswer, tolerance = 0;
      let feedbackDivId;

      if (textInput && textInput.dataset.correctAnswer) {
        // Quest√£o de texto (T/F)
        questionId = textInput.id;
        userAnswer = textInput.value;
        correctAnswer = textInput.dataset.correctAnswer;
      } else if (numberInput && numberInput.dataset.correctAnswer) {
        // Quest√£o num√©rica
        questionId = numberInput.id;
        // Converte para n√∫mero. Se n√£o for um n√∫mero v√°lido, NaN.
        userAnswer = parseFloat(numberInput.value);
        correctAnswer = parseFloat(numberInput.dataset.correctAnswer);
        if (numberInput.dataset.tolerance) {
          tolerance = parseFloat(numberInput.dataset.tolerance);
        }
        // Se a resposta do usu√°rio n√£o for um n√∫mero v√°lido, trate como incorreta
        if (isNaN(userAnswer)) {
             userAnswer = null; // Mant√©m como valor num√©rico inv√°lido
        }
      } else if (form && form.querySelector('input[type="radio"]') && form.dataset.correctAnswer) {
        // Quest√£o de m√∫ltipla escolha (radio)
        questionId = form.querySelector('input[type="radio"]').name;
        userAnswer = getSelectedRadioValue(questionId);
        correctAnswer = form.dataset.correctAnswer;
      } else {
        // Se n√£o for um tipo de quest√£o reconhecido ou n√£o tem resposta correta
        totalQuestions--; // N√£o conta esta quest√£o no total se n√£o puder ser avaliada
        return; // Pula para a pr√≥xima quest√£o
      }

      feedbackDivId = 'feedback-' + questionId;
      const feedbackDiv = document.getElementById(feedbackDivId);

      if (feedbackDiv) { // Apenas processa se h√° um feedback div
        checkAnswerAndSetStatus(questionId, userAnswer, correctAnswer, feedbackDivId, tolerance);

        // Agora, exibe e colore o feedback ap√≥s a verifica√ß√£o
        if (feedbackDiv.dataset.status === 'correct') {
          feedbackDiv.style.color = 'green';
          correctCount++;
        } else if (feedbackDiv.dataset.status === 'incorrect') {
          feedbackDiv.style.color = 'red';
        } else {
          feedbackDiv.style.color = 'black'; // Se n√£o foi respondida ou n√£o tem status
        }
        feedbackDiv.style.display = 'block'; // Exibe o feedback
      }
    });

    scoreDiv.textContent = `‚úÖ  You answered ${correctCount} out of  ${totalQuestions}  correctly.`;
    toggleButton.textContent = 'Hide Feedback';
  }
}
</script>
<button id="toggle-feedback-btn" onclick="toggleFeedback()" style="background-color:#007BFF; color:white; padding:8px 16px; border:none; border-radius:5px; cursor:pointer;">
Show Feedback
</button>
<div id="score-summary" style="margin-top: 15px; font-weight: bold;">

</div>
</div>
</section></section>
<section>

<section id="now-it-is-your-turn-1" class="slide level2" data-background="#191f36">
<h2>Now it is your turn‚Ä¶</h2>
<div style="font-family: sans-serif; display: flex; flex-direction: column; align-items: center; gap: 16px; margin-top: 30px;">
<p><a href="https://henriquemartins.net/teaching/financial_strategy/module1/p1tf.html" target="_blank" style="text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);"> ‚úÖ True / False Questions </a></p>
<p><a href="https://henriquemartins.net/teaching/financial_strategy/module1/p1num.html" target="_blank" style="text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);"> üî¢ Numeric Questions </a></p>
<p><a href="https://henriquemartins.net/teaching/financial_strategy/module1/p1mcq.html" target="_blank" style="text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);"> üìù Multiple Choice </a></p>
<p><a href="https://henriquemartins.net/teaching/financial_strategy/module1/p1long.html" target="_blank" style="text-decoration: none; width: 75%; background: white; color: #2c3e50; font-weight: bold; text-align: center; padding: 16px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);"> ‚úçÔ∏è Long-form Answers </a></p>
</div>
<div class="footer">

</div>
</section>
<section id="section-8" class="slide level2" data-background="#f7f9fc">
<h2></h2>
<div data-ticket="" data-bridge="https://course-chat.hcmrtns.workers.dev/checkouts" data-session="module1_checkout1" data-page="module1_checkout1" data-require-login="true" data-open="2026-01-02 16:30" data-close="2026-02-02 16:59">

</div>
<!-- checkout2.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) -->
<style>
  /* ===== Tokens (light) ‚Äî exit-checkout colors ===== */
  :root{
    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);
    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;
    --focus:rgba(59,130,246,.22);
    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;
    --textarea-bg:#fff;

    /* ribbon colors by state */
    --ribbon-open-1: rgba(34,197,94,.18);   /* green */
    --ribbon-open-2: rgba(16,185,129,.16);
    --ribbon-soon-1: rgba(245,158,11,.18);  /* amber */
    --ribbon-soon-2: rgba(251,191,36,.16);
    --ribbon-closed-1: rgba(239,68,68,.20); /* red */
    --ribbon-closed-2: rgba(248,113,113,.16);
    --ribbon-default-1: rgba(99,102,241,.14); /* blue (fallback) */
    --ribbon-default-2: rgba(96,165,250,.14);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);
      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);
      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;
      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;
      --textarea-bg:rgba(2,6,23,.55);
    }
  }

  /* Card */
  [data-ticket] .tw-card{
    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;
    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);
    color:var(--ink);overflow:hidden;box-sizing:border-box;
  }
  [data-ticket] .tw-card::before{
    content:"";position:absolute;inset:0 0 auto 0;height:56px;
    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));
    pointer-events:none;
  }
  /* ribbon by state */
  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }
  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }
  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }

  /* Header */
  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}
  [data-ticket] .tw-icon{
    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;
  }
  [data-ticket] .tw-icon::after{
    content:"";position:absolute;inset:-3px;border-radius:14px;
    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));
    z-index:-1;filter:blur(6px);opacity:.55;
  }
  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}
  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}
  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}
  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}

  /* Badges */
  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
  [data-ticket] .tw-badge{
    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;
    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;
  }
  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{
    color:currentColor;stroke:currentColor!important;fill:none;
  }
  [data-ticket] .tw-window-text{white-space:pre-line;}

  /* Status dot */
  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}
  [data-ticket].open  .tw-dot{background:#16a34a;}
  [data-ticket].soon  .tw-dot{background:#f59e0b;}
  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}

  /* Textarea */
  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}
  [data-ticket] textarea.tw-text{
    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;
    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;
    resize:vertical;color:var(--ink);box-sizing:border-box;
  }
  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}
  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}

  /* Footer & messages */
  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;}
  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}
  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}
  [data-ticket] .tw-msg.success{color:#059669!important;}
  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}
  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}
  /* match dot color if no explicit class was set */
  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}
  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}
  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}

  /* Button */
  [data-ticket] .tw-btn{
    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);
    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;
    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;
  }
  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}
  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}
  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}
  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}

  /* Spinner */
  [data-ticket] .spin:after{
    content:"";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);
    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;
  }
  @keyframes twspin{to{transform:rotate(360deg)}}

  /* Mini-login */
  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}
  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}

  /* Responsive */
  @media (max-width:640px){
    [data-ticket] .tw-card{border-radius:14px;padding:14px;}
    [data-ticket] .tw-header{gap:10px;}
    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}
  }
</style>
<script>
(() => {
  const $ = (sel, el=document) => el.querySelector(sel);

  function mountAll(){
    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);
  }

  function initOne(host){
    host.setAttribute('data-tw-mounted','1');

    // ---- Config/attrs
    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();
    const sessionTag = (host.getAttribute('data-session') || '').trim();
    const pageAttr   = (host.getAttribute('data-page') || '').trim();
    const winStartStr= (host.getAttribute('data-open') || '').trim();
    const winEndStr  = (host.getAttribute('data-close') || '').trim();
    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';

    // ---- Helpers
    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;
    const winStart = parseLocal(winStartStr);
    const winEnd   = parseLocal(winEndStr);

    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };
    function statusNow(){
      const now = new Date();
      if (!winStart || !winEnd) return {state:'open', label:'Always available'};
      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }
      if (now > winEnd)   return {state:'closed', label:'Closed'};
      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};
    }
    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();
    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);

    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };
    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;
    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };
    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };

    // ---- UI skeleton
    host.innerHTML = '';
    const card = document.createElement('div'); card.className = 'tw-card';
    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\n‚Üí ' + winEndStr) : 'No window set';
    card.innerHTML = `
      <div class="tw-header">
        <div class="tw-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="tw-titles">
          <div class="tw-title">Check-out</div>
          <div class="tw-sub"></div>
        </div>
        <div class="tw-meta">
          <div class="tw-badge"><span class="tw-dot"></span><span class="tw-badge-text">‚Äî</span></div>
          <div class="tw-badge" title="S√£o Paulo time">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M12 7v5l4 2" stroke="#334155" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="9" stroke="#334155" stroke-width="1.5" fill="none"/></svg>
            <span class="tw-window-text">${windowLabel}</span>
          </div>
        </div>
      </div>
      <div class="tw-login" style="display:none">
        <input type="text" class="tw-login-input" placeholder="Digite seu ID / e-mail do curso"/>
        <button type="button" class="tw-btn tw-login-btn">Entrar</button>
      </div>
      <div class="tw-body"></div>
      <div class="tw-footer">
        <button type="button" class="tw-btn tw-send">Send (click only 1x)</button>
        <div class="tw-count">0/500</div>
      </div>
      <div class="tw-msg"></div>`;
    host.appendChild(card);

    // refs
    const body = $('.tw-body', card);
    const btn  = $('.tw-send', card);
    const msg  = $('.tw-msg', card);
    const badgeText = $('.tw-badge-text', card);
    const count = $('.tw-count', card);
    const loginRow = $('.tw-login', card);
    const loginInp = $('.tw-login-input', card);
    const loginBtn = $('.tw-login-btn', card);

    // textarea
    const ta = document.createElement('textarea');
    ta.className = 'tw-text'; ta.maxLength = 500;
    ta.placeholder = 'Your check-out (max 500): one thing you learned + one question‚Ä¶';
    body.appendChild(ta);
    ta.addEventListener('input', () => { count.textContent = `${ta.value.length}/500`; syncEnabled(); });
    count.textContent = '0/500';

    const successMsg = 'Check-out recorded. Thank you!';
    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';

    function paintBadge(){
      const st = statusNow();
      host.classList.remove('open','soon','closed'); host.classList.add(st.state);
      badgeText.textContent = st.label;
    }

    function showLoginIfNeeded(){
      const need = requireLogin && !getStudentId();
      loginRow.style.display = need ? 'flex' : 'none';
    }

    function syncEnabled(){
      const logged = !requireLogin || !!getStudentId();
      const st     = statusNow().state;
      const filled = ta.value.trim().length>0;
      const enabled= logged && (st==='open') && filled && !isDone();
      btn.disabled = !enabled;

      showLoginIfNeeded(); paintBadge();

      if (isDone()){
        setMsg(msg, dupMsg, 'success');
        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;
      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');
      else if (st==='soon') setMsg(msg,'Not open yet.','warning');
      else if (st==='closed') setMsg(msg,'This activity is closed.','error');
      else if (!filled) setMsg(msg,'Write something to submit.','warning');
      else setMsg(msg,''); // ready
    }

    // mini-login
    loginBtn?.addEventListener('click', () => {
      const v = (loginInp.value || '').trim();
      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }
      try { localStorage.setItem('studentId', v); } catch {}
      window.studentId = v;
      document.dispatchEvent(new Event('auth:login'));
      setMsg(msg,''); syncEnabled();
    });

    // timers + cleanup
    paintBadge(); syncEnabled();
    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);
    const obs = new MutationObserver(() => {
      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }
    });
    obs.observe(document.body, {childList:true, subtree:true});
    document.addEventListener('auth:login', syncEnabled);

    // Submit
    btn.addEventListener('click', async (e) => {
      e.preventDefault(); e.stopPropagation();

      const sid = getStudentId();
      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }
      const text = ta.value.trim().slice(0,500);
      if (!text){ setMsg(msg,'Write something to submit.','warning'); return; }
      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }

      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');

      const payload = {
        student_id: sid,                 // ‚Üê alinha com D1
        slide_id: (sessionTag || getPageId()),
        ticket: text,
        tsClient: new Date().toISOString(),
        open:  winStartStr,
        close: winEndStr,
        user_agent: navigator.userAgent
      };

      try{
        const res = await fetch(bridge, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload),
          keepalive:true
        });

        const raw = await res.text();
        let data = null; try{ data = JSON.parse(raw); }catch(_){}

        if (!res.ok){
          if (data && data.status === 'closed_window'){
            setMsg(msg,'This activity is closed now.','error');
          } else {
            setMsg(msg,'Failed to submit. Please try again.','error');
          }
          console.error('[checkout2] HTTP error:', res.status, raw);
          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
          return;
        }

        if (data && data.status === 'success'){
          setMsg(msg, successMsg, 'success');
          ta.value=''; count.textContent='0/500';
          markDone(btn); clearInterval(ticker);
          return;
        }
        if (data && data.status === 'duplicate'){
          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;
        }
        if (data && data.status === 'closed_window'){
          setMsg(msg,'This activity is closed now.','error');
          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
          return;
        }

        setMsg(msg,'Failed to submit. Please try again.','error');
        console.error('[checkout2] unexpected response:', raw);
        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
      }catch(err){
        console.error('[checkout2] submit error:', err);
        setMsg(msg,'Network error. Please try again.','error');
        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
      }
    });
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', mountAll, { once:true });
  } else {
    mountAll();
  }
})();
</script>
</section>
<section id="section-9" class="slide level2" data-background="#f7f9fc">
<h2></h2>
<div data-ticket="" data-bridge="https://course-chat.hcmrtns.workers.dev/checkouts" data-session="module1_checkout2" data-page="module1_checkout2" data-require-login="true" data-open="2026-02-04 16:30" data-close="2026-02-04 16:59">

</div>
<!-- checkout2.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) -->
<style>
  /* ===== Tokens (light) ‚Äî exit-checkout colors ===== */
  :root{
    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);
    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;
    --focus:rgba(59,130,246,.22);
    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;
    --textarea-bg:#fff;

    /* ribbon colors by state */
    --ribbon-open-1: rgba(34,197,94,.18);   /* green */
    --ribbon-open-2: rgba(16,185,129,.16);
    --ribbon-soon-1: rgba(245,158,11,.18);  /* amber */
    --ribbon-soon-2: rgba(251,191,36,.16);
    --ribbon-closed-1: rgba(239,68,68,.20); /* red */
    --ribbon-closed-2: rgba(248,113,113,.16);
    --ribbon-default-1: rgba(99,102,241,.14); /* blue (fallback) */
    --ribbon-default-2: rgba(96,165,250,.14);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);
      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);
      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;
      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;
      --textarea-bg:rgba(2,6,23,.55);
    }
  }

  /* Card */
  [data-ticket] .tw-card{
    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;
    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);
    color:var(--ink);overflow:hidden;box-sizing:border-box;
  }
  [data-ticket] .tw-card::before{
    content:"";position:absolute;inset:0 0 auto 0;height:56px;
    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));
    pointer-events:none;
  }
  /* ribbon by state */
  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }
  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }
  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }

  /* Header */
  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}
  [data-ticket] .tw-icon{
    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;
  }
  [data-ticket] .tw-icon::after{
    content:"";position:absolute;inset:-3px;border-radius:14px;
    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));
    z-index:-1;filter:blur(6px);opacity:.55;
  }
  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}
  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}
  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}
  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}

  /* Badges */
  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
  [data-ticket] .tw-badge{
    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;
    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;
  }
  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{
    color:currentColor;stroke:currentColor!important;fill:none;
  }
  [data-ticket] .tw-window-text{white-space:pre-line;}

  /* Status dot */
  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}
  [data-ticket].open  .tw-dot{background:#16a34a;}
  [data-ticket].soon  .tw-dot{background:#f59e0b;}
  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}

  /* Textarea */
  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}
  [data-ticket] textarea.tw-text{
    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;
    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;
    resize:vertical;color:var(--ink);box-sizing:border-box;
  }
  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}
  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}

  /* Footer & messages */
  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;}
  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}
  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}
  [data-ticket] .tw-msg.success{color:#059669!important;}
  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}
  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}
  /* match dot color if no explicit class was set */
  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}
  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}
  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}

  /* Button */
  [data-ticket] .tw-btn{
    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);
    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;
    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;
  }
  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}
  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}
  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}
  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}

  /* Spinner */
  [data-ticket] .spin:after{
    content:"";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);
    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;
  }
  @keyframes twspin{to{transform:rotate(360deg)}}

  /* Mini-login */
  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}
  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}

  /* Responsive */
  @media (max-width:640px){
    [data-ticket] .tw-card{border-radius:14px;padding:14px;}
    [data-ticket] .tw-header{gap:10px;}
    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}
  }
</style>
<script>
(() => {
  const $ = (sel, el=document) => el.querySelector(sel);

  function mountAll(){
    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);
  }

  function initOne(host){
    host.setAttribute('data-tw-mounted','1');

    // ---- Config/attrs
    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();
    const sessionTag = (host.getAttribute('data-session') || '').trim();
    const pageAttr   = (host.getAttribute('data-page') || '').trim();
    const winStartStr= (host.getAttribute('data-open') || '').trim();
    const winEndStr  = (host.getAttribute('data-close') || '').trim();
    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';

    // ---- Helpers
    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;
    const winStart = parseLocal(winStartStr);
    const winEnd   = parseLocal(winEndStr);

    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };
    function statusNow(){
      const now = new Date();
      if (!winStart || !winEnd) return {state:'open', label:'Always available'};
      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }
      if (now > winEnd)   return {state:'closed', label:'Closed'};
      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};
    }
    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();
    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);

    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };
    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;
    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };
    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };

    // ---- UI skeleton
    host.innerHTML = '';
    const card = document.createElement('div'); card.className = 'tw-card';
    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\n‚Üí ' + winEndStr) : 'No window set';
    card.innerHTML = `
      <div class="tw-header">
        <div class="tw-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="tw-titles">
          <div class="tw-title">Check-out</div>
          <div class="tw-sub"></div>
        </div>
        <div class="tw-meta">
          <div class="tw-badge"><span class="tw-dot"></span><span class="tw-badge-text">‚Äî</span></div>
          <div class="tw-badge" title="S√£o Paulo time">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M12 7v5l4 2" stroke="#334155" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="9" stroke="#334155" stroke-width="1.5" fill="none"/></svg>
            <span class="tw-window-text">${windowLabel}</span>
          </div>
        </div>
      </div>
      <div class="tw-login" style="display:none">
        <input type="text" class="tw-login-input" placeholder="Digite seu ID / e-mail do curso"/>
        <button type="button" class="tw-btn tw-login-btn">Entrar</button>
      </div>
      <div class="tw-body"></div>
      <div class="tw-footer">
        <button type="button" class="tw-btn tw-send">Send (click only 1x)</button>
        <div class="tw-count">0/500</div>
      </div>
      <div class="tw-msg"></div>`;
    host.appendChild(card);

    // refs
    const body = $('.tw-body', card);
    const btn  = $('.tw-send', card);
    const msg  = $('.tw-msg', card);
    const badgeText = $('.tw-badge-text', card);
    const count = $('.tw-count', card);
    const loginRow = $('.tw-login', card);
    const loginInp = $('.tw-login-input', card);
    const loginBtn = $('.tw-login-btn', card);

    // textarea
    const ta = document.createElement('textarea');
    ta.className = 'tw-text'; ta.maxLength = 500;
    ta.placeholder = 'Your check-out (max 500): one thing you learned + one question‚Ä¶';
    body.appendChild(ta);
    ta.addEventListener('input', () => { count.textContent = `${ta.value.length}/500`; syncEnabled(); });
    count.textContent = '0/500';

    const successMsg = 'Check-out recorded. Thank you!';
    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';

    function paintBadge(){
      const st = statusNow();
      host.classList.remove('open','soon','closed'); host.classList.add(st.state);
      badgeText.textContent = st.label;
    }

    function showLoginIfNeeded(){
      const need = requireLogin && !getStudentId();
      loginRow.style.display = need ? 'flex' : 'none';
    }

    function syncEnabled(){
      const logged = !requireLogin || !!getStudentId();
      const st     = statusNow().state;
      const filled = ta.value.trim().length>0;
      const enabled= logged && (st==='open') && filled && !isDone();
      btn.disabled = !enabled;

      showLoginIfNeeded(); paintBadge();

      if (isDone()){
        setMsg(msg, dupMsg, 'success');
        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;
      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');
      else if (st==='soon') setMsg(msg,'Not open yet.','warning');
      else if (st==='closed') setMsg(msg,'This activity is closed.','error');
      else if (!filled) setMsg(msg,'Write something to submit.','warning');
      else setMsg(msg,''); // ready
    }

    // mini-login
    loginBtn?.addEventListener('click', () => {
      const v = (loginInp.value || '').trim();
      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }
      try { localStorage.setItem('studentId', v); } catch {}
      window.studentId = v;
      document.dispatchEvent(new Event('auth:login'));
      setMsg(msg,''); syncEnabled();
    });

    // timers + cleanup
    paintBadge(); syncEnabled();
    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);
    const obs = new MutationObserver(() => {
      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }
    });
    obs.observe(document.body, {childList:true, subtree:true});
    document.addEventListener('auth:login', syncEnabled);

    // Submit
    btn.addEventListener('click', async (e) => {
      e.preventDefault(); e.stopPropagation();

      const sid = getStudentId();
      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }
      const text = ta.value.trim().slice(0,500);
      if (!text){ setMsg(msg,'Write something to submit.','warning'); return; }
      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }

      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');

      const payload = {
        student_id: sid,                 // ‚Üê alinha com D1
        slide_id: (sessionTag || getPageId()),
        ticket: text,
        tsClient: new Date().toISOString(),
        open:  winStartStr,
        close: winEndStr,
        user_agent: navigator.userAgent
      };

      try{
        const res = await fetch(bridge, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload),
          keepalive:true
        });

        const raw = await res.text();
        let data = null; try{ data = JSON.parse(raw); }catch(_){}

        if (!res.ok){
          if (data && data.status === 'closed_window'){
            setMsg(msg,'This activity is closed now.','error');
          } else {
            setMsg(msg,'Failed to submit. Please try again.','error');
          }
          console.error('[checkout2] HTTP error:', res.status, raw);
          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
          return;
        }

        if (data && data.status === 'success'){
          setMsg(msg, successMsg, 'success');
          ta.value=''; count.textContent='0/500';
          markDone(btn); clearInterval(ticker);
          return;
        }
        if (data && data.status === 'duplicate'){
          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;
        }
        if (data && data.status === 'closed_window'){
          setMsg(msg,'This activity is closed now.','error');
          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
          return;
        }

        setMsg(msg,'Failed to submit. Please try again.','error');
        console.error('[checkout2] unexpected response:', raw);
        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
      }catch(err){
        console.error('[checkout2] submit error:', err);
        setMsg(msg,'Network error. Please try again.','error');
        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
      }
    });
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', mountAll, { once:true });
  } else {
    mountAll();
  }
})();
</script>
</section>
<section id="any-questions" class="slide level2" data-background="#fdf6e3">
<h2>üôã‚Äç‚ôÇÔ∏è <strong>Any Questions?</strong></h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="thank-you">Thank You!</h3>
<p><img data-src="../figs/qa2.png" style="box-shadow: none;;width:110.0%"></p>
</div><div class="column" style="width:50%;">
<div style="text-align:right;">
<p><img src="../figs/avatar.jpg" width="120px" style="border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);"></p>
</div>
<h3 id="henrique-c.-martins"><strong>Henrique C. Martins</strong></h3>
<ul>
<li>üåê <a href="https://eaesp.fgv.br/en/people/henrique-castro-martins">FGV/EAESP</a><br>
</li>
<li>üíº <a href="https://www.linkedin.com/in/henriquecastror/">LinkedIn</a><br>
</li>
<li>üß† <a href="https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&amp;hl=pt-BR&amp;oi=ao">Google Scholar</a><br>
</li>
<li>üìÑ <a href="http://lattes.cnpq.br/6076997472159785">Lattes CV</a><br>
</li>
<li>üè† <a href="https://henriquemartins.net/">Personal Website</a><br>
</li>
</ul>
</div>
</div>

<div class="quarto-auto-generated-content">
<p><img src="../figs/background8.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><span style="font-size:10px"> [<a href="mailto:henrique.martins@fgv.br">Henrique C. Martins</a>] [<a href="https://henriquemartins.net/teaching/financial_strategy/">Teaching Resources</a>]<strong>[Do not use without permission]</strong></span></p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <!-- chat-widget-deluxe.html : Floating chat for all slides (Quarto + revealjs) -->
    <style>
      :root{
        /* Fundo geral claro e elegante */
        --bg: rgba(255,255,255,.88);
        --border: rgba(15,23,42,.12);
        --shadow: 0 12px 40px rgba(20,20,40,.18);

        --brand1: #4f46e5; /* indigo */
        --brand2: #06b6d4; /* cyan */
        --brand-weak: rgba(79,70,229,.10);

        --text: #0f172a;
        --muted: #475569;
        --danger: #b91c1c;

        --bubble-user: #ffffff;
        --bubble-ai:   #fbfdff;
      }
      @media (prefers-color-scheme: dark){
        :root{
          --bg: rgba(19,26,42,.72);
          --border: rgba(255,255,255,.10);
          --shadow: 0 18px 50px rgba(0,0,0,.55);
          --text: #e6e9ef;
          --muted: #b6bfca;
          --brand-weak: rgba(79,70,229,.20);

          --bubble-user: rgba(255,255,255,.08);
          --bubble-ai:   rgba(255,255,255,.06);
        }
      }

      .vhcm-panel, .vhcm-input textarea, .vhcm-bubble {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: "liga" 1, "kern" 1;
      }

      /* FAB button */
      .vhcm-fab{position:fixed; right:18px; bottom:18px; z-index:9999; display:flex; align-items:center; gap:10px}
      .vhcm-fab button{border:none; border-radius:16px; padding:12px 14px; cursor:pointer; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; box-shadow:var(--shadow); display:flex; align-items:center; gap:10px; font-weight:600}
      .vhcm-fab svg{width:20px; height:20px}

      /* Panel (redimension√°vel) */
      .vhcm-panel{
        position:fixed; right:18px; bottom:78px;
        width:325px; height:600px;
        min-width:280px; min-height:360px;
        max-width:94vw; max-height:84vh;

        display:none; flex-direction:column; border:1px solid var(--border);
        border-radius:18px; box-shadow:var(--shadow); overflow:hidden; z-index:9999;
        backdrop-filter: blur(16px) saturate(140%); -webkit-backdrop-filter: blur(16px) saturate(140%);
        background: var(--bg); animation:vslide .25s ease-out;

        /* permite redimensionar pelo canto inferior direito */
        resize: both;
      }
      @keyframes vslide{from{transform: translateY(8px); opacity:0} to{transform:none; opacity:1}}

      .vhcm-header{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border); background:linear-gradient(135deg, rgba(79,70,229,.10), rgba(6,182,212,.08));}
      .vhcm-brand{display:flex; align-items:center; gap:10px}
      .vhcm-logo{width:28px; height:28px; border-radius:10px; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; box-shadow:0 4px 16px var(--brand-weak)}
      .vhcm-title{font-weight:700; letter-spacing:.2px; color:var(--text)}
      .vhcm-status{display:flex; align-items:center; gap:6px; color:var(--muted); font-size:12px}
      .vhcm-dot{width:8px; height:8px; border-radius:50%; background:#22c55e; box-shadow:0 0 0 2px rgba(34,197,94,.25)}
      .vhcm-close{border:none; background:transparent; font-size:18px; cursor:pointer; color:var(--muted)}

      /* Bot√£o meia tela */
      .vhcm-half{
        border:none; background:transparent; cursor:pointer;
        font-size:16px; color:var(--muted); margin-right:6px;
      }
      .vhcm-half:hover{ color: var(--text); }

      /* Painel em meia tela (50vw x 50vh) */
      .vhcm-panel.vhcm--half{
        width: 50vw !important;
        height: 50vh !important;
        max-width: 95vw;
        max-height: 95vh;
        border-radius: 12px;
      }

      .vhcm-body{flex:1; overflow:auto; padding:14px; background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0));}
      .vhcm-typing{font-size:12px; color:var(--muted); display:none; padding:6px 2px}
      .vhcm-dots{display:inline-flex; gap:3px; margin-left:4px}
      .vhcm-dots span{width:6px; height:6px; border-radius:50%; background:var(--muted); opacity:.6; animation:blink 1.2s infinite}
      .vhcm-dots span:nth-child(2){animation-delay:.2s}
      .vhcm-dots span:nth-child(3){animation-delay:.4s}
      @keyframes blink{0%,80%,100%{opacity:.2; transform:translateY(0)} 40%{opacity:.9; transform:translateY(-2px)}}

      .vhcm-input{
        display:flex; align-items:flex-end; gap:8px; padding:12px;
        border-top:1px solid var(--border);
        background:linear-gradient(180deg, rgba(255,255,255,.40), rgba(255,255,255,.20));
      }
      .vhcm-input textarea{
        flex:1;
        resize:none;
        min-height:44px;
        max-height:140px;
        padding:12px 14px;
        border:1px solid var(--border);
        border-radius:14px;
        background:#ffffff;
        color:#0f172a;
        font: 500 14px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        caret-color: var(--brand1);
        box-shadow: 0 1px 0 rgba(0,0,0,.02) inset;
      }
      .vhcm-input textarea::placeholder{ color:#475569; }

      .vhcm-send{background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:600}
      .vhcm-send svg{width:18px; height:18px}

      .vhcm-msg{display:flex; gap:10px; margin-bottom:12px; align-items:flex-end}
      .vhcm-avatar{width:28px; height:28px; border-radius:10px; background:var(--brand-weak); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; color:var(--text)}
      .vhcm-bubble{
        max-width:78%; padding:12px 14px; border-radius:14px; border:1px solid var(--border);
        box-shadow: 0 6px 18px rgba(0,0,0,.06);
        line-height:1.48; font-weight:500;
      }
      .vhcm-msg.user{justify-content:flex-end}
      .vhcm-msg.user .vhcm-bubble{
        background: var(--bubble-user);
        color: var(--text);
        border-color: rgba(15,23,42,.10);
      }
      .vhcm-msg.user .vhcm-avatar{display:none}
      .vhcm-msg.ai .vhcm-bubble{
        background: var(--bubble-ai);
        color: var(--text);
        border-color: rgba(15,23,42,.10);
      }

      .vhcm-error{color:var(--danger); font-size:12px; margin:6px 2px}
    </style>

    <div class="vhcm-fab">
      <button id="vhcm-open" title="Virtual HCM">
        <svg viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c4.97 0 9-3.582 9-8 0-1.93-.71-3.706-1.92-5.126l.86-3.006-3.01.847C15.87 5.6 14 5 12 5 7.03 5 3 8.582 3 13s4.03 9 9 9Z" stroke="currentColor" stroke-width="1.2"></path></svg>
        Virtual HCM
      </button>
    </div>

    <div class="vhcm-panel" id="vhcm-panel" role="dialog" aria-label="Virtual HCM chat">
      <div class="vhcm-header">
        <div class="vhcm-brand">
          <div class="vhcm-logo">VH</div>
          <div>
            <div class="vhcm-title">Virtual HCM</div>
            <div class="vhcm-status"><span class="vhcm-dot"></span><span id="vhcm-module-label">module1</span></div>
          </div>
        </div>
        <div>
          <button id="vhcm-half" class="vhcm-half" aria-label="Half screen" title="Half screen">‚§¢</button>
          <button id="vhcm-close" class="vhcm-close" aria-label="Close">‚úï</button>
        </div>
      </div>
      <div class="vhcm-body" id="vhcm-body"></div>
      <div class="vhcm-typing" id="vhcm-typing">Virtual HCM is typing <span class="vhcm-dots"><span></span><span></span><span></span></span></div>
      <div class="vhcm-input">
        <textarea id="vhcm-text" placeholder="Ask anything about this module‚Ä¶"></textarea>
        <button class="vhcm-send" id="vhcm-send" title="Send">
          <svg viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 11l17-8-8 17-1-7-8-2Z" stroke="#fff" stroke-width="1.6"></path></svg>
          Send
        </button>
      </div>
    </div>

    <script>
    (function(){
      // ====== CONFIG ======
      const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbza4kInsudyRFK_62VL8eULh3TiF_zMdleq4N0OpX4QunuU2rEryBnbE4S9zDHQkvB_/exec"; // troque se necess√°rio
      const DEFAULT_MODULE = "module1";
      const STORAGE_OPEN   = "vhcm_open";
      const STORAGE_SIZE   = "vhcm_size";
      const STORAGE_HALF   = "vhcm_half_mode";
      const STORAGE_SIZE_PREV = "vhcm_size_prev";

      // ====== Elements ======
      const btnOpen = document.getElementById('vhcm-open');
      const btnClose = document.getElementById('vhcm-close');
      const btnHalf = document.getElementById('vhcm-half');
      const panel = document.getElementById('vhcm-panel');
      const body = document.getElementById('vhcm-body');
      const typing = document.getElementById('vhcm-typing');
      const text = document.getElementById('vhcm-text');
      const send = document.getElementById('vhcm-send');
      const moduleLabel = document.getElementById('vhcm-module-label');

      // ====== Module detection (robusta, sem quebrar compatibilidade) ======
      function detectModule(){
        try {
          // 1) Override expl√≠cito via window.VHCM.module
          if (window.VHCM && window.VHCM.module) {
            const v = String(window.VHCM.module).trim();
            if (v) return v;
          }
          // 2) Reveal slide atual com data-module
          if (window.Reveal && typeof Reveal.getCurrentSlide === 'function') {
            const s = Reveal.getCurrentSlide && Reveal.getCurrentSlide();
            const v = (s && (s.dataset.module || s.getAttribute('data-module'))) || '';
            if (v && String(v).trim()) return String(v).trim();
          }
          // 3) <meta name="vhcm-module" content="moduleX">
          const meta = document.querySelector('meta[name="vhcm-module"]');
          if (meta && meta.content && meta.content.trim()) return meta.content.trim();
          // 4) atributo data-module no <body>
          const dm = document.body && document.body.getAttribute && document.body.getAttribute('data-module');
          if (dm && dm.trim()) return dm.trim();
          // 5) querystring ?module=moduleX
          const qs = new URLSearchParams(location.search).get('module');
          if (qs && qs.trim()) return qs.trim();
          // 6) regex no caminho (module2, m2, p2.html)
          const path = (location.pathname || '').toLowerCase();
          let m = path.match(/module(\d+)/); if (m) return `module${m[1]}`;
          m = path.match(/\/m(\d+)\b/);     if (m) return `module${m[1]}`;
          m = path.match(/\/p(\d+)\.html/); if (m) return `module${m[1]}`;
          // 7) compat: window.CURRENT_MODULE (caso voc√™ j√° defina em algum lugar)
          if (window.CURRENT_MODULE) return String(window.CURRENT_MODULE).trim();
        } catch(_){}
        // 8) fallback
        return DEFAULT_MODULE;
      }

      // ====== Helpers ======
      // (√öNICA MUDAN√áA) ‚Üí pega o aluno logado do localStorage, priorizando o ID salvo no login
      function getStudent(){
        try{
          const u = (localStorage.getItem('fs_user')
                  || localStorage.getItem('studentId')
                  || localStorage.getItem('studentName')
                  || 'Anonimo').trim();
          return u || 'Anonimo';
        }catch(_){
          return 'Anonimo';
        }
      }
      function currentModule(){ return detectModule(); }

      function bubble(author, textHtml, isUser=false){
        const wrap = document.createElement('div');
        wrap.className = 'vhcm-msg' + (isUser ? ' user' : ' ai');
        const avatar = document.createElement('div');
        avatar.className = 'vhcm-avatar';
        avatar.textContent = isUser ? 'You' : 'VH';
        const bub = document.createElement('div');
        bub.className = 'vhcm-bubble';
        bub.innerHTML = String(textHtml || '').replace(/\n/g,'<br>');
        if (isUser){ wrap.appendChild(bub); wrap.appendChild(avatar); }
        else { wrap.appendChild(avatar); wrap.appendChild(bub); }
        body.appendChild(wrap); body.scrollTop = body.scrollHeight;
      }
      function setOpen(open){ panel.style.display = open ? 'flex' : 'none'; localStorage.setItem(STORAGE_OPEN, open ? '1' : '0'); }

      // ====== Restaurar tamanho salvo ======
      (function restoreSize(){
        try{
          const saved = JSON.parse(localStorage.getItem(STORAGE_SIZE) || 'null');
          if (saved?.w && saved?.h) {
            panel.style.width = saved.w;
            panel.style.height = saved.h;
          }
        }catch(_){}
      })();

      // ====== Observar e salvar mudan√ßas de tamanho ======
      (function watchSize(){
        if (!('ResizeObserver' in window)) return;
        const ro = new ResizeObserver(entries => {
          for (const e of entries) {
            const { width, height } = e.contentRect || {};
            if (!width || !height) continue;
            localStorage.setItem(STORAGE_SIZE, JSON.stringify({
              w: Math.round(width) + 'px',
              h: Math.round(height) + 'px'
            }));
          }
        });
        ro.observe(panel);
      })();

      // ====== Open/Close & persist state ======
      btnOpen.addEventListener('click', ()=> setOpen(panel.style.display !== 'flex'));
      btnClose.addEventListener('click', ()=> setOpen(false));
      if (localStorage.getItem(STORAGE_OPEN) === '1') setOpen(true);

      // ====== Module label sync ======
      function updateModuleLabel(){ moduleLabel.textContent = currentModule(); }
      updateModuleLabel();
      if (window.Reveal && typeof Reveal.on === 'function'){ Reveal.on('slidechanged', updateModuleLabel); }
      window.addEventListener('hashchange', updateModuleLabel); // caso mude via URL/anchor

      // ====== Meia tela (toggle) ======
      function readSize(){ try { return JSON.parse(localStorage.getItem(STORAGE_SIZE) || 'null'); } catch(_){ return null; } }
      function savePrevSize(){
        const rect = panel.getBoundingClientRect();
        localStorage.setItem(STORAGE_SIZE_PREV, JSON.stringify({
          w: Math.round(rect.width) + 'px',
          h: Math.round(rect.height) + 'px'
        }));
      }
      function readPrevSize(){ try { return JSON.parse(localStorage.getItem(STORAGE_SIZE_PREV) || 'null'); } catch(_){ return null; } }

      function setHalfMode(on){
        if (on){
          // guarda tamanho atual antes de mudar
          savePrevSize();
          panel.classList.add('vhcm--half');
          panel.style.width  = '50vw';
          panel.style.height = '50vh';
          localStorage.setItem(STORAGE_HALF, '1');
          btnHalf.title = 'Exit half screen';
        } else {
          panel.classList.remove('vhcm--half');
          localStorage.setItem(STORAGE_HALF, '0');
          btnHalf.title = 'Half screen';
          const prev = readPrevSize() || readSize();
          if (prev?.w && prev?.h){
            panel.style.width  = prev.w;
            panel.style.height = prev.h;
          } else {
            panel.style.width  = '';
            panel.style.height = '';
          }
        }
      }

      btnHalf.addEventListener('click', ()=>{
        const isOn = panel.classList.contains('vhcm--half');
        setHalfMode(!isOn);
      });

      // Restaurar modo meia tela se estava ativo
      if (localStorage.getItem(STORAGE_HALF) === '1') {
        setHalfMode(true);
      }

      // ====== Send logic ======
      async function sendQuestion(){
        const q = text.value.trim(); if (!q) return;
        const mod = currentModule(); updateModuleLabel();
        bubble('You', q, true); text.value=''; typing.style.display='block';
        try{
          const resp = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            // sem headers pra evitar preflight; servidor j√° aceita JSON puro
            body: JSON.stringify({ question: q, student: getStudent(), module: mod })
          });
          const raw = await resp.text();
          let data = {}; try { data = JSON.parse(raw); } catch(_){ data = { answer: 'Server returned an invalid response.' }; }
          typing.style.display='none';
          bubble('Virtual HCM', data.answer || 'No answer received.', false);
        } catch(e){
          typing.style.display='none';
          bubble('Error', 'Could not contact the server.', false);
        }
      }

      send.addEventListener('click', sendQuestion);
      text.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendQuestion(); }
      });
    })();
    </script>
    <style>
      html.locked .requires-auth, body.locked .requires-auth { display: none !important; }

      :root {
        --lb-bg: rgba(46, 58, 78, 0.85);
        --lb-border: rgba(255, 255, 255, 0.12);
        --lb-shadow: 0 18px 60px rgba(0, 0, 0, 0.45), 0 2px 8px rgba(0, 0, 0, 0.18);
        --lb-radius: 18px;
        --lb-accent: #a78bfa;
        --lb-accent-weak: rgba(167, 139, 250, 0.25);
        --pill-start: #6d5df5; 
        --pill-end: #2ec5ff;
      }

      /* POSICIONAMENTO √Ä ESQUERDA */
      .lb-panel { 
        position: fixed; 
        bottom: 20px; 
        left: 20px; 
        z-index: 2147483647; 
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
      }

      /* BOT√ÉO ESTILO P√çLULA (IGUAL AO VIRTUAL HCM) */
      .lb-toggle { 
        height: 40px; 
        padding: 0 16px 0 12px; 
        border-radius: 999px; 
        display: inline-flex; 
        align-items: center; 
        justify-content: center; 
        gap: 8px; 
        border: none;
        background: linear-gradient(135deg, var(--pill-start), var(--pill-end)); 
        color: #fff; 
        box-shadow: 0 10px 28px rgba(2, 6, 23, 0.30), inset 0 0 0 1px rgba(255, 255, 255, 0.14);
        cursor: pointer; 
        user-select: none; 
        transition: transform .12s ease, box-shadow .12s ease, filter .12s ease; 
      }
      
      .lb-toggle:hover { transform: translateY(-1px); filter: brightness(1.05); }
      .lb-toggle:active { transform: translateY(0); filter: brightness(.98); }

      .lb-label-text {
        font-size: 14px;
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      .lb-icon { font-size: 18px; line-height: 1; }

      /* CARD AJUSTADO PARA ABRIR DA ESQUERDA */
      .lb-card {
        margin-top: 10px; 
        width: 500px; 
        max-height: 62vh; 
        overflow: auto; 
        border: 1px solid var(--lb-border); 
        background: var(--lb-bg);
        -webkit-backdrop-filter: saturate(160%) blur(12px); 
        backdrop-filter: saturate(160%) blur(12px); 
        border-radius: var(--lb-radius); 
        box-shadow: var(--lb-shadow);
        display: none; 
        position: absolute; 
        bottom: 52px; 
        left: 0; 
        transform-origin: bottom left; 
        color: #e5e7eb;
      }
      
      .lb-card.open { display: block; animation: lbPop .18s cubic-bezier(.2, .9, .2, 1); }
      
      @keyframes lbPop { 
        from { transform: scale(.95); opacity: 0 } 
        to { transform: scale(1); opacity: 1 } 
      }

      .lb-header { 
        padding: 12px 14px; 
        border-bottom: 1px solid rgba(255, 255, 255, .1); 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        background: linear-gradient(180deg, rgba(167, 139, 250, .15), transparent 60%); 
        border-top-left-radius: var(--lb-radius); 
        border-top-right-radius: var(--lb-radius);
        position: sticky; 
        top: 0; 
        z-index: 10;
        backdrop-filter: blur(6px); 
      }

      .lb-title { font-weight: 800; letter-spacing: .2px; color: #fff; }

      .lb-list { list-style: none; margin: 0; padding: 6px 0 8px; }
      .lb-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; border-bottom: 1px dashed rgba(255, 255, 255, .06); }
      .lb-item:last-child { border-bottom: 0; }

      .lb-left { display: flex; align-items: center; gap: 10px; min-width: 0; }
      .lb-rank { width: 28px; text-align: right; font-variant-numeric: tabular-nums; color: #fde68a; font-weight: 700; }
      .lb-item.top-2 .lb-rank { color: #cbd5e1; } 
      .lb-item.top-3 .lb-rank { color: #d8b4fe; }

      .lb-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #e5e7eb; }
      .lb-points { font-variant-numeric: tabular-nums; font-weight: 600; color: #f3f4f6; }

      .lb-footer { 
        padding: 12px 14px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        gap: 8px; 
        border-top: 1px solid rgba(255, 255, 255, .1);
        background: rgba(0, 0, 0, 0.2); 
        border-bottom-left-radius: var(--lb-radius); 
        border-bottom-right-radius: var(--lb-radius);
        position: sticky; 
        bottom: 0; 
        backdrop-filter: blur(6px); 
      }
      
      .lb-badge-me { background: var(--pill-start); padding: 4px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; color: #fff; }

      @media (max-width: 820px) { 
        .lb-panel { left: 12px; bottom: 88px; } 
        .lb-card { position: fixed; left: 12px; right: 12px; bottom: 88px; width: auto; height: 58vh; max-height: none; transform-origin: bottom center; } 
      }
    </style>

    <div class="requires-auth">
      <div class="lb-panel" id="lbPanel2">
        <button class="lb-toggle" id="lbToggle2" title="Ranking" aria-label="Open ranking">
          <span class="lb-icon">üèÜ</span>
          <span class="lb-label-text">Ranking</span>
        </button>
        <div class="lb-card" id="lbCard2" role="dialog" aria-modal="false" aria-label="Ranking">
          <div class="lb-header">
            <div class="lb-title">Top <span id="lbTopN2">10</span></div>
          </div>
          <ul class="lb-list" id="lbList2"></ul>
          <div class="lb-footer"><span id="lbMe2"></span></div>
        </div>
      </div>
    </div>

    <script>
      const LB_ENDPOINT = 'https://course-chat.hcmrtns.workers.dev/ranking';
      const LB_TOP = 10;
      const LB_POLL_MS = 3000;

      let LB_STUDENT = (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').toString();

      const $ = (id) => document.getElementById(id);
      const lbToggle  = $('lbToggle2');
      const lbCard    = $('lbCard2');
      const lbList    = $('lbList2');
      const lbTopNEl  = $('lbTopN2');
      const lbMeEl    = $('lbMe2');
      lbTopNEl.textContent = LB_TOP;

      document.addEventListener('auth:login', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? ev.detail.studentId :
          (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '');
        if (sid) { 
          LB_STUDENT = String(sid); 
          if (lbCard.classList.contains('open')) fetchRanking(); 
        }
      });

      lbToggle.addEventListener('click', () => {
        const open = lbCard.classList.contains('open');
        if (open) {
          lbCard.classList.remove('open');
        } else {
          lbCard.classList.add('open');
          fetchRanking();
        }
      });
      
      document.addEventListener('keydown', (e) => { if(e.key === 'Escape') lbCard.classList.remove('open'); });

      async function fetchRanking() {
        try {
          const who = LB_STUDENT || 'anonymous';
          const url = `${LB_ENDPOINT}?top=${LB_TOP}&who=${encodeURIComponent(who)}`;
          const res = await fetch(url, { method: 'GET' });
          const data = await res.json();
          if (!data.ok && data.status !== 'success') throw new Error(data.error || 'Failed');
          renderTop(data.top, data.me);
        } catch (e) {
          console.error('Ranking error:', e);
          lbList.innerHTML = '<li class="lb-item"><div class="lb-name" style="opacity:.6">Updating ranking...</div></li>';
        }
      }

    function renderTop(top, me) {
        lbList.innerHTML = '';
        
        // 1. Renderiza a lista p√∫blica (Sem detalhes individuais)
        if (!top || !top.length) {
            lbList.innerHTML = '<li class="lb-item"><div class="lb-name" style="opacity:.8">No points yet.</div></li>';
        } else {
            for (const row of top) {
                const li = document.createElement('li'); 
                li.className = 'lb-item';
                if (row.rank <= 3) li.classList.add(`top-${row.rank}`);
                
                const left = document.createElement('div'); 
                left.className = 'lb-left';
                
                const rk = document.createElement('div'); 
                rk.className = 'lb-rank'; 
                rk.textContent = row.rank;
                
                const nm = document.createElement('div'); 
                nm.className = 'lb-name'; 
                nm.textContent = row.name || row.studentId || row.student;
                
                left.appendChild(rk); 
                left.appendChild(nm);
                
                const pts = document.createElement('div'); 
                pts.className = 'lb-points'; 
                pts.textContent = (row.total_points ?? row.points) + ' pts';
                
                li.appendChild(left); 
                li.appendChild(pts);
                lbList.appendChild(li);
            }
        }

        // 2. Renderiza a faixa roxa (Privada com detalhamento completo)
    // 2. Renderiza a faixa roxa (Privada com dados reais do banco)
        if (me) {
            // Fonte aumentada para 13px para melhor leitura no projetor
            const detailStyle = 'font-size: 12px; opacity: 0.9; margin-left: 10px; font-weight: 400;';
            
            // Mapeamento direto das colunas do seu banco
            const likes = me.likes_points || 0;
            const checkouts = me.checkouts_points || 0;
            const pools = me.poll_points || 0;
            const problems = me.exercises_points || 0;

            const details = `Likes: ${likes} ¬∑ Checkouts: ${checkouts} ¬∑ Questions: ${pools} `;

            lbMeEl.innerHTML = `
                <span class="lb-badge-me">
                    Me: #${me.rank} ¬∑ ${me.points} pts 
                    <span style="${detailStyle}">(${details})</span>
                </span>`;
        } else {
            lbMeEl.innerHTML = '';
        }
    }

      if (LB_POLL_MS && Number(LB_POLL_MS) > 0) setInterval(fetchRanking, LB_POLL_MS);
    </script>
    <style>
      .notice-modal-backdrop {
        position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4);
        display: none; align-items: center; justify-content: center;
        z-index: 2147483647;
      }
      .notice-modal {
        width: min(92vw, 500px); background: #fff; border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        padding: 24px; font-family: system-ui, -apple-system, sans-serif;
        border: 1px solid rgba(0, 0, 0, 0.08);
      }
      .notice-title { font-size: 1.25rem; font-weight: 700; margin: 0 0 10px; color: #1e3a8a; }
      .notice-body { color: #334155; line-height: 1.6; font-size: 1rem; }
      .notice-actions { display: flex; justify-content: flex-end; margin-top: 20px; }
      .notice-btn {
        padding: 10px 24px; border-radius: 8px; font-weight: 600;
        border: none; background: #1e3a8a; color: #fff; cursor: pointer;
        transition: background 0.2s;
      }
      .notice-btn:hover { background: #172e6b; }
    </style>

    <div class="notice-modal-backdrop" id="noticeBackdrop" aria-hidden="true">
      <div class="notice-modal" role="dialog" aria-modal="true">
        <div class="notice-title" id="noticeTitle">Notice</div>
        <div class="notice-body" id="noticeBody"></div>
        <div class="notice-actions">
          <button class="notice-btn" id="noticeOkBtn" type="button">Got it!</button>
        </div>
      </div>
    </div>

    <script>
    (function(){
      const API_BASE = 'https://course-chat.hcmrtns.workers.dev';
      
      async function checkNotices() {
        const sid = localStorage.getItem('studentId') || '';
        if (!sid) return;

        try {
          const res = await fetch(`${API_BASE}/auth/notices/get?studentId=${sid}`);
          const data = await res.json();

          if (data.ok && data.hasNotice) {
            displayNotice(data.notice, sid);
          }
        } catch (e) { console.error("Notice check failed", e); }
      }

      function displayNotice(notice, sid) {
        const backdrop = document.getElementById('noticeBackdrop');
        const title = document.getElementById('noticeTitle');
        const body = document.getElementById('noticeBody');
        const btn = document.getElementById('noticeOkBtn');

        title.textContent = notice.title;
        body.innerHTML = notice.message_html;
        backdrop.style.display = 'flex';

        btn.onclick = async () => {
          // Registrar "visto" na D1
          fetch(`${API_BASE}/auth/notices/ack?studentId=${sid}&notice_id=${notice.notice_id}`);
          backdrop.style.display = 'none';
        };
      }

      if (document.readyState === 'complete') checkNotices();
      else window.addEventListener('load', checkNotices);
    })();
    </script>
    <div id="live-poll-container" style="display:none; z-index:9999; transition: all 0.4s ease;"></div>
    <script>
    (function() {
        const WORKER_URL = "https://course-chat.hcmrtns.workers.dev"; 
        const pollContainer = document.getElementById('live-poll-container');
        let lastPollId = null;

        function applyResponsiveStyle() {
            pollContainer.style.position = 'fixed';
            pollContainer.style.top = '50%';
            pollContainer.style.left = '50%';
            pollContainer.style.transform = 'translate(-50%, -50%)';
            pollContainer.style.width = '90%';
            pollContainer.style.maxWidth = '700px';
            pollContainer.style.display = 'block';
        }

        async function checkPoll() {
            try {
                const sid = localStorage.getItem("studentId") || localStorage.getItem("fs_user") || "guest";
                const res = await fetch(`${WORKER_URL}/poll/status?student_id=${sid}`); // <-- Adicionei o ?student_id=
                const data = await res.json();

                if (!data || data.is_active !== 1) {
                    pollContainer.style.display = 'none';
                    return;
                }

                if (data.show_results === 1) {
                    renderResults(data);
                    applyResponsiveStyle();
                    return;
                }

                if (!localStorage.getItem('answered_' + data.poll_id)) {
                    if (data.poll_id !== lastPollId) {
                        lastPollId = data.poll_id;
                        renderPoll(data);
                    }
                    applyResponsiveStyle();
                } else {
                    // Se j√° respondeu e n√£o √© hora de mostrar resultados, mant√©m fechado
                    pollContainer.style.display = 'none';
                }
            } catch (e) { console.error(e); }
        }

        function renderPoll(data) {
            const isNumeric = data.poll_type === 'numeric';
            const accentColor = isNumeric ? "#0891b2" : (data.poll_type === 'quiz' ? "#b91c1c" : "#1e3a8a");
            const icon = isNumeric ? "üî¢ Numeric Question" : (data.poll_type === 'quiz' ? "üèÜ Quiz" : "üìä Info");

            let inputHtml = '';
            if (isNumeric) {
                inputHtml = `
                    <div style="margin: 20px 0; text-align: center;">
                        <input type="number" step="any" id="numeric_answer" placeholder="Use comma & two decimais (ex. 12,34)" 
                            style="width:450px; padding:12px; border:2px solid #cbd5e1; border-radius:10px; font-size:1.4em; text-align:center;">
                    </div>`;
            } else {
                const options = JSON.parse(data.options_json || '{}');
                for (const [key, val] of Object.entries(options)) {
                    if(!val) continue; 
                    inputHtml += `
                        <label style="display:flex; align-items:center; margin:12px 0; padding:15px; border:1px solid #cbd5e1; border-radius:10px; cursor:pointer; background:#f8fafc;">
                            <input type="radio" name="poll_choice" value="${key}" style="width:18px; height:18px; margin-right:12px;"> 
                            <span style="font-size:1.1em;"><strong>${key})</strong> ${val}</span>
                        </label>`;
                }
            }

            pollContainer.innerHTML = `
                <div id="poll-inner-card" style="background:white; border-radius:15px; padding:30px; box-shadow:0 25px 50px rgba(0,0,0,0.3); border: 4px solid ${accentColor};">
                    <h3 style="margin:0 0 15px; color:${accentColor}; font-size:1.4em;">${icon}</h3>
                    <p style="font-size:1.2em; margin-bottom:20px; font-weight:600;">${data.question}</p>
                    <form id="poll-form">
                        ${inputHtml}
                        <button type="submit" style="width:100%; background:${accentColor}; color:white; border:none; border-radius:8px; padding:15px; font-weight:bold; cursor:pointer; font-size:1.1em;">Submit Answer</button>
                    </form>
                </div>`;

            document.getElementById('poll-form').onsubmit = async (e) => {
                e.preventDefault();
                const isNumericType = data.poll_type === 'numeric';
                let choice = isNumericType ? document.getElementById('numeric_answer').value : document.querySelector('input[name="poll_choice"]:checked')?.value;
                
                if (!choice) return;

                const student_id = localStorage.getItem("studentId") || localStorage.getItem("fs_user") || "guest";
                const res = await fetch(`${WORKER_URL}/poll/vote`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ student_id, poll_id: data.poll_id, choice: choice })
                });

                if (res.ok) {
                    localStorage.setItem('answered_' + data.poll_id, 'true');
                    
                    // Substitui o conte√∫do da box pela mensagem de sucesso
                    const innerCard = document.getElementById('poll-inner-card');
                    innerCard.style.borderColor = "#059669";
                    innerCard.innerHTML = `
                        <div style="text-align:center; padding: 20px 0;">
                            <div style="font-size:3em; margin-bottom:10px;">‚úÖ</div>
                            <h3 style="color:#059669; margin-bottom:10px;">Answer Saved!</h3>
                            <p style="font-size:1.1em; color:#475569;">Please wait for the professor to release the results.</p>
                            <button onclick="document.getElementById('live-poll-container').style.display='none'" 
                                style="margin-top:20px; background:#059669; color:white; border:none; padding:10px 25px; border-radius:8px; cursor:pointer; font-weight:bold;">
                                Done
                            </button>
                        </div>`;
                }
            };
        }

        async function renderResults(pollData) {
            const res = await fetch(`${WORKER_URL}/poll/results`);
            const stats = await res.json();
            const isNumeric = pollData.poll_type === 'numeric';
            const total = stats.reduce((acc, curr) => acc + curr.count, 0);
            
            let chartHtml = '<div style="margin-top:20px;">';

            if (isNumeric) {
                chartHtml += `<p style="text-align:center; font-size:1.2em;">Correct Answer: <strong style="color:#059669;">${pollData.correct_option}</strong></p>`;
                chartHtml += `<p style="text-align:center; color:#64748b;">Total participations: ${total}</p>`;
            } else {
                const definedOptions = JSON.parse(pollData.options_json || '{}');
                const correctAns = (pollData.correct_option || "").trim().toUpperCase();
                for (const [key, val] of Object.entries(definedOptions)) {
                    if (!val) continue;
                    const isCorrect = key.toUpperCase() === correctAns;
                    const voteData = stats.find(s => s.chosen_option === key.toUpperCase()) || {count: 0};
                    const percent = total > 0 ? Math.round((voteData.count / total) * 100) : 0;
                    const barColor = isCorrect ? "#22c55e" : "#1e3a8a";

                    chartHtml += `
                        <div style="margin-bottom:15px;">
                            <div style="display:flex; justify-content:between; margin-bottom:5px; font-weight:bold;">
                                <span>Option ${key}: ${val} ${ (isCorrect) ? '‚úÖ' : ''}</span>
                                <span style="margin-left:auto;">${percent}%</span>
                            </div>
                            <div style="background:#e2e8f0; border-radius:8px; height:20px; width:100%; overflow:hidden;">
                                <div style="background:${barColor}; width:${percent}%; height:100%; transition:width 1s ease;"></div>
                            </div>
                        </div>`;
                }
            }
            chartHtml += '</div>';

            const feedbackHtml = pollData.feedback_text ? `
                <div style="margin-top:20px; padding:15px; background:#f8fafc; border-left:4px solid #059669; color:#334155; font-size:0.95em;">
                    <strong>Professor's Explanation:</strong><br>${pollData.feedback_text}
                </div>` : '';

            pollContainer.innerHTML = `
                <div style="background:white; border-radius:15px; padding:30px; box-shadow:0 25px 50px rgba(0,0,0,0.4); border: 4px solid #059669;">
                    <h3 style="margin:0; color:#059669; font-size:1.4em;">üìä Final Results</h3>
                    ${chartHtml}
                    ${feedbackHtml}
                    <button onclick="document.getElementById('live-poll-container').style.display='none'" style="width:100%; margin-top:20px; padding:10px; border-radius:8px; border:none; background:#e2e8f0; cursor:pointer; font-weight:bold;">Close</button>
                </div>`;
        }

        setInterval(checkPoll, 5000);
        checkPoll();
    })();
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>
      // Redund√¢ncia leve: tamb√©m define o m√≥dulo via JS neste deck
      // (o notices-on-login reconhece body[data-module], localStorage e window.VHCM.module)
      window.VHCM = window.VHCM || {};
      window.VHCM.module = "mod1";

      document.addEventListener('DOMContentLoaded', () => {
        try { localStorage.setItem('mod1','mod1'); } catch(_) {}
      });

      Reveal.on('ready', event => {
        if (event.indexh === 0) {
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
      });
      Reveal.addEventListener('slidechanged', (event) => {
        if (event.indexh === 0) {
          Reveal.configure({ slideNumber: null });
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
        if (event.indexh === 1) {
          Reveal.configure({ slideNumber: 'c' });
          document.querySelector("div.has-logo > img.slide-logo").style.display = null;
        }
      });
    </script>
    

</body></html>
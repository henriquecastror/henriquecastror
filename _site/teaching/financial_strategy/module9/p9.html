<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Henrique C. Martins">
  <title>Henrique Castro Martins - Estrat√©gia Financeira</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="../logo.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-771J5563G0"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-771J5563G0', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <!-- === login-start.html (com prote√ß√£o para p√°ginas e slides + turbo + warmup) === -->

  <style>
    /* Card padr√£o (p√°ginas normais) */
    #login-form {
      max-width: 300px;
      margin: 100px auto 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background: #fff;
      box-sizing: border-box;
    }
    #login-form input {
      width: 100%; padding: 10px; margin: 6px 0;
      border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
    }
    #login-form button {
      width: 100%; padding: 10px; margin-top: 10px;
      background-color: #0066cc; color: #fff; border: 0; border-radius: 5px; cursor: pointer;
    }
    #login-error { color: red; text-align: center; margin-top: 10px; }
    #loading-msg{ display:none; text-align:center; margin-top:10px; color:gray; }

    /* Desabilitado durante autentica√ß√£o */
    #login-form button:disabled { opacity:.6; cursor:not-allowed; }
    #login-form input:disabled  { opacity:.7; }

    /* Conte√∫do de p√°ginas normais (fica atr√°s do login at√© destravar) */
    html.locked #after-login-content,
    body.locked #after-login-content { display: none !important; }

    /* Slides (Reveal.js): desfoca deck e bloqueia intera√ß√£o */
    html.locked.reveal-page .reveal,
    body.locked.reveal-page .reveal { filter: blur(4px); pointer-events: none; user-select: none; }

    #login-scrim { display:none; }
    html.locked.reveal-page #login-scrim,
    body.locked.reveal-page #login-scrim{
      display:block; position:fixed; inset:0; background:rgba(255,255,255,.92); z-index:9998;
    }
    html.locked.reveal-page #login-form,
    body.locked.reveal-page #login-form{
      position: fixed; top:50%; left:50%; transform: translate(-50%,-50%);
      margin:0; max-width:340px; width:min(340px,92vw); z-index:9999;
    }

    /* Oculta o "Welcome" nos slides */
    .reveal-page #welcome-message { display: none !important; }

    /* Remember me */
    .remember-row{
      display:flex; align-items:center; gap:8px; margin-top:6px; font-size:.95rem; color:#444; white-space:nowrap;
    }
    .remember-row label{ display:flex; align-items:center; gap:6px; cursor:pointer; }

    /* Fallback duro para p√°ginas comuns: esconde TUDO (qualquer descendente) menos o form/scrim
       enquanto locked. Evita vazamentos quando o tema injeta containers. */
    html.locked body:not(.reveal-page) :not(#login-form):not(#login-form *):not(#login-scrim):not(script):not(style):not(link) {
      display: none !important;
    }

    /* Garante que o form fique acima de qualquer layout do tema */
    #login-form { position: relative; z-index: 10000; }
    #login-scrim { z-index: 9998; }

    /* Scrim e formul√°rio fixos tamb√©m em p√°ginas N√ÉO-reveal enquanto locked */
    html.locked #login-scrim,
    body.locked #login-scrim {
      display: block !important;
      position: fixed !important;
      inset: 0 !important;
      background: #ffffff !important;
      z-index: 2147483646 !important;
    }
    html.locked #login-form,
    body.locked #login-form {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      margin: 0 !important;
      max-width: 340px !important;
      width: min(340px, 92vw) !important;
      z-index: 2147483647 !important;
    }

    /* Evita rolagem/scroll do conte√∫do ao fundo enquanto locked */
    html.locked, body.locked { overflow: hidden !important; }
  </style>

  <!-- Aplica 'locked' em <html> imediatamente e em <body> quando dispon√≠vel + preconnect -->
  <script>
    (function(){
      const addLocked = el => { if (el && !el.classList.contains('locked')) el.classList.add('locked'); };
      addLocked(document.documentElement);
      if (document.body) { addLocked(document.body); }
      else { document.addEventListener('DOMContentLoaded', () => addLocked(document.body)); }

      // preconnect/dns-prefetch para acelerar chamadas ao GAS de login
      try {
        const l1=document.createElement('link'); l1.rel='preconnect';   l1.href='https://script.google.com'; document.head.appendChild(l1);
        const l2=document.createElement('link'); l2.rel='dns-prefetch'; l2.href='https://script.google.com'; document.head.appendChild(l2);
      } catch(_) {}
    })();
  </script>

  <!-- shim seguro: define onLoginSuccess se ainda n√£o existir -->
  <script>
    if (typeof window.onLoginSuccess !== 'function') {
      window.onLoginSuccess = function(studentId){
        try {
          const sid = String(studentId || '').trim();
          window.studentId = sid;
          localStorage.setItem('studentId', sid);
          // compat com widgets antigos
          document.dispatchEvent(new CustomEvent('auth:login',   { detail: { studentId: sid } }));
          setTimeout(() => window.dispatchEvent(new CustomEvent('login:success', { detail:{ studentId: sid } })), 0);
          // hook imediato para o notice center (se j√° carregado)
          if (window.noticeCenter && typeof window.noticeCenter.onLogin === 'function') {
            window.noticeCenter.onLogin(sid);
          }
          if (window.VHCM) window.VHCM.lastLoginAt = Date.now();
          console.debug('[Login] onLoginSuccess ‚Üí', sid);
        } catch(e) {
          console.warn('onLoginSuccess shim warn:', e);
        }
      };
    }
  </script>

  <meta name="twitter:title" content="Henrique Castro Martins - Estrat√©gia Financeira">
<meta name="twitter:description" content="Part 9 - Ch 16 Financial Distress, Managerial Incentives, and Information">
<meta name="twitter:card" content="summary">
</head><body class="quarto-light"><form id="login-form" onsubmit="event.preventDefault(); validateLogin();">
    <h3 style="text-align:center;">Login</h3>
    <input type="text" id="username" placeholder="Username" autocomplete="username" required="">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" required="">
    <div class="remember-row">
      <label><input type="checkbox" id="remember-me" checked=""> Remember me</label>
    </div>
    <button type="submit" id="login-submit">Enter</button>
    <div id="loading-msg"></div>
    <div id="login-error"></div>
  </form>

  <div id="login-scrim" aria-hidden="true"></div>

  <div id="after-login-content" style="display:none;">
    <h4 id="welcome-message" style="text-align:center; display:none; margin-top:10px; font-size:1.8em; color:#333;"></h4>
  </div>

  <script>
    /***** CONFIG *****/
    const REMEMBER_PASSWORD  = true;
    const GAS_URL            = 'https://script.google.com/macros/s/AKfycbxb3Z73DvsgGiGwK-jVp89jA5EGEYk24nbPNblQiNxFZPYvvDTvO-v4S4N_L-4YZ8KZfQ/exec';
    const SESSION_MAX_HOURS  = 8;     // validade do "lembrado"
    const FAST_WINDOW_HOURS  = 2;     // turbo: libera instant√¢neo
    const VALIDATE_TIMEOUTMS = 3000;  // timeout da valida√ß√£o

    /* üî• Warm-up silencioso do GAS: acorda a fun√ß√£o antes do 1¬∫ login real */
    window.addEventListener('load', () => {
      try {
        const warm = new Image();
        warm.referrerPolicy = 'no-referrer';
        warm.src = `${GAS_URL}?username=&password=&page=WARMUP&t=${Date.now()}`;
      } catch(_) {}
    });

    /***** Marca slides (se houver Reveal) *****/
    document.addEventListener('DOMContentLoaded', () => {
      if (document.querySelector('.reveal')) document.body.classList.add('reveal-page');
    });

    /***** Pr√©-preenche campos com Remember (se houver) *****/
    document.addEventListener('DOMContentLoaded', () => {
      try{
        const u = localStorage.getItem('fs_user');
        const p = localStorage.getItem('fs_pass');
        if (u) document.getElementById('username').value = u;
        if (REMEMBER_PASSWORD && p) document.getElementById('password').value = p;
      }catch(_){}
    });

    /***** Storage helpers *****/
    function saveRemember(u,p,checked){
      try{
        if(checked){
          localStorage.setItem('fs_user', u);
          localStorage.setItem('fs_last_login_at', Date.now().toString());
          if (REMEMBER_PASSWORD) localStorage.setItem('fs_pass', p); else localStorage.removeItem('fs_pass');
        }else{
          localStorage.removeItem('fs_user'); localStorage.removeItem('fs_pass'); localStorage.removeItem('fs_last_login_at');
        }
      }catch(_){}
    }
    function getRemember(){
      try{
        const u=localStorage.getItem('fs_user');
        const p=localStorage.getItem('fs_pass');
        const t=parseInt(localStorage.getItem('fs_last_login_at')||'0',10);
        if(!u||!t) return null; return {u,p,t};
      }catch(_){ return null; }
    }
    const within=(ts,h)=> (Date.now()-ts) < h*3600*1000;

    /* üîí Desativa/Reativa o form durante autentica√ß√£o */
    function setAuthLoading(isLoading){
      const btn = document.getElementById('login-submit');
      const u   = document.getElementById('username');
      const p   = document.getElementById('password');
      const cb  = document.getElementById('remember-me');
      if (btn){
        btn.disabled = isLoading;
        btn.textContent = isLoading ? 'Signing in...' : 'Enter';
      }
      [u,p,cb].forEach(el => { if (el) el.disabled = isLoading; });
    }

    /***** GAS helpers *****/
    function logWithImage(u,p,page){
      const img=new Image(); img.referrerPolicy='no-referrer';
      img.src=`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}&t=${Date.now()}`;
    }
    async function gasAuth(u,p,page,timeoutMs){
      async function _once(ms){
        const ctrl=new AbortController();
        const timer=setTimeout(()=>ctrl.abort('timeout'), ms||0);
        try{
          const res=await fetch(`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}`, {signal:ctrl.signal, cache:'no-store'});
          return (await res.text()||'').trim();
        } finally { clearTimeout(timer); }
      }
      try{
        return await _once(timeoutMs||12000);   // 1¬™ tentativa
      }catch(_){
        return await _once(15000);              // retry mais folgado
      }
    }

    /***** UI helpers *****/
    function unlockAs(u){
      const welcome=document.getElementById('welcome-message');
      if (welcome && !document.body.classList.contains('reveal-page')){
        welcome.textContent=`Welcome, ${u}!`; welcome.style.display='block';
      }
      document.getElementById('login-form').style.display='none';
      const after=document.getElementById('after-login-content'); if(after) after.style.display='block';

      // Remover 'locked' de html e body
      document.documentElement.classList.remove('locked');
      if (document.body) document.body.classList.remove('locked');

      const scrim=document.getElementById('login-scrim'); if(scrim) scrim.style.display='none';
    }

    /***** Auto-login com janela turbo (tamb√©m nos slides) *****/
    document.addEventListener('DOMContentLoaded', async () => {
      const saved=getRemember(); if(!saved) return;
      const page=location.pathname;

      if (within(saved.t, FAST_WINDOW_HOURS)) {
        // libera j√° e registra em background
        unlockAs(saved.u);
        onLoginSuccess(saved.u); // mant√©m studentId para outros scripts

        saveRemember(saved.u, saved.p, true);
        logWithImage(saved.u, saved.p, page);

        // checagem silenciosa (opcional)
        try { const r=await gasAuth(saved.u, saved.p, 'CHECK', 12000); if(r!=='OK'){ /* opcional: relock */ } } catch(_) {}
        return;
      }

      if (within(saved.t, SESSION_MAX_HOURS)) {
        const loading=document.getElementById('loading-msg');
        loading.textContent='Checking saved login...'; loading.style.display='block';
        try{
          const r=await gasAuth(saved.u, saved.p, page, VALIDATE_TIMEOUTMS);
          loading.style.display='none';
          if(r==='OK'){ unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); }
        }catch(_){
          // timeout: libera e registra em background
          loading.style.display='none';
          unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); logWithImage(saved.u, saved.p, page);
        }
      }
    });

    /***** Login manual *****/
    async function validateLogin(rememberOverride){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      const cb=document.getElementById('remember-me');
      const remember = (rememberOverride!==undefined) ? rememberOverride : (cb? cb.checked : true);

      const err=document.getElementById('login-error');
      const load=document.getElementById('loading-msg');
      err.textContent='';
      load.textContent='Authenticating your credentials. This may take a few seconds...';
      load.style.display='block';
      setAuthLoading(true);

      const page=location.pathname;
      try{
        const r=await gasAuth(u,p,page,VALIDATE_TIMEOUTMS);
        load.style.display='none';
        if (r==='OK'){ saveRemember(u,p,remember); unlockAs(u); onLoginSuccess(u); }
        else if (r==='FAIL'){ err.textContent='Invalid username or password.'; }
        else { err.textContent='Missing credentials.'; }
      }catch(_){
        load.style.display='none'; err.textContent='Network error. Please try again.';
      }finally{
        if (document.getElementById('login-form').style.display !== 'none') {
          setAuthLoading(false);
        }
      }
    }

    // Auto preenche (se j√° houver credenciais lembradas)
    document.addEventListener('DOMContentLoaded', ()=>{
      try{
        const u=localStorage.getItem('fs_user'); const p=localStorage.getItem('fs_pass');
        if(u){ document.getElementById('username').value=u; }
        if(p && REMEMBER_PASSWORD){ document.getElementById('password').value=p; }
        const cb=document.getElementById('remember-me'); if(cb) cb.checked=true;
      }catch(_){}
    });

    /* Auto-wrap robusto ‚Äî apenas para p√°ginas N√ÉO-Reveal */
    document.addEventListener('DOMContentLoaded', () => {
      try {
        if (document.querySelector('.reveal') || document.body.classList.contains('reveal-page')) return;

        const wrapper = document.getElementById('after-login-content');
        if (!wrapper) return;

        const root = wrapper.parentElement || document.body;
        const loginForm  = document.getElementById('login-form');
        const loginScrim = document.getElementById('login-scrim');

        const isKeep = (el) =>
          el === wrapper || el === loginForm || el === loginScrim ||
          el.tagName === 'SCRIPT' || el.tagName === 'STYLE' || el.tagName === 'LINK';

        Array.from(root.children).forEach(el => {
          if (!isKeep(el) && !wrapper.contains(el)) {
            wrapper.appendChild(el);
          }
        });
      } catch (e) {
        console.warn('auto-wrap (non-reveal) warn:', e);
      }
    });
  </script>


  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#b1cafa" class="quarto-title-block center">
  <h1 class="title">Estrat√©gia Financeira</h1>
  <p class="subtitle"><strong>Part 9 - Ch 16 Financial Distress, Managerial Incentives, and Information</strong></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<strong>Henrique C. Martins</strong> 
</div>
        <p class="quarto-title-affiliation">
            <strong><a href="https://eaesp.fgv.br/en"><img data-src="../figs/background6.png" style="box-shadow: none;" width="300"></a></strong>
          </p>
    </div>
</div>

  <p class="date">16-08-2025</p>
</section>
<section>

<section id="section" class="slide level2" data-background="#A91B0D">
<h2></h2>
<div title="‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses</strong></p>
</div>
<div class="callout-content">
<p>The <strong>Virtual HCM</strong> is powered by <strong>AI</strong> to assist you with course materials.<br>
While it is trained on the course‚Äôs content, <strong>it may occasionally</strong>:</p>
<ul>
<li>Misinterpret the question or context.<br>
</li>
<li>Generate <strong>inaccurate or incomplete</strong> information.<br>
</li>
<li>Provide answers <strong>not explicitly included</strong> in the materials.</li>
</ul>
<p><strong>Your responsibility:</strong><br>
Always cross-check the answers with the book, slides, readings, and feedback provided in the course. In case you are not sure, ask the instructor.</p>
<p>üí° <em>Use Virtual HCM as a <strong>learning aid</strong>, not as the sole source of truth.</em></p>
</div>
</div>
</div>
</div>
</section>
<section id="section-1" class="slide level2" data-background-image="../figs/cha16.png" data-background-size="1300px">
<h2></h2>
</section>
<section id="chapter-outline" class="slide level2" style="color: #000;">
<h2>Chapter Outline</h2>
<p>16.1 Default and Bankruptcy in a Perfect Market</p>
<p>16.2 The Costs of Bankruptcy and Financial Distress</p>
<p>16.3 Financial Distress Costs and Firm Value</p>
<p>16.4 Optimal Capital Structure: The Tradeoff Theory</p>
<p>16.5 Exploiting Debt Holders: The Agency Costs of Leverage</p>
<p>16.6 Motivating Managers: The Agency Benefits of Leverage</p>
<p>16.7 Agency Costs and the Tradeoff Theory</p>
<p>16.8 Asymmetric Information and Capital Structure</p>
<p>16.9 Capital Structure: The Bottom Line</p>
</section></section>
<section>
<section id="default-and-bankruptcy-in-perf.-mkt" class="title-slide slide level1 smaller center" data-background="#cfd5ea">
<h1>16.1 Default and Bankruptcy in Perf. Mkt</h1>

</section>
<section id="bankruptcy-in-perf.-mkt" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p>An important consequence of leverage is the <strong>risk of bankruptcy</strong>.</p>
<ul>
<li><p>Equity financing does not carry this risk.</p></li>
<li><p>Although equity holders hope to receive dividends, the firm is not legally obligated to pay them.</p></li>
</ul>
<p><strong>Financial Distress</strong></p>
<ul>
<li>When a firm has difficulty meeting its debt obligations: payment delay or default.</li>
</ul>
<p><strong>Default</strong></p>
<ul>
<li><p>When a firm fails to make the required interest or principal payments on its debt or violates a debt covenant (see next slide).</p></li>
<li><p>After the firm defaults, debt holders are given certain rights to the assets of the firm and may even take legal ownership of the firm‚Äôs assets through bankruptcy.</p></li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-1" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<ul>
<li><p><strong>Debt covenants</strong> are restrictions that lenders (creditors, debt holders, investors) put on lending agreements to limit the actions of the borrower (debtor).</p></li>
<li><p>In other words, debt covenants are agreements between a company and its lenders that the company will operate within certain rules set by the lenders.</p></li>
<li><p>They are also called banking covenants or financial covenants.</p></li>
</ul>
<p><strong>When a debt covenant is violated</strong>, depending on the severity, the lender can do several things:</p>
<ul>
<li>Demand penalty payment.</li>
<li>Increase the predetermined interest rate.</li>
<li>Increase the amount of collateral.</li>
<li>Demand full immediate repayment of the loan.</li>
<li>Terminate the debt agreement.</li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-2" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p><strong>Positive debt covenants</strong> are covenants that state what the borrower <strong>must do</strong>.</p>
<ul>
<li>Achieve a certain threshold in certain financial ratios.</li>
<li>Ensure facilities and factories are in good working condition.</li>
<li>Perform regular maintenance of capital assets.</li>
<li>Provide yearly audited financial statements.</li>
<li>Ensure accounting practices are in accordance with GAAP (Generally Accepted Accounting Principles).</li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-3" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p><strong>Negative debt covenants</strong> are covenants that state what the borrower <strong>cannot do</strong>.</p>
<ul>
<li>Pay cash dividends over a certain amount or predetermined threshold.</li>
<li>Sell certain assets.</li>
<li>Borrow more debt.</li>
<li>Issue debt more senior than the current debt.</li>
<li>Enter into certain types of agreements or leases.</li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-4" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p><strong>Example</strong></p>
<p>Let‚Äôs discuss an example of default.</p>
<p>Armin is considering a new project.</p>
<ul>
<li>Although the new product represents a significant advance over Armin‚Äôs competitors‚Äô products, the <strong>product‚Äôs success is uncertain</strong>.</li>
<li>If it is a hit, revenues and profits will grow, and Armin will be worth <strong>150 million</strong> at the end of the year.</li>
<li>If it fails, Armin will be worth only <strong>80 million</strong>.</li>
</ul>
<div class="fragment">
<p>Armin may employ one of two alternative capital structures:</p>
<ul>
<li>It can use <strong>all-equity financing</strong>.</li>
<li>It can use <strong>debt that matures at the end of the year</strong> with a total of <strong>100 million due</strong>.</li>
</ul>
</div>
</section>
<section id="bankruptcy-in-perf.-mkt-5" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Without Lev.</th>
<th>Without Lev.</th>
<th>With Lev.</th>
<th>With Lev.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
</tr>
<tr class="even">
<td>Debt Value</td>
<td>-</td>
<td>-</td>
<td>100</td>
<td>80</td>
</tr>
<tr class="odd">
<td>Equity value</td>
<td>150</td>
<td>80</td>
<td>50</td>
<td>0</td>
</tr>
<tr class="even">
<td>All investors</td>
<td>150</td>
<td>80</td>
<td>150</td>
<td>80</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="fragment">
<p>Both debt and equity holders are worse off if the product fails rather than succeeds.</p>
<ul>
<li>Without leverage, if the product fails equity holders lose $70 million (150 million ‚àí 80 million)</li>
<li>With leverage, equity holders lose 50 million, and debt holders lose 20 million, but the total loss is the same, 70 million.</li>
</ul>
</div>
<div class="fragment">
<p><strong>The firm is in default</strong> if the project fails with leverage.</p>
</div>
</section>
<section id="bankruptcy-in-perf.-mkt-6" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p>Note, the decline in value <strong>is not caused by bankruptcy:</strong></p>
<p><strong>The decline is the same whether or not the firm has leverage.</strong></p>
<ul>
<li>If the new product fails, Armin will experience <strong>economic distress</strong>, which is a significant decline in the value of a firm‚Äôs assets, whether or not it experiences <strong>financial distress</strong> due to leverage.</li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-7" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p>The takeaway of first subsection is:</p>
<p><strong>With perfect capital markets, Modigliani-Miller (MM) Proposition I applies: The total value to all investors does not depend on the firm‚Äôs capital structure.</strong></p>
<ul>
<li>There is no disadvantage to debt financing, and a firm will have the same total value and will be able to raise the same amount initially from investors with either choice of capital structure.</li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-8" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p><strong>Problem</strong></p>
<p>Consider the following outcomes for the following scenarios both with and without leverage for Moon Industries‚Äô new venture:</p>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Without Lev.</th>
<th>Without Lev.</th>
<th>With Lev.</th>
<th>With Lev.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
</tr>
<tr class="even">
<td>Debt Value</td>
<td>-</td>
<td>-</td>
<td>150</td>
<td>90</td>
</tr>
<tr class="odd">
<td>Equity value</td>
<td>250</td>
<td>90</td>
<td>100</td>
<td>0</td>
</tr>
<tr class="even">
<td>All investors</td>
<td>250</td>
<td>90</td>
<td>250</td>
<td>90</td>
</tr>
</tbody>
</table>
<ul>
<li>Moon‚Äôs new venture is equally likely to succeed or to fail.</li>
<li>The risk-free rate is 4%.</li>
<li>The venture has a beta of 0, and the cost of capital is equal to the risk-free rate.</li>
<li>Compute the value of Moon‚Äôs securities at the beginning of the year with and without leverage.</li>
</ul>
</section>
<section id="bankruptcy-in-perf.-mkt-9" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.1 Bankruptcy in Perf. Mkt</h2>
<p><strong>Problem</strong></p>
<p><span class="math display">\[V^U = \frac{0.5 \times 250 + 0.5 \times 90}{1.04} = 163.46 million\]</span></p>
<div class="fragment">
<p><span class="math display">\[V^L = \frac{0.5 \times 100 + 0.5 \times 0}{1.04} = 48.08 million\]</span></p>
<p><span class="math display">\[Debt = \frac{0.5 \times 150 + 0.5 \times 90}{1.04} = 115.38 million\]</span> <span class="math display">\[V^L + Debt = 48.08 million + 115.38 million = 163.46 million\]</span></p>
</div>
</section></section>
<section>
<section id="bankruptcy-costs-fin.-distress" class="title-slide slide level1 smaller center" data-background="#eeffff">
<h1>16.2 Bankruptcy Costs &amp; Fin. Distress</h1>

</section>
<section id="bankruptcy-fin.-distress" class="slide level2 smaller" data-background="#eeffff">
<h2>16.2 Bankruptcy &amp; Fin. Distress</h2>
<p>With perfect capital markets, the risk of bankruptcy is not a disadvantage of debt; rather, <strong>bankruptcy shifts the ownership of the firm from equity holders to debt holders without changing the total value available to all investors</strong> (this is basically the previous section).</p>
<div class="fragment">
<p><strong>In reality, the bankruptcy process is complex, time-consuming, and costly.</strong></p>
<ul>
<li><p>Costly outside experts are often hired by the firm to assist with the bankruptcy.</p></li>
<li><p>Creditors also incur similar costs during the bankruptcy process.</p>
<ul>
<li>They may wait several years to receive payment.</li>
<li>They may hire their own experts for legal and professional advice.</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p>The <strong>direct costs of bankruptcy</strong> reduce the value of the assets that the firm‚Äôs investors will ultimately receive.</p>
<ul>
<li>The average direct costs of bankruptcy are approximately <strong>3% to 4% of the pre-bankruptcy market value of total assets</strong>.</li>
</ul>
</div>
</section>
<section id="bankruptcy-fin.-distress-1" class="slide level2 smaller" data-background="#eeffff">
<h2>16.2 Bankruptcy &amp; Fin. Distress</h2>
<p>Although the <strong>indirect costs</strong> are difficult to measure accurately, they are often much larger than the direct costs of bankruptcy.</p>
<ul>
<li>Loss of Customers</li>
<li>Loss of Suppliers</li>
<li>Loss of Employees</li>
<li>Loss of Receivables</li>
<li>Fire Sale of Assets</li>
<li>Delayed Liquidation</li>
<li>Costs to Creditors</li>
</ul>
<p>It is estimated that the potential loss due to financial distress is <strong>10% to 20% of firm value</strong>.</p>
</section></section>
<section>
<section id="fin.-distress-costs-and-value" class="title-slide slide level1 smaller center" data-background="#ead1dc">
<h1>16.3 Fin. Distress Costs and Value</h1>

</section>
<section id="fin.-distress-costs-and-value-1" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.3 Fin. Distress Costs and Value</h2>
<p><strong>Remember previous example</strong></p>
<ul>
<li>With all-equity financing, Armin‚Äôs assets will be worth 150 million if its new product succeeds and 80 million if the new product fails.</li>
<li>This example assumes there are <strong>no financial distress costs</strong>.</li>
</ul>
<div class="fragment">
<p><strong>Remember previous example</strong></p>
<p>Assuming <strong>financial distress costs</strong> of 20 million.</p>
<ul>
<li>With debt of $100 million, Armin will be forced into bankruptcy if the new product fails.</li>
<li>In this case, some of the value of Armin‚Äôs assets will be lost to bankruptcy and financial distress costs. As a result, <strong>debt holders will receive less than 80 million.</strong></li>
<li>Let‚Äôs say debt holders receive only <strong>60 million after accounting for the costs of financial distress</strong>.</li>
</ul>
</div>
</section>
<section id="fin.-distress-costs-and-value-2" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.3 Fin. Distress Costs and Value</h2>
<p>That is, the total value to all investors is now less with leverage than it is without leverage when the new product fails.</p>
<ul>
<li>The difference of $20 million is due to financial distress costs.</li>
<li>These costs will lower the total value of the firm with leverage, and MM‚Äôs Proposition I will no longer hold.</li>
</ul>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Without Lev.</th>
<th>Without Lev.</th>
<th>With Lev.</th>
<th>With Lev.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
</tr>
<tr class="even">
<td>Debt Value</td>
<td>-</td>
<td>-</td>
<td>100</td>
<td>60</td>
</tr>
<tr class="odd">
<td>Equity value</td>
<td>150</td>
<td>80</td>
<td>50</td>
<td>0</td>
</tr>
<tr class="even">
<td>All investors</td>
<td>150</td>
<td>80</td>
<td>150</td>
<td>60</td>
</tr>
</tbody>
</table>
</section>
<section id="fin.-distress-costs-and-value-3" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.3 Fin. Distress Costs and Value</h2>
<p><strong>Problem</strong></p>
<p>Extending the previous example, assume now that the costs of financial distress are $15 million:</p>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 18%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Without Lev.</th>
<th>Without Lev.</th>
<th>With Lev.</th>
<th>With Lev.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
<td><strong>Success</strong></td>
<td><strong>Failure</strong></td>
</tr>
<tr class="even">
<td>Debt Value</td>
<td>-</td>
<td>-</td>
<td>150</td>
<td>75</td>
</tr>
<tr class="odd">
<td>Equity value</td>
<td>250</td>
<td>90</td>
<td>100</td>
<td>0</td>
</tr>
<tr class="even">
<td>All investors</td>
<td>250</td>
<td>90</td>
<td>250</td>
<td>75</td>
</tr>
</tbody>
</table>
<ul>
<li>Compute the value of Moon‚Äôs securities at the beginning of the year with and without leverage, given that financial distress is costly.</li>
</ul>
</section>
<section id="fin.-distress-costs-and-value-4" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.3 Fin. Distress Costs and Value</h2>
<p><strong>Problem</strong></p>
<p><span class="math display">\[V^U = \frac{0.5 \times 250 + 0.5 \times 90}{1.04} = 163.46 million\]</span></p>
<p><span class="math display">\[V^L = \frac{0.5 \times 100 + 0.5 \times 0}{1.04} = 48.08 million\]</span></p>
<p><span class="math display">\[Debt = \frac{0.5 \times 150 + 0.5 \times 75}{1.04} = 108.17 million\]</span></p>
<p><span class="math display">\[V^L + Debt = 48.08 million + 108.17 million = 156.25 million\]</span></p>
<p>The difference, (<span class="math inline">\(163.46 ‚àí 156.25 = 7.21\)</span>), is the present value of the 15 million in financial distress costs</p>
<p><span class="math display">\[PV(FDC) = \frac{0.5\times 0 + 0.5 \times 15}{1.04} = 7.21\]</span></p>
</section>
<section id="fin.-distress-costs-and-value-5" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.3 Fin. Distress Costs and Value</h2>
<p><strong>Who Pays for Financial Distress Costs?</strong></p>
<ul>
<li>For Armin, if the new product fails, equity holders lose their investment in the firm and will not care about bankruptcy costs.</li>
<li>However, debt holders recognize that if the new product fails and the firm defaults, they will not be able to get the full value of the assets.</li>
<li>As a result, they will pay less for the debt initially (the present value of the bankruptcy costs less).</li>
<li>If the debt holders initially pay less for the debt, less money is available for the firm to pay dividends, repurchase shares, and make investments.</li>
<li>This difference comes out of the equity holders‚Äô pockets.</li>
</ul>
<p><strong>When securities are fairly priced, the original shareholders of a firm pay the present value of the costs associated with bankruptcy and financial distress.</strong></p>
</section></section>
<section>
<section id="the-tradeoff-theory" class="title-slide slide level1 smaller center" data-background="#FFF3A6">
<h1>16.4 The Tradeoff Theory</h1>

</section>
<section id="the-tradeoff-theory-1" class="slide level2 smaller" data-background="#FFF3A6">
<h2>16.4 The Tradeoff Theory</h2>
<p><strong>Tradeoff Theory</strong></p>
<p>The firm picks its capital structure by <strong>trading off the benefits of the tax shield from debt against the costs of financial distress and agency costs</strong>.</p>
<p>According to the Tradeoff theory, the total value of a levered firm equals the value of the firm without leverage plus the present value of the tax savings from debt, less the present value of financial distress costs:</p>
<p><span class="math display">\[V^L = V^U + PV(Interest\;tax\;shield) - PV(Financial\;distress\;costs)\]</span></p>
</section>
<section id="the-tradeoff-theory-2" class="slide level2 smaller" data-background="#FFF3A6">
<h2>16.4 The Tradeoff Theory</h2>
<p><strong>Three key factors determine the present value of financial distress costs:</strong></p>
<p><strong>1) The probability of financial distress</strong></p>
<ul>
<li>The probability of financial distress increases with the <strong>amount of a firm‚Äôs liabilities</strong> (relative to its assets).</li>
<li>The probability of financial distress increases with the <strong>volatility of a firm‚Äôs cash flows</strong> and asset values.</li>
</ul>
<div class="fragment">
<p><strong>2) The magnitude of the costs after a firm is in distress</strong></p>
<ul>
<li>Financial distress costs will vary by <strong>industry</strong>.</li>
</ul>
</div>
<div class="fragment">
<p><strong>3) The appropriate discount rate for the distress costs</strong></p>
<ul>
<li>Depends on the <strong>firm‚Äôs market risk</strong></li>
<li>The present value of distress costs will be higher for <strong>high beta firms</strong>.</li>
</ul>
</div>
</section>
<section id="section-2" class="slide level2 smaller" data-background="#FFF3A6">
<h2></h2>

<img data-src="../figs/berk_demarzo_tradeoff_1.jpg" class="r-stretch"></section>
<section id="the-tradeoff-theory-3" class="slide level2 smaller" data-background="#FFF3A6">
<h2>16.4 The Tradeoff Theory</h2>
<p>It is easy to see that each firm will have an <strong>optimal leverage level</strong></p>
<ul>
<li>For low levels of debt, the risk of default remains low, and the main effect of an increase in leverage is an increase in the interest tax shield.</li>
<li>As the level of debt increases, the probability of default increases. Then, the costs of financial distress increase, reducing the value of the levered firm.</li>
</ul>
<div class="fragment">
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><strong>The Tradeoff theory states that firms should increase their leverage until it reaches the level for which the firm value is maximized.</strong> At this point, the tax savings that result from increasing leverage are perfectly offset by the increased probability of incurring the costs of financial distress.</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="../figs/thanos.png"></p>
</div>
</div>
</div>
</div>
</section>
<section id="the-tradeoff-theory-4" class="slide level2 smaller" data-background="#FFF3A6">
<h2>16.4 The Tradeoff Theory</h2>
<p><strong>Problem</strong></p>
<p>Holland, Inc.&nbsp;is considering adding leverage to its capital structure. Holland‚Äôs managers believe they can add as much as <strong>50 million in debt</strong> and exploit the benefits of the tax shield. They estimate <span class="math inline">\(T_c = 39\%\)</span>. However, they also recognize that higher debt increases the risk of financial distress. Based on simulations of the firm‚Äôs future cash flows, the CFO has made the following estimates (in millions of dollars):</p>
<div class="fragment">
<table>
<thead>
<tr class="header">
<th>Debt</th>
<th>0</th>
<th>10</th>
<th>20</th>
<th>30</th>
<th>40</th>
<th>50</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PV(Int. Tax. Shield)</td>
<td>0</td>
<td>3.9</td>
<td>7.8</td>
<td>11.7</td>
<td>15.6</td>
<td>19.5</td>
</tr>
<tr class="even">
<td>PV(Fin. Dis. Costs)</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>3.38</td>
<td>19.23</td>
<td>23.47</td>
</tr>
<tr class="odd">
<td>Net Benefit</td>
<td>0</td>
<td>3.9</td>
<td>7.8</td>
<td>8.32</td>
<td>-3.63</td>
<td>-3.97</td>
</tr>
</tbody>
</table>
<p>The level of debt that leads to the highest net benefit is 30 million. Holland will gain 11.7 million due to tax shields and lose 3.38 million due to the present value of financial distress costs, for a net gain of 8.32 million.</p>
</div>
</section></section>
<section>
<section id="agency-costs-of-leverage" class="title-slide slide level1 smaller center" data-background="#eeffff">
<h1>16.5 Agency Costs of Leverage</h1>

</section>
<section id="agency-costs-of-leverage-1" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Agency Costs</strong></p>
<ul>
<li>Costs that arise when there are <strong>conflicts of interest</strong> between the firm‚Äôs stakeholders</li>
<li>Management will generally make decisions that increase the value of the firm‚Äôs equity.</li>
<li>However, <strong>when a firm has leverage, managers may make decisions that benefit shareholders but harm the firm‚Äôs creditors</strong> and lower the total value of the firm.</li>
</ul>
<div class="fragment">
<ul>
<li>Risk-taking &amp; Asset substitution</li>
<li>Debt overhang &amp; Under-investment</li>
<li>Cashing out</li>
<li>Leverage Ratchet effect</li>
</ul>
</div>
</section>
<section id="agency-costs-of-leverage-2" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Consider Baxter, Inc., which is facing financial distress</strong></p>
<ul>
<li>Baxter has a loan of <strong>1 million due at the end of the year</strong>.</li>
<li>Without a change in its strategy, <strong>the market value of its assets will be only 900,000 at that time</strong>, and Baxter will default on its debt.</li>
</ul>
<div class="fragment">
<p>Baxter is considering a new strategy</p>
<ul>
<li>The new strategy requires no upfront investment, but it has only a 50% chance of success.</li>
<li>If the new strategy <strong>succeeds</strong>, it will increase the value of the <strong>firm‚Äôs asset to $1.3 million</strong>.</li>
<li>If the new strategy <strong>fails</strong>, the value of the <strong>firm‚Äôs assets will fall to $300,000</strong>.</li>
</ul>
</div>
<div class="fragment">
<p><strong>Should Baxter execute this strategy?</strong></p>
</div>
</section>
<section id="agency-costs-of-leverage-3" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Certainly not!</strong></p>
<p>The expected value of the firm‚Äôs assets under the new strategy is 800,000, a <strong>decline of 100,000</strong> from the old strategy</p>
<p><span class="math display">\[50\% \times 1.3 million + 50\% \times 0,3 million = 0,8 million\]</span></p>
<div class="fragment">
<p>However, despite the negative expected payoff, some within the firm have suggested that Baxter should go ahead with the new strategy</p>
<p><strong>Can shareholders benefit from this decision? What would be the rationale?</strong></p>
</div>
</section>
<section id="agency-costs-of-leverage-4" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p>If Baxter does nothing, it will ultimately default and equity holders will get nothing with certainty.</p>
<ul>
<li><strong>Equity holders have nothing to lose</strong> if Baxter tries the risky strategy.</li>
<li>If the strategy succeeds, equity holders will receive $300,000 after paying off the debt.</li>
<li>Given a 50% chance of success, the <strong>equity holders‚Äô expected payoff is 150,000</strong>.</li>
</ul>
<p><span class="math display">\[50\% \times 0 + 50\% \times 300.000 = 150.000\]</span></p>
</section>
<section id="agency-costs-of-leverage-5" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<table>
<colgroup>
<col style="width: 47%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Old Strat.</th>
<th>New Success</th>
<th>New failure</th>
<th>New Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Value of assets</td>
<td>900</td>
<td>1300</td>
<td>300</td>
<td>800</td>
</tr>
<tr class="even">
<td>Debt</td>
<td>900</td>
<td>1000</td>
<td>300</td>
<td>650</td>
</tr>
<tr class="odd">
<td>Equity</td>
<td>0</td>
<td>300</td>
<td>0</td>
<td>150</td>
</tr>
</tbody>
</table>
<ul>
<li>If project succeeds, debt holders receive 1 mil. If fails, debt holders receive 300,000.</li>
<li>The debt holders‚Äô expected payoff is 650,000, a loss of 250,000 compared to the old strategy.
<ul>
<li><span class="math inline">\(50\% \times 1 million + 50\% \times 300,000 = 650,000\)</span></li>
</ul></li>
<li>The debt holders 250,000 loss corresponds to the 100,000 expected decline in firm value due to the risky strategy and the equity holder‚Äôs 150,000 gain.</li>
<li>Effectively, the equity holders are <strong>gambling with the debt holders‚Äô money</strong>.</li>
</ul>
</section>
<section id="agency-costs-of-leverage-6" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Asset Substitution Problem</strong></p>
<ul>
<li>When a firm faces financial distress, <strong>shareholders can gain at the expense of debt holders</strong> by taking a negative-NPV project, if it is sufficiently risky.
<ul>
<li>Also called <strong>risk-shifting</strong> problem</li>
</ul></li>
<li>Shareholders have an <strong>incentive to invest in negative-NPV projects that are risky</strong>, even though a negative-NPV project destroys value for the firm overall.</li>
<li>Anticipating this bad behavior, <strong>security holders will pay less for the firm initially</strong>.</li>
</ul>
</section>
<section id="agency-costs-of-leverage-7" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Debt Overhang and Under-Investment</strong></p>
<p>Now assume Baxter does not pursue the risky strategy, but instead the firm is considering an investment opportunity that requires an <strong>initial investment of $100,000</strong> and will generate a risk-free return of <strong>50%</strong>.</p>
<p>If the current risk-free rate is 5%, this investment clearly has a <strong>positive NPV</strong>.</p>
<ul>
<li><strong>What if Baxter does not have the cash on hand to make the investment?</strong></li>
<li>Could Baxter raise <strong>$100,000</strong> in new equity to make the investment?</li>
</ul>
</section>
<section id="agency-costs-of-leverage-8" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Debt Overhang and Under-Investment</strong></p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Without project</th>
<th>With new project</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Existing assets</td>
<td>900</td>
<td>900</td>
</tr>
<tr class="even">
<td>New project</td>
<td></td>
<td>150</td>
</tr>
<tr class="odd">
<td>Total firm value</td>
<td>900</td>
<td>1050</td>
</tr>
<tr class="even">
<td>Debt</td>
<td>900</td>
<td>1000</td>
</tr>
<tr class="odd">
<td>Equity</td>
<td>0</td>
<td>50</td>
</tr>
</tbody>
</table>
<div class="fragment">
<ul>
<li>If equity holders contribute 100,000 to fund the project, <strong>they get back only 50,000.</strong></li>
<li>The other 100,000 from the project goes to the debt holders, whose payoff increases from 900,000 to 1 million.</li>
<li>Debt holders receive most of the benefit, thus <strong>this project is a negative-NPV investment opportunity for equity holders, even though it offers a positive NPV for the firm</strong>.</li>
</ul>
</div>
</section>
<section id="agency-costs-of-leverage-9" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Debt Overhang and Under-Investment</strong></p>
<p>A situation in which <strong>equity holders choose not to invest in a positive NPV project</strong> because the firm is in financial distress and the value of undertaking the investment opportunity <strong>will accrue to bondholders rather than themselves</strong>.</p>
<p>When a firm faces financial distress, it may choose not to finance new, positive-NPV projects.</p>
<ul>
<li>This is also called a <strong>debt overhang</strong> problem.</li>
</ul>
</section>
<section id="agency-costs-of-leverage-10" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>Cashing Out</strong></p>
<p>When a firm faces financial distress, shareholders have an <strong>incentive to withdraw money from the firm</strong>, if possible.</p>
<p>For example, if it is likely the company will default, <strong>the firm may sell assets below market value </strong> and use the funds to pay an immediate cash dividend to the shareholders.</p>
<ul>
<li><strong>Covenants</strong> may prevent this type of strategy.</li>
</ul>
</section>
<section id="agency-costs-of-leverage-11" class="slide level2 smaller" data-background="#eeffff">
<h2>16.5 Agency Costs of Leverage</h2>
<p><strong>These are examples of Agency costs of Leverage</strong></p>
<p>Leverage can encourage managers and shareholders to act in ways that reduce value.</p>
<ul>
<li>It appears that the equity holders benefit at the expense of the debt holders.</li>
<li>However, ultimately, <strong>it is the shareholders of the firm who bear these agency costs.</strong></li>
</ul>
</section>
</section>
<section>
<section id="agency-benefits-of-leverage" class="title-slide slide level1 smaller center" data-background="#ead1dc">
<h1>16.6 Agency Benefits of Leverage</h1>

</section>
<section id="agency-benefits-of-leverage-1" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.6 Agency Benefits of Leverage</h2>
<p><strong>Management Entrenchment</strong></p>
<ul>
<li>A situation arising as the result of the separation of ownership and control in which managers may make decisions that benefit themselves at investors‚Äô expenses.</li>
</ul>
<p>Entrenchment may allow managers to run the firm in their own best interests, rather than in the best interests of the shareholders. For instance, spending on <strong>perks</strong>.</p>
<p><strong>Leverage can reduce the degree of managerial entrenchment</strong> because managers are more likely to be fired when a firm faces financial distress.</p>
<ul>
<li>In addition, when the firm is highly levered, <strong>creditors themselves will closely monitor the actions of managers</strong>, providing an additional layer of management oversight.</li>
</ul>
</section>
<section id="agency-benefits-of-leverage-2" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.6 Agency Benefits of Leverage</h2>
<p><strong>Concentration of Ownership</strong></p>
<ul>
<li>One advantage of using leverage is that it allows the <strong>original owners of the firm to maintain their equity stake</strong>.</li>
<li>They will likely have a strong interest in doing what is best for the firm.</li>
</ul>
</section>

<section id="agency-benefits-of-leverage-4" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.6 Agency Benefits of Leverage</h2>
<p><strong>Reduction of Wasteful Investment</strong></p>
<ul>
<li>Another concern for large corporations is that managers may make large, <strong>unprofitable investments</strong>.</li>
<li>Managers may engage in <strong>empire building</strong>.</li>
<li>Managers often prefer to run larger firms rather than smaller ones, so they will take on investments that increase the size, but not necessarily the profitability, of the firm.</li>
<li>Thus, managers may <strong>expand unprofitable divisions</strong>, <strong>pay too much for acquisitions</strong>, make <strong>unnecessary capital expenditures</strong>, or hire <strong>unnecessary employees</strong>.</li>
</ul>
</section>
<section id="agency-benefits-of-leverage-5" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.6 Agency Benefits of Leverage</h2>
<p><strong>Managerial Overconfidence</strong></p>
<ul>
<li>Managers may over-invest because they are <strong>overconfident</strong>.</li>
<li>Managers tend to be bullish on the firm‚Äôs prospects and may believe that new opportunities are better than they actually are.</li>
<li><strong>Debt forces managers to be more realistic</strong> with the true prospects of the firm because they have the commitment to pay back debtholders.</li>
</ul>
</section>
<section id="agency-benefits-of-leverage-6" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.6 Agency Benefits of Leverage</h2>
<p><strong>Free Cash Flow Hypothesis</strong></p>
<ul>
<li>The view that <strong>wasteful spending is more likely to occur when firms have high levels of cash flow in excess</strong> of what is needed after making all positive-NPV investments and payments to debt holders.</li>
<li><strong>When cash is tight, managers will be motivated to run the firm as efficiently as possible</strong>.</li>
<li><strong>Leverage increases firm value because it commits the firm to making future interest payments</strong>, thereby reducing excess cash flows and wasteful investment by managers.</li>
</ul>
</section>
<section id="agency-benefits-of-leverage-7" class="slide level2 smaller" data-background="#ead1dc">
<h2>16.6 Agency Benefits of Leverage</h2>
<p>The takeaway of this section is:</p>
<p><strong>Leverage also has benefits that might increase firm value.</strong></p>
<p><strong>The net effect is an empirical matter and is not trivial to find.</strong></p>
<div class="fragment">
<p><strong>Firms would pursue an optimal debt level.</strong></p>
</div>
</section></section>
<section>
<section id="agency-costs-and-the-tt" class="title-slide slide level1 smaller center" data-background="#cfd5ea">
<h1>16.7 Agency Costs and the TT</h1>

</section>
<section id="agency-costs-and-the-tt-1" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.7 Agency Costs and the TT</h2>
<p>We can now write that:</p>
<p><span class="math display">\[V^L = V^U + PV(Interest\;tax\;shield) - PV(Financial\;distress\;costs)\]</span> <span class="math display">\[- PV(Agency\;costs\;of\;debt) + PV(Agency\;benefits\;of\;debt)\]</span></p>
</section>
<section id="section-3" class="slide level2 smaller" data-background="#cfd5ea">
<h2></h2>

<img data-src="../figs/bm_16_2.png" class="r-stretch"></section>
<section id="agency-costs-and-the-tt-2" class="slide level2 smaller" data-background="#cfd5ea">
<h2>16.7 Agency Costs and the TT</h2>
<p><strong>The Optimal Debt Level</strong></p>
<p>Again, the optimal level is not the same to all firms.</p>
<p><strong>R&amp;D-Intensive Firms</strong></p>
<ul>
<li>Firms with high R&amp;D costs and future growth opportunities typically maintain low debt levels.</li>
<li>These firms tend to have low current free cash flows and risky business strategies.</li>
</ul>
<p><strong>Low-Growth, Mature Firms</strong></p>
<ul>
<li>Mature, low-growth firms with stable cash flows and tangible assets often carry a high-debt load.</li>
<li>These firms tend to have high free cash flows with few good investment opportunities.</li>
</ul>
</section></section>
<section>
<section id="asymmetric-info.-cap.-struc." class="title-slide slide level1 smaller center" data-background="#eeffff">
<h1>16.8 Asymmetric Info. &amp; Cap. Struc.</h1>

</section>
<section id="asymmetry-cap.-struc." class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p><strong>Asymmetric Information</strong></p>
<ul>
<li>A situation in which parties have different information. For example, when managers have superior information to investors regarding the firm‚Äôs future cash flows.</li>
</ul>
<div class="fragment">
<p><strong>Signaling Theory of Debt</strong></p>
<ul>
<li>The use of leverage as a way to signal information to investors.</li>
<li>Thus a firm can use leverage as a way to convince investors that it does have information that the firm will grow, even if it cannot provide verifiable details about the sources of growth.</li>
</ul>
</div>
</section>
<section id="asymmetry-cap.-struc.-1" class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p><strong>Adverse Selection</strong> : The idea that when the buyers and sellers have different information, the average quality of assets in the market will differ from the average quality overall.</p>
<p><strong>Lemons Principle</strong></p>
<ul>
<li><p>When a seller has private information about the value of a good, buyers will discount the price they are willing to pay due to adverse selection.</p></li>
<li><p>An example of adverse selection and the lemons principle is the <strong>used car market</strong>.</p></li>
<li><p>If the seller has private information about the quality of the car, then <strong>her desire to sell reveals the car is probably of low quality</strong>.</p></li>
<li><p>Buyers are therefore reluctant to buy except at heavily discounted prices.</p></li>
<li><p><strong>Owners of high-quality cars are reluctant to sell</strong> because they know buyers will think they are selling a lemon and offer only a low price.</p></li>
<li><p>Consequently, <strong>the quality and prices of cars sold in the market are both low</strong>.</p></li>
</ul>
</section>
<section id="asymmetry-cap.-struc.-2" class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p>This same principle can be applied to <strong>the market for equity</strong>.</p>
<ul>
<li>Firms that sell new equity have <strong>private information about the quality of the future projects</strong>.</li>
<li>However, due to the lemons principle, <strong>buyers are reluctant to believe management‚Äôs assessment</strong> of the new projects and are only willing to buy the new equity at heavily discounted prices.</li>
</ul>
<div class="fragment">
<p>In other words,</p>
<p><strong>If the firm is issuing equity at market prices, it must be that managers think the stock is expensive.</strong></p>
<p><strong>If the firm is buying back shares at market prices, it must be that managers think the stock is cheap.</strong></p>
</div>
</section>
<section id="asymmetry-cap.-struc.-3" class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p><strong>Problem</strong></p>
<p>You are an analyst who follows Great Windows‚Äô stock. Although the current stock price is 37.50, you believe the stock is worth either 25 or 50, depending on the success of a new product launch.</p>
<p>If Great Windows‚Äô CEO announces that she plans to buy 10,000 additional shares in the company, how will the share price change?</p>
<div class="fragment">
<p><strong>Solution</strong></p>
<p>If the CEO knows the new product launch is a failure, she would sell the stock at 37.50 given that the she knows true value is 25.</p>
<p>If the CEO announces that she is buying 10,000 additional shares, she must know that the new product launch is a success and the true value is 50 per share. Thus, the stock price should rise to 50.</p>
</div>
</section>
<section id="asymmetry-cap.-struc.-4" class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p><strong>The Pecking Order of Financing Choices</strong></p>
<ul>
<li>Firms prefer to finance investments with internally-generated funds.</li>
<li>If external finance is required, firms issue the safest security first.</li>
<li>They start with debt, then possibly hybrid securities, such as convertible bonds, then equity as a last resort.</li>
</ul>
</section>
<section id="asymmetry-cap.-struc.-5" class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p><strong>Problem</strong></p>
<ul>
<li><p>Nesbat Industries needs to raise 25 million for a new investment project. If the firm issues one year debt, it may have to pay an interest rate of 10%, although Nesbat‚Äôs managers believe that 8% would be a fair rate given the level of risk.</p></li>
<li><p>However, if the firm issues equity, they believe the equity may be underpriced by 7.5%.</p></li>
<li><p>What is the cost to current shareholders of financing the project out of retained earnings, debt, and equity?</p></li>
</ul>
</section>
<section id="asymmetry-cap.-struc.-6" class="slide level2 smaller" data-background="#eeffff">
<h2>16.8 Asymmetry &amp; Cap. Struc.</h2>
<p><strong>Solution</strong></p>
<ul>
<li>If the firm spends 25 million out of retained earnings, rather than paying that money out to shareholders as a dividend, the cost to shareholders is 25 million.</li>
</ul>
<div class="fragment">
<ul>
<li>Using debt costs the firm <span class="math inline">\(25 \times 1.10 = 27.5\)</span> million in one year, which has a present value based on management‚Äôs view of the firm‚Äôs risk of <span class="math inline">\(\frac{27.5}{1.08} = 25.46\)</span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Finally, if equity is underpriced by 7.5%, then to raise 25 million, the firm will need to issue <span class="math inline">\(\frac{25}{1-0.075} = 27.03\)</span> million of new equity. Thus, the cost to existing shareholders will be 27.03 million.</li>
</ul>
</div>
</section></section>
<section>
<section id="the-bottom-line" class="title-slide slide level1 smaller center" data-background="#ead1dc">
<h1>16.9 The Bottom Line</h1>

</section>
<section id="the-bottom-line-1" class="slide level2 smaller scrollable" data-background="#ead1dc">
<h2>16.9 The Bottom Line</h2>
<div>
<ol type="1">
<li class="fragment"><p>With <strong>perfect capital markets</strong>, a firm‚Äôs security choice alters the risk of the firm‚Äôs equity, but it does not change its value or the amount it can raise from outside investors</p></li>
<li class="fragment"><p>The optimal capital structure depends on <strong>market imperfections</strong>, such as taxes, financial distress costs, agency costs, and asymmetric information.</p>
<ul>
<li class="fragment">the most clear-cut, and possibly the most significant, is <strong>taxes</strong></li>
</ul></li>
<li class="fragment"><p><strong>Financial distress</strong> may lead to other consequences that reduce the value of the firm</p></li>
<li class="fragment"><p><strong>Agency costs and benefits</strong> of leverage are also important determinants of capital structure.</p></li>
<li class="fragment"><p>A firm must also consider the potential <strong>signaling and adverse selection</strong> consequences of its financing choice</p></li>
<li class="fragment"><p>Actively changing a firm‚Äôs capital structure entails <strong>transactions costs</strong>.</p></li>
</ol>
</div>
</section></section>
<section>
<section id="now-it-is-your-turn" class="title-slide slide level1 smaller center" data-background="#191f36">
<h1>Now it is your turn‚Ä¶</h1>
<div class="footer">

</div>
</section>
<section id="any-questions" class="slide level2" data-background="#fdf6e3">
<h2>üôã‚Äç‚ôÇÔ∏è <strong>Any Questions?</strong></h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="thank-you">Thank You!</h3>
<p><img data-src="../figs/qa2.png" style="box-shadow: none;;width:110.0%"></p>
</div><div class="column" style="width:50%;">
<div style="text-align:right;">
<p><img src="../figs/avatar.jpg" width="120px" style="border-radius:50%; box-shadow:0 4px 12px rgba(0,0,0,.25);"></p>
</div>
<h3 id="henrique-c.-martins"><strong>Henrique C. Martins</strong></h3>
<ul>
<li>üåê <a href="https://eaesp.fgv.br/en/people/henrique-castro-martins">FGV/EAESP</a><br>
</li>
<li>üíº <a href="https://www.linkedin.com/in/henriquecastror/">LinkedIn</a><br>
</li>
<li>üß† <a href="https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&amp;hl=pt-BR&amp;oi=ao">Google Scholar</a><br>
</li>
<li>üìÑ <a href="http://lattes.cnpq.br/6076997472159785">Lattes CV</a><br>
</li>
<li>üè† <a href="https://henriquemartins.net/">Personal Website</a><br>
</li>
</ul>
</div>
</div>

<div class="quarto-auto-generated-content">
<p><img src="../figs/background8.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><span style="font-size:10px"> [<a href="mailto:henrique.martins@fgv.br">Henrique C. Martins</a>] [<a href="https://henriquemartins.net/teaching/financial_strategy/">Teaching Resources</a>]<strong>[Do not use without permission]</strong></span></p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <!-- chat-widget-deluxe.html : Floating chat for all slides (Quarto + revealjs) -->
    <style>
      :root{
        /* Fundo geral claro e elegante */
        --bg: rgba(255,255,255,.88);
        --border: rgba(15,23,42,.12);
        --shadow: 0 12px 40px rgba(20,20,40,.18);

        --brand1: #4f46e5; /* indigo */
        --brand2: #06b6d4; /* cyan */
        --brand-weak: rgba(79,70,229,.10);

        --text: #0f172a;
        --muted: #475569;
        --danger: #b91c1c;

        --bubble-user: #ffffff;
        --bubble-ai:   #fbfdff;
      }
      @media (prefers-color-scheme: dark){
        :root{
          --bg: rgba(19,26,42,.72);
          --border: rgba(255,255,255,.10);
          --shadow: 0 18px 50px rgba(0,0,0,.55);
          --text: #e6e9ef;
          --muted: #b6bfca;
          --brand-weak: rgba(79,70,229,.20);

          --bubble-user: rgba(255,255,255,.08);
          --bubble-ai:   rgba(255,255,255,.06);
        }
      }

      .vhcm-panel, .vhcm-input textarea, .vhcm-bubble {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: "liga" 1, "kern" 1;
      }

      /* FAB button */
      .vhcm-fab{position:fixed; right:18px; bottom:18px; z-index:9999; display:flex; align-items:center; gap:10px}
      .vhcm-fab button{border:none; border-radius:16px; padding:12px 14px; cursor:pointer; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; box-shadow:var(--shadow); display:flex; align-items:center; gap:10px; font-weight:600}
      .vhcm-fab svg{width:20px; height:20px}

      /* Panel (redimension√°vel) */
      .vhcm-panel{
        position:fixed; right:18px; bottom:78px;
        width:325px; height:600px;
        min-width:280px; min-height:360px;
        max-width:94vw; max-height:84vh;

        display:none; flex-direction:column; border:1px solid var(--border);
        border-radius:18px; box-shadow:var(--shadow); overflow:hidden; z-index:9999;
        backdrop-filter: blur(16px) saturate(140%); -webkit-backdrop-filter: blur(16px) saturate(140%);
        background: var(--bg); animation:vslide .25s ease-out;

        /* permite redimensionar pelo canto inferior direito */
        resize: both;
      }
      @keyframes vslide{from{transform: translateY(8px); opacity:0} to{transform:none; opacity:1}}

      .vhcm-header{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border); background:linear-gradient(135deg, rgba(79,70,229,.10), rgba(6,182,212,.08));}
      .vhcm-brand{display:flex; align-items:center; gap:10px}
      .vhcm-logo{width:28px; height:28px; border-radius:10px; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; box-shadow:0 4px 16px var(--brand-weak)}
      .vhcm-title{font-weight:700; letter-spacing:.2px; color:var(--text)}
      .vhcm-status{display:flex; align-items:center; gap:6px; color:var(--muted); font-size:12px}
      .vhcm-dot{width:8px; height:8px; border-radius:50%; background:#22c55e; box-shadow:0 0 0 2px rgba(34,197,94,.25)}
      .vhcm-close{border:none; background:transparent; font-size:18px; cursor:pointer; color:var(--muted)}

      /* Bot√£o meia tela */
      .vhcm-half{
        border:none; background:transparent; cursor:pointer;
        font-size:16px; color:var(--muted); margin-right:6px;
      }
      .vhcm-half:hover{ color: var(--text); }

      /* Painel em meia tela (50vw x 50vh) */
      .vhcm-panel.vhcm--half{
        width: 50vw !important;
        height: 50vh !important;
        max-width: 95vw;
        max-height: 95vh;
        border-radius: 12px;
      }

      .vhcm-body{flex:1; overflow:auto; padding:14px; background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0));}
      .vhcm-typing{font-size:12px; color:var(--muted); display:none; padding:6px 2px}
      .vhcm-dots{display:inline-flex; gap:3px; margin-left:4px}
      .vhcm-dots span{width:6px; height:6px; border-radius:50%; background:var(--muted); opacity:.6; animation:blink 1.2s infinite}
      .vhcm-dots span:nth-child(2){animation-delay:.2s}
      .vhcm-dots span:nth-child(3){animation-delay:.4s}
      @keyframes blink{0%,80%,100%{opacity:.2; transform:translateY(0)} 40%{opacity:.9; transform:translateY(-2px)}}

      .vhcm-input{
        display:flex; align-items:flex-end; gap:8px; padding:12px;
        border-top:1px solid var(--border);
        background:linear-gradient(180deg, rgba(255,255,255,.40), rgba(255,255,255,.20));
      }
      .vhcm-input textarea{
        flex:1;
        resize:none;
        min-height:44px;
        max-height:140px;
        padding:12px 14px;
        border:1px solid var(--border);
        border-radius:14px;
        background:#ffffff;
        color:#0f172a;
        font: 500 14px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        caret-color: var(--brand1);
        box-shadow: 0 1px 0 rgba(0,0,0,.02) inset;
      }
      .vhcm-input textarea::placeholder{ color:#475569; }

      .vhcm-send{background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:600}
      .vhcm-send svg{width:18px; height:18px}

      .vhcm-msg{display:flex; gap:10px; margin-bottom:12px; align-items:flex-end}
      .vhcm-avatar{width:28px; height:28px; border-radius:10px; background:var(--brand-weak); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; color:var(--text)}
      .vhcm-bubble{
        max-width:78%; padding:12px 14px; border-radius:14px; border:1px solid var(--border);
        box-shadow: 0 6px 18px rgba(0,0,0,.06);
        line-height:1.48; font-weight:500;
      }
      .vhcm-msg.user{justify-content:flex-end}
      .vhcm-msg.user .vhcm-bubble{
        background: var(--bubble-user);
        color: var(--text);
        border-color: rgba(15,23,42,.10);
      }
      .vhcm-msg.user .vhcm-avatar{display:none}
      .vhcm-msg.ai .vhcm-bubble{
        background: var(--bubble-ai);
        color: var(--text);
        border-color: rgba(15,23,42,.10);
      }

      .vhcm-error{color:var(--danger); font-size:12px; margin:6px 2px}
    </style>

    <div class="vhcm-fab">
      <button id="vhcm-open" title="Virtual HCM">
        <svg viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c4.97 0 9-3.582 9-8 0-1.93-.71-3.706-1.92-5.126l.86-3.006-3.01.847C15.87 5.6 14 5 12 5 7.03 5 3 8.582 3 13s4.03 9 9 9Z" stroke="currentColor" stroke-width="1.2"></path></svg>
        Virtual HCM
      </button>
    </div>

    <div class="vhcm-panel" id="vhcm-panel" role="dialog" aria-label="Virtual HCM chat">
      <div class="vhcm-header">
        <div class="vhcm-brand">
          <div class="vhcm-logo">VH</div>
          <div>
            <div class="vhcm-title">Virtual HCM</div>
            <div class="vhcm-status"><span class="vhcm-dot"></span><span id="vhcm-module-label">module1</span></div>
          </div>
        </div>
        <div>
          <button id="vhcm-half" class="vhcm-half" aria-label="Half screen" title="Half screen">‚§¢</button>
          <button id="vhcm-close" class="vhcm-close" aria-label="Close">‚úï</button>
        </div>
      </div>
      <div class="vhcm-body" id="vhcm-body"></div>
      <div class="vhcm-typing" id="vhcm-typing">Virtual HCM is typing <span class="vhcm-dots"><span></span><span></span><span></span></span></div>
      <div class="vhcm-input">
        <textarea id="vhcm-text" placeholder="Ask anything about this module‚Ä¶"></textarea>
        <button class="vhcm-send" id="vhcm-send" title="Send">
          <svg viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 11l17-8-8 17-1-7-8-2Z" stroke="#fff" stroke-width="1.6"></path></svg>
          Send
        </button>
      </div>
    </div>

    <script>
    (function(){
      // ====== CONFIG ======
      const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbza4kInsudyRFK_62VL8eULh3TiF_zMdleq4N0OpX4QunuU2rEryBnbE4S9zDHQkvB_/exec"; // troque se necess√°rio
      const DEFAULT_MODULE = "module1";
      const STORAGE_OPEN   = "vhcm_open";
      const STORAGE_SIZE   = "vhcm_size";
      const STORAGE_HALF   = "vhcm_half_mode";
      const STORAGE_SIZE_PREV = "vhcm_size_prev";

      // ====== Elements ======
      const btnOpen = document.getElementById('vhcm-open');
      const btnClose = document.getElementById('vhcm-close');
      const btnHalf = document.getElementById('vhcm-half');
      const panel = document.getElementById('vhcm-panel');
      const body = document.getElementById('vhcm-body');
      const typing = document.getElementById('vhcm-typing');
      const text = document.getElementById('vhcm-text');
      const send = document.getElementById('vhcm-send');
      const moduleLabel = document.getElementById('vhcm-module-label');

      // ====== Module detection (robusta, sem quebrar compatibilidade) ======
      function detectModule(){
        try {
          // 1) Override expl√≠cito via window.VHCM.module
          if (window.VHCM && window.VHCM.module) {
            const v = String(window.VHCM.module).trim();
            if (v) return v;
          }
          // 2) Reveal slide atual com data-module
          if (window.Reveal && typeof Reveal.getCurrentSlide === 'function') {
            const s = Reveal.getCurrentSlide && Reveal.getCurrentSlide();
            const v = (s && (s.dataset.module || s.getAttribute('data-module'))) || '';
            if (v && String(v).trim()) return String(v).trim();
          }
          // 3) <meta name="vhcm-module" content="moduleX">
          const meta = document.querySelector('meta[name="vhcm-module"]');
          if (meta && meta.content && meta.content.trim()) return meta.content.trim();
          // 4) atributo data-module no <body>
          const dm = document.body && document.body.getAttribute && document.body.getAttribute('data-module');
          if (dm && dm.trim()) return dm.trim();
          // 5) querystring ?module=moduleX
          const qs = new URLSearchParams(location.search).get('module');
          if (qs && qs.trim()) return qs.trim();
          // 6) regex no caminho (module2, m2, p2.html)
          const path = (location.pathname || '').toLowerCase();
          let m = path.match(/module(\d+)/); if (m) return `module${m[1]}`;
          m = path.match(/\/m(\d+)\b/);     if (m) return `module${m[1]}`;
          m = path.match(/\/p(\d+)\.html/); if (m) return `module${m[1]}`;
          // 7) compat: window.CURRENT_MODULE (caso voc√™ j√° defina em algum lugar)
          if (window.CURRENT_MODULE) return String(window.CURRENT_MODULE).trim();
        } catch(_){}
        // 8) fallback
        return DEFAULT_MODULE;
      }

      // ====== Helpers ======
      // (√öNICA MUDAN√áA) ‚Üí pega o aluno logado do localStorage, priorizando o ID salvo no login
      function getStudent(){
        try{
          const u = (localStorage.getItem('fs_user')
                  || localStorage.getItem('studentId')
                  || localStorage.getItem('studentName')
                  || 'Anonimo').trim();
          return u || 'Anonimo';
        }catch(_){
          return 'Anonimo';
        }
      }
      function currentModule(){ return detectModule(); }

      function bubble(author, textHtml, isUser=false){
        const wrap = document.createElement('div');
        wrap.className = 'vhcm-msg' + (isUser ? ' user' : ' ai');
        const avatar = document.createElement('div');
        avatar.className = 'vhcm-avatar';
        avatar.textContent = isUser ? 'You' : 'VH';
        const bub = document.createElement('div');
        bub.className = 'vhcm-bubble';
        bub.innerHTML = String(textHtml || '').replace(/\n/g,'<br>');
        if (isUser){ wrap.appendChild(bub); wrap.appendChild(avatar); }
        else { wrap.appendChild(avatar); wrap.appendChild(bub); }
        body.appendChild(wrap); body.scrollTop = body.scrollHeight;
      }
      function setOpen(open){ panel.style.display = open ? 'flex' : 'none'; localStorage.setItem(STORAGE_OPEN, open ? '1' : '0'); }

      // ====== Restaurar tamanho salvo ======
      (function restoreSize(){
        try{
          const saved = JSON.parse(localStorage.getItem(STORAGE_SIZE) || 'null');
          if (saved?.w && saved?.h) {
            panel.style.width = saved.w;
            panel.style.height = saved.h;
          }
        }catch(_){}
      })();

      // ====== Observar e salvar mudan√ßas de tamanho ======
      (function watchSize(){
        if (!('ResizeObserver' in window)) return;
        const ro = new ResizeObserver(entries => {
          for (const e of entries) {
            const { width, height } = e.contentRect || {};
            if (!width || !height) continue;
            localStorage.setItem(STORAGE_SIZE, JSON.stringify({
              w: Math.round(width) + 'px',
              h: Math.round(height) + 'px'
            }));
          }
        });
        ro.observe(panel);
      })();

      // ====== Open/Close & persist state ======
      btnOpen.addEventListener('click', ()=> setOpen(panel.style.display !== 'flex'));
      btnClose.addEventListener('click', ()=> setOpen(false));
      if (localStorage.getItem(STORAGE_OPEN) === '1') setOpen(true);

      // ====== Module label sync ======
      function updateModuleLabel(){ moduleLabel.textContent = currentModule(); }
      updateModuleLabel();
      if (window.Reveal && typeof Reveal.on === 'function'){ Reveal.on('slidechanged', updateModuleLabel); }
      window.addEventListener('hashchange', updateModuleLabel); // caso mude via URL/anchor

      // ====== Meia tela (toggle) ======
      function readSize(){ try { return JSON.parse(localStorage.getItem(STORAGE_SIZE) || 'null'); } catch(_){ return null; } }
      function savePrevSize(){
        const rect = panel.getBoundingClientRect();
        localStorage.setItem(STORAGE_SIZE_PREV, JSON.stringify({
          w: Math.round(rect.width) + 'px',
          h: Math.round(rect.height) + 'px'
        }));
      }
      function readPrevSize(){ try { return JSON.parse(localStorage.getItem(STORAGE_SIZE_PREV) || 'null'); } catch(_){ return null; } }

      function setHalfMode(on){
        if (on){
          // guarda tamanho atual antes de mudar
          savePrevSize();
          panel.classList.add('vhcm--half');
          panel.style.width  = '50vw';
          panel.style.height = '50vh';
          localStorage.setItem(STORAGE_HALF, '1');
          btnHalf.title = 'Exit half screen';
        } else {
          panel.classList.remove('vhcm--half');
          localStorage.setItem(STORAGE_HALF, '0');
          btnHalf.title = 'Half screen';
          const prev = readPrevSize() || readSize();
          if (prev?.w && prev?.h){
            panel.style.width  = prev.w;
            panel.style.height = prev.h;
          } else {
            panel.style.width  = '';
            panel.style.height = '';
          }
        }
      }

      btnHalf.addEventListener('click', ()=>{
        const isOn = panel.classList.contains('vhcm--half');
        setHalfMode(!isOn);
      });

      // Restaurar modo meia tela se estava ativo
      if (localStorage.getItem(STORAGE_HALF) === '1') {
        setHalfMode(true);
      }

      // ====== Send logic ======
      async function sendQuestion(){
        const q = text.value.trim(); if (!q) return;
        const mod = currentModule(); updateModuleLabel();
        bubble('You', q, true); text.value=''; typing.style.display='block';
        try{
          const resp = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            // sem headers pra evitar preflight; servidor j√° aceita JSON puro
            body: JSON.stringify({ question: q, student: getStudent(), module: mod })
          });
          const raw = await resp.text();
          let data = {}; try { data = JSON.parse(raw); } catch(_){ data = { answer: 'Server returned an invalid response.' }; }
          typing.style.display='none';
          bubble('Virtual HCM', data.answer || 'No answer received.', false);
        } catch(e){
          typing.style.display='none';
          bubble('Error', 'Could not contact the server.', false);
        }
      }

      send.addEventListener('click', sendQuestion);
      text.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendQuestion(); }
      });
    })();
    </script>
    <!-- rankings-widget.html : Bot√£o-√≠cone minimal + painel sofisticado -->
    <style>
      /* Esconde tudo que exigir auth enquanto a p√°gina estiver bloqueada pelo login-start */
      html.locked .requires-auth,
      body.locked .requires-auth { display: none !important; }

      :root{
        --chatbot-gap: 350px;

        /* meio-termo: mais escuro que o claro, mais claro que o grafite */
        --lb-bg: rgba(46, 58, 78, 0.72);         /* slate-700 ~ 72% */
        --lb-border: rgba(255,255,255,0.10);
        --lb-shadow: 0 18px 60px rgba(0,0,0,0.35), 0 2px 8px rgba(0,0,0,0.18);
        --lb-radius: 18px;

        /* acentos (lil√°s/azul) */
        --lb-accent: #a78bfa;                    /* lil√°s */
        --lb-accent-weak: rgba(167,139,250,0.18);

        /* degrad√™ do bot√£o, combinando com seu tema */
        --pill-start: #6d5df5;  /* violeta */
        --pill-end:   #2ec5ff;  /* azul-ciano */
      }

      .lb-panel{
        position: fixed;
        bottom: 20px;
        right: var(--chatbot-gap);
        z-index: 2147483647;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      }

      /* Bot√£o s√≥-√≠cone, circular (mesmo tom do chat/coment√°rios) */
      .lb-toggle{
        width: 40px; height: 40px; border-radius: 999px;
        display: inline-flex; align-items: center; justify-content: center;
        border: none;
        background: linear-gradient(135deg, var(--pill-start), var(--pill-end));
        color: white;           /* √≠cone branco */
        box-shadow: 0 10px 28px rgba(2,6,23,.30), inset 0 0 0 1px rgba(255,255,255,.14);
        cursor: pointer; user-select: none;
        transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      }
      .lb-toggle:hover{ transform: translateY(-1px); filter: brightness(1.05); }
      .lb-toggle:active{ transform: translateY(0); filter: brightness(.98); }
      .lb-icon{ font-size: 20px; line-height: 1; }

      /* Cart√£o do ranking (glass) */
      .lb-card{
        margin-top: 10px;
        width: 360px; max-height: 62vh; overflow: auto;
        border: 1px solid var(--lb-border); background: var(--lb-bg);
        -webkit-backdrop-filter: saturate(160%) blur(10px);
        backdrop-filter: saturate(160%) blur(10px);
        border-radius: var(--lb-radius);
        box-shadow: var(--lb-shadow);
        display: none;
        position: absolute; bottom: 52px; right: 0; /* abre acima do bot√£o */
        transform-origin: bottom right;
        color: #e5e7eb; /* texto claro */
      }
      .lb-card.open{ display:block; animation: lbPop .18s cubic-bezier(.2,.9,.2,1); }
      @keyframes lbPop { from { transform: scale(.98); opacity: 0 } to { transform: scale(1); opacity: 1 } }

      .lb-header{
        padding: 12px 14px;
        border-bottom: 1px solid rgba(255,255,255,.06);
        display:flex; justify-content:space-between; align-items:center;
        background: linear-gradient(180deg, rgba(167,139,250,.12), transparent 60%);
        border-top-left-radius: var(--lb-radius);
        border-top-right-radius: var(--lb-radius);
        position: sticky; top: 0; backdrop-filter: blur(6px);
      }
      .lb-title{
        font-weight: 800; letter-spacing:.2px; color:#f3f4f6;
      }
      .lb-refresh{
        font-size: 12px; color: #d1d5db; display:flex; align-items:center; gap: 6px;
      }
      .lb-dot{
        width:8px;height:8px;border-radius:999px;background:var(--lb-accent);
        box-shadow: 0 0 0 4px var(--lb-accent-weak);
      }

      .lb-list{ list-style:none; margin:0; padding: 6px 0 8px; }
      .lb-item{
        display:flex; align-items:center; justify-content:space-between;
        padding: 10px 14px;
        border-bottom: 1px dashed rgba(255,255,255,.06);
      }
      .lb-item:last-child{ border-bottom: 0; }

      .lb-left{ display:flex; align-items:center; gap:10px; min-width:0; }
      .lb-rank{
        width: 28px; text-align:right; font-variant-numeric: tabular-nums;
        color:#fde68a; font-weight:700; /* dourado p/ 1¬∫ */
      }
      .lb-item.top-2 .lb-rank{ color:#cbd5e1; } /* prata */
      .lb-item.top-3 .lb-rank{ color:#d8b4fe; } /* lil√°s */

      .lb-name{
        flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; color:#e5e7eb;
      }
      .lb-points{ font-variant-numeric: tabular-nums; font-weight:600; color:#f3f4f6; }

      .lb-footer{
        padding: 10px 14px;
        display:flex; justify-content:space-between; align-items:center; gap:8px;
        border-top: 1px solid rgba(255,255,255,.06);
        background: linear-gradient(0deg, rgba(167,139,250,.10), transparent 60%);
        border-bottom-left-radius: var(--lb-radius);
        border-bottom-right-radius: var(--lb-radius);
        position: sticky; bottom: 0; backdrop-filter: blur(6px);
      }
      .lb-badge-me{
        background: var(--lb-accent-weak);
        padding: 4px 8px; border-radius: 999px; font-size: 12px; font-weight:600;
        color: #f5f3ff;
      }

      /* Mobile: bottom sheet */
      @media (max-width: 820px){
        .lb-panel{ right: 12px; bottom: 88px; }
        .lb-card{
          position: fixed; left: 12px; right: 12px; bottom: 88px;
          width: auto; height: 58vh; max-height: none; transform-origin: bottom center;
        }
      }
      @media (max-width: 380px){
        .lb-card{ height: 62vh; }
      }
    </style>

    <!-- üîí Este wrapper esconde o widget at√© o login -->
    <div class="requires-auth">
      <div class="lb-panel" id="lbPanel">
        <button class="lb-toggle" id="lbToggle" title="Leaderboard" aria-label="Open leaderboard">
          <span class="lb-icon">üèÜ</span>
        </button>
        <div class="lb-card" id="lbCard" role="dialog" aria-modal="false" aria-label="Leaderboard">
          <div class="lb-header">
            <div class="lb-title">Top <span id="lbTopN">10</span></div>
            <div class="lb-refresh"><span class="lb-dot" aria-hidden="true"></span><span id="lbUpdated">Refresh ‚Äî</span></div>
          </div>

          <ul class="lb-list" id="lbList"></ul>

          <div class="lb-footer">
            <span id="lbMe"></span>
            <!-- (sem bot√µes de fechar/refresh) -->
          </div>
        </div>
      </div>
    </div>

    <script>
      /************ CONFIG ************/
      const LB_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxb3Z73DvsgGiGwK-jVp89jA5EGEYk24nbPNblQiNxFZPYvvDTvO-v4S4N_L-4YZ8KZfQ/exec';
      const LB_TOP = 10;
      const LB_POLL_MS = 3000;

      // student/module/page com fallback, mas permitindo atualizar ap√≥s login
      let LB_STUDENT = (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').toString();
      const LB_MODULE  = (window.moduleId   || '').toString() || 'module1';
      const LB_PAGE    = (window.pageId     || '').toString() || (location.pathname + location.hash);
      /********************************/

      const lbToggle  = document.getElementById('lbToggle');
      const lbCard    = document.getElementById('lbCard');
      const lbList    = document.getElementById('lbList');
      const lbTopNEl  = document.getElementById('lbTopN');
      const lbMeEl    = document.getElementById('lbMe');
      const lbUpdated = document.getElementById('lbUpdated');
      lbTopNEl.textContent = LB_TOP;

      // Se o login acontecer depois do load, atualiza student e faz refresh
      document.addEventListener('auth:login', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? ev.detail.studentId : (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '');
        if (sid) {
          LB_STUDENT = String(sid);
          // Se o card estiver aberto, recarrega; sen√£o, s√≥ atualiza timestamp
          if (lbCard.classList.contains('open')) fetchLeaderboard(); else setUpdated();
        }
      });

      // Toggle abrir/fechar
      lbToggle.addEventListener('click', () => {
        const open = lbCard.classList.contains('open');
        if (open) lbCard.classList.remove('open');
        else { lbCard.classList.add('open'); fetchLeaderboard(); }
      });
      // Fechar com Esc
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') lbCard.classList.remove('open'); });

      // Atualiza "Refresh HH:MM:SS"
      function setUpdated(ts){
        const d = ts ? new Date(ts) : new Date();
        const hh = String(d.getHours()).padStart(2,'0');
        const mm = String(d.getMinutes()).padStart(2,'0');
        const ss = String(d.getSeconds()).padStart(2,'0');
        lbUpdated.textContent = `Refresh ${hh}:${mm}:${ss}`;
      }

      // Carregar Top
      async function fetchLeaderboard() {
        try {
          const who = LB_STUDENT || 'anonymous';
          const url = `${LB_ENDPOINT}?action=leaderboard_top&top=${LB_TOP}&who=${encodeURIComponent(who)}`;
          const res = await fetch(url, { method: 'GET' });
          const data = await res.json();
          if (!data.ok) throw new Error(data.error || 'Failed');
          renderTop(data.top, data.me, data.updated_at);
          setUpdated(data.updated_at);
        } catch (e) {
          console.error('Leaderboard error:', e);
          lbList.innerHTML = '<li class="lb-item"><div class="lb-name">N√£o foi poss√≠vel carregar o ranking.</div></li>';
          setUpdated();
        }
      }

      // Renderizar lista
      function renderTop(top, me, updatedAt) {
        lbList.innerHTML = '';
        if (!top || !top.length){
          lbList.innerHTML = '<li class="lb-item"><div class="lb-name" style="opacity:.8">Ainda sem pontos por aqui.</div></li>';
        } else {
          for (const row of top) {
            const li = document.createElement('li'); li.className = 'lb-item';
            if (row.rank <= 3) li.classList.add(`top-${row.rank}`);
            const left = document.createElement('div'); left.className='lb-left';
            const rk = document.createElement('div'); rk.className='lb-rank'; rk.textContent = row.rank;
            const nm = document.createElement('div'); nm.className='lb-name'; nm.textContent = row.name || row.studentId;
            left.appendChild(rk); left.appendChild(nm);
            const pts = document.createElement('div'); pts.className='lb-points'; pts.textContent = row.total_points + ' pts';
            li.appendChild(left); li.appendChild(pts);
            lbList.appendChild(li);
          }
        }
        lbMeEl.innerHTML = me ? `<span class="lb-badge-me">You: #${me.rank} ¬∑ ${me.total_points} pts</span>` : '';
        setUpdated(updatedAt);
      }
      // exp√µe para uso externo se precisar
      window.renderTop = renderTop;

      // Auto-refresh
      if (LB_POLL_MS && Number(LB_POLL_MS) > 0) setInterval(fetchLeaderboard, LB_POLL_MS);

      // Logger de eventos (exponho global para uso em outras partes)
      async function leaderboardLogEvent(event_type, { points=null, details='' } = {}) {
        try {
          const payload = {
            action: 'leaderboard_log',
            studentId: LB_STUDENT || 'anonymous',
            event_type,
            module: LB_MODULE,
            page: LB_PAGE,
            details,
            points,
            fingerprint: `${LB_STUDENT || 'anonymous'}-${event_type}-${LB_MODULE}-${LB_PAGE}`
          };
          const res = await fetch(LB_ENDPOINT, { method: 'POST', body: JSON.stringify(payload) });
          const data = await res.json();
          if (!data.ok) throw new Error(data.error || 'failed');
          fetchLeaderboard();
          return data;
        } catch (e) {
          console.error('logEvent error:', e);
          return { ok:false, error: String(e) };
        }
      }
      window.leaderboardLogEvent = leaderboardLogEvent;
    </script>
    <!-- notices-on-login.html -->
    <style>
      .notice-modal-backdrop{
        position:fixed; inset:0; background:rgba(15,23,42,.35);
        display:none; align-items:center; justify-content:center;
        z-index:2147483647; /* topo de tudo */
      }
      .notice-modal{
        width:min(92vw, 680px); background:#fff; border-radius:16px;
        box-shadow:0 18px 50px rgba(0,0,0,.25);
        padding:18px 18px 12px; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        border:1px solid rgba(0,0,0,.08);
      }
      .notice-title{ font-size:1.1rem; font-weight:700; margin:0 0 6px; color:#0f172a; }
      .notice-body{ color:#334155; line-height:1.5; }
      .notice-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:14px; }

      .notice-btn{
        padding:10px 14px; border-radius:10px;
        border:1px solid rgba(0,0,0,.1); background:#0ea5e9; color:#fff; cursor:pointer;
      }

      /* Bot√µes das op√ß√µes */
      .notice-choice{
        padding:10px 14px; border-radius:999px;
        border:1px solid rgba(15,23,42,.08);
        background: linear-gradient(180deg,#3b82f6,#2563eb);
        color:#fff; cursor:pointer; box-shadow: 0 2px 0 rgba(0,0,0,.06);
        transition: transform .12s ease, filter .12s ease, opacity .12s ease;
      }
      .notice-choice:hover{ transform: translateY(-1px); filter: brightness(1.05); }
      .notice-choice:disabled{ opacity:.7; cursor:default; transform:none; }

      /* Estado visual ap√≥s clique */
      .notice-choice.is-selected{
        background: linear-gradient(180deg,#2563eb,#1d4ed8);
        border-color: rgba(37,99,235,.35);
      }
      .notice-choice.is-correct{
        background: linear-gradient(180deg,#16a34a,#15803d);
        border-color: rgba(22,163,74,.35);
      }
      .notice-choice.is-wrong{
        background: linear-gradient(180deg,#dc2626,#b91c1c);
        border-color: rgba(220,38,38,.35);
      }
    </style>

    <div class="notice-modal-backdrop" id="noticeBackdrop" aria-hidden="true" style="display:none">
      <div class="notice-modal" role="dialog" aria-modal="true">
        <div class="notice-title" id="noticeTitle">Notice</div>
        <div class="notice-body" id="noticeBody"></div>
        <div class="notice-actions">
          <button class="notice-btn" id="noticeOkBtn" type="button">Ok, got it</button>
        </div>
      </div>
    </div>

    <script>
    (function(){
      const ENDPOINT = 'https://script.google.com/macros/s/AKfycbw1stXhHVbcinNcagloc6XNr3MYW9zn8EctaxxLuOJ086ODpCBvNCPwdfzbJxwl1XgDfw/exec';
      const SESSION_FLAG = 'notice_shown_this_load';
      const FEEDBACK_AUTO_CLOSE_MS = 15000; // V/F: tempo p/ ler feedback (0 = fecha s√≥ no "Ok, got it")
      const DEBUG = false;

      /* Preconnect + dns-prefetch */
      try {
        const l1=document.createElement('link'); l1.rel='preconnect';   l1.href='https://script.google.com'; document.head.appendChild(l1);
        const l2=document.createElement('link'); l2.rel='dns-prefetch'; l2.href='https://script.google.com'; document.head.appendChild(l2);
      } catch(_) {}

      /* üî• Warm-up imediato do GAS */
      try {
        const warm = new Image();
        warm.referrerPolicy = 'no-referrer';
        warm.src = `${ENDPOINT}?action=ping&t=${Date.now()}`;
      } catch(_) {}

      /* Helpers b√°sicos */
      function ensureModal(){
        let backdrop = document.getElementById('noticeBackdrop');
        if (!backdrop) {
          const tpl = document.createElement('div');
          tpl.innerHTML = `
            <div class="notice-modal-backdrop" id="noticeBackdrop" aria-hidden="true" style="display:none">
              <div class="notice-modal" role="dialog" aria-modal="true">
                <div class="notice-title" id="noticeTitle">Notice</div>
                <div class="notice-body" id="noticeBody"></div>
                <div class="notice-actions">
                  <button class="notice-btn" id="noticeOkBtn" type="button">Ok, got it</button>
                </div>
              </div>
            </div>`;
          document.body.appendChild(tpl.firstElementChild);
          if (DEBUG) console.log('[notice] backdrop injected');
        }
      }
      function getStudentId(){
        try { return (localStorage.getItem('studentId') || sessionStorage.getItem('studentId') || window.__lastLoginStudentId || '').trim(); }
        catch(e){ return ''; }
      }
      function normalizeModule(m){
        if (!m) return '';
        const s = String(m).trim().toLowerCase();
        const m1 = s.match(/^module(\d+)$/); if (m1) return `mod${m1[1]}`;
        return s;
      }
      function getModule(){
        try {
          const el = document.getElementById('current-module'); if (el && el.value) return normalizeModule(el.value);
          const byStorage = localStorage.getItem('module') || sessionStorage.getItem('module'); if (byStorage) return normalizeModule(byStorage);
          const dm = document.body && document.body.getAttribute('data-module'); if (dm) return normalizeModule(dm);
          if (window.VHCM && window.VHCM.module) return normalizeModule(window.VHCM.module);
          return '';
        } catch(e){ return ''; }
      }
      function fetchJSON(url){
        return fetch(url, { credentials:'omit', cache:'no-store' })
          .then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.json(); });
      }
      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
      function personalize(s, studentId, module){
        return String(s || '')
          .replace(/\{\{\s*studentId\s*\}\}/gi, escapeHtml(studentId || ''))
          .replace(/\{\{\s*module\s*\}\}/gi, escapeHtml(module || ''));
      }
      function fireAndForget(url){
        try { const img = new Image(); img.referrerPolicy='no-referrer'; img.src = url; } catch(_) {}
      }
      function ackAndClose(studentId, notice_id){
        const modal = document.getElementById('noticeBackdrop');
        if (modal) modal.style.display = 'none';
        const qs2 = new URLSearchParams({ action:'ack', studentId, notice_id, t: Date.now().toString() });
        fireAndForget(`${ENDPOINT}?${qs2.toString()}`);
      }

      /* Normaliza r√≥tulos T/F em v√°rios formatos */
      function normalizeTF(x){
        const s = String(x || '').trim().toLowerCase();
        if (['true','t','verdadeiro','v','yes','y','sim','‚úÖ','‚úîÔ∏è'].includes(s)) return 'true';
        if (['false','f','falso','no','n','nao','n√£o','‚ùå','‚úñÔ∏è'].includes(s)) return 'false';
        if (s.startsWith('true'))  return 'true';
        if (s.startsWith('false')) return 'false';
        return '';
      }

      /* Render de poll (normal e T/F) */
      function renderPoll(notice, studentId, module){
        const body = document.getElementById('noticeBody');
        const okBtn = document.getElementById('noticeOkBtn');
        const opts = Array.isArray(notice.poll_options) ? notice.poll_options : [];
        const q    = notice.poll_question || 'Vote:';

        const correctKey = normalizeTF(notice.poll_correct);
        const isQuizTF   = (correctKey === 'true' || correctKey === 'false');
        let autoTimer = null;

        const pollWrap = document.createElement('div');
        pollWrap.innerHTML = `
          <div style="margin:8px 0 12px 0;"><strong>${escapeHtml(q)}</strong></div>
          <div id="pollBtns" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
          <div id="pollFeedback" style="margin-top:10px;"></div>
        `;
        body.appendChild(pollWrap);

        const btns = pollWrap.querySelector('#pollBtns');
        const fb   = pollWrap.querySelector('#pollFeedback');

        // T/F: deixa "Ok, got it" para leitura do feedback
        if (isQuizTF && okBtn) {
          okBtn.style.display = '';
          okBtn.onclick = (ev) => {
            ev.preventDefault(); ev.stopPropagation();
            if (autoTimer) { clearTimeout(autoTimer); autoTimer = null; }
            ackAndClose(studentId, notice.notice_id);
          };
        }

        opts.forEach((label) => {
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'notice-choice';
          b.textContent = label;

          b.addEventListener('click', () => {
            // desabilita todos imediatamente
            const all = [...btns.querySelectorAll('button')];
            all.forEach(x => x.disabled = true);

            // envia voto (fire-and-forget)
            const qs = new URLSearchParams({
              action: 'poll_vote',
              studentId,
              module: module || '',
              poll_id: notice.poll_id || '',
              choice: label,
              t: Date.now().toString()
            });
            fireAndForget(`${ENDPOINT}?${qs.toString()}`);

            if (!isQuizTF) {
              // Poll "opini√£o": s√≥ marca sele√ß√£o e fecha j√°
              b.classList.add('is-selected');
              ackAndClose(studentId, notice.notice_id);
              return;
            }

            // T/F: decide correto/errado usando normaliza√ß√£o
            const choiceKey = normalizeTF(label);
            const isCorrect = (choiceKey && choiceKey === correctKey);

            b.classList.add(isCorrect ? 'is-correct' : 'is-wrong');

            // Feedback amig√°vel
            fb.style.color = isCorrect ? '#065f46' : '#b91c1c';
            fb.innerHTML = isCorrect
              ? (notice.feedback_correct_html || '<p><strong>‚úÖ Correct.</strong></p>')
              : (notice.feedback_wrong_html  || '<p><strong>‚ùå Not quite.</strong></p>');

            // Auto-fecha ap√≥s leitura (se configurado)
            if (FEEDBACK_AUTO_CLOSE_MS > 0) {
              autoTimer = setTimeout(() => {
                autoTimer = null;
                ackAndClose(studentId, notice.notice_id);
              }, FEEDBACK_AUTO_CLOSE_MS);
            }
          });

          btns.appendChild(b);
        });
      }

      /* Mostra aviso/poll */
      async function showNotice(studentId){
        try { if (sessionStorage.getItem(SESSION_FLAG)) return false; } catch(e){}

        const module = getModule();
        const qs = new URLSearchParams({ action:'get', studentId });
        if (module) qs.set('module', module);

        const data = await fetchJSON(`${ENDPOINT}?${qs.toString()}`);
        if (!data.ok || !data.hasNotice || !data.notice) return false;

        ensureModal();

        const notice = data.notice;
        const titleEl = document.getElementById('noticeTitle');
        const bodyEl  = document.getElementById('noticeBody');
        const okBtn   = document.getElementById('noticeOkBtn');
        const modal   = document.getElementById('noticeBackdrop');
        if (!titleEl || !bodyEl || !okBtn || !modal) return false;

        titleEl.textContent = personalize(notice.title || (notice.type === 'poll' ? 'Quick poll' : 'Notice'), studentId, module);
        bodyEl.innerHTML = personalize(notice.message_html || '', studentId, module);
        modal.style.display = 'flex';

        if (notice.type === 'poll' && !notice.already_voted) {
          const correctKey = normalizeTF(notice.poll_correct);
          const isQuizTF   = (correctKey === 'true' || correctKey === 'false');

          // Para poll de opini√£o: esconda o "Ok, got it"
          okBtn.style.display = isQuizTF ? '' : 'none';
          if (!isQuizTF) {
            okBtn.onclick = (ev) => { ev.preventDefault(); ev.stopPropagation(); ackAndClose(studentId, notice.notice_id); };
          }

          renderPoll(notice, studentId, module);
        } else {
          // Aviso HTML simples
          okBtn.style.display = '';
          okBtn.onclick = (ev) => { ev.preventDefault(); ev.stopPropagation(); ackAndClose(studentId, notice.notice_id); };
        }

        try { sessionStorage.setItem(SESSION_FLAG, notice.notice_id); } catch(e){}
        return true;
      }

      /* API global opcional */
      window.noticeCenter = {
        onLogin: (studentId) => { try { window.__lastLoginStudentId = studentId; } catch(e){}; showNotice(String(studentId || '').trim()); },
        showNow: () => { try{ sessionStorage.removeItem(SESSION_FLAG); }catch(_){};
          const sid = getStudentId(); if (sid) showNotice(sid);
        }
      };

      /* Espera login e mostra (fallback) */
      async function waitForLoginAndShow(maxMs=20000){
        const start = Date.now();
        while (Date.now() - start < maxMs) {
          const sid = getStudentId();
          if (sid) { await showNotice(sid); return; }
          await new Promise(r => setTimeout(r, 150));
        }
      }

      /* Gatilhos */
      document.addEventListener('auth:login', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? String(ev.detail.studentId).trim() : getStudentId();
        if (sid) window.noticeCenter.onLogin(sid);
      });
      window.addEventListener('login:success', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? String(ev.detail.studentId).trim() : getStudentId();
        if (sid) window.noticeCenter.onLogin(sid);
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => { waitForLoginAndShow(); });
      } else {
        waitForLoginAndShow();
      }
    })();
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>
      // Redund√¢ncia leve: tamb√©m define o m√≥dulo via JS neste deck
      // (o notices-on-login reconhece body[data-module], localStorage e window.VHCM.module)
      window.VHCM = window.VHCM || {};
      window.VHCM.module = "mod9";

      document.addEventListener('DOMContentLoaded', () => {
        try { localStorage.setItem('mod2','mod2'); } catch(_) {}
      });

      Reveal.on('ready', event => {
        if (event.indexh === 0) {
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
      });
      Reveal.addEventListener('slidechanged', (event) => {
        if (event.indexh === 0) {
          Reveal.configure({ slideNumber: null });
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
        if (event.indexh === 1) {
          Reveal.configure({ slideNumber: 'c' });
          document.querySelector("div.has-logo > img.slide-logo").style.display = null;
        }
      });
    </script>
    

</body></html>
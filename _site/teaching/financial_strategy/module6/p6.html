<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Henrique C. Martins">
  <title>Henrique Castro Martins - Estrat√©gia Financeira</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="../logo.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-771J5563G0"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-771J5563G0', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <!-- === login-start.html (com prote√ß√£o para p√°ginas e slides + turbo + warmup) === -->

  <style>
    /* Card padr√£o (p√°ginas normais) */
    #login-form {
      max-width: 300px;
      margin: 100px auto 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background: #fff;
      box-sizing: border-box;
    }
    #login-form input {
      width: 100%; padding: 10px; margin: 6px 0;
      border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
    }
    #login-form button {
      width: 100%; padding: 10px; margin-top: 10px;
      background-color: #0066cc; color: #fff; border: 0; border-radius: 5px; cursor: pointer;
    }
    #login-error { color: red; text-align: center; margin-top: 10px; }
    #loading-msg{ display:none; text-align:center; margin-top:10px; color:gray; }

    /* Desabilitado durante autentica√ß√£o */
    #login-form button:disabled { opacity:.6; cursor:not-allowed; }
    #login-form input:disabled  { opacity:.7; }

    /* Conte√∫do de p√°ginas normais (fica atr√°s do login at√© destravar) */
    html.locked #after-login-content,
    body.locked #after-login-content { display: none !important; }

    /* Slides (Reveal.js): desfoca deck e bloqueia intera√ß√£o */
    html.locked.reveal-page .reveal,
    body.locked.reveal-page .reveal { filter: blur(4px); pointer-events: none; user-select: none; }

    #login-scrim { display:none; }
    html.locked.reveal-page #login-scrim,
    body.locked.reveal-page #login-scrim{
      display:block; position:fixed; inset:0; background:rgba(255,255,255,.92); z-index:9998;
    }
    html.locked.reveal-page #login-form,
    body.locked.reveal-page #login-form{
      position: fixed; top:50%; left:50%; transform: translate(-50%,-50%);
      margin:0; max-width:340px; width:min(340px,92vw); z-index:9999;
    }

    /* Oculta o "Welcome" nos slides */
    .reveal-page #welcome-message { display: none !important; }

    /* Remember me */
    .remember-row{
      display:flex; align-items:center; gap:8px; margin-top:6px; font-size:.95rem; color:#444; white-space:nowrap;
    }
    .remember-row label{ display:flex; align-items:center; gap:6px; cursor:pointer; }

    /* Fallback duro para p√°ginas comuns: esconde TUDO (qualquer descendente) menos o form/scrim
       enquanto locked. Evita vazamentos quando o tema injeta containers. */
    html.locked body:not(.reveal-page) :not(#login-form):not(#login-form *):not(#login-scrim):not(script):not(style):not(link) {
      display: none !important;
    }

    /* Garante que o form fique acima de qualquer layout do tema */
    #login-form { position: relative; z-index: 10000; }
    #login-scrim { z-index: 9998; }

    /* Scrim e formul√°rio fixos tamb√©m em p√°ginas N√ÉO-reveal enquanto locked */
    html.locked #login-scrim,
    body.locked #login-scrim {
      display: block !important;
      position: fixed !important;
      inset: 0 !important;
      background: #ffffff !important;
      z-index: 2147483646 !important;
    }
    html.locked #login-form,
    body.locked #login-form {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      margin: 0 !important;
      max-width: 340px !important;
      width: min(340px, 92vw) !important;
      z-index: 2147483647 !important;
    }

    /* Evita rolagem/scroll do conte√∫do ao fundo enquanto locked */
    html.locked, body.locked { overflow: hidden !important; }
  </style>

  <!-- Aplica 'locked' em <html> imediatamente e em <body> quando dispon√≠vel + preconnect -->
  <script>
    (function(){
      const addLocked = el => { if (el && !el.classList.contains('locked')) el.classList.add('locked'); };
      addLocked(document.documentElement);
      if (document.body) { addLocked(document.body); }
      else { document.addEventListener('DOMContentLoaded', () => addLocked(document.body)); }

      // preconnect/dns-prefetch para acelerar chamadas ao GAS de login
      try {
        const l1=document.createElement('link'); l1.rel='preconnect';   l1.href='https://script.google.com'; document.head.appendChild(l1);
        const l2=document.createElement('link'); l2.rel='dns-prefetch'; l2.href='https://script.google.com'; document.head.appendChild(l2);
      } catch(_) {}
    })();
  </script>

  <!-- shim seguro: define onLoginSuccess se ainda n√£o existir -->
  <script>
    if (typeof window.onLoginSuccess !== 'function') {
      window.onLoginSuccess = function(studentId){
        try {
          const sid = String(studentId || '').trim();
          window.studentId = sid;
          localStorage.setItem('studentId', sid);
          // compat com widgets antigos
          document.dispatchEvent(new CustomEvent('auth:login',   { detail: { studentId: sid } }));
          setTimeout(() => window.dispatchEvent(new CustomEvent('login:success', { detail:{ studentId: sid } })), 0);
          // hook imediato para o notice center (se j√° carregado)
          if (window.noticeCenter && typeof window.noticeCenter.onLogin === 'function') {
            window.noticeCenter.onLogin(sid);
          }
          if (window.VHCM) window.VHCM.lastLoginAt = Date.now();
          console.debug('[Login] onLoginSuccess ‚Üí', sid);
        } catch(e) {
          console.warn('onLoginSuccess shim warn:', e);
        }
      };
    }
  </script>

  <meta name="twitter:title" content="Henrique Castro Martins - Estrat√©gia Financeira">
<meta name="twitter:description" content="Part 6 - ch.24 Debt Financing">
<meta name="twitter:card" content="summary">
</head><body class="quarto-light"><form id="login-form" onsubmit="event.preventDefault(); validateLogin();">
    <h3 style="text-align:center;">Login</h3>
    <input type="text" id="username" placeholder="Username" autocomplete="username" required="">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" required="">
    <div class="remember-row">
      <label><input type="checkbox" id="remember-me" checked=""> Remember me</label>
    </div>
    <button type="submit" id="login-submit">Enter</button>
    <div id="loading-msg"></div>
    <div id="login-error"></div>
  </form>

  <div id="login-scrim" aria-hidden="true"></div>

  <div id="after-login-content" style="display:none;">
    <h4 id="welcome-message" style="text-align:center; display:none; margin-top:10px; font-size:1.8em; color:#333;"></h4>
  </div>

  <script>
    /***** CONFIG *****/
    const REMEMBER_PASSWORD  = true;
    const GAS_URL            = 'https://script.google.com/macros/s/AKfycbxb3Z73DvsgGiGwK-jVp89jA5EGEYk24nbPNblQiNxFZPYvvDTvO-v4S4N_L-4YZ8KZfQ/exec';
    const SESSION_MAX_HOURS  = 8;     // validade do "lembrado"
    const FAST_WINDOW_HOURS  = 2;     // turbo: libera instant√¢neo
    const VALIDATE_TIMEOUTMS = 3000;  // timeout da valida√ß√£o

    /* üî• Warm-up silencioso do GAS: acorda a fun√ß√£o antes do 1¬∫ login real */
    window.addEventListener('load', () => {
      try {
        const warm = new Image();
        warm.referrerPolicy = 'no-referrer';
        warm.src = `${GAS_URL}?username=&password=&page=WARMUP&t=${Date.now()}`;
      } catch(_) {}
    });

    /***** Marca slides (se houver Reveal) *****/
    document.addEventListener('DOMContentLoaded', () => {
      if (document.querySelector('.reveal')) document.body.classList.add('reveal-page');
    });

    /***** Pr√©-preenche campos com Remember (se houver) *****/
    document.addEventListener('DOMContentLoaded', () => {
      try{
        const u = localStorage.getItem('fs_user');
        const p = localStorage.getItem('fs_pass');
        if (u) document.getElementById('username').value = u;
        if (REMEMBER_PASSWORD && p) document.getElementById('password').value = p;
      }catch(_){}
    });

    /***** Storage helpers *****/
    function saveRemember(u,p,checked){
      try{
        if(checked){
          localStorage.setItem('fs_user', u);
          localStorage.setItem('fs_last_login_at', Date.now().toString());
          if (REMEMBER_PASSWORD) localStorage.setItem('fs_pass', p); else localStorage.removeItem('fs_pass');
        }else{
          localStorage.removeItem('fs_user'); localStorage.removeItem('fs_pass'); localStorage.removeItem('fs_last_login_at');
        }
      }catch(_){}
    }
    function getRemember(){
      try{
        const u=localStorage.getItem('fs_user');
        const p=localStorage.getItem('fs_pass');
        const t=parseInt(localStorage.getItem('fs_last_login_at')||'0',10);
        if(!u||!t) return null; return {u,p,t};
      }catch(_){ return null; }
    }
    const within=(ts,h)=> (Date.now()-ts) < h*3600*1000;

    /* üîí Desativa/Reativa o form durante autentica√ß√£o */
    function setAuthLoading(isLoading){
      const btn = document.getElementById('login-submit');
      const u   = document.getElementById('username');
      const p   = document.getElementById('password');
      const cb  = document.getElementById('remember-me');
      if (btn){
        btn.disabled = isLoading;
        btn.textContent = isLoading ? 'Signing in...' : 'Enter';
      }
      [u,p,cb].forEach(el => { if (el) el.disabled = isLoading; });
    }

    /***** GAS helpers *****/
    function logWithImage(u,p,page){
      const img=new Image(); img.referrerPolicy='no-referrer';
      img.src=`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}&t=${Date.now()}`;
    }
    async function gasAuth(u,p,page,timeoutMs){
      async function _once(ms){
        const ctrl=new AbortController();
        const timer=setTimeout(()=>ctrl.abort('timeout'), ms||0);
        try{
          const res=await fetch(`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}`, {signal:ctrl.signal, cache:'no-store'});
          return (await res.text()||'').trim();
        } finally { clearTimeout(timer); }
      }
      try{
        return await _once(timeoutMs||12000);   // 1¬™ tentativa
      }catch(_){
        return await _once(15000);              // retry mais folgado
      }
    }

    /***** UI helpers *****/
    function unlockAs(u){
      const welcome=document.getElementById('welcome-message');
      if (welcome && !document.body.classList.contains('reveal-page')){
        welcome.textContent=`Welcome, ${u}!`; welcome.style.display='block';
      }
      document.getElementById('login-form').style.display='none';
      const after=document.getElementById('after-login-content'); if(after) after.style.display='block';

      // Remover 'locked' de html e body
      document.documentElement.classList.remove('locked');
      if (document.body) document.body.classList.remove('locked');

      const scrim=document.getElementById('login-scrim'); if(scrim) scrim.style.display='none';
    }

    /***** Auto-login com janela turbo (tamb√©m nos slides) *****/
    document.addEventListener('DOMContentLoaded', async () => {
      const saved=getRemember(); if(!saved) return;
      const page=location.pathname;

      if (within(saved.t, FAST_WINDOW_HOURS)) {
        // libera j√° e registra em background
        unlockAs(saved.u);
        onLoginSuccess(saved.u); // mant√©m studentId para outros scripts

        saveRemember(saved.u, saved.p, true);
        logWithImage(saved.u, saved.p, page);

        // checagem silenciosa (opcional)
        try { const r=await gasAuth(saved.u, saved.p, 'CHECK', 12000); if(r!=='OK'){ /* opcional: relock */ } } catch(_) {}
        return;
      }

      if (within(saved.t, SESSION_MAX_HOURS)) {
        const loading=document.getElementById('loading-msg');
        loading.textContent='Checking saved login...'; loading.style.display='block';
        try{
          const r=await gasAuth(saved.u, saved.p, page, VALIDATE_TIMEOUTMS);
          loading.style.display='none';
          if(r==='OK'){ unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); }
        }catch(_){
          // timeout: libera e registra em background
          loading.style.display='none';
          unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); logWithImage(saved.u, saved.p, page);
        }
      }
    });

    /***** Login manual *****/
    async function validateLogin(rememberOverride){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      const cb=document.getElementById('remember-me');
      const remember = (rememberOverride!==undefined) ? rememberOverride : (cb? cb.checked : true);

      const err=document.getElementById('login-error');
      const load=document.getElementById('loading-msg');
      err.textContent='';
      load.textContent='Authenticating your credentials. This may take a few seconds...';
      load.style.display='block';
      setAuthLoading(true);

      const page=location.pathname;
      try{
        const r=await gasAuth(u,p,page,VALIDATE_TIMEOUTMS);
        load.style.display='none';
        if (r==='OK'){ saveRemember(u,p,remember); unlockAs(u); onLoginSuccess(u); }
        else if (r==='FAIL'){ err.textContent='Invalid username or password.'; }
        else { err.textContent='Missing credentials.'; }
      }catch(_){
        load.style.display='none'; err.textContent='Network error. Please try again.';
      }finally{
        if (document.getElementById('login-form').style.display !== 'none') {
          setAuthLoading(false);
        }
      }
    }

    // Auto preenche (se j√° houver credenciais lembradas)
    document.addEventListener('DOMContentLoaded', ()=>{
      try{
        const u=localStorage.getItem('fs_user'); const p=localStorage.getItem('fs_pass');
        if(u){ document.getElementById('username').value=u; }
        if(p && REMEMBER_PASSWORD){ document.getElementById('password').value=p; }
        const cb=document.getElementById('remember-me'); if(cb) cb.checked=true;
      }catch(_){}
    });

    /* Auto-wrap robusto ‚Äî apenas para p√°ginas N√ÉO-Reveal */
    document.addEventListener('DOMContentLoaded', () => {
      try {
        if (document.querySelector('.reveal') || document.body.classList.contains('reveal-page')) return;

        const wrapper = document.getElementById('after-login-content');
        if (!wrapper) return;

        const root = wrapper.parentElement || document.body;
        const loginForm  = document.getElementById('login-form');
        const loginScrim = document.getElementById('login-scrim');

        const isKeep = (el) =>
          el === wrapper || el === loginForm || el === loginScrim ||
          el.tagName === 'SCRIPT' || el.tagName === 'STYLE' || el.tagName === 'LINK';

        Array.from(root.children).forEach(el => {
          if (!isKeep(el) && !wrapper.contains(el)) {
            wrapper.appendChild(el);
          }
        });
      } catch (e) {
        console.warn('auto-wrap (non-reveal) warn:', e);
      }
    });
  </script>


  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#b1cafa" class="quarto-title-block center">
  <h1 class="title">Estrat√©gia Financeira</h1>
  <p class="subtitle"><strong>Part 6 - ch.24 Debt Financing</strong></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<strong>Henrique C. Martins</strong> 
</div>
        <p class="quarto-title-affiliation">
            <strong><a href="https://eaesp.fgv.br/en"><img data-src="../figs/background6.png" style="box-shadow: none;" width="300"></a></strong>
          </p>
    </div>
</div>

  <p class="date">16-08-2025</p>
</section>
<section>

<section id="section" class="slide level2" data-background="#A91B0D">
<h2></h2>
<div title="‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>‚ö†Ô∏è Disclaimer ‚Äì Virtual HCM Responses</strong></p>
</div>
<div class="callout-content">
<p>The <strong>Virtual HCM</strong> is powered by <strong>AI</strong> to assist you with course materials.<br>
While it is trained on the course‚Äôs content, <strong>it may occasionally</strong>:</p>
<ul>
<li>Misinterpret the question or context.<br>
</li>
<li>Generate <strong>inaccurate or incomplete</strong> information.<br>
</li>
<li>Provide answers <strong>not explicitly included</strong> in the materials.</li>
</ul>
<p><strong>Your responsibility:</strong><br>
Always cross-check the answers with the book, slides, readings, and feedback provided in the course. In case you are not sure, ask the instructor.</p>
<p>üí° <em>Use Virtual HCM as a <strong>learning aid</strong>, not as the sole source of truth.</em></p>
</div>
</div>
</div>
</div>
<div class="quarto-auto-generated-content">
<p><img src="../figs/background8.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><span style="font-size:10px"> [<a href="mailto:henrique.martins@fgv.br">Henrique C. Martins</a>] [<a href="https://henriquemartins.net/teaching/financial_strategy/">Teaching Resources</a>]<strong>[Do not use without permission]</strong></span></p>
</div>
</div></section>
<section id="section-1" class="slide level2" data-background-image="../figs/cha24.png" data-background-size="1300px">
<h2></h2>
</section>
<section id="chapter-outline" class="slide level2" style="color: #000;">
<h2>Chapter Outline</h2>
<p>24.1 Corporate Debt</p>
<p>24.2 Other Types of Debt</p>
<p>24.3 Bond Covenants</p>
<p>24.4 Repayment Provisions</p>
</section></section>
<section>
<section id="corporate-debt" class="title-slide slide level1 smaller center" data-background="#f1f2c9">
<h1>24.1 Corporate Debt</h1>

</section>
<section id="corporate-debt-1" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Public debt</strong></p>
<p><strong>The Prospectus</strong>: A public bond issue is similar to a stock issue.</p>
<ul>
<li><strong>Indenture</strong>
<ul>
<li>Included in a prospectus, it is a formal contract between a bond issuer and a <strong>trust company</strong>.</li>
<li>The <strong>trust company</strong> represents the bondholders and makes sure that the terms of the indenture are enforced.</li>
<li>In the case of default, the <strong>trust company</strong> represents the interests of the bond holders.</li>
</ul></li>
</ul>
</section>
<section id="section-2" class="slide level2 smaller" data-background="#f1f2c9">
<h2></h2>
<center>
<img data-src="../figs/bm_24_hertz.jpg">
</center>
</section>
<section id="corporate-debt-2" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Public debt</strong></p>
<ul>
<li>Corporate bonds <strong>almost always pay coupons semiannually</strong>, although a few corporations have issued zero-coupon bonds.</li>
<li>Most corporate bonds have maturities of a few years.</li>
<li>The face value or principal amount of a bond is denominated most often as $1000.
<ul>
<li>The face value does not always correspond to the actual money raised because of <strong>underwriting fees</strong> and/or if the bond is issued at a <strong>discount</strong>.</li>
</ul></li>
<li><strong>Original Issue Discount Bond (OID)</strong>
<ul>
<li>Describes a bond that is issued at a discount</li>
</ul></li>
</ul>
</section>
<section id="corporate-debt-3" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Registered Bonds</strong></p>
<ul>
<li>The issuer of this type of bond maintains a list of all holders of its bonds.</li>
<li>Bonds are registered at CVM &amp; SEC for listed companies.</li>
<li>Private companies do not issue bonds usualy.</li>
<li>Coupon and principal payments are made only to people on this list.</li>
<li>Almost all bonds today are registered bonds.</li>
</ul>
<p><strong>Bearer Bonds</strong>:</p>
<ul>
<li>Similar to currency: whoever physically holds the bond certificate owns the bond.</li>
<li>To receive a coupon payment, the holder of a bearer bond must provide explicit proof of ownership by literally clipping a coupon off the bond certificate and remitting it to the paying agent.</li>
<li>It used to be literally a piece of paper.</li>
</ul>
</section>
<section id="corporate-debt-4" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<center>
<img data-src="../figs/cupons.jpg">
</center>
</section>
<section id="corporate-debt-5" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Unsecured Debt</strong>: A type of corporate debt that, in the event of bankruptcy, gives bondholders a claim to only the assets of the firm that are not already pledged as collateral on other debt.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Notes</strong>: Notes typically are coupon bonds with maturities shorter than 10 years.</li>
<li><strong>Debentures</strong>: Debentures typically have longer maturities than notes.</li>
</ul>
<div class="fragment">
<p><strong>Secured Debt</strong>: A type of corporate debt in which specific assets are pledged as collateral.</p>
<ul>
<li><strong>Mortgage Bonds</strong>: Real property is pledged as collateral that bondholders have a direct claim to in the event of bankruptcy. They are paid with the cash flow source generated by the asset.</li>
<li><strong>Asset-Backed Bonds (ABS)</strong>: Specific assets are pledged as collateral that bondholders have a direct claim to in case of bankruptcy. Can be any kind of asset.</li>
</ul>
</div>
</section>

<section id="corporate-debt-7" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Tranches</strong>: Different classes of securities that comprise a single bond issue.</p>

<img data-src="../figs/bm_24_2.png" class="r-stretch"><p>Issue price: par (it means that the bond has been issued at face value).</p>
</section>
<section id="corporate-debt-8" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Seniority</strong></p>
<ul>
<li>A bondholder‚Äôs priority in claiming assets not already securing other debt.</li>
<li>Most debenture issues contain covenants restricting the company from issuing new debt with equal or higher priority than existing debt.</li>
</ul>
<div class="fragment">
<p><strong>Subordinated Debentures</strong>: Debt that, in the event of a default, has a <strong>lower</strong> priority claim to the firm‚Äôs assets than other outstanding debt.</p>
<p><strong>Senior Debentures</strong>: Debt that, in the event of a default, has a <strong>higher</strong> priority claim to the firm‚Äôs assets than other outstanding debt.</p>
</div>
</section>
<section id="corporate-debt-9" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Bond Markets</strong> &amp; <strong>International Bonds</strong></p>
<p><strong>Domestic Bonds</strong>: Bonds issued by a local entity and traded in a local market, but purchased by foreigners. They are denominated in the local currency.</p>
<p><strong>Foreign Bonds</strong>: Bonds issued by a foreign company in a local market and intended for local investors. They are denominated in the local currency.</p>
<ul>
<li><strong>Yankee Bonds</strong>: Foreign bonds in the United States</li>
<li><strong>Samurai Bonds</strong>: Foreign bonds in Japan</li>
<li><strong>Bulldogs</strong>: Foreign bonds in the United Kingdom</li>
<li><strong>Eurobonds</strong>: International bonds that are <strong>not denominated in the local currency of the country in which they are issued</strong>. <em>The trading is not subject to any particular nation‚Äôs regulation</em>.</li>
<li><strong>Global Bonds</strong>: Bonds that are offered for sale in several different markets simultaneously. Global bonds can be offered for sale in the same currency as the country of issuance (unlike Eurobonds).</li>
</ul>
</section>
<section id="corporate-debt-10" class="slide level2 smaller" data-background="#f1f2c9">
<h2>24.1 Corporate Debt</h2>
<p><strong>Private Debt</strong>: Debt that is not publicly traded. Has the advantage that it avoids the cost of registration but has the disadvantage of being illiquid.</p>
<div class="fragment">
<p><strong>Loans</strong>: A bank loan that lasts for a specific term.</p>
<ul>
<li><strong>Syndicated Bank Loan</strong>: A single loan that is funded by a group of banks rather than just a single bank.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><strong>Line of Credit</strong>: A credit commitment for a specific time period, typically two to three years, which a company can use as needed.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><strong>Private Placements</strong>: A bond issue that is sold to a small group of investors rather than the general public.
<ul>
<li>Because a private placement does not need to be registered, it is less costly to issue than public debt.</li>
</ul></li>
</ul>
</div>
</section></section>
<section>
<section id="other-types-of-debt" class="title-slide slide level1 smaller center" data-background="#FFD6A4">
<h1>24.2 Other Types of Debt</h1>

</section>
<section id="other-types-of-debt-1" class="slide level2 smaller" data-background="#FFD6A4">
<h2>24.2 Other Types of Debt</h2>
<p><strong>Sovereign Debt</strong>: Debt issued by national governments. U.S. Treasury securities represents the single largest sector of the U.S. bond market. The same is true un Brazil.</p>
<div class="fragment">
<p><img data-src="../figs/bm_24_3.png"></p>
<p>Treasury-Inflation-Protected Securities are called <strong>TIPS</strong>.</p>
</div>
</section>
<section id="section-3" class="slide level2 smaller" data-background="#FFD6A4">
<h2></h2>
<center>
<img data-src="../figs/td1.png">
</center>
</section>
<section id="section-4" class="slide level2 smaller" data-background="#FFD6A4">
<h2></h2>
<center>
<img data-src="../figs/td2.png">
</center>
</section>

<section id="other-types-of-debt-3" class="slide level2 smaller" data-background="#FFD6A4">
<h2>24.2 Other Types of Debt</h2>
<p><strong>Municipal Bonds (Munis)</strong></p>
<ul>
<li>Bonds issued by state and local governments.</li>
<li>They are not taxable at the federal level (and sometimes at the state and local level as well).</li>
<li>Sometimes referred to as tax-exempt bonds.</li>
<li>Not common in Brazil.</li>
</ul>
</section>
<section id="other-types-of-debt-4" class="slide level2 smaller" data-background="#FFD6A4">
<h2>24.2 Other Types of Debt</h2>
<p><strong>Asset-Backed Securities (ABS)</strong></p>
<ul>
<li>Securities made up of other financial securities. Security‚Äôs cash flows come from the cash flows of the underlying financial securities that ‚Äúback‚Äù it.</li>
</ul>
<p><strong>Asset Securitization</strong>: The process of creating an asset-backed security.</p>
<p><strong>Mortgage-Backed Security</strong>: Largest ABS market. Backed by home mortgages. Often they are guaranteed against default risk by the U.S. government.</p>
<ul>
<li>When homeowners in the underlying mortgages make their mortgage payments, this cash goes (minus servicing fees) to the holders of the mortgage-backed security, e.g., usually banks.</li>
</ul>
</section>
</section>
<section>
<section id="bond-covenants" class="title-slide slide level1 smaller center" data-background="#ead1dc">
<h1>24.3 Bond Covenants</h1>

</section>
<section id="bond-covenants-1" class="slide level2 smaller" data-background="#ead1dc">
<h2>24.3 Bond Covenants</h2>
<p><strong>Restrictive clauses in a bond contract that limit the issuers from undercutting their ability to repay the bonds</strong>.</p>
<p>For example, covenants may:</p>
<ul>
<li>Restrict the ability of management to pay dividends</li>
<li>Restrict the level of further indebtedness</li>
<li>Specify that the issuer must maintain a minimum amount of working capital</li>
</ul>
<div class="fragment">
<p>There are: positive and negative covenants</p>
<ul>
<li><p><strong>Positive</strong>: the firm must do something (keep specific financial ratios, pay taxes and other obligations, etc)</p></li>
<li><p><strong>Negative</strong>: the firm must not do something (sell specific assets, pay too much dividend, etc)</p></li>
</ul>
<p>Covenants are a common feature of bonds.</p>
</div>
</section></section>
<section>
<section id="repayment-provisions" class="title-slide slide level1 smaller center" data-background="#eeffff">
<h1>24.4 Repayment Provisions</h1>

</section>
<section id="repayment-provisions-1" class="slide level2 smaller" data-background="#eeffff">
<h2>24.4 Repayment Provisions</h2>
<p>A bond issuer typically <strong>repays its bonds by making coupon and principal payments</strong> as specified in the bond contract. <strong>However</strong>, the issuer can:</p>
<ul>
<li>Repurchase a fraction of the outstanding bonds in the market.</li>
<li>Make a tender offer for the entire issue.</li>
<li>Exercise a call provision.</li>
</ul>
<div class="fragment">
<p><strong>Callable Bonds</strong>: Bonds that contain a call provision that allows the issuer to repurchase the bonds at a predetermined price.</p>
<p><strong>Call provisions</strong>: Allows the issuer of the bond the right (not obligation) to retire all outstanding bonds on (or after) a specific date, for the call price. The call price is generally set at or above, and expressed as a % of face value (e.g..102% of face value).</p>
</div>
<div class="fragment">
<ul>
<li>A firm may choose to call a bond issue if interest rates have fallen.</li>
<li>The issuer can lower its borrowing costs by exercising the call on the callable bond and then immediately refinancing the issue at a lower rate.</li>
</ul>
</div>
</section>
<section id="repayment-provisions-2" class="slide level2 smaller" data-background="#eeffff">
<h2>24.4 Repayment Provisions</h2>
<p><strong>Callable Bonds</strong></p>
<ul>
<li>Holders of callable bonds understand that the issuer will exercise the call option only when the coupon rate of the bond exceeds the prevailing market rate.</li>
<li>If a bond is called, investors must reinvest the proceeds when market rates are lower than the coupon rate they are currently receiving.</li>
<li>This makes callable bonds relatively less attractive to bondholders than identical non-callable bonds.</li>
<li>A callable bond will trade at a lower price (and therefore a higher yield) than an otherwise equivalent non-callable bond.</li>
</ul>
</section>
<section id="repayment-provisions-3" class="slide level2 smaller" data-background="#eeffff">
<h2>24.4 Repayment Provisions</h2>
<p><strong>Sinking Fund</strong></p>
<ul>
<li><p>A method of repaying a bond in which a company makes regular payments into a fund administered by a trustee over the life of the bond.</p></li>
<li><p>These payments are then used to repurchase bonds.</p></li>
<li><p>This allows the firm to retire some of the outstanding debt without affecting the cash flows of the remaining bonds.</p></li>
<li><p>The trust can either repurchase the bonds in the market (if the price is below the face value) or by lottery at the par (if the price is above face value).</p></li>
</ul>
</section>
<section id="repayment-provisions-4" class="slide level2 smaller" data-background="#eeffff">
<h2>24.4 Repayment Provisions</h2>
<p><strong>Convertible Bond</strong>: A corporate bond with a provision that gives the bondholder an option to convert each bond owned into a fixed number of shares of common stock.</p>
<p><strong>Conversion Ratio</strong>: The number of shares received upon conversion of a convertible bond, usually stated per $1000 of face value.</p>
<p><strong>Conversion Price</strong>: The face value of a convertible bond divided by the number of shares received if the bond is converted.</p>
<ul>
<li>Assume a convertible bond with a $1000 face value and a conversion ratio of 15.</li>
<li>If you convert the bond into stock, you will receive 15 shares.</li>
<li>If you do not convert, you will receive 1000.</li>
<li>By converting you essentially ‚Äúpay‚Äù 1000 for 15 shares, implying a price per share of 66.67.</li>
<li>If the price of the stock exceeds 66.67, you will choose to convert; otherwise, you will take the cash.</li>
</ul>
</section></section>
<section>
<section id="ratings" class="title-slide slide level1 smaller center" data-background="#96ffa8">
<h1>Ratings</h1>

</section>
<section id="ratings-1" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings</h2>
<p>A credit rating is an <strong>opinion of the general creditworthiness of either an issuer or one of the specific issues made by the issuer.</strong></p>
<p>These <em>opinions</em> represent the default risk of a security.</p>
<p>There are many factors that affect a credit rating.</p>
<ul>
<li>Industry-level factors</li>
<li>Firm-level factors</li>
<li>Security-level factors</li>
<li>Firm‚Äôs financial analysis and quality</li>
<li>Etc.</li>
</ul>
</section>
<section id="ratings-2" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings</h2>
<p>Ratings are constructed to represent the risk of default.</p>
<ul>
<li>A high (low) rating implies a low (high) probability of default.</li>
<li>Default refers to any event that results in the issuer‚Äôs breaching its financial contract.
<ul>
<li><strong>Minor default:</strong> failing to meet a contracted financial ratio.</li>
<li><strong>Serious default:</strong> failure to make an interest or principal payment.</li>
</ul></li>
</ul>
</section>
<section id="ratings-3" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings</h2>
<p><strong>Three main players:</strong></p>
<ul>
<li>Moody‚Äôs</li>
<li>Standard &amp; Poor‚Äôs</li>
<li>Fitch</li>
</ul>
<p>They make money:</p>
<ul>
<li>‚ÄúSelling‚Äù a rating:</li>
<li>Selling softwares to access information.</li>
</ul>
<p><strong>There is an idea that <em>‚Äúnot having a rating is worse than having poor rating‚Äù</em>.</strong></p>
<ul>
<li><p>Do you agree?</p></li>
<li><p>Short video: <a href="https://www.youtube.com/watch?v=9xZx1lf2tvs">The Big Short</a>.</p></li>
</ul>
</section>
<section id="section-6" class="slide level2 smaller" data-background="#96ffa8">
<h2></h2>
<center>
<img data-src="../figs/ratings_theeconomist.png">
</center>
</section>
<section id="ratings-4" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings</h2>

<img data-src="../figs/ratings.png" class="r-stretch"><p>Investment grad ~= Speculative grade ~= Default.</p>
</section>
<section id="ratings-link" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings <a href="https://www.spglobal.com/ratings/en/research/articles/200625-credit-trends-global-corporate-debt-market-state-of-play-in-2020-11546901">Link</a></h2>

<img data-src="../figs/ratings_dist.png" class="r-stretch"></section>
<section id="ratings-5" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings</h2>
<center>
<img data-src="../figs/Default_rates.png">
</center>
</section>
<section id="ratings-and-the-cost-of-capital" class="slide level2 smaller" data-background="#96ffa8">
<h2>Ratings and the cost of capital</h2>
<center>
<img data-src="../figs/Spreads.png">
</center>
</section>
<section id="the-rating-process" class="slide level2 smaller" data-background="#96ffa8">
<h2>The Rating process</h2>
<ul>
<li>Rating agency meets with company management (CFO &amp; CEO).</li>
<li>A team of analysts is assigned to the transaction to review the offering documents, financial statements, the terms of the proposed offering, use of proceeds, historical and pro forma financial analysis, competitive analysis, capital-expenditure plans, etc.</li>
<li>A recommendation is made to an internal rating committee that votes on the proposed rating.</li>
<li>The company is notified and allowed to respond before the rating is released to the media. The company has the opportunity to appeal and present additional data supporting a higher rating.</li>
<li>A rating is often assigned within two weeks.</li>
<li>After the final rating is assigned, analysts track the company‚Äôs performance and adjusts the rating over time.</li>
<li>The rating agency typically conducts formal quarterly reviews and meets with management at least once annually.</li>
</ul>
</section></section>
<section>
<section id="now-it-is-your-turn" class="title-slide slide level1 smaller center" data-background="#191f36">
<h1>Now it is your turn‚Ä¶</h1>
<div class="footer">

</div>
<div class="footer">

</div>
</section>
<section id="any-questions" class="slide level2" data-background="#b1cafa">
<h2>üôã‚Äç‚ôÇÔ∏è <strong>Any Questions?</strong></h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="thank-you">Thank You!</h3>
<p><img data-src="../figs/qa2.png" style="box-shadow: none;;width:110.0%"></p>
</div><div class="column" style="width:50%;">
<h3 id="henrique-c.-martins">üë§ <strong>Henrique C. Martins</strong></h3>
<ul>
<li>üåê <a href="https://eaesp.fgv.br/en/people/henrique-castro-martins">FGV/EAESP</a><br>
</li>
<li>üíº <a href="https://www.linkedin.com/in/henriquecastror/">LinkedIn</a><br>
</li>
<li>üß† <a href="https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&amp;hl=pt-BR&amp;oi=ao">Google Scholar</a><br>
</li>
<li>üìÑ <a href="http://lattes.cnpq.br/6076997472159785">Lattes CV</a><br>
</li>
<li>üè† <a href="https://henriquemartins.net/">Personal Website</a><br>
</li>
</ul>
</div>
</div>
</section>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <!-- chat-widget-deluxe.html : Floating chat for all slides (Quarto + revealjs) -->
    <style>
      :root{
        /* Fundo geral claro e elegante */
        --bg: rgba(255,255,255,.88);
        --border: rgba(15,23,42,.12);
        --shadow: 0 12px 40px rgba(20,20,40,.18);

        --brand1: #4f46e5; /* indigo */
        --brand2: #06b6d4; /* cyan */
        --brand-weak: rgba(79,70,229,.10);

        --text: #0f172a;
        --muted: #475569;
        --danger: #b91c1c;

        --bubble-user: #ffffff;
        --bubble-ai:   #fbfdff;
      }
      @media (prefers-color-scheme: dark){
        :root{
          --bg: rgba(19,26,42,.72);
          --border: rgba(255,255,255,.10);
          --shadow: 0 18px 50px rgba(0,0,0,.55);
          --text: #e6e9ef;
          --muted: #b6bfca;
          --brand-weak: rgba(79,70,229,.20);

          --bubble-user: rgba(255,255,255,.08);
          --bubble-ai:   rgba(255,255,255,.06);
        }
      }

      .vhcm-panel, .vhcm-input textarea, .vhcm-bubble {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: "liga" 1, "kern" 1;
      }

      /* FAB button */
      .vhcm-fab{position:fixed; right:18px; bottom:18px; z-index:9999; display:flex; align-items:center; gap:10px}
      .vhcm-fab button{border:none; border-radius:16px; padding:12px 14px; cursor:pointer; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; box-shadow:var(--shadow); display:flex; align-items:center; gap:10px; font-weight:600}
      .vhcm-fab svg{width:20px; height:20px}

      /* Panel (redimension√°vel) */
      .vhcm-panel{
        position:fixed; right:18px; bottom:78px;
        width:325px; height:600px;
        min-width:280px; min-height:360px;
        max-width:94vw; max-height:84vh;

        display:none; flex-direction:column; border:1px solid var(--border);
        border-radius:18px; box-shadow:var(--shadow); overflow:hidden; z-index:9999;
        backdrop-filter: blur(16px) saturate(140%); -webkit-backdrop-filter: blur(16px) saturate(140%);
        background: var(--bg); animation:vslide .25s ease-out;

        /* permite redimensionar pelo canto inferior direito */
        resize: both;
      }
      @keyframes vslide{from{transform: translateY(8px); opacity:0} to{transform:none; opacity:1}}

      .vhcm-header{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border); background:linear-gradient(135deg, rgba(79,70,229,.10), rgba(6,182,212,.08));}
      .vhcm-brand{display:flex; align-items:center; gap:10px}
      .vhcm-logo{width:28px; height:28px; border-radius:10px; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; box-shadow:0 4px 16px var(--brand-weak)}
      .vhcm-title{font-weight:700; letter-spacing:.2px; color:var(--text)}
      .vhcm-status{display:flex; align-items:center; gap:6px; color:var(--muted); font-size:12px}
      .vhcm-dot{width:8px; height:8px; border-radius:50%; background:#22c55e; box-shadow:0 0 0 2px rgba(34,197,94,.25)}
      .vhcm-close{border:none; background:transparent; font-size:18px; cursor:pointer; color:var(--muted)}

      /* Bot√£o meia tela */
      .vhcm-half{
        border:none; background:transparent; cursor:pointer;
        font-size:16px; color:var(--muted); margin-right:6px;
      }
      .vhcm-half:hover{ color: var(--text); }

      /* Painel em meia tela (50vw x 50vh) */
      .vhcm-panel.vhcm--half{
        width: 50vw !important;
        height: 50vh !important;
        max-width: 95vw;
        max-height: 95vh;
        border-radius: 12px;
      }

      .vhcm-body{flex:1; overflow:auto; padding:14px; background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0));}
      .vhcm-typing{font-size:12px; color:var(--muted); display:none; padding:6px 2px}
      .vhcm-dots{display:inline-flex; gap:3px; margin-left:4px}
      .vhcm-dots span{width:6px; height:6px; border-radius:50%; background:var(--muted); opacity:.6; animation:blink 1.2s infinite}
      .vhcm-dots span:nth-child(2){animation-delay:.2s}
      .vhcm-dots span:nth-child(3){animation-delay:.4s}
      @keyframes blink{0%,80%,100%{opacity:.2; transform:translateY(0)} 40%{opacity:.9; transform:translateY(-2px)}}

      .vhcm-input{
        display:flex; align-items:flex-end; gap:8px; padding:12px;
        border-top:1px solid var(--border);
        background:linear-gradient(180deg, rgba(255,255,255,.40), rgba(255,255,255,.20));
      }
      .vhcm-input textarea{
        flex:1;
        resize:none;
        min-height:44px;
        max-height:140px;
        padding:12px 14px;
        border:1px solid var(--border);
        border-radius:14px;
        background:#ffffff;
        color:#0f172a;
        font: 500 14px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        caret-color: var(--brand1);
        box-shadow: 0 1px 0 rgba(0,0,0,.02) inset;
      }
      .vhcm-input textarea::placeholder{ color:#475569; }

      .vhcm-send{background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:600}
      .vhcm-send svg{width:18px; height:18px}

      .vhcm-msg{display:flex; gap:10px; margin-bottom:12px; align-items:flex-end}
      .vhcm-avatar{width:28px; height:28px; border-radius:10px; background:var(--brand-weak); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; color:var(--text)}
      .vhcm-bubble{
        max-width:78%; padding:12px 14px; border-radius:14px; border:1px solid var(--border);
        box-shadow: 0 6px 18px rgba(0,0,0,.06);
        line-height:1.48; font-weight:500;
      }
      .vhcm-msg.user{justify-content:flex-end}
      .vhcm-msg.user .vhcm-bubble{
        background: var(--bubble-user);
        color: var(--text);
        border-color: rgba(15,23,42,.10);
      }
      .vhcm-msg.user .vhcm-avatar{display:none}
      .vhcm-msg.ai .vhcm-bubble{
        background: var(--bubble-ai);
        color: var(--text);
        border-color: rgba(15,23,42,.10);
      }

      .vhcm-error{color:var(--danger); font-size:12px; margin:6px 2px}
    </style>

    <div class="vhcm-fab">
      <button id="vhcm-open" title="Virtual HCM">
        <svg viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c4.97 0 9-3.582 9-8 0-1.93-.71-3.706-1.92-5.126l.86-3.006-3.01.847C15.87 5.6 14 5 12 5 7.03 5 3 8.582 3 13s4.03 9 9 9Z" stroke="currentColor" stroke-width="1.2"></path></svg>
        Virtual HCM
      </button>
    </div>

    <div class="vhcm-panel" id="vhcm-panel" role="dialog" aria-label="Virtual HCM chat">
      <div class="vhcm-header">
        <div class="vhcm-brand">
          <div class="vhcm-logo">VH</div>
          <div>
            <div class="vhcm-title">Virtual HCM</div>
            <div class="vhcm-status"><span class="vhcm-dot"></span><span id="vhcm-module-label">module1</span></div>
          </div>
        </div>
        <div>
          <button id="vhcm-half" class="vhcm-half" aria-label="Half screen" title="Half screen">‚§¢</button>
          <button id="vhcm-close" class="vhcm-close" aria-label="Close">‚úï</button>
        </div>
      </div>
      <div class="vhcm-body" id="vhcm-body"></div>
      <div class="vhcm-typing" id="vhcm-typing">Virtual HCM is typing <span class="vhcm-dots"><span></span><span></span><span></span></span></div>
      <div class="vhcm-input">
        <textarea id="vhcm-text" placeholder="Ask anything about this module‚Ä¶"></textarea>
        <button class="vhcm-send" id="vhcm-send" title="Send">
          <svg viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 11l17-8-8 17-1-7-8-2Z" stroke="#fff" stroke-width="1.6"></path></svg>
          Send
        </button>
      </div>
    </div>

    <script>
    (function(){
      // ====== CONFIG ======
      const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbza4kInsudyRFK_62VL8eULh3TiF_zMdleq4N0OpX4QunuU2rEryBnbE4S9zDHQkvB_/exec"; // troque se necess√°rio
      const DEFAULT_MODULE = "module1";
      const STORAGE_OPEN   = "vhcm_open";
      const STORAGE_SIZE   = "vhcm_size";
      const STORAGE_HALF   = "vhcm_half_mode";
      const STORAGE_SIZE_PREV = "vhcm_size_prev";

      // ====== Elements ======
      const btnOpen = document.getElementById('vhcm-open');
      const btnClose = document.getElementById('vhcm-close');
      const btnHalf = document.getElementById('vhcm-half');
      const panel = document.getElementById('vhcm-panel');
      const body = document.getElementById('vhcm-body');
      const typing = document.getElementById('vhcm-typing');
      const text = document.getElementById('vhcm-text');
      const send = document.getElementById('vhcm-send');
      const moduleLabel = document.getElementById('vhcm-module-label');

      // ====== Module detection (robusta, sem quebrar compatibilidade) ======
      function detectModule(){
        try {
          // 1) Override expl√≠cito via window.VHCM.module
          if (window.VHCM && window.VHCM.module) {
            const v = String(window.VHCM.module).trim();
            if (v) return v;
          }
          // 2) Reveal slide atual com data-module
          if (window.Reveal && typeof Reveal.getCurrentSlide === 'function') {
            const s = Reveal.getCurrentSlide && Reveal.getCurrentSlide();
            const v = (s && (s.dataset.module || s.getAttribute('data-module'))) || '';
            if (v && String(v).trim()) return String(v).trim();
          }
          // 3) <meta name="vhcm-module" content="moduleX">
          const meta = document.querySelector('meta[name="vhcm-module"]');
          if (meta && meta.content && meta.content.trim()) return meta.content.trim();
          // 4) atributo data-module no <body>
          const dm = document.body && document.body.getAttribute && document.body.getAttribute('data-module');
          if (dm && dm.trim()) return dm.trim();
          // 5) querystring ?module=moduleX
          const qs = new URLSearchParams(location.search).get('module');
          if (qs && qs.trim()) return qs.trim();
          // 6) regex no caminho (module2, m2, p2.html)
          const path = (location.pathname || '').toLowerCase();
          let m = path.match(/module(\d+)/); if (m) return `module${m[1]}`;
          m = path.match(/\/m(\d+)\b/);     if (m) return `module${m[1]}`;
          m = path.match(/\/p(\d+)\.html/); if (m) return `module${m[1]}`;
          // 7) compat: window.CURRENT_MODULE (caso voc√™ j√° defina em algum lugar)
          if (window.CURRENT_MODULE) return String(window.CURRENT_MODULE).trim();
        } catch(_){}
        // 8) fallback
        return DEFAULT_MODULE;
      }

      // ====== Helpers ======
      // (√öNICA MUDAN√áA) ‚Üí pega o aluno logado do localStorage, priorizando o ID salvo no login
      function getStudent(){
        try{
          const u = (localStorage.getItem('fs_user')
                  || localStorage.getItem('studentId')
                  || localStorage.getItem('studentName')
                  || 'Anonimo').trim();
          return u || 'Anonimo';
        }catch(_){
          return 'Anonimo';
        }
      }
      function currentModule(){ return detectModule(); }

      function bubble(author, textHtml, isUser=false){
        const wrap = document.createElement('div');
        wrap.className = 'vhcm-msg' + (isUser ? ' user' : ' ai');
        const avatar = document.createElement('div');
        avatar.className = 'vhcm-avatar';
        avatar.textContent = isUser ? 'You' : 'VH';
        const bub = document.createElement('div');
        bub.className = 'vhcm-bubble';
        bub.innerHTML = String(textHtml || '').replace(/\n/g,'<br>');
        if (isUser){ wrap.appendChild(bub); wrap.appendChild(avatar); }
        else { wrap.appendChild(avatar); wrap.appendChild(bub); }
        body.appendChild(wrap); body.scrollTop = body.scrollHeight;
      }
      function setOpen(open){ panel.style.display = open ? 'flex' : 'none'; localStorage.setItem(STORAGE_OPEN, open ? '1' : '0'); }

      // ====== Restaurar tamanho salvo ======
      (function restoreSize(){
        try{
          const saved = JSON.parse(localStorage.getItem(STORAGE_SIZE) || 'null');
          if (saved?.w && saved?.h) {
            panel.style.width = saved.w;
            panel.style.height = saved.h;
          }
        }catch(_){}
      })();

      // ====== Observar e salvar mudan√ßas de tamanho ======
      (function watchSize(){
        if (!('ResizeObserver' in window)) return;
        const ro = new ResizeObserver(entries => {
          for (const e of entries) {
            const { width, height } = e.contentRect || {};
            if (!width || !height) continue;
            localStorage.setItem(STORAGE_SIZE, JSON.stringify({
              w: Math.round(width) + 'px',
              h: Math.round(height) + 'px'
            }));
          }
        });
        ro.observe(panel);
      })();

      // ====== Open/Close & persist state ======
      btnOpen.addEventListener('click', ()=> setOpen(panel.style.display !== 'flex'));
      btnClose.addEventListener('click', ()=> setOpen(false));
      if (localStorage.getItem(STORAGE_OPEN) === '1') setOpen(true);

      // ====== Module label sync ======
      function updateModuleLabel(){ moduleLabel.textContent = currentModule(); }
      updateModuleLabel();
      if (window.Reveal && typeof Reveal.on === 'function'){ Reveal.on('slidechanged', updateModuleLabel); }
      window.addEventListener('hashchange', updateModuleLabel); // caso mude via URL/anchor

      // ====== Meia tela (toggle) ======
      function readSize(){ try { return JSON.parse(localStorage.getItem(STORAGE_SIZE) || 'null'); } catch(_){ return null; } }
      function savePrevSize(){
        const rect = panel.getBoundingClientRect();
        localStorage.setItem(STORAGE_SIZE_PREV, JSON.stringify({
          w: Math.round(rect.width) + 'px',
          h: Math.round(rect.height) + 'px'
        }));
      }
      function readPrevSize(){ try { return JSON.parse(localStorage.getItem(STORAGE_SIZE_PREV) || 'null'); } catch(_){ return null; } }

      function setHalfMode(on){
        if (on){
          // guarda tamanho atual antes de mudar
          savePrevSize();
          panel.classList.add('vhcm--half');
          panel.style.width  = '50vw';
          panel.style.height = '50vh';
          localStorage.setItem(STORAGE_HALF, '1');
          btnHalf.title = 'Exit half screen';
        } else {
          panel.classList.remove('vhcm--half');
          localStorage.setItem(STORAGE_HALF, '0');
          btnHalf.title = 'Half screen';
          const prev = readPrevSize() || readSize();
          if (prev?.w && prev?.h){
            panel.style.width  = prev.w;
            panel.style.height = prev.h;
          } else {
            panel.style.width  = '';
            panel.style.height = '';
          }
        }
      }

      btnHalf.addEventListener('click', ()=>{
        const isOn = panel.classList.contains('vhcm--half');
        setHalfMode(!isOn);
      });

      // Restaurar modo meia tela se estava ativo
      if (localStorage.getItem(STORAGE_HALF) === '1') {
        setHalfMode(true);
      }

      // ====== Send logic ======
      async function sendQuestion(){
        const q = text.value.trim(); if (!q) return;
        const mod = currentModule(); updateModuleLabel();
        bubble('You', q, true); text.value=''; typing.style.display='block';
        try{
          const resp = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            // sem headers pra evitar preflight; servidor j√° aceita JSON puro
            body: JSON.stringify({ question: q, student: getStudent(), module: mod })
          });
          const raw = await resp.text();
          let data = {}; try { data = JSON.parse(raw); } catch(_){ data = { answer: 'Server returned an invalid response.' }; }
          typing.style.display='none';
          bubble('Virtual HCM', data.answer || 'No answer received.', false);
        } catch(e){
          typing.style.display='none';
          bubble('Error', 'Could not contact the server.', false);
        }
      }

      send.addEventListener('click', sendQuestion);
      text.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendQuestion(); }
      });
    })();
    </script>
    <!-- rankings-widget.html : Bot√£o-√≠cone minimal + painel sofisticado -->
    <style>
      /* Esconde tudo que exigir auth enquanto a p√°gina estiver bloqueada pelo login-start */
      html.locked .requires-auth,
      body.locked .requires-auth { display: none !important; }

      :root{
        --chatbot-gap: 350px;

        /* meio-termo: mais escuro que o claro, mais claro que o grafite */
        --lb-bg: rgba(46, 58, 78, 0.72);         /* slate-700 ~ 72% */
        --lb-border: rgba(255,255,255,0.10);
        --lb-shadow: 0 18px 60px rgba(0,0,0,0.35), 0 2px 8px rgba(0,0,0,0.18);
        --lb-radius: 18px;

        /* acentos (lil√°s/azul) */
        --lb-accent: #a78bfa;                    /* lil√°s */
        --lb-accent-weak: rgba(167,139,250,0.18);

        /* degrad√™ do bot√£o, combinando com seu tema */
        --pill-start: #6d5df5;  /* violeta */
        --pill-end:   #2ec5ff;  /* azul-ciano */
      }

      .lb-panel{
        position: fixed;
        bottom: 20px;
        right: var(--chatbot-gap);
        z-index: 2147483647;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      }

      /* Bot√£o s√≥-√≠cone, circular (mesmo tom do chat/coment√°rios) */
      .lb-toggle{
        width: 40px; height: 40px; border-radius: 999px;
        display: inline-flex; align-items: center; justify-content: center;
        border: none;
        background: linear-gradient(135deg, var(--pill-start), var(--pill-end));
        color: white;           /* √≠cone branco */
        box-shadow: 0 10px 28px rgba(2,6,23,.30), inset 0 0 0 1px rgba(255,255,255,.14);
        cursor: pointer; user-select: none;
        transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      }
      .lb-toggle:hover{ transform: translateY(-1px); filter: brightness(1.05); }
      .lb-toggle:active{ transform: translateY(0); filter: brightness(.98); }
      .lb-icon{ font-size: 20px; line-height: 1; }

      /* Cart√£o do ranking (glass) */
      .lb-card{
        margin-top: 10px;
        width: 360px; max-height: 62vh; overflow: auto;
        border: 1px solid var(--lb-border); background: var(--lb-bg);
        -webkit-backdrop-filter: saturate(160%) blur(10px);
        backdrop-filter: saturate(160%) blur(10px);
        border-radius: var(--lb-radius);
        box-shadow: var(--lb-shadow);
        display: none;
        position: absolute; bottom: 52px; right: 0; /* abre acima do bot√£o */
        transform-origin: bottom right;
        color: #e5e7eb; /* texto claro */
      }
      .lb-card.open{ display:block; animation: lbPop .18s cubic-bezier(.2,.9,.2,1); }
      @keyframes lbPop { from { transform: scale(.98); opacity: 0 } to { transform: scale(1); opacity: 1 } }

      .lb-header{
        padding: 12px 14px;
        border-bottom: 1px solid rgba(255,255,255,.06);
        display:flex; justify-content:space-between; align-items:center;
        background: linear-gradient(180deg, rgba(167,139,250,.12), transparent 60%);
        border-top-left-radius: var(--lb-radius);
        border-top-right-radius: var(--lb-radius);
        position: sticky; top: 0; backdrop-filter: blur(6px);
      }
      .lb-title{
        font-weight: 800; letter-spacing:.2px; color:#f3f4f6;
      }
      .lb-refresh{
        font-size: 12px; color: #d1d5db; display:flex; align-items:center; gap: 6px;
      }
      .lb-dot{
        width:8px;height:8px;border-radius:999px;background:var(--lb-accent);
        box-shadow: 0 0 0 4px var(--lb-accent-weak);
      }

      .lb-list{ list-style:none; margin:0; padding: 6px 0 8px; }
      .lb-item{
        display:flex; align-items:center; justify-content:space-between;
        padding: 10px 14px;
        border-bottom: 1px dashed rgba(255,255,255,.06);
      }
      .lb-item:last-child{ border-bottom: 0; }

      .lb-left{ display:flex; align-items:center; gap:10px; min-width:0; }
      .lb-rank{
        width: 28px; text-align:right; font-variant-numeric: tabular-nums;
        color:#fde68a; font-weight:700; /* dourado p/ 1¬∫ */
      }
      .lb-item.top-2 .lb-rank{ color:#cbd5e1; } /* prata */
      .lb-item.top-3 .lb-rank{ color:#d8b4fe; } /* lil√°s */

      .lb-name{
        flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; color:#e5e7eb;
      }
      .lb-points{ font-variant-numeric: tabular-nums; font-weight:600; color:#f3f4f6; }

      .lb-footer{
        padding: 10px 14px;
        display:flex; justify-content:space-between; align-items:center; gap:8px;
        border-top: 1px solid rgba(255,255,255,.06);
        background: linear-gradient(0deg, rgba(167,139,250,.10), transparent 60%);
        border-bottom-left-radius: var(--lb-radius);
        border-bottom-right-radius: var(--lb-radius);
        position: sticky; bottom: 0; backdrop-filter: blur(6px);
      }
      .lb-badge-me{
        background: var(--lb-accent-weak);
        padding: 4px 8px; border-radius: 999px; font-size: 12px; font-weight:600;
        color: #f5f3ff;
      }

      /* Mobile: bottom sheet */
      @media (max-width: 820px){
        .lb-panel{ right: 12px; bottom: 88px; }
        .lb-card{
          position: fixed; left: 12px; right: 12px; bottom: 88px;
          width: auto; height: 58vh; max-height: none; transform-origin: bottom center;
        }
      }
      @media (max-width: 380px){
        .lb-card{ height: 62vh; }
      }
    </style>

    <!-- üîí Este wrapper esconde o widget at√© o login -->
    <div class="requires-auth">
      <div class="lb-panel" id="lbPanel">
        <button class="lb-toggle" id="lbToggle" title="Leaderboard" aria-label="Open leaderboard">
          <span class="lb-icon">üèÜ</span>
        </button>
        <div class="lb-card" id="lbCard" role="dialog" aria-modal="false" aria-label="Leaderboard">
          <div class="lb-header">
            <div class="lb-title">Top <span id="lbTopN">10</span></div>
            <div class="lb-refresh"><span class="lb-dot" aria-hidden="true"></span><span id="lbUpdated">Refresh ‚Äî</span></div>
          </div>

          <ul class="lb-list" id="lbList"></ul>

          <div class="lb-footer">
            <span id="lbMe"></span>
            <!-- (sem bot√µes de fechar/refresh) -->
          </div>
        </div>
      </div>
    </div>

    <script>
      /************ CONFIG ************/
      const LB_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxb3Z73DvsgGiGwK-jVp89jA5EGEYk24nbPNblQiNxFZPYvvDTvO-v4S4N_L-4YZ8KZfQ/exec';
      const LB_TOP = 10;
      const LB_POLL_MS = 3000;

      // student/module/page com fallback, mas permitindo atualizar ap√≥s login
      let LB_STUDENT = (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').toString();
      const LB_MODULE  = (window.moduleId   || '').toString() || 'module1';
      const LB_PAGE    = (window.pageId     || '').toString() || (location.pathname + location.hash);
      /********************************/

      const lbToggle  = document.getElementById('lbToggle');
      const lbCard    = document.getElementById('lbCard');
      const lbList    = document.getElementById('lbList');
      const lbTopNEl  = document.getElementById('lbTopN');
      const lbMeEl    = document.getElementById('lbMe');
      const lbUpdated = document.getElementById('lbUpdated');
      lbTopNEl.textContent = LB_TOP;

      // Se o login acontecer depois do load, atualiza student e faz refresh
      document.addEventListener('auth:login', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? ev.detail.studentId : (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '');
        if (sid) {
          LB_STUDENT = String(sid);
          // Se o card estiver aberto, recarrega; sen√£o, s√≥ atualiza timestamp
          if (lbCard.classList.contains('open')) fetchLeaderboard(); else setUpdated();
        }
      });

      // Toggle abrir/fechar
      lbToggle.addEventListener('click', () => {
        const open = lbCard.classList.contains('open');
        if (open) lbCard.classList.remove('open');
        else { lbCard.classList.add('open'); fetchLeaderboard(); }
      });
      // Fechar com Esc
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') lbCard.classList.remove('open'); });

      // Atualiza "Refresh HH:MM:SS"
      function setUpdated(ts){
        const d = ts ? new Date(ts) : new Date();
        const hh = String(d.getHours()).padStart(2,'0');
        const mm = String(d.getMinutes()).padStart(2,'0');
        const ss = String(d.getSeconds()).padStart(2,'0');
        lbUpdated.textContent = `Refresh ${hh}:${mm}:${ss}`;
      }

      // Carregar Top
      async function fetchLeaderboard() {
        try {
          const who = LB_STUDENT || 'anonymous';
          const url = `${LB_ENDPOINT}?action=leaderboard_top&top=${LB_TOP}&who=${encodeURIComponent(who)}`;
          const res = await fetch(url, { method: 'GET' });
          const data = await res.json();
          if (!data.ok) throw new Error(data.error || 'Failed');
          renderTop(data.top, data.me, data.updated_at);
          setUpdated(data.updated_at);
        } catch (e) {
          console.error('Leaderboard error:', e);
          lbList.innerHTML = '<li class="lb-item"><div class="lb-name">N√£o foi poss√≠vel carregar o ranking.</div></li>';
          setUpdated();
        }
      }

      // Renderizar lista
      function renderTop(top, me, updatedAt) {
        lbList.innerHTML = '';
        if (!top || !top.length){
          lbList.innerHTML = '<li class="lb-item"><div class="lb-name" style="opacity:.8">Ainda sem pontos por aqui.</div></li>';
        } else {
          for (const row of top) {
            const li = document.createElement('li'); li.className = 'lb-item';
            if (row.rank <= 3) li.classList.add(`top-${row.rank}`);
            const left = document.createElement('div'); left.className='lb-left';
            const rk = document.createElement('div'); rk.className='lb-rank'; rk.textContent = row.rank;
            const nm = document.createElement('div'); nm.className='lb-name'; nm.textContent = row.name || row.studentId;
            left.appendChild(rk); left.appendChild(nm);
            const pts = document.createElement('div'); pts.className='lb-points'; pts.textContent = row.total_points + ' pts';
            li.appendChild(left); li.appendChild(pts);
            lbList.appendChild(li);
          }
        }
        lbMeEl.innerHTML = me ? `<span class="lb-badge-me">You: #${me.rank} ¬∑ ${me.total_points} pts</span>` : '';
        setUpdated(updatedAt);
      }
      // exp√µe para uso externo se precisar
      window.renderTop = renderTop;

      // Auto-refresh
      if (LB_POLL_MS && Number(LB_POLL_MS) > 0) setInterval(fetchLeaderboard, LB_POLL_MS);

      // Logger de eventos (exponho global para uso em outras partes)
      async function leaderboardLogEvent(event_type, { points=null, details='' } = {}) {
        try {
          const payload = {
            action: 'leaderboard_log',
            studentId: LB_STUDENT || 'anonymous',
            event_type,
            module: LB_MODULE,
            page: LB_PAGE,
            details,
            points,
            fingerprint: `${LB_STUDENT || 'anonymous'}-${event_type}-${LB_MODULE}-${LB_PAGE}`
          };
          const res = await fetch(LB_ENDPOINT, { method: 'POST', body: JSON.stringify(payload) });
          const data = await res.json();
          if (!data.ok) throw new Error(data.error || 'failed');
          fetchLeaderboard();
          return data;
        } catch (e) {
          console.error('logEvent error:', e);
          return { ok:false, error: String(e) };
        }
      }
      window.leaderboardLogEvent = leaderboardLogEvent;
    </script>
    <!-- notices-on-login.html -->
    <style>
      .notice-modal-backdrop{
        position:fixed; inset:0; background:rgba(15,23,42,.35);
        display:none; align-items:center; justify-content:center;
        z-index:2147483647; /* topo de tudo */
      }
      .notice-modal{
        width:min(92vw, 680px); background:#fff; border-radius:16px;
        box-shadow:0 18px 50px rgba(0,0,0,.25);
        padding:18px 18px 12px; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
        border:1px solid rgba(0,0,0,.08);
      }
      .notice-title{ font-size:1.1rem; font-weight:700; margin:0 0 6px; color:#0f172a; }
      .notice-body{ color:#334155; line-height:1.5; }
      .notice-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:14px; }

      .notice-btn{
        padding:10px 14px; border-radius:10px;
        border:1px solid rgba(0,0,0,.1); background:#0ea5e9; color:#fff; cursor:pointer;
      }

      /* Bot√µes das op√ß√µes */
      .notice-choice{
        padding:10px 14px; border-radius:999px;
        border:1px solid rgba(15,23,42,.08);
        background: linear-gradient(180deg,#3b82f6,#2563eb);
        color:#fff; cursor:pointer; box-shadow: 0 2px 0 rgba(0,0,0,.06);
        transition: transform .12s ease, filter .12s ease, opacity .12s ease;
      }
      .notice-choice:hover{ transform: translateY(-1px); filter: brightness(1.05); }
      .notice-choice:disabled{ opacity:.7; cursor:default; transform:none; }

      /* Estado visual ap√≥s clique */
      .notice-choice.is-selected{
        background: linear-gradient(180deg,#2563eb,#1d4ed8);
        border-color: rgba(37,99,235,.35);
      }
      .notice-choice.is-correct{
        background: linear-gradient(180deg,#16a34a,#15803d);
        border-color: rgba(22,163,74,.35);
      }
      .notice-choice.is-wrong{
        background: linear-gradient(180deg,#dc2626,#b91c1c);
        border-color: rgba(220,38,38,.35);
      }
    </style>

    <div class="notice-modal-backdrop" id="noticeBackdrop" aria-hidden="true" style="display:none">
      <div class="notice-modal" role="dialog" aria-modal="true">
        <div class="notice-title" id="noticeTitle">Notice</div>
        <div class="notice-body" id="noticeBody"></div>
        <div class="notice-actions">
          <button class="notice-btn" id="noticeOkBtn" type="button">Ok, got it</button>
        </div>
      </div>
    </div>

    <script>
    (function(){
      const ENDPOINT = 'https://script.google.com/macros/s/AKfycbw1stXhHVbcinNcagloc6XNr3MYW9zn8EctaxxLuOJ086ODpCBvNCPwdfzbJxwl1XgDfw/exec';
      const SESSION_FLAG = 'notice_shown_this_load';
      const FEEDBACK_AUTO_CLOSE_MS = 15000; // V/F: tempo p/ ler feedback (0 = fecha s√≥ no "Ok, got it")
      const DEBUG = false;

      /* Preconnect + dns-prefetch */
      try {
        const l1=document.createElement('link'); l1.rel='preconnect';   l1.href='https://script.google.com'; document.head.appendChild(l1);
        const l2=document.createElement('link'); l2.rel='dns-prefetch'; l2.href='https://script.google.com'; document.head.appendChild(l2);
      } catch(_) {}

      /* üî• Warm-up imediato do GAS */
      try {
        const warm = new Image();
        warm.referrerPolicy = 'no-referrer';
        warm.src = `${ENDPOINT}?action=ping&t=${Date.now()}`;
      } catch(_) {}

      /* Helpers b√°sicos */
      function ensureModal(){
        let backdrop = document.getElementById('noticeBackdrop');
        if (!backdrop) {
          const tpl = document.createElement('div');
          tpl.innerHTML = `
            <div class="notice-modal-backdrop" id="noticeBackdrop" aria-hidden="true" style="display:none">
              <div class="notice-modal" role="dialog" aria-modal="true">
                <div class="notice-title" id="noticeTitle">Notice</div>
                <div class="notice-body" id="noticeBody"></div>
                <div class="notice-actions">
                  <button class="notice-btn" id="noticeOkBtn" type="button">Ok, got it</button>
                </div>
              </div>
            </div>`;
          document.body.appendChild(tpl.firstElementChild);
          if (DEBUG) console.log('[notice] backdrop injected');
        }
      }
      function getStudentId(){
        try { return (localStorage.getItem('studentId') || sessionStorage.getItem('studentId') || window.__lastLoginStudentId || '').trim(); }
        catch(e){ return ''; }
      }
      function normalizeModule(m){
        if (!m) return '';
        const s = String(m).trim().toLowerCase();
        const m1 = s.match(/^module(\d+)$/); if (m1) return `mod${m1[1]}`;
        return s;
      }
      function getModule(){
        try {
          const el = document.getElementById('current-module'); if (el && el.value) return normalizeModule(el.value);
          const byStorage = localStorage.getItem('module') || sessionStorage.getItem('module'); if (byStorage) return normalizeModule(byStorage);
          const dm = document.body && document.body.getAttribute('data-module'); if (dm) return normalizeModule(dm);
          if (window.VHCM && window.VHCM.module) return normalizeModule(window.VHCM.module);
          return '';
        } catch(e){ return ''; }
      }
      function fetchJSON(url){
        return fetch(url, { credentials:'omit', cache:'no-store' })
          .then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.json(); });
      }
      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
      function personalize(s, studentId, module){
        return String(s || '')
          .replace(/\{\{\s*studentId\s*\}\}/gi, escapeHtml(studentId || ''))
          .replace(/\{\{\s*module\s*\}\}/gi, escapeHtml(module || ''));
      }
      function fireAndForget(url){
        try { const img = new Image(); img.referrerPolicy='no-referrer'; img.src = url; } catch(_) {}
      }
      function ackAndClose(studentId, notice_id){
        const modal = document.getElementById('noticeBackdrop');
        if (modal) modal.style.display = 'none';
        const qs2 = new URLSearchParams({ action:'ack', studentId, notice_id, t: Date.now().toString() });
        fireAndForget(`${ENDPOINT}?${qs2.toString()}`);
      }

      /* Normaliza r√≥tulos T/F em v√°rios formatos */
      function normalizeTF(x){
        const s = String(x || '').trim().toLowerCase();
        if (['true','t','verdadeiro','v','yes','y','sim','‚úÖ','‚úîÔ∏è'].includes(s)) return 'true';
        if (['false','f','falso','no','n','nao','n√£o','‚ùå','‚úñÔ∏è'].includes(s)) return 'false';
        if (s.startsWith('true'))  return 'true';
        if (s.startsWith('false')) return 'false';
        return '';
      }

      /* Render de poll (normal e T/F) */
      function renderPoll(notice, studentId, module){
        const body = document.getElementById('noticeBody');
        const okBtn = document.getElementById('noticeOkBtn');
        const opts = Array.isArray(notice.poll_options) ? notice.poll_options : [];
        const q    = notice.poll_question || 'Vote:';

        const correctKey = normalizeTF(notice.poll_correct);
        const isQuizTF   = (correctKey === 'true' || correctKey === 'false');
        let autoTimer = null;

        const pollWrap = document.createElement('div');
        pollWrap.innerHTML = `
          <div style="margin:8px 0 12px 0;"><strong>${escapeHtml(q)}</strong></div>
          <div id="pollBtns" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
          <div id="pollFeedback" style="margin-top:10px;"></div>
        `;
        body.appendChild(pollWrap);

        const btns = pollWrap.querySelector('#pollBtns');
        const fb   = pollWrap.querySelector('#pollFeedback');

        // T/F: deixa "Ok, got it" para leitura do feedback
        if (isQuizTF && okBtn) {
          okBtn.style.display = '';
          okBtn.onclick = (ev) => {
            ev.preventDefault(); ev.stopPropagation();
            if (autoTimer) { clearTimeout(autoTimer); autoTimer = null; }
            ackAndClose(studentId, notice.notice_id);
          };
        }

        opts.forEach((label) => {
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'notice-choice';
          b.textContent = label;

          b.addEventListener('click', () => {
            // desabilita todos imediatamente
            const all = [...btns.querySelectorAll('button')];
            all.forEach(x => x.disabled = true);

            // envia voto (fire-and-forget)
            const qs = new URLSearchParams({
              action: 'poll_vote',
              studentId,
              module: module || '',
              poll_id: notice.poll_id || '',
              choice: label,
              t: Date.now().toString()
            });
            fireAndForget(`${ENDPOINT}?${qs.toString()}`);

            if (!isQuizTF) {
              // Poll "opini√£o": s√≥ marca sele√ß√£o e fecha j√°
              b.classList.add('is-selected');
              ackAndClose(studentId, notice.notice_id);
              return;
            }

            // T/F: decide correto/errado usando normaliza√ß√£o
            const choiceKey = normalizeTF(label);
            const isCorrect = (choiceKey && choiceKey === correctKey);

            b.classList.add(isCorrect ? 'is-correct' : 'is-wrong');

            // Feedback amig√°vel
            fb.style.color = isCorrect ? '#065f46' : '#b91c1c';
            fb.innerHTML = isCorrect
              ? (notice.feedback_correct_html || '<p><strong>‚úÖ Correct.</strong></p>')
              : (notice.feedback_wrong_html  || '<p><strong>‚ùå Not quite.</strong></p>');

            // Auto-fecha ap√≥s leitura (se configurado)
            if (FEEDBACK_AUTO_CLOSE_MS > 0) {
              autoTimer = setTimeout(() => {
                autoTimer = null;
                ackAndClose(studentId, notice.notice_id);
              }, FEEDBACK_AUTO_CLOSE_MS);
            }
          });

          btns.appendChild(b);
        });
      }

      /* Mostra aviso/poll */
      async function showNotice(studentId){
        try { if (sessionStorage.getItem(SESSION_FLAG)) return false; } catch(e){}

        const module = getModule();
        const qs = new URLSearchParams({ action:'get', studentId });
        if (module) qs.set('module', module);

        const data = await fetchJSON(`${ENDPOINT}?${qs.toString()}`);
        if (!data.ok || !data.hasNotice || !data.notice) return false;

        ensureModal();

        const notice = data.notice;
        const titleEl = document.getElementById('noticeTitle');
        const bodyEl  = document.getElementById('noticeBody');
        const okBtn   = document.getElementById('noticeOkBtn');
        const modal   = document.getElementById('noticeBackdrop');
        if (!titleEl || !bodyEl || !okBtn || !modal) return false;

        titleEl.textContent = personalize(notice.title || (notice.type === 'poll' ? 'Quick poll' : 'Notice'), studentId, module);
        bodyEl.innerHTML = personalize(notice.message_html || '', studentId, module);
        modal.style.display = 'flex';

        if (notice.type === 'poll' && !notice.already_voted) {
          const correctKey = normalizeTF(notice.poll_correct);
          const isQuizTF   = (correctKey === 'true' || correctKey === 'false');

          // Para poll de opini√£o: esconda o "Ok, got it"
          okBtn.style.display = isQuizTF ? '' : 'none';
          if (!isQuizTF) {
            okBtn.onclick = (ev) => { ev.preventDefault(); ev.stopPropagation(); ackAndClose(studentId, notice.notice_id); };
          }

          renderPoll(notice, studentId, module);
        } else {
          // Aviso HTML simples
          okBtn.style.display = '';
          okBtn.onclick = (ev) => { ev.preventDefault(); ev.stopPropagation(); ackAndClose(studentId, notice.notice_id); };
        }

        try { sessionStorage.setItem(SESSION_FLAG, notice.notice_id); } catch(e){}
        return true;
      }

      /* API global opcional */
      window.noticeCenter = {
        onLogin: (studentId) => { try { window.__lastLoginStudentId = studentId; } catch(e){}; showNotice(String(studentId || '').trim()); },
        showNow: () => { try{ sessionStorage.removeItem(SESSION_FLAG); }catch(_){};
          const sid = getStudentId(); if (sid) showNotice(sid);
        }
      };

      /* Espera login e mostra (fallback) */
      async function waitForLoginAndShow(maxMs=20000){
        const start = Date.now();
        while (Date.now() - start < maxMs) {
          const sid = getStudentId();
          if (sid) { await showNotice(sid); return; }
          await new Promise(r => setTimeout(r, 150));
        }
      }

      /* Gatilhos */
      document.addEventListener('auth:login', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? String(ev.detail.studentId).trim() : getStudentId();
        if (sid) window.noticeCenter.onLogin(sid);
      });
      window.addEventListener('login:success', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? String(ev.detail.studentId).trim() : getStudentId();
        if (sid) window.noticeCenter.onLogin(sid);
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => { waitForLoginAndShow(); });
      } else {
        waitForLoginAndShow();
      }
    })();
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>
      // Redund√¢ncia leve: tamb√©m define o m√≥dulo via JS neste deck
      // (o notices-on-login reconhece body[data-module], localStorage e window.VHCM.module)
      window.VHCM = window.VHCM || {};
      window.VHCM.module = "mod6";

      document.addEventListener('DOMContentLoaded', () => {
        try { localStorage.setItem('mod6','mod6'); } catch(_) {}
      });

      Reveal.on('ready', event => {
        if (event.indexh === 0) {
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
      });
      Reveal.addEventListener('slidechanged', (event) => {
        if (event.indexh === 0) {
          Reveal.configure({ slideNumber: null });
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
        if (event.indexh === 1) {
          Reveal.configure({ slideNumber: 'c' });
          document.querySelector("div.has-logo > img.slide-logo").style.display = null;
        }
      });
    </script>
    

</body></html>
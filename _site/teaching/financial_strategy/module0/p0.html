<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Henrique C. Martins">
  <title>Henrique Castro Martins - Estrat√©gia Financeira</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="../logo.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-771J5563G0"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-771J5563G0', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <!-- === login-start.html (com prote√ß√£o para p√°ginas e slides + turbo + warmup + remember blindado) === -->

  <style>
    /* Card padr√£o (p√°ginas normais) */
    #login-form {
      max-width: 300px;
      margin: 100px auto 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background: #fff;
      box-sizing: border-box;
    }
    #login-form input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    /* ‚úÖ FIX layout do checkbox: n√£o herdar width/padding dos inputs de texto */
    #login-form input[type="checkbox"] {
      width: auto !important;
      padding: 0 !important;
      margin: 0 !important;
      border: none !important;
      box-shadow: none !important;
      vertical-align: middle;
    }

    #login-form button {
      width: 100%; padding: 10px; margin-top: 10px;
      background-color: #0066cc; color: #fff; border: 0; border-radius: 5px; cursor: pointer;
    }
    #login-error { color: red; text-align: center; margin-top: 10px; }
    #loading-msg{ display:none; text-align:center; margin-top:10px; color:gray; }

    /* Desabilitado durante autentica√ß√£o */
    #login-form button:disabled { opacity:.6; cursor:not-allowed; }
    #login-form input:disabled  { opacity:.7; }

    /* Conte√∫do de p√°ginas normais (fica atr√°s do login at√© destravar) */
    html.locked #after-login-content,
    body.locked #after-login-content { display: none !important; }

    /* Slides (Reveal.js): desfoca deck e bloqueia intera√ß√£o */
    html.locked.reveal-page .reveal,
    body.locked.reveal-page .reveal { filter: blur(4px); pointer-events: none; user-select: none; }

    #login-scrim { display:none; }
    html.locked.reveal-page #login-scrim,
    body.locked.reveal-page #login-scrim{
      display:block; position:fixed; inset:0; background:rgba(255,255,255,.92); z-index:9998;
    }
    html.locked.reveal-page #login-form,
    body.locked.reveal-page #login-form{
      position: fixed; top:50%; left:50%; transform: translate(-50%,-50%);
      margin:0; max-width:340px; width:min(340px,92vw); z-index:9999;
    }

    /* Oculta o "Welcome" nos slides */
    .reveal-page #welcome-message { display: none !important; }

    /* Remember me */
    .remember-row{
      display:flex; align-items:center; gap:8px; margin-top:6px; font-size:.95rem; color:#444; white-space:nowrap;
    }
    .remember-row label{ display:flex; align-items:center; gap:6px; cursor:pointer; }

    /* Fallback duro para p√°ginas comuns: esconde TUDO (qualquer descendente) menos o form/scrim) */
    html.locked body:not(.reveal-page) :not(#login-form):not(#login-form *):not(#login-scrim):not(script):not(style):not(link) {
      display: none !important;
    }

    /* Garante que o form fique acima de qualquer layout do tema */
    #login-form { position: relative; z-index: 10000; }
    #login-scrim { z-index: 9998; }

    /* Scrim e formul√°rio fixos tamb√©m em p√°ginas N√ÉO-reveal enquanto locked */
    html.locked #login-scrim,
    body.locked #login-scrim {
      display: block !important;
      position: fixed !important;
      inset: 0 !important;
      background: #ffffff !important;
      z-index: 2147483646 !important;
    }
    html.locked #login-form,
    body.locked #login-form {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      margin: 0 !important;
      max-width: 340px !important;
      width: min(340px, 92vw) !important;
      z-index: 2147483647 !important;
    }

    /* Evita rolagem/scroll do conte√∫do ao fundo enquanto locked */
    html.locked, body.locked { overflow: hidden !important; }

    /* üîí Blindagem extra contra webexercises esconder a checkbox */
    #login-form .remember-row { display:flex !important; visibility:visible !important; }
    #login-form #remember-me { display:inline-block !important; }

    /* üßº Esconde imediatamente artefatos escapados (qualquer descendente code/pre/sourceCode etc) DENTRO do form */
    #login-form pre,
    #login-form code,
    #login-form .sourceCode,
    #login-form .sourcecode,
    #login-form .quarto-code-cell,
    #login-form .cell-output,
    #login-form .cell-output-display,
    #login-form .cell { display: none !important; }
  </style>

  <!-- Aplica 'locked' em <html> imediatamente e em <body> quando dispon√≠vel + preconnect -->
  <script>
    (function(){
      const addLocked = el => { if (el && !el.classList.contains('locked')) el.classList.add('locked'); };
      addLocked(document.documentElement);
      if (document.body) { addLocked(document.body); }
      else { document.addEventListener('DOMContentLoaded', () => addLocked(document.body)); }

      // preconnect/dns-prefetch para acelerar chamadas ao GAS de login
      try {
        const l1=document.createElement('link'); l1.rel='preconnect';   l1.href='https://script.google.com'; document.head.appendChild(l1);
        const l2=document.createElement('link'); l2.rel='dns-prefetch'; l2.href='https://script.google.com'; document.head.appendChild(l2);
      } catch(_) {}
    })();
  </script>

  <!-- shim seguro: define onLoginSuccess se ainda n√£o existir -->
  <script>
    if (typeof window.onLoginSuccess !== 'function') {
      window.onLoginSuccess = function(studentId){
        try {
          const sid = String(studentId || '').trim();
          window.studentId = sid;
          localStorage.setItem('studentId', sid);
          // compat com widgets antigos
          document.dispatchEvent(new CustomEvent('auth:login',   { detail: { studentId: sid } }));
          setTimeout(() => window.dispatchEvent(new CustomEvent('login:success', { detail:{ studentId: sid } })), 0);
          // hook imediato para o notice center (se j√° carregado)
          if (window.noticeCenter && typeof window.noticeCenter.onLogin === 'function') {
            window.noticeCenter.onLogin(sid);
          }
          if (window.VHCM) window.VHCM.lastLoginAt = Date.now();
          console.debug('[Login] onLoginSuccess ‚Üí', sid);
        } catch(e) {
          console.warn('onLoginSuccess shim warn:', e);
        }
      };
    }
  </script>

  <meta property="og:title" content="Henrique Castro Martins - Estrat√©gia Financeira">
<meta property="og:description" content="Module 0">
<meta property="og:site_name" content="Henrique Castro Martins">
<meta name="twitter:title" content="Henrique Castro Martins - Estrat√©gia Financeira">
<meta name="twitter:description" content="Module 0">
<meta name="twitter:card" content="summary">
</head><body class="quarto-light"><form id="login-form" onsubmit="event.preventDefault(); validateLogin();">
    <h3 style="text-align:center;">Login</h3>
    <input type="text" id="username" placeholder="Username" autocomplete="username" required="">
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" required="">

    <!-- Remember: input separado + label com 'for' (alinhado como na 2¬™ imagem) -->
    <div class="remember-row">
      <input type="checkbox" id="remember-me" checked="">
      <label for="remember-me">Remember me</label>
    </div>

    <button type="submit" id="login-submit">Enter</button>
    <div id="loading-msg"></div>
    <div id="login-error"></div>
  </form>

  <div id="login-scrim" aria-hidden="true"></div>

  <div id="after-login-content" style="display:none;">
    <h4 id="welcome-message" style="text-align:center; display:none; margin-top:10px; font-size:1.8em; color:#333;"></h4>
  </div>

  <script>
    /***** CONFIG *****/
    const REMEMBER_PASSWORD  = true;
    const GAS_URL            = 'https://course-chat.hcmrtns.workers.dev/auth/login';
    const SESSION_MAX_HOURS  = 8;     // validade do "lembrado"
    const FAST_WINDOW_HOURS  = 2;     // turbo: libera instant√¢neo
    const VALIDATE_TIMEOUTMS = 3000;  // timeout da valida√ß√£o

    /* üî• Warm-up silencioso do GAS: acorda a fun√ß√£o antes do 1¬∫ login real */
    window.addEventListener('load', () => {
      try {
        const warm = new Image();
        warm.referrerPolicy = 'no-referrer';
        warm.src = `${GAS_URL}?username=&password=&page=WARMUP&t=${Date.now()}`;
      } catch(_) {}
    });

    /***** Marca slides (se houver Reveal) *****/
    document.addEventListener('DOMContentLoaded', () => {
      if (document.querySelector('.reveal')) document.body.classList.add('reveal-page');
    });

    /***** Pr√©-preenche campos com Remember (se houver) *****/
    document.addEventListener('DOMContentLoaded', () => {
      try{
        const u = localStorage.getItem('fs_user');
        const p = localStorage.getItem('fs_pass');
        if (u) document.getElementById('username').value = u;
        if (REMEMBER_PASSWORD && p) document.getElementById('password').value = p;
      }catch(_){}
    });

    /***** Storage helpers *****/
    function saveRemember(u,p,checked){
      try{
        if(checked){
          localStorage.setItem('fs_user', u);
          localStorage.setItem('fs_last_login_at', Date.now().toString());
          if (REMEMBER_PASSWORD) localStorage.setItem('fs_pass', p); else localStorage.removeItem('fs_pass');
        }else{
          localStorage.removeItem('fs_user'); localStorage.removeItem('fs_pass'); localStorage.removeItem('fs_last_login_at');
        }
      }catch(_){}
    }
    function getRemember(){
      try{
        const u=localStorage.getItem('fs_user');
        const p=localStorage.getItem('fs_pass');
        const t=parseInt(localStorage.getItem('fs_last_login_at')||'0',10);
        if(!u||!t) return null; return {u,p,t};
      }catch(_){ return null; }
    }
    const within=(ts,h)=> (Date.now()-ts) < h*3600*1000;

    /* üîí Desativa/Reativa o form durante autentica√ß√£o */
    function setAuthLoading(isLoading){
      const btn = document.getElementById('login-submit');
      const u   = document.getElementById('username');
      const p   = document.getElementById('password');
      const cb  = document.getElementById('remember-me');
      if (btn){
        btn.disabled = isLoading;
        btn.textContent = isLoading ? 'Signing in...' : 'Enter';
      }
      [u,p,cb].forEach(el => { if (el) el.disabled = isLoading; });
    }

    /***** GAS helpers *****/
    function logWithImage(u,p,page){
      const img=new Image(); img.referrerPolicy='no-referrer';
      img.src=`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}&t=${Date.now()}`;
    }
    async function gasAuth(u,p,page,timeoutMs){
      async function _once(ms){
        const ctrl=new AbortController();
        const timer=setTimeout(()=>ctrl.abort('timeout'), ms||0);
        try{
          const res=await fetch(`${GAS_URL}?username=${encodeURIComponent(u)}&password=${encodeURIComponent(p||'')}&page=${encodeURIComponent(page)}`, {signal:ctrl.signal, cache:'no-store'});
          return (await res.text()||'').trim();
        } finally { clearTimeout(timer); }
      }
      try{
        return await _once(timeoutMs||12000);   // 1¬™ tentativa
      }catch(_){
        return await _once(15000);              // retry mais folgado
      }
    }

    /***** UI helpers *****/
    function unlockAs(u){
      const welcome=document.getElementById('welcome-message');
      if (welcome && !document.body.classList.contains('reveal-page')){
        welcome.textContent=`Welcome, ${u}!`; welcome.style.display='block';
      }
      document.getElementById('login-form').style.display='none';
      const after=document.getElementById('after-login-content'); if(after) after.style.display='block';

      // Remover 'locked' de html e body
      document.documentElement.classList.remove('locked');
      if (document.body) document.body.classList.remove('locked');

      const scrim=document.getElementById('login-scrim'); if(scrim) scrim.style.display='none';
    }

    /***** Auto-login com janela turbo (tamb√©m nos slides) *****/
    document.addEventListener('DOMContentLoaded', async () => {
      const saved=getRemember(); if(!saved) return;
      const page=location.pathname;

      if (within(saved.t, FAST_WINDOW_HOURS)) {
        // libera j√° e registra em background
        unlockAs(saved.u);
        onLoginSuccess(saved.u); // mant√©m studentId para outros scripts

        saveRemember(saved.u, saved.p, true);
        logWithImage(saved.u, saved.p, page);

        // checagem silenciosa (opcional)
        try { const r=await gasAuth(saved.u, saved.p, 'CHECK', 12000); if(r!=='OK'){ /* opcional: relock */ } } catch(_) {}
        return;
      }

      if (within(saved.t, SESSION_MAX_HOURS)) {
        const loading=document.getElementById('loading-msg');
        loading.textContent='Checking saved login...'; loading.style.display='block';
        try{
          const r=await gasAuth(saved.u, saved.p, page, VALIDATE_TIMEOUTMS);
          loading.style.display='none';
          if(r==='OK'){ unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); }
        }catch(_){
          // timeout: libera e registra em background
          loading.style.display='none';
          unlockAs(saved.u); onLoginSuccess(saved.u); saveRemember(saved.u, saved.p, true); logWithImage(saved.u, saved.p, page);
        }
      }
    });

    /***** Login manual *****/
    async function validateLogin(rememberOverride){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      const cb=document.getElementById('remember-me');
      const remember = (rememberOverride!==undefined) ? rememberOverride : (cb? cb.checked : true);

      const err=document.getElementById('login-error');
      const load=document.getElementById('loading-msg');
      err.textContent='';
      load.textContent='Authenticating your credentials. This may take a few seconds...';
      load.style.display='block';
      setAuthLoading(true);

      const page=location.pathname;
      try{
        const r=await gasAuth(u,p,page,VALIDATE_TIMEOUTMS);
        load.style.display='none';
        if (r==='OK'){ saveRemember(u,p,remember); unlockAs(u); onLoginSuccess(u); }
        else if (r==='FAIL'){ err.textContent='Invalid username or password.'; }
        else { err.textContent='Missing credentials.'; }
      }catch(_){
        load.textContent=''; err.textContent='Network error. Please try again.';
      }finally{
        if (document.getElementById('login-form').style.display !== 'none') {
          setAuthLoading(false);
        }
      }
    }

    // Auto preenche (se j√° houver credenciais lembradas)
    document.addEventListener('DOMContentLoaded', ()=>{
      try{
        const u=localStorage.getItem('fs_user'); const p=localStorage.getItem('fs_pass');
        if(u){ document.getElementById('username').value=u; }
        if(p && REMEMBER_PASSWORD){ document.getElementById('password').value=p; }
        const cb=document.getElementById('remember-me'); if(cb) cb.checked=true;
      }catch(_){}
    });

    /* Auto-wrap robusto ‚Äî apenas para p√°ginas N√ÉO-Reveal */
    document.addEventListener('DOMContentLoaded', () => {
      try {
        if (document.querySelector('.reveal') || document.body.classList.contains('reveal-page')) return;

        const wrapper = document.getElementById('after-login-content');
        if (!wrapper) return;

        const root = wrapper.parentElement || document.body;
        const loginForm  = document.getElementById('login-form');
        const loginScrim = document.getElementById('login-scrim');

        const isKeep = (el) =>
          el === wrapper || el === loginForm || el === loginScrim ||
          el.tagName === 'SCRIPT' || el.tagName === 'STYLE' || el.tagName === 'LINK';

        Array.from(root.children).forEach(el => {
          if (!isKeep(el) && !wrapper.contains(el)) {
            wrapper.appendChild(el);
          }
        });
      } catch (e) {
        console.warn('auto-wrap (non-reveal) warn:', e);
      }
    });

    /* üîí Fallback: recria a checkbox se webexercises a remover (estrutura input+label) */
    document.addEventListener('DOMContentLoaded', () => {
      const form=document.getElementById('login-form');
      if(!form) return;
      if(!document.getElementById('remember-me')){
        const row=document.createElement('div');
        row.className='remember-row';

        const input=document.createElement('input');
        input.type='checkbox';
        input.id='remember-me';
        input.checked=true;

        const label=document.createElement('label');
        label.htmlFor='remember-me';
        label.appendChild(document.createTextNode(' Remember me'));

        row.appendChild(input);
        row.appendChild(label);

        const btn=document.getElementById('login-submit');
        form.insertBefore(row, btn);
      }
    });

    /* üßπ Sanitizador: remove artefatos (pre/code/sourceCode/cell) do remember dentro do form (em QUALQUER profundidade) */
    (function(){
      function looksLikeRememberLine(txt){
        if(!txt) return false;
        const t = txt.trim();
        return /<\s*input[^>]*type=["']checkbox["'][^>]*id=["']remember-me["']/i.test(t) ||
               /<\s*label[^>]*for=["']remember-me["'][^>]*>/i.test(t);
      }
      function cleanRememberArtifacts(){
        const form = document.getElementById('login-form');
        if(!form) return;

        // Remove blocos t√≠picos do Quarto/knitr que cont√™m o HTML escapado
        form.querySelectorAll('pre, code, .sourceCode, .sourcecode, .quarto-code-cell, .cell-output, .cell-output-display, .cell')
          .forEach(el => { if(looksLikeRememberLine(el.textContent)) el.remove(); });

        // Remove n√≥s de texto ‚Äúcrus‚Äù em qualquer n√≠vel
        const treeWalker = document.createTreeWalker(form, NodeFilter.SHOW_TEXT, null);
        const toRemove = [];
        while(treeWalker.nextNode()){
          const n = treeWalker.currentNode;
          if(looksLikeRememberLine(n.textContent)) toRemove.push(n);
        }
        toRemove.forEach(n => n.parentNode && n.parentNode.removeChild(n));
      }

      if (document.readyState !== 'loading') cleanRememberArtifacts();
      else document.addEventListener('DOMContentLoaded', cleanRememberArtifacts);

      // Observa mudan√ßas no form inteiro (subtree) para limpar assim que surgir
      const formObs = document.getElementById('login-form');
      if (formObs) new MutationObserver(cleanRememberArtifacts)
        .observe(formObs, { childList: true, subtree: true });
    })();

  </script>


  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#b1cafa" class="quarto-title-block center">
  <h1 class="title">Estrat√©gia Financeira</h1>
  <p class="subtitle">Module 0</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<strong>Henrique C. Martins</strong> 
</div>
        <p class="quarto-title-affiliation">
            <strong><a href="https://eaesp.fgv.br/en"><img data-src="../figs/background6.png" style="box-shadow: none;" width="300"></a></strong>
          </p>
    </div>
</div>

  <p class="date">31-01-2026</p>
</section>
<section>

<section id="introduction-1" class="slide level2" style="color: #000;">
<h2>Introduction</h2>
<center>
<img data-src="../figs/changemymind.jpg">
</center>
<div class="like-container">
<p><button class="like-btn" title="Click if you got this"> ‚úÖ <span class="like-text">Got it</span> <span class="like-count">(0)</span> </button></p>
</div>
<script>
(function () {
  const root = document.currentScript && document.currentScript.previousElementSibling;
  if (!root || !root.matches('.like-container')) return;

  const btn = root.querySelector('.like-btn');
  const textSpan = btn && btn.querySelector('.like-text');
  const countSpan = btn && btn.querySelector('.like-count');
  if (!btn || !textSpan || !countSpan) return;

  const scriptURL = "https://course-chat.hcmrtns.workers.dev";

  function pageId() {
    const sec = root.closest('section');
    function getSlideHashForSection(sec) {
      if (sec && sec.id) return `#/${sec.id}`;
      if (window.Reveal && Reveal.getIndices) {
        const idx = Reveal.getIndices(sec || Reveal.getCurrentSlide());
        if (idx && typeof idx.h === 'number') {
          return (typeof idx.v === 'number' && idx.v > 0) ? `#/${idx.h}/${idx.v}` : `#/${idx.h}`;
        }
      }
      return location.hash || '#';
    }
    const hash = getSlideHashForSection(sec);
    return location.origin + location.pathname + location.search + hash;
  }
  function getStudentId(){
    return (window.studentId || localStorage.getItem("studentId") || localStorage.getItem("fs_user") || "");
  }
  function hasLogin(){ return !!getStudentId(); }

  function setGotItState() {
    textSpan.textContent = "Got it ‚úî";
    btn.classList.add("liked");
    btn.title = "You have already confirmed";
  }
  function clearGotItState() {
    textSpan.textContent = "Got it";
    btn.classList.remove("liked");
    btn.title = hasLogin() ? "Click if you got this" : "Please log in to confirm";
  }

  function syncButtonLock() {
    if (!hasLogin()) {
      btn.setAttribute('disabled', 'disabled');
      btn.style.opacity = 0.6;
      btn.title = "Please log in to confirm";
    } else {
      btn.removeAttribute('disabled');
      btn.style.opacity = "";
      btn.title = "Click if you got this";
    }
  }
  syncButtonLock();
  document.addEventListener('auth:login', () => { syncButtonLock(); updateCount(); });

  // Envia ponto (opcional; n√£o bloqueia)
  async function awardLikePoint(student, pid){
    try{
      await fetch(`${scriptURL}/ranking`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          student,
          event_type:'like',
          module:(window.moduleId||'module'),
          page: pid,
          details:'source=like_button',
          fingerprint:`${student}:like:${pid}`
        })
      });
      if (typeof window.leaderboardLogEvent === 'function') {
        window.leaderboardLogEvent('like', { details:'mirrored_to_cloudflare' });
      }
    }catch(_){}
  }

  btn.addEventListener('click', () => {
    const pid = pageId();
    if (!hasLogin()) { alert("Please log in first."); return; }
    if (localStorage.getItem(`liked_${pid}`)) return;

    btn.disabled = true;
    btn.classList.add('pulse');
    setTimeout(() => btn.classList.remove('pulse'), 300);

    const student = getStudentId();
    fetch(`${scriptURL}/likes?like=1&page=${encodeURIComponent(pid)}&student=${encodeURIComponent(student)}`)
      .then(r=>r.json())
      .then(async data=>{
        if (data && data.status === 'liked') {
          await awardLikePoint(student, pid);
        }
        if (data && (data.status === 'liked' || data.status === 'already')) {
          localStorage.setItem(`liked_${pid}`,"true");
          setGotItState();
        }
        updateCount();
      })
      .catch(console.error)
      .finally(()=>{ btn.disabled = false; });
  });

  function updateCount(){
    const pid = pageId();
    const student = getStudentId() || "anon";
    fetch(`${scriptURL}/likes?state=1&page=${encodeURIComponent(pid)}&student=${encodeURIComponent(student)}`)
      .then(r=>r.json())
      .then(data=>{
        const count = Number(data && data.count) || 0;
        countSpan.textContent = `(${count})`;
        if (data && data.liked) {
          // servidor confirma like ‚Üí garante UI e storage
          localStorage.setItem(`liked_${pid}`,"true");
          setGotItState();
        } else {
          // servidor diz que N√ÉO h√° like ‚Üí limpa UI e storage
          localStorage.removeItem(`liked_${pid}`);
          clearGotItState();
        }
      })
      .catch(()=>{ /* ignora */ });
  }

  updateCount();
  const interval = setInterval(updateCount, 3000);

  const obs = new MutationObserver(() => {
    if (!document.body.contains(root)) { clearInterval(interval); obs.disconnect(); }
  });
  obs.observe(document.body, { childList:true, subtree:true });

  if (window.Reveal && Reveal.addEventListener) {
    Reveal.addEventListener('slidechanged', updateCount);
  }
})();
</script>
<style>
.like-container { position: relative; margin-top: 20px; text-align: right; }
.like-btn {
  background-color:#f0fdf4; border:2px solid #86efac; color:#15803d;
  padding:8px 16px; font-size:16px; border-radius:25px;
  display:inline-flex; align-items:center; gap:8px; font-weight:500;
  box-shadow:1px 1px 4px rgba(0,0,0,0.08);
  transition: background-color .2s, color .2s, opacity .2s, transform .15s;
  cursor:pointer;
}
.like-btn:hover{ background-color:#dcfce7; border-color:#4ade80; color:#166534; }
.like-btn.liked{ background:#f0f0f0; color:#888; border-color:#ddd; opacity:.6; cursor:default; }
.like-btn .like-count{
  background:#86efac; color:#064e3b; padding:2px 8px; border-radius:12px;
  font-size:14px; font-weight:bold;
}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
.pulse{animation:pulse .3s ease;}
</style>
</section>
<section id="introduction-2" class="slide level2 smaller" style="color: #000;">
<h2>Introduction</h2>
<ul>
<li><p><strong>Today:</strong></p>
<ul>
<li><strong>Introduction to the course</strong></li>
<li>Discussion about the <strong>Syllabus</strong></li>
<li><strong>Performance assessment</strong></li>
<li>Initial discussion about finance</li>
<li>First Chapter</li>
</ul></li>
</ul>
</section>
<section id="description" class="slide level2 smaller" style="color: #000;">
<h2>Description</h2>
<p>The purpose of the course is to familiarize students with the concepts and techniques related to the analysis and strategic decisions in the areas of investment and financing in a risky environment, always with the purpose of maximizing the company‚Äôs value.</p>
<p>At the end of the semester, the student should be able to master the:</p>
<ul>
<li>concepts of analysis, measurement, and applications of cost and capital structure,
<ul>
<li>including strategies regarding portfolios</li>
</ul></li>
<li>earnings distribution policy,</li>
<li>finding firm value.</li>
</ul>
</section>
<section id="section" class="slide level2 smaller" style="color: #000;">
<h2></h2>
<p><strong>To Midterm:</strong></p>
<ul>
<li><p>Ch 23: <strong>Raising Equity Capital</strong></p></li>
<li><p>Ch 10: <strong>Capital Markets and the Pricing of Risk</strong></p></li>
<li><p>Ch 11: <strong>Optimal Portfolio Choice and the Capital Asset Pricing Model</strong></p></li>
<li><p>Ch 12: <strong>Estimating the Cost of Capital</strong></p></li>
<li><p>Ch 13: <strong>Investor Behavior and Capital Market Efficiency</strong></p></li>
</ul>
<p><strong>To final:</strong></p>
<ul>
<li><p>Ch 24: <strong>Debt Financing</strong></p></li>
<li><p>Ch 14: <strong>Capital Structure in a Perfect Market</strong></p></li>
<li><p>Ch 15: <strong>Debt and Taxes</strong></p></li>
<li><p>Ch 16: <strong>Financial Distress, Managerial Incentives, and Information</strong></p></li>
<li><p>Ch 17: <strong>Payout Policy</strong></p></li>
</ul>
</section>
<section id="setting-expectations" class="slide level2 smaller" style="color: #000;">
<h2>Setting expectations</h2>
<p><strong><span style="color:red;">Your mission (should you choose to accept it‚Ä¶)</span></strong></p>
<div class="fragment">
<ul>
<li><p><strong>Read the book</strong> before class (preferably more than once).</p></li>
<li><p>Solve <strong>all</strong> the problems.</p></li>
<li><p><strong>Make notes</strong> (with your hand, not your computer)</p>
<ul>
<li>Research shows that taking notes boosts academic performance.</li>
<li>It is better to take a note and throw it away than to take a note on your computer.</li>
</ul></li>
<li><p><strong>Ask questions</strong>.</p>
<ul>
<li>This is the best way to learn. I will ask questions all the time during class. I expect that you answer them.</li>
</ul></li>
</ul>
</div>
</section>
<section id="new-rules-202601" class="slide level2 smaller" style="color: #000;">
<h2>New rules 2026/01</h2>
<ul>
<li><p><em>Art. 31¬∫ - N√£o existe abono de falta, mesmo que por raz√µes justificadas, visto que o aluno tem o direito de faltar em at√© 25% das aulas oferecidas sem a necessidade de qualquer justificativa ou comprova√ß√£o</em>.</p></li>
<li><p>Exemplos:</p>
<ul>
<li>situa√ß√µes familiares, problemas de sa√∫de, problemas com pets, etc.</li>
</ul></li>
<li><p>Exce√ß√µes:</p>
<ul>
<li>Guarda religiosa</li>
<li>Chamados judiciais/servi√ßo militar</li>
<li>Sele√ß√µes esportivas oficiais do pa√≠s</li>
</ul></li>
</ul>
</section>
<section id="new-rules-202601-1" class="slide level2 smaller" style="color: #000;">
<h2>New rules 2026/01</h2>
<p>Assim, a partir do 1o/2026, no caso de falta por Guarda Religiosa, o professor solicitar√° ao aluno uma ‚Äúpresta√ß√£o alternativa‚Äù (termo mencionado na Lei 13.796, que trata da Guarda Religiosa).</p>
<ul>
<li>Esta ‚Äúpresta√ß√£o alternativa‚Äù tem a fun√ß√£o de reduzir o preju√≠zo pedag√≥gico que o aluno teve devido √† sua falta na aula (por exemplo, indica√ß√£o e confer√™ncia de leitura, exerc√≠cios dirigidos etc., sempre compat√≠vel com o conte√∫do efetivamente perdido daquela aula).</li>
<li>A falta ser√° efetivamente abonada pelo professor ap√≥s o aluno cumprir sua ‚Äúpresta√ß√£o alternativa‚Äù, dentro de um prazo previamente combinado com o professor.</li>
</ul>
</section>
<section id="new-rules-202601-2" class="slide level2 smaller" style="color: #000;">
<h2>New rules 2026/01</h2>
<ul>
<li>7/4 (after 17h), 8/4 (all day), 9/4 (all day),</li>
<li>21/5 (after 17 h),</li>
<li>22/5 (all day)</li>
<li>every Friday (after 17h),</li>
<li>evey Saturday.</li>
</ul>
</section>
<section id="new-rules-202601-3" class="slide level2 smaller" style="color: #000;">
<h2>New rules 2026/01</h2>
<p>There is no Reaval anymore</p>
<ul>
<li>Instead, you can ask for a <em>Recupera√ß√£o</em></li>
<li>Still 5,00 to 5,99</li>
<li>Exams of summer/winter courses</li>
<li>You can follow the classes of summer/winter courses</li>
</ul>
</section>
<section id="new-rules-202601-4" class="slide level2 smaller" style="color: #000;">
<h2>New rules 2026/01</h2>
<p>Stricter penalties for problems during exams</p>
<ul>
<li>Weeks/Months of penaly</li>
</ul>
</section>
<section id="section-1" class="slide level2 smaller" style="color: #000;">
<h2></h2>
<p>BERK, Jonathan, DeMARZO, Peter. Corporate Finance, Global Edition. 5th edition, Boston, MA: Pearson, 2019. <a href="https://amzn.to/3jl9YPl">https://amzn.to/3jl9YPl</a></p>
<center>
<img data-src="../figs/berkdemarzo.jpg">
</center>
</section>


<section id="about-notes" class="slide level2 smaller" style="color: #000;">
<h2>About notes</h2>
<center>
<img data-src="../figs/share_slides.png">
</center>
<p>Worthington, D. L., &amp; Levasseur, D. G. (2015). To provide or not to provide course PowerPoint slides? The impact of instructor-provided slides upon student attendance and performance. Computers &amp; Education, 85, 14-22.</p>
</section>
<section id="about-notes-1" class="slide level2 smaller" style="color: #000;">
<h2>About notes</h2>
<center>
<img data-src="paper0.png">
</center>
</section>
<section id="about-notes-2" class="slide level2 smaller" style="color: #000;">
<h2>About notes</h2>
<div>
<ul>
<li class="fragment"><p><em>Participants were 67 students (33 male, 33 female, 1 unknown) from the Princeton University subject pool.</em></p></li>
<li class="fragment"><p><em>We selected five TED Talks (for length (slightly over 15 min) and to cover topics that would be interesting but not common knowledge. Laptops had full-size (11-in. √ó 4-in.) keyboards and were disconnected from the Internet.</em></p></li>
<li class="fragment"><p><em>Participants watched the lecture</em>.</p></li>
<li class="fragment"><p><em>Next, participants were taken to a lab; they completed two 5-min distractor tasks and engaged in a taxing working memory task </em></p></li>
<li class="fragment"><p><em>Finally, participants responded to both <strong>factual-recall questions</strong> (e.g., ‚ÄúApproximately how many years ago did the Indus civilization exist?‚Äù) and <strong>conceptual-application questions</strong> (e.g., ‚ÄúHow do Japan and Sweden differ in their approaches to equality within their societies?‚Äù) about the lecture and completed demographic measures.</em></p></li>
</ul>
</div>
</section>
<section id="section-2" class="slide level2 smaller" style="color: #000;">
<h2></h2>
<center>
<img data-src="paper2.png">
</center>
</section>
<section id="section-3" class="slide level2 smaller" style="color: #000;">
<h2></h2>
<center>
<img data-src="paper3.png">
</center>
</section>
<section id="section-4" class="slide level2 smaller" style="color: #000;">
<h2></h2>
<center>
<img data-src="paper1.png">
</center>
</section>
<section id="about-notes-3" class="slide level2 smaller" style="color: #000;">
<h2>About notes</h2>
<center>
<img data-src="paper4.png">
</center>
</section>
<section id="about-notes-4" class="slide level2 smaller" style="color: #000;">
<h2>About notes</h2>
<center>
<img data-src="forms1.png" style="width:140.0%" data-heigth="140%">
</center>
</section>
<section id="performance-assessment" class="slide level2 smaller" style="color: #000;">
<h2>Performance assessment</h2>
<p>1 Midterm Exam: <strong>40%</strong></p>
<div class="fragment">
<p>2 Final Exam: <strong>40%</strong></p>
</div>
<div class="fragment">
<p>3 Activities: <strong>20%</strong></p>
<ul>
<li>Quizzes and ‚ÄúMonitored activity‚Äù</li>
<li>Participation</li>
</ul>
</div>
</section>
<section id="read-the-syllabus" class="slide level2 smaller" style="color: #000;">
<h2>Read the Syllabus</h2>
<center>
<img data-src="../figs/syllabus.gif">
</center>
</section></section>
<section>

<section id="how-to-study-source" class="slide level2 smaller" style="color: #000;">
<h2>How to study? (<a href="https://www.bbc.com/portuguese/geral-64354629">Source</a>)</h2>

<img data-src="../figs/howtostudy1.png" class="r-stretch"></section>
<section id="how-to-study-source-1" class="slide level2 smaller" style="color: #000;">
<h2>How to study? (<a href="https://www.bbc.com/portuguese/geral-64354629">Source</a>)</h2>

<img data-src="../figs/howtostudy2.png" class="r-stretch"></section>
<section id="how-to-study-source-2" class="slide level2 smaller" style="color: #000;">
<h2>How to study? (<a href="https://www.bbc.com/portuguese/geral-64354629">Source</a>)</h2>

<img data-src="../figs/howtostudy3.png" class="r-stretch"></section>
<section id="how-to-study-source-3" class="slide level2 smaller" style="color: #000;">
<h2>How to study? (<a href="https://www.bbc.com/portuguese/geral-64354629">Source</a>)</h2>

<img data-src="../figs/howtostudy4.png" class="r-stretch"></section>
<section id="how-to-study-source-4" class="slide level2 smaller" style="color: #000;">
<h2>How to study? (<a href="https://www.bbc.com/portuguese/geral-64354629">Source</a>)</h2>

<img data-src="../figs/howtostudy5.png" class="r-stretch"></section>


<section id="warming-up" class="slide level2 smaller" style="color: #000;">
<h2>Warming up‚Ä¶</h2>
<div class="collumns">
<div class="column" style="width:30.5%;">
<p><img data-src="../figs/movie1.jpg"></p>
</div>
<div class="column" style="width:31.5%;">
<p><img data-src="../figs/movie2.jpg"></p>
</div>
<div class="column" style="width:30%;">
<p><img data-src="../figs/movie3.jpg"></p>
</div>
</div>
</section>
<section id="warming-up-1" class="slide level2 smaller" style="color: #000;">
<h2>Warming up‚Ä¶</h2>
<div class="collumns">
<div class="column" style="width:34%;">
<p><img data-src="../figs/movie6.jpg"></p>
</div>
<div class="column" style="width:30%;">
<p><img data-src="../figs/movie7.jpg"></p>
</div>
<div class="column" style="width:30%;">
<p><img data-src="../figs/movie5.jpg"></p>
</div>
</div>
</section>

<section id="what-is-finance" class="slide level2 smaller" style="color: #000;">
<h2><strong>What is Finance?</strong></h2>

<img data-src="../figs/whatisfinance1.png" class="r-stretch"><p><strong>What is missing?</strong></p>
</section>
<section id="what-is-finance-1" class="slide level2 smaller" style="color: #000;">
<h2><strong>What is Finance?</strong></h2>

<img data-src="../figs/whatisfinance2.png" class="r-stretch"><p><strong>Which of these answers is better?</strong></p>
</section>
<section id="section-5" class="slide level2" data-background="#f7f9fc">
<h2></h2>
<div data-ticket="" data-bridge="https://course-chat.hcmrtns.workers.dev/checkouts" data-session="What is Finance?" data-page="What is Finance?" data-require-login="true" data-question="How confident are you about today's content?" data-open="2025-02-02 15:30" data-close="2026-02-02 16:59">

</div>
<!-- checkout3.html ‚Äî Check-out ‚Üí Cloudflare Worker (JSON, CORS-safe) + Likert required + custom question label via data-question -->
<style>
  :root{
    --card-bg:#fff; --card-border:rgba(15,23,42,.06); --card-shadow:0 12px 30px rgba(17,24,39,.12);
    --ink:#0b1220; --muted:#3a4a5c; --muted-2:#2b3a4a; --line:#e9eef5; --pill-bg:#f5f9ff;
    --focus:rgba(59,130,246,.22);
    --btn-bg-1:#4f46e5; --btn-bg-2:#60a5fa; --btn-ink:#fff;
    --textarea-bg:#fff;

    --ribbon-open-1: rgba(34,197,94,.18);
    --ribbon-open-2: rgba(16,185,129,.16);
    --ribbon-soon-1: rgba(245,158,11,.18);
    --ribbon-soon-2: rgba(251,191,36,.16);
    --ribbon-closed-1: rgba(239,68,68,.20);
    --ribbon-closed-2: rgba(248,113,113,.16);
    --ribbon-default-1: rgba(99,102,241,.14);
    --ribbon-default-2: rgba(96,165,250,.14);

    --likert-bg: rgba(15,23,42,.06);
    --likert-border: rgba(15,23,42,.10);
    --likert-selected: rgba(79,70,229,.18);
    --likert-selected-border: rgba(79,70,229,.40);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --card-bg:rgba(15,23,42,.92); --card-border:rgba(148,163,184,.20); --card-shadow:0 16px 44px rgba(0,0,0,.55);
      --line:rgba(148,163,184,.28); --pill-bg:rgba(148,163,184,.18);
      --ink:#f8fafc; --muted:#e5edf6; --muted-2:#f1f5f9;
      --btn-bg-1:#5b7fff; --btn-bg-2:#7cc5ff; --btn-ink:#0b1220;
      --textarea-bg:rgba(2,6,23,.55);

      --likert-bg: rgba(148,163,184,.18);
      --likert-border: rgba(148,163,184,.26);
      --likert-selected: rgba(124,197,255,.22);
      --likert-selected-border: rgba(124,197,255,.52);
    }
  }

  [data-ticket] .tw-card{
    position:relative;background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;
    padding:16px;box-shadow:var(--card-shadow);backdrop-filter:saturate(120%) blur(6px);-webkit-backdrop-filter:saturate(120%) blur(6px);
    color:var(--ink);overflow:hidden;box-sizing:border-box;
  }
  [data-ticket] .tw-card::before{
    content:"";position:absolute;inset:0 0 auto 0;height:56px;
    background:linear-gradient(135deg,var(--ribbon-default-1),var(--ribbon-default-2));
    pointer-events:none;
  }
  [data-ticket].open   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-open-1),var(--ribbon-open-2)); }
  [data-ticket].soon   .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-soon-1),var(--ribbon-soon-2)); }
  [data-ticket].closed .tw-card::before{ background:linear-gradient(135deg,var(--ribbon-closed-1),var(--ribbon-closed-2)); }

  [data-ticket] .tw-header{display:flex;align-items:center;gap:12px;margin-bottom:10px;position:relative;z-index:1;}
  [data-ticket] .tw-icon{
    width:36px;height:36px;border-radius:12px;background:#1f2937;display:grid;place-items:center;flex:0 0 36px;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);position:relative;
  }
  [data-ticket] .tw-icon::after{
    content:"";position:absolute;inset:-3px;border-radius:14px;
    background:conic-gradient(from 120deg,rgba(79,70,229,.35),rgba(6,182,212,.35),rgba(79,70,229,.35));
    z-index:-1;filter:blur(6px);opacity:.55;
  }
  [data-ticket] .tw-icon svg{width:18px;height:18px;color:#fff;opacity:.96;}
  [data-ticket] .tw-titles{display:flex;flex-direction:column;gap:2px;}
  [data-ticket] .tw-title{font-weight:800;color:var(--ink);line-height:1.1;letter-spacing:.2px;}
  [data-ticket] .tw-sub{color:var(--muted);font-size:.92rem;}

  [data-ticket] .tw-meta{margin-left:auto;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
  [data-ticket] .tw-badge{
    display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;
    background:var(--pill-bg);color:var(--muted-2);font-size:.88rem;white-space:nowrap;box-shadow:0 1px 0 rgba(17,24,39,.04) inset;
  }
  [data-ticket] .tw-badge svg, [data-ticket] .tw-badge svg *, [data-ticket] .tw-badge .tw-window-text{
    color:currentColor;stroke:currentColor!important;fill:none;
  }
  [data-ticket] .tw-window-text{white-space:pre-line;}

  [data-ticket] .tw-dot{width:8px;height:8px;border-radius:50%;background:#94a3b8;}
  [data-ticket].open  .tw-dot{background:#16a34a;}
  [data-ticket].soon  .tw-dot{background:#f59e0b;}
  [data-ticket].closed.tw-dot,[data-ticket].closed .tw-dot{background:#ff4d4f;}

  [data-ticket] .tw-body{position:relative;z-index:1;box-sizing:border-box;}
  [data-ticket] textarea.tw-text{
    width:100%;border:1px solid var(--line);background:var(--textarea-bg);border-radius:14px;padding:12px 14px;
    font-size:1rem;line-height:1.5;outline:none;transition:border-color .15s,box-shadow .15s,transform .06s;min-height:120px;
    resize:vertical;color:var(--ink);box-sizing:border-box;
  }
  [data-ticket] textarea.tw-text:focus{border-color:#60a5fa;box-shadow:0 0 0 4px var(--focus);transform:translateY(-1px);}
  [data-ticket] textarea.tw-text::placeholder{color:#60758a;opacity:.9;}

  [data-ticket] .tw-footer{display:flex;align-items:center;gap:12px;margin-top:12px;flex-wrap:wrap;}
  [data-ticket] .tw-count{margin-left:auto;color:#60758a;font-size:.86rem;}
  [data-ticket] .tw-msg{margin-top:8px;font-size:.93rem;min-height:1.2em;font-weight:700;letter-spacing:.2px;}
  [data-ticket] .tw-msg.success{color:#059669!important;}
  [data-ticket] .tw-msg.error{color:#ff4d4f!important;}
  [data-ticket] .tw-msg.warning{color:#f59e0b!important;}
  [data-ticket].open  .tw-msg:not(.success):not(.error):not(.warning){color:#16a34a!important;}
  [data-ticket].soon  .tw-msg:not(.success):not(.error):not(.warning){color:#f59e0b!important;}
  [data-ticket].closed.tw-msg,[data-ticket].closed .tw-msg:not(.success):not(.error):not(.warning){color:#ff4d4f!important;}

  [data-ticket] .tw-btn{
    padding:10px 16px;border-radius:12px;border:1px solid rgba(15,23,42,.12);
    background:linear-gradient(135deg,var(--btn-bg-1),var(--btn-bg-2));color:var(--btn-ink);font-weight:800;cursor:pointer;
    box-shadow:0 4px 14px rgba(59,130,246,.25);transition:transform .08s ease,box-shadow .15s ease,filter .15s ease;letter-spacing:.2px;
  }
  [data-ticket] .tw-btn:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(59,130,246,.35);filter:saturate(108%);}
  [data-ticket] .tw-btn:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}
  [data-ticket] .tw-btn:disabled{opacity:.85;cursor:not-allowed;transform:none;background:#e5f0ff;color:#6b7280;border-color:#dbeafe;box-shadow:none;}
  [data-ticket] .tw-btn.sent{opacity:.92;cursor:default;}

  [data-ticket] .spin:after{
    content:"";display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid rgba(255,255,255,.65);
    border-top-color:transparent;border-radius:50%;animation:twspin .8s linear infinite;vertical-align:-2px;
  }
  @keyframes twspin{to{transform:rotate(360deg)}}

  [data-ticket] .tw-login{display:flex;gap:8px;align-items:center;margin:8px 0 12px 0}
  [data-ticket] .tw-login input{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--textarea-bg);color:var(--ink);outline:none}

  [data-ticket] .tw-likert{
    display:flex;align-items:center;gap:10px;
    padding:8px 10px;border-radius:12px;border:1px solid var(--line);
    background:var(--pill-bg);
  }
  [data-ticket] .tw-likert .tw-lab{
    font-size:.86rem;font-weight:800;color:var(--muted-2);white-space:nowrap;
  }
  [data-ticket] .tw-likert .tw-boxes{display:flex;gap:6px;}
  [data-ticket] .tw-likert button.tw-box{
    width:28px;height:28px;border-radius:9px;
    border:1px solid var(--likert-border);
    background:var(--likert-bg);
    color:var(--muted-2);
    font-weight:900;
    cursor:pointer;
    display:grid;place-items:center;
    transition:transform .06s, box-shadow .15s, border-color .15s, background .15s;
    user-select:none;
  }
  [data-ticket] .tw-likert button.tw-box:hover{transform:translateY(-1px);}
  [data-ticket] .tw-likert button.tw-box:focus-visible{outline:none;box-shadow:0 0 0 4px var(--focus);}
  [data-ticket] .tw-likert button.tw-box.selected{
    background:var(--likert-selected);
    border-color:var(--likert-selected-border);
  }

  @media (max-width:640px){
    [data-ticket] .tw-card{border-radius:14px;padding:14px;}
    [data-ticket] .tw-header{gap:10px;}
    [data-ticket] .tw-badge{padding:5px 9px;font-size:.82rem;}
    [data-ticket] .tw-likert{width:100%;justify-content:space-between;}
  }
</style>
<script>
(() => {
  const $ = (sel, el=document) => el.querySelector(sel);

  function mountAll(){
    document.querySelectorAll('[data-ticket]:not([data-tw-mounted])').forEach(initOne);
  }

  function initOne(host){
    host.setAttribute('data-tw-mounted','1');

    // ---- Config/attrs
    const bridge = (host.getAttribute('data-bridge') || window.BRIDGE_URL || '').trim();
    const sessionTag = (host.getAttribute('data-session') || '').trim();
    const pageAttr   = (host.getAttribute('data-page') || '').trim();
    const winStartStr= (host.getAttribute('data-open') || '').trim();
    const winEndStr  = (host.getAttribute('data-close') || '').trim();
    const requireLogin = String(host.getAttribute('data-require-login') || 'true').toLowerCase() !== 'false';

    // NEW: custom Likert question label
    const questionLabel = (host.getAttribute('data-question') || 'Confidence').trim();

    // limits
    const MIN_CHARS = 100;
    const MAX_CHARS = 500;

    // ---- Helpers
    const parseLocal = (ts) => ts ? new Date(ts.replace(' ','T')) : null;
    const winStart = parseLocal(winStartStr);
    const winEnd   = parseLocal(winEndStr);

    const fmtDur = (s) => { const m=Math.floor(s/60),r=s%60; if(m>=60){const h=Math.floor(m/60),mm=m%60;return `${h}h ${mm}m`;} if(m>0) return `${m}m ${r}s`; return `${r}s`; };
    function statusNow(){
      const now = new Date();
      if (!winStart || !winEnd) return {state:'open', label:'Always available'};
      if (now < winStart){ const s1=Math.max(0,Math.floor((winStart-now)/1000)); return {state:'soon', label:'Opens in '+fmtDur(s1)}; }
      if (now > winEnd)   return {state:'closed', label:'Closed'};
      const s2=Math.max(0,Math.floor((winEnd-now)/1000)); return {state:'open', label:'Closes in '+fmtDur(s2)};
    }
    const getStudentId = () => String(window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').trim();
    const getPageId = () => pageAttr || window.pageId || (location.pathname + location.hash);

    const setMsg = (el, text, cls) => { el.textContent = text || ''; el.className = 'tw-msg' + (cls ? ' ' + cls : ''); };
    const doneKey = () => `ticket_done:exit:${(sessionTag || getPageId() || 'page')}:${(getStudentId() || 'anon')}`;
    const isDone  = () => { try { return localStorage.getItem(doneKey()) === '1'; } catch(_) { return false; } };
    const markDone = (btn) => { try{ localStorage.setItem(doneKey(), '1'); }catch(_){}; btn.classList.remove('spin'); btn.disabled = true; btn.classList.add('sent'); btn.textContent = 'Sent ‚úì'; };

    // ---- UI skeleton
    host.innerHTML = '';
    const card = document.createElement('div'); card.className = 'tw-card';
    const windowLabel = (winStartStr && winEndStr) ? (winStartStr + '\n‚Üí ' + winEndStr) : 'No window set';

    card.innerHTML = `
      <div class="tw-header">
        <div class="tw-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 8v5l3 3M6 3h12a1 1 0 0 1 1 1v16l-7-3-7 3V4a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="tw-titles">
          <div class="tw-title">Check-out</div>
          <div class="tw-sub"></div>
        </div>
        <div class="tw-meta">
          <div class="tw-badge"><span class="tw-dot"></span><span class="tw-badge-text">‚Äî</span></div>
          <div class="tw-badge" title="S√£o Paulo time">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M12 7v5l4 2" stroke="#334155" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="9" stroke="#334155" stroke-width="1.5" fill="none"/></svg>
            <span class="tw-window-text">${windowLabel}</span>
          </div>
        </div>
      </div>

      <div class="tw-login" style="display:none">
        <input type="text" class="tw-login-input" placeholder="Digite seu ID / e-mail do curso"/>
        <button type="button" class="tw-btn tw-login-btn">Entrar</button>
      </div>

      <div class="tw-body"></div>

      <div class="tw-footer">
        <div class="tw-likert" role="group" aria-label="Likert question">
          <span class="tw-lab"></span>
          <div class="tw-boxes">
            <button type="button" class="tw-box" data-val="1" aria-label="1">1</button>
            <button type="button" class="tw-box" data-val="2" aria-label="2">2</button>
            <button type="button" class="tw-box" data-val="3" aria-label="3">3</button>
            <button type="button" class="tw-box" data-val="4" aria-label="4">4</button>
            <button type="button" class="tw-box" data-val="5" aria-label="5">5</button>
          </div>
        </div>

        <button type="button" class="tw-btn tw-send">Send (click only 1x)</button>
        <div class="tw-count">0/${MAX_CHARS}</div>
      </div>

      <div class="tw-msg"></div>`;
    host.appendChild(card);

    // refs
    const body = $('.tw-body', card);
    const btn  = $('.tw-send', card);
    const msg  = $('.tw-msg', card);
    const badgeText = $('.tw-badge-text', card);
    const count = $('.tw-count', card);
    const loginRow = $('.tw-login', card);
    const loginInp = $('.tw-login-input', card);
    const loginBtn = $('.tw-login-btn', card);
    const likertLabelEl = $('.tw-lab', card);
    const likertBoxes = Array.from(card.querySelectorAll('.tw-box'));

    // set label
    likertLabelEl.textContent = questionLabel || 'Confidence';

    // state
    let likertValue = 0;

    // textarea
    const ta = document.createElement('textarea');
    ta.className = 'tw-text';
    ta.maxLength = MAX_CHARS;
    ta.placeholder = `Your check-out (min ${MIN_CHARS}, max ${MAX_CHARS}): one thing you learned + one question‚Ä¶`;
    body.appendChild(ta);

    function updateCount(){
      count.textContent = `${ta.value.length}/${MAX_CHARS}`;
    }
    ta.addEventListener('input', () => { updateCount(); syncEnabled(); });
    updateCount();

    const successMsg = 'Check-out recorded. Thank you!';
    const dupMsg     = 'You have already completed the check-out for this session. Thanks!';

    function paintBadge(){
      const st = statusNow();
      host.classList.remove('open','soon','closed'); host.classList.add(st.state);
      badgeText.textContent = st.label;
    }

    function showLoginIfNeeded(){
      const need = requireLogin && !getStudentId();
      loginRow.style.display = need ? 'flex' : 'none';
    }

    function setLikert(val){
      likertValue = val;
      likertBoxes.forEach(b => {
        const v = parseInt(b.getAttribute('data-val'), 10);
        b.classList.toggle('selected', v === likertValue);
        b.setAttribute('aria-pressed', (v === likertValue) ? 'true' : 'false');
      });
    }

    likertBoxes.forEach(b => {
      b.addEventListener('click', () => {
        const v = parseInt(b.getAttribute('data-val'), 10) || 0;
        setLikert(v);
        setMsg(msg, '');
        syncEnabled();
      });
    });

    function syncEnabled(){
      const logged = !requireLogin || !!getStudentId();
      const st     = statusNow().state;
      const len    = ta.value.trim().length;

      const filled = len >= MIN_CHARS;
      const rated  = likertValue >= 1 && likertValue <= 5;

      const enabled= logged && (st==='open') && filled && rated && !isDone();
      btn.disabled = !enabled;

      showLoginIfNeeded(); paintBadge();

      if (isDone()){
        setMsg(msg, dupMsg, 'success');
        btn.textContent = 'Sent ‚úì'; btn.classList.add('sent'); btn.disabled = true;
      } else if (!logged) setMsg(msg,'Please log in to submit.','warning');
      else if (st==='soon') setMsg(msg,'Not open yet.','warning');
      else if (st==='closed') setMsg(msg,'This activity is closed.','error');
      else if (!filled) setMsg(msg, `Write at least ${MIN_CHARS} characters to submit.`, 'warning');
      else if (!rated) setMsg(msg, `Please answer: ${questionLabel} (1‚Äì5).`, 'warning');
      else setMsg(msg,'');
    }

    // mini-login
    loginBtn?.addEventListener('click', () => {
      const v = (loginInp.value || '').trim();
      if (!v) { setMsg(msg,'Informe seu ID para continuar.','warning'); return; }
      try { localStorage.setItem('studentId', v); } catch {}
      window.studentId = v;
      document.dispatchEvent(new Event('auth:login'));
      setMsg(msg,''); syncEnabled();
    });

    // timers + cleanup
    paintBadge(); syncEnabled();
    const ticker = setInterval(() => { paintBadge(); syncEnabled(); }, 1000);
    const obs = new MutationObserver(() => {
      if(!document.body.contains(host)){ clearInterval(ticker); obs.disconnect(); }
    });
    obs.observe(document.body, {childList:true, subtree:true});
    document.addEventListener('auth:login', syncEnabled);

    // Submit
    btn.addEventListener('click', async (e) => {
      e.preventDefault(); e.stopPropagation();

      const sid = getStudentId();
      if (requireLogin && !sid){ setMsg(msg,'Please log in to submit.','warning'); return; }

      const text = ta.value.trim().slice(0,MAX_CHARS);
      if (text.length < MIN_CHARS){ setMsg(msg, `Write at least ${MIN_CHARS} characters to submit.`, 'warning'); return; }
      if (!(likertValue >= 1 && likertValue <= 5)){ setMsg(msg, `Please answer: ${questionLabel} (1‚Äì5).`, 'warning'); return; }
      if (!bridge){ setMsg(msg,'Missing BRIDGE URL.','error'); return; }

      btn.classList.add('spin'); btn.disabled = true; setMsg(msg,'');

      const payload = {
        student_id: sid,
        slide_id: (sessionTag || getPageId()),
        ticket: text,

        // Likert (custom question)
        likert_question: questionLabel,
        likert_value: likertValue,

        tsClient: new Date().toISOString(),
        open:  winStartStr,
        close: winEndStr,
        user_agent: navigator.userAgent
      };

      try{
        const res = await fetch(bridge, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload),
          keepalive:true
        });

        const raw = await res.text();
        let data = null; try{ data = JSON.parse(raw); }catch(_){}

        if (!res.ok){
          if (data && data.status === 'closed_window'){
            setMsg(msg,'This activity is closed now.','error');
          } else {
            setMsg(msg,'Failed to submit. Please try again.','error');
          }
          console.error('[checkout3] HTTP error:', res.status, raw);
          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
          return;
        }

        if (data && data.status === 'success'){
          setMsg(msg, successMsg, 'success');
          ta.value=''; updateCount();
          setLikert(0);
          markDone(btn); clearInterval(ticker);
          return;
        }
        if (data && data.status === 'duplicate'){
          setMsg(msg, dupMsg, 'success'); markDone(btn); clearInterval(ticker); return;
        }
        if (data && data.status === 'closed_window'){
          setMsg(msg,'This activity is closed now.','error');
          btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
          return;
        }

        setMsg(msg,'Failed to submit. Please try again.','error');
        console.error('[checkout3] unexpected response:', raw);
        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
      }catch(err){
        console.error('[checkout3] submit error:', err);
        setMsg(msg,'Network error. Please try again.','error');
        btn.classList.remove('spin'); btn.disabled = false; btn.textContent = 'Send (click only 1x)';
      }
    });
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', mountAll, { once:true });
  } else {
    mountAll();
  }
})();
</script>
</section>
<section id="finance-is-a-time-machine" class="slide level2 smaller" style="color: #000;">
<h2>Finance is a time machine</h2>
<p><em>Finance is an applied science that deals with the allocation of scarce resources over time under conditions of uncertainty.</em> (<a href="https://www.annualreviews.org/doi/pdf/10.1146/annurev-financial-011019-040506">Source</a>)</p>

<img data-src="../figs/time_machine.jpg" class="r-stretch"></section>

<section id="any-questions" class="slide level2" data-background="#b1cafa">
<h2>üôã‚Äç‚ôÇÔ∏è <strong>Any Questions?</strong></h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="thank-you">Thank You!</h3>
<p><img data-src="../figs/qa2.png" style="margin-top: 10px;;width:110.0%"></p>
</div><div class="column" style="width:50%;">
<h3 id="henrique-c.-martins">üë§ <strong>Henrique C. Martins</strong></h3>
<ul>
<li>üåê <a href="https://eaesp.fgv.br/en/people/henrique-castro-martins">FGV/EAESP</a><br>
</li>
<li>üíº <a href="https://www.linkedin.com/in/henriquecastror/">LinkedIn</a><br>
</li>
<li>üß† <a href="https://scholar.google.com.br/citations?user=7gIfkRMAAAAJ&amp;hl=pt-BR&amp;oi=ao">Google Scholar</a><br>
</li>
<li>üìÑ <a href="http://lattes.cnpq.br/6076997472159785">Lattes CV</a><br>
</li>
<li>üè† <a href="https://henriquemartins.net/">Personal Website</a><br>
</li>
</ul>
</div>
</div>

<div class="quarto-auto-generated-content">
<p><img src="../figs/background8.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><span style="font-size:10px"> [<a href="mailto:henrique.martins@fgv.br">Henrique C. Martins</a>] [<a href="https://henriquemartins.net/teaching/financial_strategy/">Teaching Resources</a>]<strong>[Do not use without permission]</strong></span></p>
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <!-- dm.html -->
    <script>
    (function () {
      try {
        // -----------------------------
        // Helpers
        // -----------------------------
        function getCookie(name) {
          const value = "; " + document.cookie;
          const parts = value.split("; " + name + "=");
          if (parts.length === 2) return parts.pop().split(";").shift();
          return null;
        }

        function getSid() {
          return (getCookie("student_id") || localStorage.getItem("studentId") || "")
            .trim()
            .toLowerCase();
        }

        function escapeHtml(str) {
          return String(str ?? "")
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
        }

        function isLocked() {
          const htmlLocked = document.documentElement?.classList?.contains("locked");
          const bodyLocked = document.body?.classList?.contains("locked"); // body pode ser null
          const anyLockedEl = !!document.querySelector(".locked");
          return !!(htmlLocked || bodyLocked || anyLockedEl);
        }

        // Se voc√™ j√° define WORKER_BASE em outro include, √≥timo.
        const WORKER_BASE =
          (window.WORKER_BASE && String(window.WORKER_BASE).trim()) ||
          "https://course-chat.hcmrtns.workers.dev";

        // -----------------------------
        // CSS animation (uma vez s√≥)
        // -----------------------------
        function ensureStyle() {
          if (document.getElementById("dm-toast-style")) return;
          const style = document.createElement("style");
          style.id = "dm-toast-style";
          style.innerHTML =
            "@keyframes dmSlideIn { from { transform:translateX(100%); opacity:0; } to { transform:translateX(0); opacity:1; } }";
          document.head.appendChild(style);
        }

        // -----------------------------
        // Inject toast
        // -----------------------------
        function injectToast(m, sid) {
          if (document.getElementById("dm-toast-container")) return;

          const original = m && m.original_ticket ? String(m.original_ticket) : "";
          const originalWhen = m && m.original_when ? String(m.original_when) : "";

          const toast = document.createElement("div");
          toast.id = "dm-toast-container";
          toast.setAttribute(
            "style",
            [
              "position:fixed",
              "top:20px",
              "right:20px",
              "background:#1e3a8a",
              "color:white",
              "padding:18px",
              "border-radius:12px",
              "box-shadow:0 10px 30px rgba(0,0,0,0.5)",
              "z-index:2147483647",
              "max-width:360px",
              "font-family:sans-serif",
              "border:2px solid #a78bfa",
              "animation: dmSlideIn 0.5s ease-out"
            ].join(";")
          );

          toast.innerHTML =
            '<div style="font-weight:800; font-size:11px; color:#a78bfa; margin-bottom:10px; text-transform:uppercase; letter-spacing:1px;">Mensagem do Professor</div>' +

            (original
              ? (
                '<div style="background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); padding:10px; border-radius:10px; margin-bottom:12px;">' +
                  '<div style="font-size:10px; font-weight:800; color:#c7d2fe; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px;">Sua mensagem (checkout)</div>' +
                  '<div style="font-size:13px; line-height:1.45; color:#e5e7eb; white-space:pre-wrap;">' + escapeHtml(original) + "</div>" +
                  (originalWhen
                    ? '<div style="margin-top:6px; font-size:10px; color:#cbd5e1; opacity:0.95;">' + escapeHtml(originalWhen) + "</div>"
                    : ""
                  ) +
                "</div>"
              )
              : ""
            ) +

            '<div style="font-size:14px; line-height:1.5; margin-bottom:12px; font-weight:500; white-space:pre-wrap;">' +
              escapeHtml((m && m.message_text) || "") +
            "</div>" +

            '<button id="dmReadBtn" style="background:#a78bfa; border:none; color:#0b1220; padding:10px; border-radius:6px; cursor:pointer; font-weight:800; width:100%; font-size:12px;">OK, ENTENDI</button>';

          document.body.appendChild(toast);

          const btn = document.getElementById("dmReadBtn");
          if (btn) {
            btn.onclick = function () {
              fetch(WORKER_BASE + "/api/messages/mark-read", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message_id: m.id, student_id: sid })
              })
              .then(() => toast.remove())
              .catch(() => toast.remove());
            };
          }
        }

        // -----------------------------
        // DM check (s√≥ roda quando tiver sid e estiver unlocked)
        // -----------------------------
        let started = false; // evita duplicar loop
        function startLoop() {
          if (started) return;
          started = true;

          ensureStyle();

          let tries = 0;
          const maxTries = 240; // 240 * 500ms = 2 minutos (ajuste se quiser)

          const tick = () => {
            tries++;

            // 1) espera login criar sid
            const sid = getSid();
            if (!sid) {
              if (tries < maxTries) return setTimeout(tick, 500);
              return; // desiste silenciosamente
            }

            // 2) espera unlock
            if (isLocked()) {
              if (tries < maxTries) return setTimeout(tick, 500);
              return;
            }

            // 3) agora sim: faz fetch e tenta mostrar
            fetch(WORKER_BASE + "/api/messages/check?sid=" + encodeURIComponent(sid))
              .then((r) => r.json())
              .then((data) => {
                if (data && data.message) {
                  injectToast(data.message, sid);
                }
              })
              .catch((err) => console.error("DM Fetch Error:", err));

            // Opcional: se quiser checar novas DMs de tempos em tempos:
            // setTimeout(tick, 15000);
          };

          tick();
        }

        // Garante body pronto (porque vamos injetar toast)
        if (document.readyState === "loading") {
          window.addEventListener("DOMContentLoaded", startLoop);
        } else {
          startLoop();
        }

      } catch (e) {
        console.warn("Erro isolado no script de DM:", e);
      }
    })();
    </script>
    <style>
    :root {
      --brand1: #4f46e5;
      --brand2: #06b6d4;

      /* FUNDO CLARO + TEXTO PRETO */
      --bg-panel: #ffffff;
      --bg-body: #f8fafc;
      --text-main: #0f172a;

      /* Bolhas mais claras */
      --msg-user-bg: #e0e7ff;
      --msg-user-text: #0f172a;
      --msg-ai-bg: #eef2ff;
      --msg-ai-text: #0f172a;

      --border-color: #e2e8f0;
      --shadow: 0 18px 60px rgba(0,0,0,0.25), 0 2px 8px rgba(0,0,0,0.12);

      /* barras (top/bottom) escuras no estilo ranking */
      --bar-bg: rgba(46, 58, 78, 0.92);
      --bar-border: rgba(255,255,255,0.12);
      --bar-text: #ffffff;
    }



      /* Bot√£o Flutuante (FAB) */
      .vhcm-fab { position: fixed; right: 20px; bottom: 20px; z-index: 9999; }
      .vhcm-fab button { 
        border: none; border-radius: 16px; padding: 15px 20px; cursor: pointer; 
        background: linear-gradient(135deg, var(--brand1), var(--brand2)); 
        color: #fff; font-weight: bold; box-shadow: 0 10px 25px rgba(79,70,229,0.3);
        display: flex; align-items: center; gap: 8px;
      }

      /* Painel do Chat */
    .vhcm-panel { 
      position: fixed; right: 20px; bottom: 90px; 
      width: 350px; height: 550px; 
      display: none; flex-direction: column; 
      background: var(--bg-panel);
      border-radius: 20px; 
      box-shadow: var(--shadow); 
      overflow: hidden; 
      z-index: 9999;
      border: 1px solid var(--border-color);
      resize: both; min-width: 280px; min-height: 400px;
    }



    .vhcm-header { 
      padding: 15px;
      background: var(--bar-bg);
      border-bottom: 1px solid var(--bar-border);
      display: flex; justify-content: space-between; align-items: center;
    }

    .vhcm-header strong { color: var(--bar-text); font-size: 18px; }
    .vhcm-module-badge {
      font-size: 11px;
      background: rgba(255,255,255,0.12);
      padding: 2px 8px;
      border-radius: 10px;
      color: rgba(255,255,255,0.85);
      border: 1px solid rgba(255,255,255,0.14);
    }


    .vhcm-body { 
      flex: 1; overflow-y: auto; padding: 20px; 
      background: var(--bg-body);
      display: flex; flex-direction: column; gap: 12px;
    }


      /* Mensagens Estilo Worker */
      .vhcm-msg { 
        max-width: 89%; padding: 11px 16px; border-radius: 15px; 
        line-height: 1.6; font-size: 15px; word-wrap: break-word;
      }
      .vhcm-msg.user { 
        background: var(--msg-user-bg); color: var(--msg-user-text); 
        align-self: flex-end; border-bottom-right-radius: 2px;
      }
      .vhcm-msg.ai { 
        background: var(--msg-ai-bg); color: var(--msg-ai-text); 
        align-self: flex-start; border-bottom-left-radius: 2px;
      }

      .vhcm-typing { font-size: 12px; color: #94a3b8; padding: 5px 20px; display: none; }

      /* Input Area */
    .vhcm-input-area { 
      padding: 15px;
      border-top: 1px solid var(--bar-border);
      display: flex; gap: 10px;
      background: var(--bar-bg);
    }


    .vhcm-input-area textarea { 
      flex: 1;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      color: #ffffff;
      border-radius: 10px;
      padding: 10px;
      resize: none;
      font-family: inherit;
      font-size: 16px;
      outline: none;
      max-height: 110px;
    }
    .vhcm-input-area textarea::placeholder { color: rgba(255,255,255,0.70); }
    .vhcm-input-area textarea:focus { border-color: rgba(167, 139, 250, 0.65); }

    .vhcm-input-area textarea:focus { border-color: rgba(167, 139, 250, 0.55); }
    .vhcm-input-area textarea::placeholder { color: rgba(255,255,255,0.70); }

      .vhcm-input-area textarea:focus { border-color: var(--brand1); }
      
      .vhcm-send { 
        background: var(--brand1); color: white; border: none; 
        border-radius: 10px; padding: 0 15px; cursor: pointer; font-weight: bold;
        transition: opacity 0.2s;
      }
      .vhcm-send:hover { opacity: 0.9; }

      .vhcm-close { border: none; background: none; cursor: pointer; font-size: 18px; color: #94a3b8; }
    </style>

    <div class="vhcm-fab">
      <button id="vhcm-open">üí¨ Open Virtual HCM</button>
    </div>

    <div class="vhcm-panel" id="vhcm-panel">
      <div class="vhcm-header">
        <div>
          <strong>Ask me anything...</strong>
        </div>
        <button id="vhcm-close" class="vhcm-close">‚úï</button>
      </div>
      <div class="vhcm-body" id="vhcm-body">
        </div>
      <div class="vhcm-typing" id="vhcm-typing">Virtual HCM is thinking...</div>
      <div class="vhcm-input-area">
        <textarea id="vhcm-text" placeholder="FYI: I'm still learning..." rows="1"></textarea>
        <button id="vhcm-send" class="vhcm-send">Send</button>
      </div>
    </div>

    <script>
    (function(){
      const API_URL = "https://chatbot.hcmrtns.workers.dev/";
      const panel = document.getElementById('vhcm-panel');
      const chatBody = document.getElementById('vhcm-body');
      const textInput = document.getElementById('vhcm-text');
      const typingIndicator = document.getElementById('vhcm-typing');

      // Abrir/Fechar
      document.getElementById('vhcm-open').onclick = () => {
      const isOpen = panel.style.display === 'flex';
      panel.style.display = isOpen ? 'none' : 'flex';
    };

      document.getElementById('vhcm-close').onclick = () => panel.style.display = 'none';

      function detectModule() {
        try {
          if (window.Reveal) {
            const s = Reveal.getCurrentSlide();
            return s.dataset.module || s.getAttribute('data-module') ;
          }
        } catch(e) {}
        return '';
      }

      function getStudent() {
        return localStorage.getItem('fs_user') || 'Student';
      }

      function addMessage(text, isUser) {
        const msg = document.createElement('div');
        msg.className = 'vhcm-msg ' + (isUser ? 'user' : 'ai');
        // Substitui quebras de linha por <br> e renderiza HTML simples (para o label üìñ/üåê)
        msg.innerHTML = text.replace(/\n/g, '<br>');
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      async function sendMessage() {
        const question = textInput.value.trim();
        if (!question) return;

        addMessage(question, true);
        textInput.value = '';
        typingIndicator.style.display = 'block';

        try {
          const res = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ 
              question: question, 
              student: getStudent(), 
              module: detectModule() 
            })
          });
          const data = await res.json();
          typingIndicator.style.display = 'none';
          addMessage(data.answer, false);
        } catch(e) {
          typingIndicator.style.display = 'none';
          addMessage("‚ö†Ô∏è Error connecting to server.", false);
        }
      }

      document.getElementById('vhcm-send').onclick = sendMessage;
      textInput.onkeydown = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };

      // Sincronizar label do m√≥dulo
      setInterval(() => {
        document.getElementById('vhcm-module-label').textContent = detectModule();
      }, 2000);
    })();
    </script>
    <style>
      html.locked .requires-auth, body.locked .requires-auth { display: none !important; }

      :root {
        --lb-bg: rgba(46, 58, 78, 0.85);
        --lb-border: rgba(255, 255, 255, 0.12);
        --lb-shadow: 0 18px 60px rgba(0, 0, 0, 0.45), 0 2px 8px rgba(0, 0, 0, 0.18);
        --lb-radius: 18px;
        --lb-accent: #a78bfa;
        --lb-accent-weak: rgba(167, 139, 250, 0.25);
        --pill-start: #6d5df5; 
        --pill-end: #2ec5ff;
      }

      /* POSICIONAMENTO √Ä ESQUERDA */
      .lb-panel { 
        position: fixed; 
        bottom: 20px; 
        left: 20px; 
        z-index: 2147483647; 
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
      }

      /* BOT√ÉO ESTILO P√çLULA (IGUAL AO VIRTUAL HCM) */
      .lb-toggle { 
        height: 40px; 
        padding: 0 16px 0 12px; 
        border-radius: 999px; 
        display: inline-flex; 
        align-items: center; 
        justify-content: center; 
        gap: 8px; 
        border: none;
        background: linear-gradient(135deg, var(--pill-start), var(--pill-end)); 
        color: #fff; 
        box-shadow: 0 10px 28px rgba(2, 6, 23, 0.30), inset 0 0 0 1px rgba(255, 255, 255, 0.14);
        cursor: pointer; 
        user-select: none; 
        transition: transform .12s ease, box-shadow .12s ease, filter .12s ease; 
      }
      
      .lb-toggle:hover { transform: translateY(-1px); filter: brightness(1.05); }
      .lb-toggle:active { transform: translateY(0); filter: brightness(.98); }

      .lb-label-text {
        font-size: 14px;
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      .lb-icon { font-size: 18px; line-height: 1; }

      /* CARD AJUSTADO PARA ABRIR DA ESQUERDA */
      .lb-card {
        margin-top: 10px; 
        width: 500px; 
        max-height: 62vh; 
        overflow: auto; 
        border: 1px solid var(--lb-border); 
        background: var(--lb-bg);
        -webkit-backdrop-filter: saturate(160%) blur(12px); 
        backdrop-filter: saturate(160%) blur(12px); 
        border-radius: var(--lb-radius); 
        box-shadow: var(--lb-shadow);
        display: none; 
        position: absolute; 
        bottom: 52px; 
        left: 0; 
        transform-origin: bottom left; 
        color: #e5e7eb;
      }
      
      .lb-card.open { display: block; animation: lbPop .18s cubic-bezier(.2, .9, .2, 1); }
      
      @keyframes lbPop { 
        from { transform: scale(.95); opacity: 0 } 
        to { transform: scale(1); opacity: 1 } 
      }

      .lb-header { 
        padding: 12px 14px; 
        border-bottom: 1px solid rgba(255, 255, 255, .1); 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        background: linear-gradient(180deg, rgba(167, 139, 250, .15), transparent 60%); 
        border-top-left-radius: var(--lb-radius); 
        border-top-right-radius: var(--lb-radius);
        position: sticky; 
        top: 0; 
        z-index: 10;
        backdrop-filter: blur(6px); 
      }

      .lb-title { font-weight: 800; letter-spacing: .2px; color: #fff; }

      .lb-list { list-style: none; margin: 0; padding: 6px 0 8px; }
      .lb-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; border-bottom: 1px dashed rgba(255, 255, 255, .06); }
      .lb-item:last-child { border-bottom: 0; }

      .lb-left { display: flex; align-items: center; gap: 10px; min-width: 0; }
      .lb-rank { width: 28px; text-align: right; font-variant-numeric: tabular-nums; color: #fde68a; font-weight: 700; }
      .lb-item.top-2 .lb-rank { color: #cbd5e1; } 
      .lb-item.top-3 .lb-rank { color: #d8b4fe; }

      .lb-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #e5e7eb; }
      .lb-points { font-variant-numeric: tabular-nums; font-weight: 600; color: #f3f4f6; }

      .lb-footer { 
        padding: 12px 14px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        gap: 8px; 
        border-top: 1px solid rgba(255, 255, 255, .1);
        background: rgba(0, 0, 0, 0.2); 
        border-bottom-left-radius: var(--lb-radius); 
        border-bottom-right-radius: var(--lb-radius);
        position: sticky; 
        bottom: 0; 
        backdrop-filter: blur(6px); 
      }
      
      .lb-badge-me { background: var(--pill-start); padding: 4px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; color: #fff; }

      @media (max-width: 820px) { 
        .lb-panel { left: 12px; bottom: 88px; } 
        .lb-card { position: fixed; left: 12px; right: 12px; bottom: 88px; width: auto; height: 58vh; max-height: none; transform-origin: bottom center; } 
      }
    </style>

    <div class="requires-auth">
      <div class="lb-panel" id="lbPanel2">
        <button class="lb-toggle" id="lbToggle2" title="Ranking" aria-label="Open ranking">
          <span class="lb-icon">üèÜ</span>
          <span class="lb-label-text">Ranking</span>
        </button>
        <div class="lb-card" id="lbCard2" role="dialog" aria-modal="false" aria-label="Ranking">
          <div class="lb-header">
            <div class="lb-title">Top <span id="lbTopN2">5</span></div>
          </div>
          <ul class="lb-list" id="lbList2"></ul>
          <div class="lb-footer"><span id="lbMe2"></span></div>
        </div>
      </div>
    </div>

    <script>
      const LB_ENDPOINT = 'https://course-chat.hcmrtns.workers.dev/ranking';
      const LB_TOP = 5;
      const LB_POLL_MS = 3000;

      let LB_STUDENT = (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '').toString();

      const $ = (id) => document.getElementById(id);
      const lbToggle  = $('lbToggle2');
      const lbCard    = $('lbCard2');
      const lbList    = $('lbList2');
      const lbTopNEl  = $('lbTopN2');
      const lbMeEl    = $('lbMe2');
      lbTopNEl.textContent = LB_TOP;

      document.addEventListener('auth:login', (ev) => {
        const sid = (ev && ev.detail && ev.detail.studentId) ? ev.detail.studentId :
          (window.studentId || localStorage.getItem('studentId') || localStorage.getItem('fs_user') || '');
        if (sid) { 
          LB_STUDENT = String(sid); 
          if (lbCard.classList.contains('open')) fetchRanking(); 
        }
      });

      lbToggle.addEventListener('click', () => {
        const open = lbCard.classList.contains('open');
        if (open) {
          lbCard.classList.remove('open');
        } else {
          lbCard.classList.add('open');
          fetchRanking();
        }
      });
      
      document.addEventListener('keydown', (e) => { if(e.key === 'Escape') lbCard.classList.remove('open'); });

      async function fetchRanking() {
        try {
          const who = LB_STUDENT || 'anonymous';
          const url = `${LB_ENDPOINT}?top=${LB_TOP}&who=${encodeURIComponent(who)}`;
          const res = await fetch(url, { method: 'GET' });
          const data = await res.json();
          if (!data.ok && data.status !== 'success') throw new Error(data.error || 'Failed');
          renderTop(data.top, data.me);
        } catch (e) {
          console.error('Ranking error:', e);
          lbList.innerHTML = '<li class="lb-item"><div class="lb-name" style="opacity:.6">Updating ranking...</div></li>';
        }
      }

    function renderTop(top, me) {
        lbList.innerHTML = '';
        
        // 1. Renderiza a lista p√∫blica (Sem detalhes individuais)
        if (!top || !top.length) {
            lbList.innerHTML = '<li class="lb-item"><div class="lb-name" style="opacity:.8">No points yet.</div></li>';
        } else {
            for (const row of top) {
                const li = document.createElement('li'); 
                li.className = 'lb-item';
                if (row.rank <= 3) li.classList.add(`top-${row.rank}`);
                
                const left = document.createElement('div'); 
                left.className = 'lb-left';
                
                const rk = document.createElement('div'); 
                rk.className = 'lb-rank'; 
                rk.textContent = row.rank;
                
                const nm = document.createElement('div'); 
                nm.className = 'lb-name'; 
                nm.textContent = row.name || row.studentId || row.student;
                
                left.appendChild(rk); 
                left.appendChild(nm);
                
                const pts = document.createElement('div'); 
                pts.className = 'lb-points'; 
                pts.textContent = (row.total_points ?? row.points) + ' pts';
                
                li.appendChild(left); 
                li.appendChild(pts);
                lbList.appendChild(li);
            }
        }

        // 2. Renderiza a faixa roxa (Privada com detalhamento completo)
    // 2. Renderiza a faixa roxa (Privada com dados reais do banco)
        if (me) {
            // Fonte aumentada para 13px para melhor leitura no projetor
            const detailStyle = 'font-size: 12px; opacity: 0.9; margin-left: 10px; font-weight: 400;';
            
            // Mapeamento direto das colunas do seu banco
            const likes = me.likes_points || 0;
            const checkouts = me.checkouts_points || 0;
            const pools = me.poll_points || 0;
            const problems = me.exercises_points || 0;

            const details = `Likes: ${likes} ¬∑ Checkouts: ${checkouts} ¬∑ Questions: ${pools} `;

            lbMeEl.innerHTML = `
                <span class="lb-badge-me">
                    Me: #${me.rank} ¬∑ ${me.points} pts 
                    <span style="${detailStyle}">(${details})</span>
                </span>`;
        } else {
            lbMeEl.innerHTML = '';
        }
    }

      if (LB_POLL_MS && Number(LB_POLL_MS) > 0) setInterval(fetchRanking, LB_POLL_MS);
    </script>
    <div id="live-poll-container" style="display:none; z-index:999999; transition: all 0.4s ease;"></div>

    <script>
    (function() {
        const WORKER_URL = "https://course-chat.hcmrtns.workers.dev"; 
        let lastPollId = null;

        // Fun√ß√£o auxiliar para pegar o ID do aluno (Cookie > LocalStorage)
        const getStudentId = () => {
            const cookieSid = document.cookie.split('; ').find(row => row.startsWith('student_id='))?.split('=')[1];
            return cookieSid || localStorage.getItem("studentId") || localStorage.getItem("fs_user") || "guest";
        };

        async function checkPoll() {
            // 1. Tenta encontrar o container. Se n√£o achar, sai sem quebrar o resto do site.
            const pollContainer = document.getElementById('live-poll-container');
            if (!pollContainer) return;

            try {
                const sid = getStudentId();
                const res = await fetch(`${WORKER_URL}/poll/status?student_id=${sid}`);
                const data = await res.json();

                if (!data || data.is_active !== 1) {
                    pollContainer.style.display = 'none';
                    return;
                }

                // Centraliza o container na tela apenas se estiver ativo
                const applyStyle = () => {
                    pollContainer.style.position = 'fixed';
                    pollContainer.style.top = '50%';
                    pollContainer.style.left = '50%';
                    pollContainer.style.transform = 'translate(-50%, -50%)';
                    pollContainer.style.width = '90%';
                    pollContainer.style.maxWidth = '700px';
                    pollContainer.style.display = 'block';
                };

                if (data.show_results === 1) {
                    renderResults(pollContainer, data);
                    applyStyle();
                    return;
                }

                if (!localStorage.getItem('answered_' + data.poll_id)) {
                    if (data.poll_id !== lastPollId) {
                        lastPollId = data.poll_id;
                        renderPoll(pollContainer, data);
                    }
                    applyStyle();
                } else {
                    pollContainer.style.display = 'none';
                }
            } catch (e) { console.warn("Poll check failed:", e); }
        }

        function renderPoll(container, data) {
            const isNumeric = data.poll_type === 'numeric';
            const accentColor = isNumeric ? "#0891b2" : (data.poll_type === 'quiz' ? "#b91c1c" : "#1e3a8a");
            
            let inputHtml = '';
            if (isNumeric) {
                inputHtml = `<input type="number" step="any" id="numeric_answer" placeholder="Ex: 12,34" style="width:100%; padding:12px; border:2px solid #cbd5e1; border-radius:10px; font-size:1.4em; text-align:center;">`;
            } else {
                const options = JSON.parse(data.options_json || '{}');
                for (const [key, val] of Object.entries(options)) {
                    if(!val) continue; 
                    inputHtml += `
                        <label style="display:flex; align-items:center; margin:10px 0; padding:12px; border:1px solid #cbd5e1; border-radius:10px; cursor:pointer; background:#f8fafc;">
                            <input type="radio" name="poll_choice" value="${key}" style="margin-right:12px;"> 
                            <span><strong>${key})</strong> ${val}</span>
                        </label>`;
                }
            }

            container.innerHTML = `
                <div id="poll-inner-card" style="background:white; border-radius:15px; padding:25px; box-shadow:0 25px 50px rgba(0,0,0,0.5); border: 4px solid ${accentColor}; color: #1e293b;">
                    <h3 style="margin:0 0 10px; color:${accentColor};">${isNumeric ? 'üî¢ Numeric' : 'üìä Quiz'}</h3>
                    <p style="font-weight:700; font-size:1.1em;">${data.question}</p>
                    <form id="poll-form">
                        ${inputHtml}
                        <button type="submit" style="width:100%; background:${accentColor}; color:white; border:none; border-radius:8px; padding:15px; font-weight:bold; cursor:pointer; margin-top:15px;">Submit Answer</button>
                    </form>
                </div>`;

            document.getElementById('poll-form').onsubmit = async (e) => {
                e.preventDefault();
                const sid = getStudentId();
                let choice = isNumeric ? document.getElementById('numeric_answer').value : document.querySelector('input[name="poll_choice"]:checked')?.value;
                if (!choice) return;

                await fetch(`${WORKER_URL}/poll/vote`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ student_id: sid, poll_id: data.poll_id, choice: choice })
                });
                localStorage.setItem('answered_' + data.poll_id, 'true');
                checkPoll();
            };
        }

        async function renderResults(container, pollData) {
            const res = await fetch(`${WORKER_URL}/poll/results`);
            const stats = await res.json();
            // ... (L√≥gica de resultados se mant√©m similar, mas usando 'container' passado por argumento)
            container.innerHTML = `<div style="background:white; padding:25px; border-radius:15px; border:4px solid #059669; color: #1e293b;">
                <h3>üìä Results</h3>
                <p>Participations: ${stats.reduce((a,b)=>a+b.count,0)}</p>
                <button onclick="this.closest('#live-poll-container').style.display='none'" style="width:100%; padding:10px; cursor:pointer;">Close</button>
            </div>`;
        }

        // Inicia o loop
        setInterval(checkPoll, 5000);
        // Aguarda um pouco o Quarto carregar o DOM
        setTimeout(checkPoll, 1000);
    })();
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    <script>
      // Redund√¢ncia leve: tamb√©m define o m√≥dulo via JS neste deck
      // (o notices-on-login reconhece body[data-module], localStorage e window.VHCM.module)
      window.VHCM = window.VHCM || {};
      window.VHCM.module = "mod0";

      document.addEventListener('DOMContentLoaded', () => {
        try { localStorage.setItem('mod0','mod0'); } catch(_) {}
      });

      Reveal.on('ready', event => {
        if (event.indexh === 0) {
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
      });
      Reveal.addEventListener('slidechanged', (event) => {
        if (event.indexh === 0) {
          Reveal.configure({ slideNumber: null });
          document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
        }
        if (event.indexh === 1) {
          Reveal.configure({ slideNumber: 'c' });
          document.querySelector("div.has-logo > img.slide-logo").style.display = null;
        }
      });
    </script>
    

</body></html>
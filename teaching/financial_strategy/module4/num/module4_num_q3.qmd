
## Cost of Debt: YTM and After-Tax Adjustment

```{r}
#| eval: true
#| results: asis
#| echo: false
#| warning: false
library(webexercises)

# Randomized bond
set.seed(NULL)
FV <- 1000
years <- sample(4:8, 1)
coupon_rate <- round(runif(1, min = 0.05, max = 0.10), 3)
price <- round(runif(1, min = 900, max = 1020), 0)
tax <- round(runif(1, min = 0.20, max = 0.35), 2)

coupon <- FV * coupon_rate

# Approximate YTM formula (decent for learning):
ytm_approx <- (coupon + (FV - price)/years) / ((FV + price)/2)
ytm_pct <- round(100*ytm_approx, 2)
after_tax_rd <- ytm_approx * (1 - tax)
after_tax_rd_pct <- round(100*after_tax_rd, 2)
```

A bond with face value \$`r FV`, **coupon rate = `r round(100*coupon_rate,2)`**% (annual), **price = \$`r price`**, and **maturity = `r years`** years.  
Compute the **approximate YTM**.

::: {.question-block}
<form onsubmit="event.preventDefault();" style="display: flex; flex-direction: row; gap: 6px;">
  <label for="module4_num_q3a"><strong>1. Approximate YTM (in %):</strong></label>
  <input type="number" id="module4_num_q3a" name="module4_num_q3a" placeholder="Enter value" style="width: 150px;"
         data-correct-answer=`r ytm_pct` data-tolerance="0.05" />
</form>

<div id="feedback-module4_num_q3a" class="feedback" data-status="" style="display:none;">
✅ **Idea:** The YTM is the bondholder’s **required return** if coupons are reinvested at the same rate.  
A handy approximation is: YTM ≈ (Coupon + (FV − Price)/n) ÷ ((FV + Price)/2).  
**Your numbers:** ≈ (`r round(coupon,2)` + (`r FV` − `r price`)/`r years`) ÷ ((`r FV` + `r price`)/2) = **`r ytm_pct`%**.
</div>
:::

If the **corporate tax rate** is **`r round(100*tax,2)`**%, compute the **after-tax cost of debt**.

::: {.question-block}
<form onsubmit="event.preventDefault();" style="display: flex; flex-direction: row; gap: 6px;">
  <label for="module4_num_q3b"><strong>2. After-tax cost of debt (in %):</strong></label>
  <input type="number" id="module4_num_q3b" name="module4_num_q3b" placeholder="Enter value" style="width: 150px;"
         data-correct-answer=`r after_tax_rd_pct` data-tolerance="0.05" />
</form>

<div id="feedback-module4_num_q3b" class="feedback" data-status="" style="display:none;">
✅ **Why lower after tax?** Interest is tax-deductible, so the effective cost is **Rd × (1 − T)**.  
**Your numbers:** `r ytm_pct`% × (1 − `r round(100*tax,2)`%) = **`r after_tax_rd_pct`%**.
</div>
:::

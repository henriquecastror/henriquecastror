<style>
  .notice-modal-backdrop {
    position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4);
    display: none; align-items: center; justify-content: center;
    z-index: 2147483647;
  }
  .notice-modal {
    width: min(92vw, 500px); background: #fff; border-radius: 16px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
    padding: 24px; font-family: system-ui, -apple-system, sans-serif;
    border: 1px solid rgba(0, 0, 0, 0.08);
  }
  .notice-title { font-size: 1.25rem; font-weight: 700; margin: 0 0 10px; color: #1e3a8a; }
  .notice-body { color: #334155; line-height: 1.6; font-size: 1rem; }
  .notice-actions { display: flex; justify-content: flex-end; margin-top: 20px; }
  .notice-btn {
    padding: 10px 24px; border-radius: 8px; font-weight: 600;
    border: none; background: #1e3a8a; color: #fff; cursor: pointer;
    transition: background 0.2s;
  }
  .notice-btn:hover { background: #172e6b; }
</style>

<div class="notice-modal-backdrop" id="noticeBackdrop" aria-hidden="true">
  <div class="notice-modal" role="dialog" aria-modal="true">
    <div class="notice-title" id="noticeTitle">Notice</div>
    <div class="notice-body" id="noticeBody"></div>
    <div class="notice-actions">
      <button class="notice-btn" id="noticeOkBtn" type="button">Got it!</button>
    </div>
  </div>
</div>

<script>
(function(){
  const API_BASE = 'https://course-chat.hcmrtns.workers.dev';
  
  async function checkNotices() {
    const sid = localStorage.getItem('studentId') || '';
    if (!sid) return;

    try {
      const res = await fetch(`${API_BASE}/auth/notices/get?studentId=${sid}`);
      const data = await res.json();

      if (data.ok && data.hasNotice) {
        displayNotice(data.notice, sid);
      }
    } catch (e) { console.error("Notice check failed", e); }
  }

  function displayNotice(notice, sid) {
    const backdrop = document.getElementById('noticeBackdrop');
    const title = document.getElementById('noticeTitle');
    const body = document.getElementById('noticeBody');
    const btn = document.getElementById('noticeOkBtn');

    title.textContent = notice.title;
    body.innerHTML = notice.message_html;
    backdrop.style.display = 'flex';

    btn.onclick = async () => {
      // Registrar "visto" na D1
      fetch(`${API_BASE}/auth/notices/ack?studentId=${sid}&notice_id=${notice.notice_id}`);
      backdrop.style.display = 'none';
    };
  }

  if (document.readyState === 'complete') checkNotices();
  else window.addEventListener('load', checkNotices);
})();
</script>